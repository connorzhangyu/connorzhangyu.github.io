<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Java on Hello World</title><link>https://connorzhangyu.com/categories/java/</link><description>Recent content in Java on Hello World</description><generator>Hugo -- gohugo.io</generator><language>zh</language><lastBuildDate>Sun, 03 Mar 2024 21:19:09 +0000</lastBuildDate><atom:link href="https://connorzhangyu.com/categories/java/index.xml" rel="self" type="application/rss+xml"/><item><title>SpringCloud</title><link>https://connorzhangyu.com/posts/springcloud/</link><pubDate>Sun, 03 Mar 2024 21:19:09 +0000</pubDate><guid>https://connorzhangyu.com/posts/springcloud/</guid><description/><content/></item><item><title>Netty</title><link>https://connorzhangyu.com/posts/netty/</link><pubDate>Sun, 10 Dec 2023 19:03:58 +0000</pubDate><guid>https://connorzhangyu.com/posts/netty/</guid><description>&lt;p>Server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠ NettyServer çš„åˆ›å»ºäº¤ç»™ Spring ç®¡ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyServer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Logger logger &lt;span style="color:#f92672">=&lt;/span> LoggerFactory.&lt;span style="color:#a6e22e">getLogger&lt;/span>(getClass());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Value&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;${netty.port}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> NettyServerHandlerInitializer nettyServerHandlerInitializer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// boss çº¿ç¨‹ç»„ï¼Œç”¨äºŽæœåŠ¡ç«¯æŽ¥å—å®¢æˆ·ç«¯çš„è¿žæŽ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> EventLoopGroup bossGroup &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// worker çº¿ç¨‹ç»„ï¼Œç”¨äºŽæœåŠ¡ç«¯æŽ¥å—å®¢æˆ·ç«¯çš„æ•°æ®è¯»å†™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> EventLoopGroup workerGroup &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Netty Server Channel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Channel channel;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯åŠ¨ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostConstruct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">start&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»º ServerBootstrap å¯¹è±¡ï¼Œç”¨äºŽ Netty Server å¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerBootstrap bootstrap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerBootstrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½® ServerBootstrap çš„å„ç§å±žæ€§&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®ä¸¤ä¸ª EventLoopGroup å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bootstrap.&lt;span style="color:#a6e22e">group&lt;/span>(bossGroup, workerGroup)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŒ‡å®š Channel ä¸ºæœåŠ¡ç«¯ NioServerSocketChannel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½® Netty Server çš„ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">localAddress&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> InetSocketAddress(port))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœåŠ¡ç«¯ accept é˜Ÿåˆ—çš„å¤§å°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">option&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">SO_BACKLOG&lt;/span>, 1024)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TCP Keepalive æœºåˆ¶ï¼Œå®žçŽ° TCP å±‚çº§çš„å¿ƒè·³ä¿æ´»åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childOption&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">SO_KEEPALIVE&lt;/span>, &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…è®¸è¾ƒå°çš„æ•°æ®åŒ…çš„å‘é€ï¼Œé™ä½Žå»¶è¿Ÿ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childOption&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">TCP_NODELAY&lt;/span>, &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childHandler&lt;/span>(nettyServerHandlerInitializer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç»‘å®šç«¯å£ï¼Œå¹¶åŒæ­¥ç­‰å¾…æˆåŠŸï¼Œå³å¯åŠ¨æœåŠ¡ç«¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChannelFuture future &lt;span style="color:#f92672">=&lt;/span> bootstrap.&lt;span style="color:#a6e22e">bind&lt;/span>().&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (future.&lt;span style="color:#a6e22e">isSuccess&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> channel &lt;span style="color:#f92672">=&lt;/span> future.&lt;span style="color:#a6e22e">channel&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;[start][Netty Server å¯åŠ¨åœ¨ {} ç«¯å£]&amp;#34;&lt;/span>, port);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é—­ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PreDestroy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">shutdown&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é—­ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (channel &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> channel.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &amp;lt;3.2&amp;gt; ä¼˜é›…å…³é—­ä¸¤ä¸ª EventLoopGroup å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bossGroup.&lt;span style="color:#a6e22e">shutdownGracefully&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> workerGroup.&lt;span style="color:#a6e22e">shutdownGracefully&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>NettyServerHandlerInitializer&lt;/p></description><content>&lt;p>Server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠ NettyServer çš„åˆ›å»ºäº¤ç»™ Spring ç®¡ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyServer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Logger logger &lt;span style="color:#f92672">=&lt;/span> LoggerFactory.&lt;span style="color:#a6e22e">getLogger&lt;/span>(getClass());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Value&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;${netty.port}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> NettyServerHandlerInitializer nettyServerHandlerInitializer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// boss çº¿ç¨‹ç»„ï¼Œç”¨äºŽæœåŠ¡ç«¯æŽ¥å—å®¢æˆ·ç«¯çš„è¿žæŽ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> EventLoopGroup bossGroup &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// worker çº¿ç¨‹ç»„ï¼Œç”¨äºŽæœåŠ¡ç«¯æŽ¥å—å®¢æˆ·ç«¯çš„æ•°æ®è¯»å†™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> EventLoopGroup workerGroup &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Netty Server Channel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Channel channel;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯åŠ¨ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostConstruct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">start&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»º ServerBootstrap å¯¹è±¡ï¼Œç”¨äºŽ Netty Server å¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerBootstrap bootstrap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerBootstrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½® ServerBootstrap çš„å„ç§å±žæ€§&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®ä¸¤ä¸ª EventLoopGroup å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bootstrap.&lt;span style="color:#a6e22e">group&lt;/span>(bossGroup, workerGroup)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŒ‡å®š Channel ä¸ºæœåŠ¡ç«¯ NioServerSocketChannel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½® Netty Server çš„ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">localAddress&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> InetSocketAddress(port))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœåŠ¡ç«¯ accept é˜Ÿåˆ—çš„å¤§å°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">option&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">SO_BACKLOG&lt;/span>, 1024)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TCP Keepalive æœºåˆ¶ï¼Œå®žçŽ° TCP å±‚çº§çš„å¿ƒè·³ä¿æ´»åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childOption&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">SO_KEEPALIVE&lt;/span>, &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…è®¸è¾ƒå°çš„æ•°æ®åŒ…çš„å‘é€ï¼Œé™ä½Žå»¶è¿Ÿ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childOption&lt;/span>(ChannelOption.&lt;span style="color:#a6e22e">TCP_NODELAY&lt;/span>, &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childHandler&lt;/span>(nettyServerHandlerInitializer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç»‘å®šç«¯å£ï¼Œå¹¶åŒæ­¥ç­‰å¾…æˆåŠŸï¼Œå³å¯åŠ¨æœåŠ¡ç«¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChannelFuture future &lt;span style="color:#f92672">=&lt;/span> bootstrap.&lt;span style="color:#a6e22e">bind&lt;/span>().&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (future.&lt;span style="color:#a6e22e">isSuccess&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> channel &lt;span style="color:#f92672">=&lt;/span> future.&lt;span style="color:#a6e22e">channel&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;[start][Netty Server å¯åŠ¨åœ¨ {} ç«¯å£]&amp;#34;&lt;/span>, port);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é—­ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PreDestroy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">shutdown&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é—­ Netty Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (channel &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> channel.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &amp;lt;3.2&amp;gt; ä¼˜é›…å…³é—­ä¸¤ä¸ª EventLoopGroup å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bossGroup.&lt;span style="color:#a6e22e">shutdownGracefully&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> workerGroup.&lt;span style="color:#a6e22e">shutdownGracefully&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>NettyServerHandlerInitializer&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyServerHandlerInitializer&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> ChannelInitializer&lt;span style="color:#f92672">&amp;lt;&lt;/span>Channel&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å¿ƒè·³è¶…æ—¶æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> Integer READ_TIMEOUT_SECONDS &lt;span style="color:#f92672">=&lt;/span> 3 &lt;span style="color:#f92672">*&lt;/span> 60;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> NettyServerHandler nettyServerHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initChannel&lt;/span>(Channel ch) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å¾— Channel å¯¹åº”çš„ ChannelPipeline&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChannelPipeline channelPipeline &lt;span style="color:#f92672">=&lt;/span> ch.&lt;span style="color:#a6e22e">pipeline&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ·»åŠ ä¸€å † NettyServerHandler åˆ° ChannelPipeline ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> channelPipeline
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç©ºé—²æ£€æµ‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ReadTimeoutHandler(READ_TIMEOUT_SECONDS, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç¼–ç å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> InvocationEncoder())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è§£ç å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> InvocationDecoder())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¶ˆæ¯åˆ†å‘å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">addLast&lt;/span>(messageDispatcher)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœåŠ¡ç«¯å¤„ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">addLast&lt;/span>(nettyServerHandler)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ¨¡æ‹Ÿå¯åŠ¨netty">æ¨¡æ‹Ÿå¯åŠ¨Netty&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>ChannelFuture future &lt;span style="color:#f92672">=&lt;/span> bootstrap.&lt;span style="color:#a6e22e">bind&lt;/span>(port).&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Netty ä»£ç†æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> port);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.&lt;span style="color:#a6e22e">channel&lt;/span>().&lt;span style="color:#a6e22e">closeFuture&lt;/span>().&lt;span style="color:#a6e22e">sync&lt;/span>(); &lt;span style="color:#75715e">// é˜»å¡žç›´åˆ°å…³é—­&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyTest&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RiceCooker cooker &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RiceCooker();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¨¡æ‹Ÿ bootstrap.bind().sync()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cooker.&lt;span style="color:#a6e22e">start&lt;/span>(); &lt;span style="color:#75715e">// å¯åŠ¨ï¼ˆé˜»å¡žç›´åˆ°å‡†å¤‡å¥½ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¨¡æ‹Ÿ future.channel().closeFuture().sync()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(() &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(5000); &lt;span style="color:#75715e">// æ¨¡æ‹Ÿ5ç§’åŽç…®å¥½é¥­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cooker.&lt;span style="color:#a6e22e">close&lt;/span>(); &lt;span style="color:#75715e">// è‡ªåŠ¨å…³é—­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (InterruptedException ignored) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cooker.&lt;span style="color:#a6e22e">waitUntilClosed&lt;/span>(); &lt;span style="color:#75715e">// é˜»å¡žï¼Œç›´åˆ°å…³é—­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RiceCooker&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isStarted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isClosed &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯åŠ¨ç”µé¥­ç…²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">start&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¯åŠ¨ç”µé¥­ç…²...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(1000); &lt;span style="color:#75715e">// æ¨¡æ‹Ÿå‡†å¤‡æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isStarted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç”µé¥­ç…²å¼€å§‹ç…®é¥­ï¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…â€œç…®é¥­å®Œæˆâ€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">waitUntilClosed&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>isClosed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(500); &lt;span style="color:#75715e">// ç­‰å¾…çŠ¶æ€å˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç…®é¥­å®Œæˆï¼Œç”µé¥­ç…²å…³é—­ã€‚&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">close&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isClosed &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç²˜åŒ…">ç²˜åŒ…&lt;/h2>
&lt;h3 id="æ¨¡æ‹Ÿç²˜åŒ…é—®é¢˜">æ¨¡æ‹Ÿç²˜åŒ…é—®é¢˜&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyServer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EventLoopGroup boss &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EventLoopGroup worker &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerBootstrap b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerBootstrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.&lt;span style="color:#a6e22e">group&lt;/span>(boss, worker)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childHandler&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ChannelInitializer&lt;span style="color:#f92672">&amp;lt;&lt;/span>SocketChannel&lt;span style="color:#f92672">&amp;gt;&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initChannel&lt;/span>(SocketChannel ch) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChannelPipeline pipeline &lt;span style="color:#f92672">=&lt;/span> ch.&lt;span style="color:#a6e22e">pipeline&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ðŸ‘‡ æ²¡æœ‰æ‹†åŒ…å¤„ç†å™¨ï¼Œç²˜åŒ…å°†å‡ºçŽ°ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pipeline.&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ServerHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.&lt;span style="color:#a6e22e">bind&lt;/span>(8080).&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Server started on port 8080&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ServerHandler&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> SimpleChannelInboundHandler&lt;span style="color:#f92672">&amp;lt;&lt;/span>ByteBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">channelRead0&lt;/span>(ChannelHandlerContext ctx, ByteBuf msg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String received &lt;span style="color:#f92672">=&lt;/span> msg.&lt;span style="color:#a6e22e">toString&lt;/span>(CharsetUtil.&lt;span style="color:#a6e22e">UTF_8&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ•°æ®é•¿åº¦ï¼š&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> msg.&lt;span style="color:#a6e22e">readableBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;åŽŸå§‹æ•°æ®: [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> received &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyClient&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EventLoopGroup group &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Bootstrap bootstrap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Bootstrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bootstrap.&lt;span style="color:#a6e22e">group&lt;/span>(group)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">channel&lt;/span>(NioSocketChannel.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">handler&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ChannelInitializer&lt;span style="color:#f92672">&amp;lt;&lt;/span>SocketChannel&lt;span style="color:#f92672">&amp;gt;&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initChannel&lt;/span>(SocketChannel ch) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ch.&lt;span style="color:#a6e22e">pipeline&lt;/span>().&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ChannelInboundHandlerAdapter() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">channelActive&lt;/span>(ChannelHandlerContext ctx) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿žç»­å‘å¤šæ¡æ¶ˆæ¯ï¼Œç²˜åŒ…ä¸€å®šä¼šå‡ºçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 5; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;msg&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctx.&lt;span style="color:#a6e22e">writeAndFlush&lt;/span>(Unpooled.&lt;span style="color:#a6e22e">copiedBuffer&lt;/span>(msg, CharsetUtil.&lt;span style="color:#a6e22e">UTF_8&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bootstrap.&lt;span style="color:#a6e22e">connect&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;127.0.0.1&amp;#34;&lt;/span>, 8080).&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡ç«¯æ‰“å°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>Server started on port &lt;span style="color:#ae81ff">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š25
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msg1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msg2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msg3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msg4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œé”™è¯¯æƒ…å†µ,æ­£å¸¸æƒ…å†µåº”è¯¥æ˜¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®:&lt;span style="color:#f92672">[&lt;/span>msg0&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®:&lt;span style="color:#f92672">[&lt;/span>msg1&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®:&lt;span style="color:#f92672">[&lt;/span>msg2&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.....
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ–¹æ¡ˆ1æ¢è¡Œç¬¦æˆ–è‡ªå®šä¹‰åˆ†éš”ç¬¦">æ–¹æ¡ˆ1:æ¢è¡Œç¬¦æˆ–è‡ªå®šä¹‰åˆ†éš”ç¬¦&lt;/h3>
&lt;p>åœ¨æœåŠ¡ç«¯é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŒ‰ \n æ‹†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">new&lt;/span> LineBasedFrameDecoder(1024);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŒ‰ &amp;#34;--&amp;#34; æ‹†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">new&lt;/span> DelimiterBasedFrameDecoder(1024, Unpooled.&lt;span style="color:#a6e22e">wrappedBuffer&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;--&amp;#34;&lt;/span>.&lt;span style="color:#a6e22e">getBytes&lt;/span>()));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NettyServer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EventLoopGroup boss &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EventLoopGroup worker &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NioEventLoopGroup();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerBootstrap b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerBootstrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.&lt;span style="color:#a6e22e">group&lt;/span>(boss, worker)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">childHandler&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ChannelInitializer&lt;span style="color:#f92672">&amp;lt;&lt;/span>SocketChannel&lt;span style="color:#f92672">&amp;gt;&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initChannel&lt;/span>(SocketChannel ch) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ChannelPipeline pipeline &lt;span style="color:#f92672">=&lt;/span> ch.&lt;span style="color:#a6e22e">pipeline&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pipeline.&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> LineBasedFrameDecoder(1024));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// pipeline.addLast(new DelimiterBasedFrameDecoder(1024, Unpooled.wrappedBuffer(&amp;#34;--&amp;#34;.getBytes())));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ðŸ‘‡ æ²¡æœ‰æ‹†åŒ…å¤„ç†å™¨ï¼Œç²˜åŒ…å°†å‡ºçŽ°ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pipeline.&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ServerHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.&lt;span style="color:#a6e22e">bind&lt;/span>(8080).&lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Server started on port 8080&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ServerHandler&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> SimpleChannelInboundHandler&lt;span style="color:#f92672">&amp;lt;&lt;/span>ByteBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">channelRead0&lt;/span>(ChannelHandlerContext ctx, ByteBuf msg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String received &lt;span style="color:#f92672">=&lt;/span> msg.&lt;span style="color:#a6e22e">toString&lt;/span>(CharsetUtil.&lt;span style="color:#a6e22e">UTF_8&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ•°æ®é•¿åº¦ï¼š&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> msg.&lt;span style="color:#a6e22e">readableBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;åŽŸå§‹æ•°æ®: [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> received &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŽ§åˆ¶å°æ‰“å°,è¿™æ˜¯æ­£å¸¸çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>Server started on port &lt;span style="color:#ae81ff">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg0&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg1&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg2&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg3&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æ•°æ®é•¿åº¦ï¼š4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åŽŸå§‹æ•°æ®: &lt;span style="color:#f92672">[&lt;/span>msg4&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ–¹æ¡ˆ2å›ºå®šé•¿åº¦">æ–¹æ¡ˆ2:å›ºå®šé•¿åº¦&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å®¢æˆ·ç«¯æ¯æ¡æ¶ˆæ¯å¿…é¡»æ­£å¥½ 8 å­—èŠ‚ï¼Œå¦åˆ™è§£æžé”™ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pipeline.&lt;span style="color:#a6e22e">addLast&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> FixedLengthFrameDecoder(8));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ–¹æ¡ˆä¸‰lengthfieldbasedframedecoder">æ–¹æ¡ˆä¸‰ï¼šLengthFieldBasedFrameDecoder&lt;/h3></content></item><item><title>ä»£ç ç‰‡æ®µ</title><link>https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</link><pubDate>Sun, 24 Sep 2023 21:19:38 +0000</pubDate><guid>https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</guid><description>&lt;h1 id="è°·æ­ŒéªŒè¯ç ">è°·æ­ŒéªŒè¯ç &lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.warrenstrange&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>googleauth&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>1.5.0&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> utils;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.warrenstrange.googleauth.GoogleAuthenticator;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.warrenstrange.googleauth.GoogleAuthenticatorKey;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.UnsupportedEncodingException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.net.URLEncoder;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">GoogleAuthUtil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç”Ÿæˆkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String &lt;span style="color:#a6e22e">generaKey&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticator gAuth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> GoogleAuthenticator();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticatorKey key &lt;span style="color:#f92672">=&lt;/span> gAuth.&lt;span style="color:#a6e22e">createCredentials&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> key.&lt;span style="color:#a6e22e">getKey&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç”ŸæˆäºŒç»´ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param key ç”Ÿæˆçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param issuer appä¸Štitleåå­— æœåŠ¡åç§° å¦‚: Google Github å°è±¡ç¬”è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param account appä¸Štitleåå­—(æ‹¬å·é‡Œçš„) ç”¨æˆ·è´¦æˆ· å¦‚: example@domain.com 138XXXXXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String &lt;span style="color:#a6e22e">createGoogleAuthQRCodeData&lt;/span>(String key, String account,String issuer) &lt;span style="color:#66d9ef">throws&lt;/span> UnsupportedEncodingException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;otpauth://totp/%s?secret=%s&amp;amp;issuer=%s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(issuer &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> account, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(key, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(issuer, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> UnsupportedEncodingException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s &lt;span style="color:#f92672">=&lt;/span> generaKey();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(s);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String googleAuthQRCodeData &lt;span style="color:#f92672">=&lt;/span> createGoogleAuthQRCodeData(s, &lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;V16&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(googleAuthQRCodeData);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param key ç”Ÿæˆçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param code ç”¨æˆ·è¾“å…¥çš„é¢è†œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">check&lt;/span>(String key,Integer code){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticator gAuth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> GoogleAuthenticator();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®ç”¨æˆ·å¯†é’¥å’Œç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼ŒéªŒè¯æ˜¯å¦ä¸€è‡´ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isCodeValid &lt;span style="color:#f92672">=&lt;/span> gAuth.&lt;span style="color:#a6e22e">authorize&lt;/span>(key, code);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> isCodeValid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å›¾ç‰‡éªŒè¯ç ">å›¾ç‰‡éªŒè¯ç &lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.github.whvcse&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>easy-captcha&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>1.6.2&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@ApiOperation&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;èŽ·å–éªŒè¯ç &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/getVerify&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> Response&lt;span style="color:#f92672">&amp;lt;&lt;/span>Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getVerify&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SpecCaptcha specCaptcha &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SpecCaptcha(130, 48, 6);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> specCaptcha.&lt;span style="color:#a6e22e">setFont&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> Font(&lt;span style="color:#e6db74">&amp;#34;Default&amp;#34;&lt;/span>, Font.&lt;span style="color:#a6e22e">PLAIN&lt;/span>, 32));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String verCode &lt;span style="color:#f92672">=&lt;/span> specCaptcha.&lt;span style="color:#a6e22e">text&lt;/span>().&lt;span style="color:#a6e22e">toLowerCase&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String key &lt;span style="color:#f92672">=&lt;/span> UUID.&lt;span style="color:#a6e22e">randomUUID&lt;/span>().&lt;span style="color:#a6e22e">toString&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> stringStringHash &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringStringHash.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;uuid&amp;#34;&lt;/span>, key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringStringHash.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;img&amp;#34;&lt;/span>, specCaptcha.&lt;span style="color:#a6e22e">toBase64&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> key &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;login_code:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> key;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redisDao.&lt;span style="color:#a6e22e">setString&lt;/span>(key, verCode);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redisDao.&lt;span style="color:#a6e22e">expire&lt;/span>(key, 2, TimeUnit.&lt;span style="color:#a6e22e">MINUTES&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Response.&lt;span style="color:#a6e22e">successData&lt;/span>(stringStringHash);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(&lt;span style="color:#e6db74">&amp;#34;éªŒè¯ç ç”Ÿæˆå¤±è´¥&amp;#34;&lt;/span>, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="åŽä¸ºäº‘ä¸Šä¼ å›¾ç‰‡">åŽä¸ºäº‘ä¸Šä¼ å›¾ç‰‡&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.huaweicloud&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>esdk-obs-java-bundle&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>3.23.9.1&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.ObsClient;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.ObsConfiguration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.exception.ObsException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.model.*;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.InputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SimpleMultipartUploadSample&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šå¸¸ä¸€ä¸ªé“¾æŽ¥æ˜¯ https://æ¡¶çš„åå­—.obs.ap-southeast-1.myhuaweicloud.com/èµ„æºè·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String endPoint &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;https://obs.ap-southeast-1.myhuaweicloud.com&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String ak &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;xxxx&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String sk &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;xxxx&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> ObsClient obsClient;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String bucketName &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ¡¶çš„åå­—&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">upload&lt;/span>(String objectKey, InputStream file) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ObsConfiguration config &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ObsConfiguration();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setSocketTimeout&lt;/span>(30000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setConnectionTimeout&lt;/span>(10000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setEndPoint&lt;/span>(endPoint);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ObsClient(ak, sk, config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 1: initiate multipart upload \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InitiateMultipartUploadRequest request &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> InitiateMultipartUploadRequest();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> request.&lt;span style="color:#a6e22e">setBucketName&lt;/span>(bucketName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> request.&lt;span style="color:#a6e22e">setObjectKey&lt;/span>(objectKey);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InitiateMultipartUploadResult result &lt;span style="color:#f92672">=&lt;/span> obsClient.&lt;span style="color:#a6e22e">initiateMultipartUpload&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 2: upload part \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UploadPartResult uploadPartResult &lt;span style="color:#f92672">=&lt;/span> obsClient.&lt;span style="color:#a6e22e">uploadPart&lt;/span>(bucketName, objectKey, result.&lt;span style="color:#a6e22e">getUploadId&lt;/span>(), 1, file);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 3: complete multipart upload \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompleteMultipartUploadRequest completeMultipartUploadRequest &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> CompleteMultipartUploadRequest();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setBucketName&lt;/span>(bucketName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setObjectKey&lt;/span>(objectKey);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setUploadId&lt;/span>(result.&lt;span style="color:#a6e22e">getUploadId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PartEtag partEtag &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> PartEtag();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> partEtag.&lt;span style="color:#a6e22e">setPartNumber&lt;/span>(uploadPartResult.&lt;span style="color:#a6e22e">getPartNumber&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> partEtag.&lt;span style="color:#a6e22e">setEtag&lt;/span>(uploadPartResult.&lt;span style="color:#a6e22e">getEtag&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">getPartEtag&lt;/span>().&lt;span style="color:#a6e22e">add&lt;/span>(partEtag);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient.&lt;span style="color:#a6e22e">completeMultipartUpload&lt;/span>(completeMultipartUploadRequest);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (ObsException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Response Code: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getResponseCode&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error Message: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorMessage&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error Code: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorCode&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Request ID: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorRequestId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Host ID: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorHostId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (obsClient &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (IOException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description><content>&lt;h1 id="è°·æ­ŒéªŒè¯ç ">è°·æ­ŒéªŒè¯ç &lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.warrenstrange&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>googleauth&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>1.5.0&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> utils;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.warrenstrange.googleauth.GoogleAuthenticator;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.warrenstrange.googleauth.GoogleAuthenticatorKey;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.UnsupportedEncodingException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.net.URLEncoder;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">GoogleAuthUtil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç”Ÿæˆkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String &lt;span style="color:#a6e22e">generaKey&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticator gAuth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> GoogleAuthenticator();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticatorKey key &lt;span style="color:#f92672">=&lt;/span> gAuth.&lt;span style="color:#a6e22e">createCredentials&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> key.&lt;span style="color:#a6e22e">getKey&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç”ŸæˆäºŒç»´ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param key ç”Ÿæˆçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param issuer appä¸Štitleåå­— æœåŠ¡åç§° å¦‚: Google Github å°è±¡ç¬”è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param account appä¸Štitleåå­—(æ‹¬å·é‡Œçš„) ç”¨æˆ·è´¦æˆ· å¦‚: example@domain.com 138XXXXXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String &lt;span style="color:#a6e22e">createGoogleAuthQRCodeData&lt;/span>(String key, String account,String issuer) &lt;span style="color:#66d9ef">throws&lt;/span> UnsupportedEncodingException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;otpauth://totp/%s?secret=%s&amp;amp;issuer=%s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(issuer &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> account, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(key, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URLEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(issuer, &lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;+&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;%20&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> UnsupportedEncodingException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s &lt;span style="color:#f92672">=&lt;/span> generaKey();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(s);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String googleAuthQRCodeData &lt;span style="color:#f92672">=&lt;/span> createGoogleAuthQRCodeData(s, &lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;V16&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(googleAuthQRCodeData);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param key ç”Ÿæˆçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param code ç”¨æˆ·è¾“å…¥çš„é¢è†œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">check&lt;/span>(String key,Integer code){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GoogleAuthenticator gAuth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> GoogleAuthenticator();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®ç”¨æˆ·å¯†é’¥å’Œç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼ŒéªŒè¯æ˜¯å¦ä¸€è‡´ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isCodeValid &lt;span style="color:#f92672">=&lt;/span> gAuth.&lt;span style="color:#a6e22e">authorize&lt;/span>(key, code);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> isCodeValid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å›¾ç‰‡éªŒè¯ç ">å›¾ç‰‡éªŒè¯ç &lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.github.whvcse&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>easy-captcha&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>1.6.2&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@ApiOperation&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;èŽ·å–éªŒè¯ç &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/getVerify&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> Response&lt;span style="color:#f92672">&amp;lt;&lt;/span>Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getVerify&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SpecCaptcha specCaptcha &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SpecCaptcha(130, 48, 6);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> specCaptcha.&lt;span style="color:#a6e22e">setFont&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> Font(&lt;span style="color:#e6db74">&amp;#34;Default&amp;#34;&lt;/span>, Font.&lt;span style="color:#a6e22e">PLAIN&lt;/span>, 32));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String verCode &lt;span style="color:#f92672">=&lt;/span> specCaptcha.&lt;span style="color:#a6e22e">text&lt;/span>().&lt;span style="color:#a6e22e">toLowerCase&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String key &lt;span style="color:#f92672">=&lt;/span> UUID.&lt;span style="color:#a6e22e">randomUUID&lt;/span>().&lt;span style="color:#a6e22e">toString&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> stringStringHash &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringStringHash.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;uuid&amp;#34;&lt;/span>, key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringStringHash.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;img&amp;#34;&lt;/span>, specCaptcha.&lt;span style="color:#a6e22e">toBase64&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> key &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;login_code:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> key;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redisDao.&lt;span style="color:#a6e22e">setString&lt;/span>(key, verCode);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redisDao.&lt;span style="color:#a6e22e">expire&lt;/span>(key, 2, TimeUnit.&lt;span style="color:#a6e22e">MINUTES&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Response.&lt;span style="color:#a6e22e">successData&lt;/span>(stringStringHash);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(&lt;span style="color:#e6db74">&amp;#34;éªŒè¯ç ç”Ÿæˆå¤±è´¥&amp;#34;&lt;/span>, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="åŽä¸ºäº‘ä¸Šä¼ å›¾ç‰‡">åŽä¸ºäº‘ä¸Šä¼ å›¾ç‰‡&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.huaweicloud&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>esdk-obs-java-bundle&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>3.23.9.1&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.ObsClient;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.ObsConfiguration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.exception.ObsException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.obs.services.model.*;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.InputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SimpleMultipartUploadSample&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šå¸¸ä¸€ä¸ªé“¾æŽ¥æ˜¯ https://æ¡¶çš„åå­—.obs.ap-southeast-1.myhuaweicloud.com/èµ„æºè·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String endPoint &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;https://obs.ap-southeast-1.myhuaweicloud.com&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String ak &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;xxxx&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String sk &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;xxxx&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> ObsClient obsClient;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> String bucketName &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ¡¶çš„åå­—&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">upload&lt;/span>(String objectKey, InputStream file) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ObsConfiguration config &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ObsConfiguration();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setSocketTimeout&lt;/span>(30000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setConnectionTimeout&lt;/span>(10000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">setEndPoint&lt;/span>(endPoint);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ObsClient(ak, sk, config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 1: initiate multipart upload \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InitiateMultipartUploadRequest request &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> InitiateMultipartUploadRequest();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> request.&lt;span style="color:#a6e22e">setBucketName&lt;/span>(bucketName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> request.&lt;span style="color:#a6e22e">setObjectKey&lt;/span>(objectKey);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InitiateMultipartUploadResult result &lt;span style="color:#f92672">=&lt;/span> obsClient.&lt;span style="color:#a6e22e">initiateMultipartUpload&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 2: upload part \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UploadPartResult uploadPartResult &lt;span style="color:#f92672">=&lt;/span> obsClient.&lt;span style="color:#a6e22e">uploadPart&lt;/span>(bucketName, objectKey, result.&lt;span style="color:#a6e22e">getUploadId&lt;/span>(), 1, file);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Step 3: complete multipart upload \n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompleteMultipartUploadRequest completeMultipartUploadRequest &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> CompleteMultipartUploadRequest();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setBucketName&lt;/span>(bucketName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setObjectKey&lt;/span>(objectKey);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">setUploadId&lt;/span>(result.&lt;span style="color:#a6e22e">getUploadId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PartEtag partEtag &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> PartEtag();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> partEtag.&lt;span style="color:#a6e22e">setPartNumber&lt;/span>(uploadPartResult.&lt;span style="color:#a6e22e">getPartNumber&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> partEtag.&lt;span style="color:#a6e22e">setEtag&lt;/span>(uploadPartResult.&lt;span style="color:#a6e22e">getEtag&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completeMultipartUploadRequest.&lt;span style="color:#a6e22e">getPartEtag&lt;/span>().&lt;span style="color:#a6e22e">add&lt;/span>(partEtag);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient.&lt;span style="color:#a6e22e">completeMultipartUpload&lt;/span>(completeMultipartUploadRequest);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (ObsException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Response Code: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getResponseCode&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error Message: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorMessage&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error Code: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorCode&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Request ID: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorRequestId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Host ID: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e.&lt;span style="color:#a6e22e">getErrorHostId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (obsClient &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obsClient.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (IOException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>Spring</title><link>https://connorzhangyu.com/posts/spring/</link><pubDate>Fri, 25 Aug 2023 14:58:26 +0000</pubDate><guid>https://connorzhangyu.com/posts/spring/</guid><description>&lt;h1 id="springmvc">SpringMVC&lt;/h1>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051458028.png" alt="">&lt;/p>
&lt;p>æ€»ç»“ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆè¯·æ±‚è¿›å…¥DispatcherServlet ç”±DispatcherServlet ä»ŽHandlerMappingsä¸­æå–å¯¹åº”çš„Handlerã€‚&lt;/li>
&lt;li>2.æ­¤æ—¶åªæ˜¯èŽ·å–åˆ°äº†å¯¹åº”çš„Handleï¼Œç„¶åŽå¾—åŽ»å¯»æ‰¾å¯¹åº”çš„é€‚é…å™¨ï¼Œå³ï¼šHandlerAdapterã€‚&lt;/li>
&lt;li>æ‹¿åˆ°å¯¹åº”HandlerAdapteræ—¶ï¼Œè¿™æ—¶å€™å¼€å§‹è°ƒç”¨å¯¹åº”çš„Handlerå¤„ç†ä¸šåŠ¡é€»è¾‘äº†ã€‚ ï¼ˆè¿™æ—¶å€™å®žé™…ä¸Šå·²ç»æ‰§è¡Œå®Œäº†æˆ‘ä»¬çš„Controllerï¼‰ æ‰§è¡Œå®Œæˆä¹‹åŽè¿”å›žä¸€ä¸ªModeAndView&lt;/li>
&lt;li>è¿™æ—¶å€™äº¤ç»™æˆ‘ä»¬çš„ViewResolveré€šè¿‡è§†å›¾åç§°æŸ¥æ‰¾å‡ºå¯¹åº”çš„è§†å›¾ç„¶åŽè¿”å›žã€‚&lt;/li>
&lt;li>æœ€åŽ æ¸²æŸ“è§†å›¾ è¿”å›žæ¸²æŸ“åŽçš„è§†å›¾ &amp;ndash;&amp;gt;å“åº”è¯·æ±‚ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="åˆå§‹åŒ–è¿‡ç¨‹">åˆå§‹åŒ–è¿‡ç¨‹&lt;/h2>
&lt;p>version 5.3.8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.HttpServletBean#init&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å­ç±»å®žçŽ°,åˆå§‹åŒ–webçŽ¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Let subclasses do whatever initialization they like.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initServletBean();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.FrameworkServlet#initServletBean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initServletBean&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–springä¸Šä¸‹æ–‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> initWebApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å­ç±»å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initFrameworkServlet();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> WebApplicationContext &lt;span style="color:#a6e22e">initWebApplicationContext&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContext rootContext &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContextUtils.&lt;span style="color:#a6e22e">getWebApplicationContext&lt;/span>(getServletContext());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContext wac &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// A context instance was injected at construction time -&amp;gt; use it&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#66d9ef">instanceof&lt;/span> ConfigurableWebApplicationContext) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ConfigurableWebApplicationContext cwac &lt;span style="color:#f92672">=&lt;/span> (ConfigurableWebApplicationContext) wac;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>cwac.&lt;span style="color:#a6e22e">isActive&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The context has not yet been refreshed -&amp;gt; provide services such as&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// setting the parent context, setting the application context id, etc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cwac.&lt;span style="color:#a6e22e">getParent&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The context instance was injected without an explicit parent -&amp;gt; set&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// the root application context (if any; may be null) as the parent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cwac.&lt;span style="color:#a6e22e">setParent&lt;/span>(rootContext);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é…ç½®å’Œåˆ·æ–°springå®¹å™¨ï¼ˆé‡è¦ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//è¿™ä¸ªæ— éžå°±æ˜¯åˆå§‹åŒ–spring iocçš„çŽ¯å¢ƒï¼Œåˆ›å»ºbeanå’Œå®žä¾‹åŒ–beanç­‰æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨refresh()æ–¹æ³•ï¼Œå·²åœ¨springæºç è§£æžä¸­è§£æžè¿‡äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureAndRefreshWebApplicationContext(cwac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// No context instance was injected at construction time -&amp;gt; see if one&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// has been registered in the servlet context. If one exists, it is assumed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// that the parent context (if any) has already been set and that the&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// user has performed any initialization such as setting the context id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> findWebApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// No context instance is defined for this servlet -&amp;gt; create a local one&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> createWebApplicationContext(rootContext);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">refreshEventReceived&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Either the context is not a ConfigurableApplicationContext with refresh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// support or the context injected at construction time had already been&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// refreshed -&amp;gt; trigger initial onRefresh manually here.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">onRefreshMonitor&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–DispatcherServletçš„é…ç½®initStrategies()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> onRefresh(wac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">publishContext&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Publish the context as a servlet context attribute.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String attrName &lt;span style="color:#f92672">=&lt;/span> getServletContextAttributeName();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> getServletContext().&lt;span style="color:#a6e22e">setAttribute&lt;/span>(attrName, wac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> wac;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#onRefresh &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">onRefresh&lt;/span>(ApplicationContext context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// //åˆå§‹åŒ–springmvcçš„é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initStrategies(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ€»ä½“æµç¨‹:&lt;/p></description><content>&lt;h1 id="springmvc">SpringMVC&lt;/h1>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051458028.png" alt="">&lt;/p>
&lt;p>æ€»ç»“ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆè¯·æ±‚è¿›å…¥DispatcherServlet ç”±DispatcherServlet ä»ŽHandlerMappingsä¸­æå–å¯¹åº”çš„Handlerã€‚&lt;/li>
&lt;li>2.æ­¤æ—¶åªæ˜¯èŽ·å–åˆ°äº†å¯¹åº”çš„Handleï¼Œç„¶åŽå¾—åŽ»å¯»æ‰¾å¯¹åº”çš„é€‚é…å™¨ï¼Œå³ï¼šHandlerAdapterã€‚&lt;/li>
&lt;li>æ‹¿åˆ°å¯¹åº”HandlerAdapteræ—¶ï¼Œè¿™æ—¶å€™å¼€å§‹è°ƒç”¨å¯¹åº”çš„Handlerå¤„ç†ä¸šåŠ¡é€»è¾‘äº†ã€‚ ï¼ˆè¿™æ—¶å€™å®žé™…ä¸Šå·²ç»æ‰§è¡Œå®Œäº†æˆ‘ä»¬çš„Controllerï¼‰ æ‰§è¡Œå®Œæˆä¹‹åŽè¿”å›žä¸€ä¸ªModeAndView&lt;/li>
&lt;li>è¿™æ—¶å€™äº¤ç»™æˆ‘ä»¬çš„ViewResolveré€šè¿‡è§†å›¾åç§°æŸ¥æ‰¾å‡ºå¯¹åº”çš„è§†å›¾ç„¶åŽè¿”å›žã€‚&lt;/li>
&lt;li>æœ€åŽ æ¸²æŸ“è§†å›¾ è¿”å›žæ¸²æŸ“åŽçš„è§†å›¾ &amp;ndash;&amp;gt;å“åº”è¯·æ±‚ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="åˆå§‹åŒ–è¿‡ç¨‹">åˆå§‹åŒ–è¿‡ç¨‹&lt;/h2>
&lt;p>version 5.3.8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.HttpServletBean#init&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å­ç±»å®žçŽ°,åˆå§‹åŒ–webçŽ¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Let subclasses do whatever initialization they like.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initServletBean();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.FrameworkServlet#initServletBean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initServletBean&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–springä¸Šä¸‹æ–‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> initWebApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å­ç±»å®žçŽ°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initFrameworkServlet();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> WebApplicationContext &lt;span style="color:#a6e22e">initWebApplicationContext&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContext rootContext &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContextUtils.&lt;span style="color:#a6e22e">getWebApplicationContext&lt;/span>(getServletContext());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebApplicationContext wac &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// A context instance was injected at construction time -&amp;gt; use it&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">webApplicationContext&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#66d9ef">instanceof&lt;/span> ConfigurableWebApplicationContext) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ConfigurableWebApplicationContext cwac &lt;span style="color:#f92672">=&lt;/span> (ConfigurableWebApplicationContext) wac;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>cwac.&lt;span style="color:#a6e22e">isActive&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The context has not yet been refreshed -&amp;gt; provide services such as&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// setting the parent context, setting the application context id, etc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cwac.&lt;span style="color:#a6e22e">getParent&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The context instance was injected without an explicit parent -&amp;gt; set&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// the root application context (if any; may be null) as the parent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cwac.&lt;span style="color:#a6e22e">setParent&lt;/span>(rootContext);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é…ç½®å’Œåˆ·æ–°springå®¹å™¨ï¼ˆé‡è¦ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//è¿™ä¸ªæ— éžå°±æ˜¯åˆå§‹åŒ–spring iocçš„çŽ¯å¢ƒï¼Œåˆ›å»ºbeanå’Œå®žä¾‹åŒ–beanç­‰æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨refresh()æ–¹æ³•ï¼Œå·²åœ¨springæºç è§£æžä¸­è§£æžè¿‡äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureAndRefreshWebApplicationContext(cwac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// No context instance was injected at construction time -&amp;gt; see if one&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// has been registered in the servlet context. If one exists, it is assumed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// that the parent context (if any) has already been set and that the&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// user has performed any initialization such as setting the context id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> findWebApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (wac &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// No context instance is defined for this servlet -&amp;gt; create a local one&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wac &lt;span style="color:#f92672">=&lt;/span> createWebApplicationContext(rootContext);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">refreshEventReceived&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Either the context is not a ConfigurableApplicationContext with refresh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// support or the context injected at construction time had already been&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// refreshed -&amp;gt; trigger initial onRefresh manually here.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">onRefreshMonitor&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–DispatcherServletçš„é…ç½®initStrategies()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> onRefresh(wac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">publishContext&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Publish the context as a servlet context attribute.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String attrName &lt;span style="color:#f92672">=&lt;/span> getServletContextAttributeName();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> getServletContext().&lt;span style="color:#a6e22e">setAttribute&lt;/span>(attrName, wac);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> wac;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#onRefresh &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">onRefresh&lt;/span>(ApplicationContext context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// //åˆå§‹åŒ–springmvcçš„é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initStrategies(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ€»ä½“æµç¨‹:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ‰§è¡ŒDispatcherServletçš„init()æ–¹æ³•ï¼Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¼šæ‰§è¡Œçˆ¶ç±»çš„HttpServletBeançš„init()æ–¹æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶åŽè°ƒç”¨äº†FrameworkServletçš„initServletBean()æ–¹æ³•&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ²¡çœ‹æ‡‚,æ‰§è¡ŒinitWebApplicationContext()æ–¹æ³•ï¼Œå°±æ˜¯å¯¹spring iocçŽ¯å¢ƒçš„åˆå§‹åŒ–ã€‚é‚£ä¹ˆè¿™é‡Œå°±è¡ç”Ÿå‡ºäº†ä¸€ä¸ªé¢è¯•é¢˜ï¼šspringå®¹å™¨å’Œspring mvcçš„å®¹å™¨çš„åŒºåˆ«ï¼Ÿé€šè¿‡æºç çš„åˆ†æžï¼Œspringå’Œspring mvcåº•å±‚ï¼Œéƒ½æ˜¯è°ƒç”¨äº†åŒä¸€ä¸ªrefresh()æ–¹æ³•ï¼Œæ‰€ä»¥springå®¹å™¨å’Œspring mvcå®¹å™¨æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œéƒ½æ˜¯æŒ‡çš„æ˜¯åŒä¸€ä¸ªå®¹å™¨ã€‚&lt;/p>
&lt;p>ï¼ˆ3ï¼‰æ‰§è¡Œåˆ°onRefresh()æ–¹æ³•ï¼Œå°±æ˜¯å¼€å§‹åˆå§‹åŒ–DispatcherServletäº†ï¼Œä¹Ÿå°±æ˜¯å¼€å§‹åˆå§‹åŒ–spring mvcã€‚&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#initStrategies &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initStrategies&lt;/span>(ApplicationContext context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//ä¸Šä¼ æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initMultipartResolver(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å›½é™…åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initLocaleResolver(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å‰æ®µçš„ä¸»é¢˜æ ·å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initThemeResolver(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//åˆå§‹åŒ–HandlerMappingsï¼ˆè¯·æ±‚æ˜ å°„å™¨ï¼‰é‡ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initHandlerMappings(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–HandlerAdaptersï¼ˆå¤„ç†é€‚é…å™¨ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initHandlerAdapters(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initHandlerExceptionResolvers(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initRequestToViewNameTranslator(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//è§†å›¾è½¬æ¢å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initViewResolvers(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é‡å®šå‘æ•°æ®ç®¡ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initFlashMapManager(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#initHandlerMappings&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initHandlerMappings&lt;/span>(ApplicationContext context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Ensure we have at least one HandlerMapping, by registering&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// a default HandlerMapping if no other mappings are found.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå¾—åˆ°handlerMappings&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMappings&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMappings&lt;/span> &lt;span style="color:#f92672">=&lt;/span> getDefaultStrategies(context, HandlerMapping.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;No HandlerMappings declared for servlet &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getServletName() &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;: using default strategies from DispatcherServlet.properties&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#getDefaultStrategies&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> String DEFAULT_STRATEGIES_PATH &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;DispatcherServlet.properties&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getDefaultStrategies&lt;/span>(ApplicationContext context, Class&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> strategyInterface) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (defaultStrategies &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Load default strategy implementations from properties file.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// This is currently strictly internal and not meant to be customized&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// by application developers.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ä»Žå±žæ€§æ–‡ä»¶åŠ è½½é»˜è®¤ç­–ç•¥å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * è¯´ç™½äº†è¿™é‡Œçš„æ„æ€å°±æ˜¯ä»ŽDEFAULT_STRATEGIES_PATHè¿™ä¸ªæ–‡ä»¶å½“ä¸­æ‹¿å‡ºæ‰€æœ‰çš„é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å¯ä»¥åŽ»æ•°ä¸€ä¸‹ä¸€å…±æœ‰8ä¸ªï¼š DispatcherServlet.properties == DEFAULT_STRATEGIES_PATH
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ClassPathResource resource &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ClassPathResource(DEFAULT_STRATEGIES_PATH, DispatcherServlet.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaultStrategies &lt;span style="color:#f92672">=&lt;/span> PropertiesLoaderUtils.&lt;span style="color:#a6e22e">loadProperties&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (IOException ex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IllegalStateException(&lt;span style="color:#e6db74">&amp;#34;Could not load &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> DEFAULT_STRATEGIES_PATH &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> ex.&lt;span style="color:#a6e22e">getMessage&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String key &lt;span style="color:#f92672">=&lt;/span> strategyInterface.&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// defaultStrategies æ˜¯DispatcherServlet.properties é…ç½®æ–‡ä»¶,åœ¨staticé™æ€ä»£ç å—åˆå§‹åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç‰ˆæœ¬å˜äº†,ä¸æ˜¯ä»Žé™æ€æ–¹æ³•ä¸­èŽ·å–åˆ°çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String value &lt;span style="color:#f92672">=&lt;/span> defaultStrategies.&lt;span style="color:#a6e22e">getProperty&lt;/span>(key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (value &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String&lt;span style="color:#f92672">[]&lt;/span> classNames &lt;span style="color:#f92672">=&lt;/span> StringUtils.&lt;span style="color:#a6e22e">commaDelimitedListToStringArray&lt;/span>(value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> strategies &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>(classNames.&lt;span style="color:#a6e22e">length&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (String className : classNames) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–classå­—èŠ‚ç æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> clazz &lt;span style="color:#f92672">=&lt;/span> ClassUtils.&lt;span style="color:#a6e22e">forName&lt;/span>(className, DispatcherServlet.&lt;span style="color:#a6e22e">class&lt;/span>.&lt;span style="color:#a6e22e">getClassLoader&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åº•å±‚æ˜¯é€šè¿‡è°ƒç”¨springçš„getBeançš„æ–¹å¼åˆ›å»ºè¯¥å¯¹è±¡ï¼ˆå¯ä»¥è¿›è¡Œbeançš„å±žæ€§è£…é…ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¯·æ±‚æ˜ å°„å°±æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•å®žçŽ°è£…é…çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object strategy &lt;span style="color:#f92672">=&lt;/span> createDefaultStrategy(context, clazz);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> strategies.&lt;span style="color:#a6e22e">add&lt;/span>((T) strategy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (ClassNotFoundException ex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BeanInitializationException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Could not find DispatcherServlet&amp;#39;s default strategy class [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> className &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;] for interface [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> key &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>, ex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (LinkageError err) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BeanInitializationException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Unresolvable class definition for DispatcherServlet&amp;#39;s default strategy class [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> className &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;] for interface [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> key &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>, err);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> strategies;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Collections.&lt;span style="color:#a6e22e">emptyList&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>DispatcherServlet.properties&lt;/p>
&lt;p>ä»ŽDispatcherServlet.propertiesé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºhandlerMappingé»˜è®¤æ˜¯æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;p>1.BeanNameUrlHandlerMapping ï¼ˆä¸»è¦å¤„ç†objectï¼‰&lt;/p>
&lt;p>2.RequestMappingHandlerMappingï¼ˆä¸»è¦å¤„ç†methodï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-properties" data-lang="properties">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Default implementation classes for DispatcherServlet&amp;#39;s strategy interfaces.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Used as fallback when no matching beans are found in the DispatcherServlet context.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Not meant to be customized by application developers.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.LocaleResolver&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.ThemeResolver&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.theme.FixedThemeResolver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">//&lt;/span> &lt;span style="color:#e6db74">HandlerMapping&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.HandlerMapping&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.function.support.RouterFunctionMapping&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">//&lt;/span> &lt;span style="color:#e6db74">HandlerAdapter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.HandlerAdapter&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.function.support.HandlerFunctionAdapter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.HandlerExceptionResolver&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.RequestToViewNameTranslator&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.ViewResolver&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.view.InternalResourceViewResolver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">org.springframework.web.servlet.FlashMapManager&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">org.springframework.web.servlet.support.SessionFlashMapManager&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>(1) initHandlerMappingsæ–¹æ³•ï¼Œå°±æ˜¯åˆå§‹åŒ–æˆ‘ä»¬çš„handlerMappingï¼ˆè¯·æ±‚æ˜ å°„å™¨ï¼‰ã€‚&lt;/p>
&lt;p>(2) handlerMappingçš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œæ‰¾åˆ°è¯·æ±‚è·¯å¾„å¯¹åº”çš„controllerçš„æ–¹æ³•ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼šè¯·æ±‚çš„è·¯å¾„ &amp;ldquo;/index&amp;rdquo;ï¼Œç„¶åŽè¿™ä¸ªhandlerMappingï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå·²ç»å°†æ‰€æœ‰controllerçš„è¯·æ±‚è·¯å¾„æ˜ å°„ä¿å­˜åœ¨ä¸€ä¸ªmapé›†åˆï¼Œå½“è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå°±å°†&amp;quot;/index&amp;quot;ä½œä¸ºä¸€ä¸ªkeyï¼Œä»Žmapé›†åˆä¸­æ‰¾åˆ°å¯¹åº”çš„controllerçš„indexæ–¹æ³•ã€‚&lt;/p>&lt;/blockquote>
&lt;p>(3) è¿™é‡Œåˆå§‹åŒ–handlerMappings ï¼Œé»˜è®¤æ˜¯æœ‰ä¸¤ä¸ªhandlerMappings ï¼Œæ˜¯ç›´æŽ¥åœ¨defaultStrategiesé…ç½®æ–‡ä»¶ä¸­èŽ·å–ã€‚&lt;/p>
&lt;p>(4) é‚£ä¹ˆdefaultStrategiesçš„å€¼æ˜¯ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–çš„å‘¢ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>é€šè¿‡æŸ¥çœ‹æºç ï¼ŒdefaultStrategiesè¿™ä¸ªå€¼ï¼Œæ˜¯DispatcherServletç±»çš„é™æ€ä»£ç å—åˆå§‹åŒ–çš„ã€‚ å…¨ä¸–ç•Œéƒ½çŸ¥é“ï¼Œå½“ä¸€ä¸ªç±»è¢«åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œè¯¥ç±»çš„staticé™æ€ä»£ç å—çš„ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="è¯·æ±‚é˜¶æ®µåˆ†æž">è¯·æ±‚é˜¶æ®µåˆ†æž&lt;/h2>
&lt;p>ç”¨æˆ·çš„ä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œä¼šç”±servletæŽ¥æ”¶åˆ°ï¼Œç„¶åŽä¸€æ­¥ä¸€æ­¥è°ƒç”¨åˆ°DispatcherServletçš„doServiceæ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#doService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doService&lt;/span>(HttpServletRequest request, HttpServletResponse response) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¸å¿ƒæ–¹æ³•ï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doDispatch(request, response);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#doDispatch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doDispatch&lt;/span>(HttpServletRequest request, HttpServletResponse response) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletRequest processedRequest &lt;span style="color:#f92672">=&lt;/span> request;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerExecutionChain mappedHandler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> multipartRequestParsed &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¼‚æ­¥ç¼–ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebAsyncManager asyncManager &lt;span style="color:#f92672">=&lt;/span> WebAsyncUtils.&lt;span style="color:#a6e22e">getAsyncManager&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®šä¹‰å˜é‡,å“ˆå“ˆå“ˆ,å¥½ç†Ÿæ‚‰å‘€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ModelAndView mv &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Exception dispatchException &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processedRequest &lt;span style="color:#f92672">=&lt;/span> checkMultipart(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> multipartRequestParsed &lt;span style="color:#f92672">=&lt;/span> (processedRequest &lt;span style="color:#f92672">!=&lt;/span> request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Determine handler for the current request.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç¡®å®šå½“å‰è¯·æ±‚çš„å¤„ç†ç¨‹åºï¼ˆé‡ç‚¹ï¼‰ï¼ŒæŽ¨æ–­controllerå’Œhandlerçš„ç±»åž‹ï¼Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿›åˆ°è¿™é‡Œçš„getHandleræ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mappedHandler &lt;span style="color:#f92672">=&lt;/span> getHandler(processedRequest);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mappedHandler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> noHandlerFound(processedRequest, response);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Determine handler adapter for the current request.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æŽ¨æ–­é€‚é…å™¨ï¼Œä¸åŒçš„controllerç±»åž‹ï¼Œäº¤ç»™ä¸åŒçš„é€‚é…å™¨åŽ»å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¦‚æžœæ˜¯ä¸€ä¸ªbeanï¼ŒmappedHandler.getHandler()è¿”å›žçš„æ˜¯ä¸€ä¸ªå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¦‚æžœæ˜¯ä¸€ä¸ªmethodï¼ŒmappedHandler.getHandler()è¿”å›žçš„æ˜¯ä¸€ä¸ªæ–¹æ³• &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerAdapter ha &lt;span style="color:#f92672">=&lt;/span> getHandlerAdapter(mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//åˆ°è¿™é‡Œï¼Œspringæ‰ç¡®å®šæˆ‘è¦æ€Žä¹ˆåå°„è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Process last-modified header, if supported by the handler.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String method &lt;span style="color:#f92672">=&lt;/span> request.&lt;span style="color:#a6e22e">getMethod&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isGet &lt;span style="color:#f92672">=&lt;/span> HttpMethod.&lt;span style="color:#a6e22e">GET&lt;/span>.&lt;span style="color:#a6e22e">matches&lt;/span>(method);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isGet &lt;span style="color:#f92672">||&lt;/span> HttpMethod.&lt;span style="color:#a6e22e">HEAD&lt;/span>.&lt;span style="color:#a6e22e">matches&lt;/span>(method)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lastModified &lt;span style="color:#f92672">=&lt;/span> ha.&lt;span style="color:#a6e22e">getLastModified&lt;/span>(request, mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">new&lt;/span> ServletWebRequest(request, response).&lt;span style="color:#a6e22e">checkNotModified&lt;/span>(lastModified) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> isGet) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‰ç½®æ‹¦æˆªå™¨å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>mappedHandler.&lt;span style="color:#a6e22e">applyPreHandle&lt;/span>(processedRequest, response)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é€šè¿‡é€‚é…å™¨ï¼Œå¤„ç†è¯·æ±‚ï¼ˆå¯ä»¥ç†è§£ä¸ºï¼Œåå°„è°ƒç”¨æ–¹æ³•ï¼‰ï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Actually invoke the handler.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mv &lt;span style="color:#f92672">=&lt;/span> ha.&lt;span style="color:#a6e22e">handle&lt;/span>(processedRequest, response, mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (asyncManager.&lt;span style="color:#a6e22e">isConcurrentHandlingStarted&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applyDefaultViewName(processedRequest, mv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mappedHandler.&lt;span style="color:#a6e22e">applyPostHandle&lt;/span>(processedRequest, response, mv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (Exception ex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dispatchException &lt;span style="color:#f92672">=&lt;/span> ex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (Throwable err) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// As of 4.3, we&amp;#39;re processing Errors thrown from handler methods as well,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// making them available for @ExceptionHandler methods and other scenarios.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dispatchException &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> NestedServletException(&lt;span style="color:#e6db74">&amp;#34;Handler dispatch failed&amp;#34;&lt;/span>, err);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (Exception ex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> triggerAfterCompletion(processedRequest, response, mappedHandler, ex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">catch&lt;/span> (Throwable err) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> triggerAfterCompletion(processedRequest, response, mappedHandler,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> NestedServletException(&lt;span style="color:#e6db74">&amp;#34;Handler processing failed&amp;#34;&lt;/span>, err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡å¯¹DispatcherServletçš„åˆ†æžï¼Œå¾—åˆ°è¯·æ±‚çš„æ ¸å¿ƒå¤„ç†æ–¹æ³•æ˜¯doDispatch()ï¼Œ&lt;/p>
&lt;p>ä¸»è¦æ˜¯åˆ†äº†å‡ æ­¥ï¼š&lt;/p>
&lt;p>(1) æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ æ“ä½œ&lt;/p>
&lt;p>(2) ç¡®å®šå½“å‰è¯·æ±‚çš„å¤„ç†çš„handlerï¼ˆé‡ç‚¹ï¼‰&lt;/p>
&lt;p>(3) æŽ¨æ–­é€‚é…å™¨ï¼Œä¸åŒçš„controllerç±»åž‹ï¼Œäº¤ç»™ä¸åŒçš„é€‚é…å™¨åŽ»å¤„ç†&lt;/p>
&lt;p>(4) æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨å¤„ç†interceptor&lt;/p>
&lt;p>(5) é€šè¿‡æ‰¾åˆ°çš„HandlerAdapter ï¼Œåå°„æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡ä»£ç controllerçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>(6) è¿”å›žç»“æžœã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#getHandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> HandlerExecutionChain &lt;span style="color:#a6e22e">getHandler&lt;/span>(HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMappings&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¾ªçŽ¯æ‰€æœ‰çš„HandlerMappings&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//this.handlerMappingsè¿™ä¸ªæ˜¯ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–çš„ï¼Ÿï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//åœ¨handlerMappingsåˆå§‹åŒ–çš„æ—¶å€™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (HandlerMapping mapping : &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMappings&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æŠŠè¯·æ±‚ä¼ è¿‡åŽ»çœ‹èƒ½ä¸èƒ½å¾—åˆ°ä¸€ä¸ªhandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ³¨æ„ï¼šæ€Žä¹ˆå¾—åˆ°handlerå’ŒhandlerMappingè‡ªå·±å®žçŽ°çš„é€»è¾‘æœ‰å…³ç³»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerExecutionChain handler &lt;span style="color:#f92672">=&lt;/span> mapping.&lt;span style="color:#a6e22e">getHandler&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractHandlerMapping#getHandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> HandlerExecutionChain &lt;span style="color:#a6e22e">getHandler&lt;/span>(HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//èŽ·å–handlerï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object handler &lt;span style="color:#f92672">=&lt;/span> getHandlerInternal(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> getDefaultHandler();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Bean name or resolved handler?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#66d9ef">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String handlerName &lt;span style="color:#f92672">=&lt;/span> (String) handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext().&lt;span style="color:#a6e22e">getBean&lt;/span>(handlerName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Ensure presence of cached lookupPath for interceptors and others&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>ServletRequestPathUtils.&lt;span style="color:#a6e22e">hasCachedPath&lt;/span>(request)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initLookupPath(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerExecutionChain executionChain &lt;span style="color:#f92672">=&lt;/span> getHandlerExecutionChain(handler, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Mapped to &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> handler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isDebugEnabled&lt;/span>() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>DispatcherType.&lt;span style="color:#a6e22e">ASYNC&lt;/span>.&lt;span style="color:#a6e22e">equals&lt;/span>(request.&lt;span style="color:#a6e22e">getDispatcherType&lt;/span>())) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">debug&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Mapped to &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> executionChain.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (hasCorsConfigurationSource(handler) &lt;span style="color:#f92672">||&lt;/span> CorsUtils.&lt;span style="color:#a6e22e">isPreFlightRequest&lt;/span>(request)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CorsConfiguration config &lt;span style="color:#f92672">=&lt;/span> getCorsConfiguration(handler, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (getCorsConfigurationSource() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CorsConfiguration globalConfig &lt;span style="color:#f92672">=&lt;/span> getCorsConfigurationSource().&lt;span style="color:#a6e22e">getCorsConfiguration&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config &lt;span style="color:#f92672">=&lt;/span> (globalConfig &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> globalConfig.&lt;span style="color:#a6e22e">combine&lt;/span>(config) : config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (config &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config.&lt;span style="color:#a6e22e">validateAllowCredentials&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executionChain &lt;span style="color:#f92672">=&lt;/span> getCorsHandlerExecutionChain(request, executionChain, config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> executionChain;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>(1) getHandler()æ–¹æ³•ï¼Œä¸»è¦æ˜¯éåŽ†åœ¨DispatcherServletåˆå§‹åŒ–æ˜¯ï¼Œåˆå§‹åŒ–çš„handlerMappingsã€‚&lt;/p>
&lt;p>(2) è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œé€šè¿‡requestçš„è·¯å¾„ï¼ŒåŽ»åŒ¹é…å¯¹åº”çš„controlleråŽ»å¤„ç†ã€‚&lt;/p>
&lt;p>(3) SpringMVCè‡ªå·±è‡ªå¸¦äº†2ä¸ªHandlerMapping æ¥ä¾›æˆ‘ä»¬é€‰æ‹© è‡³äºŽ ä¸ºä»€ä¹ˆè¦æœ‰2ä¸ªå‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="ä¸¤ç§æ³¨å†Œcontrollerçš„æ–¹å¼">ä¸¤ç§æ³¨å†ŒControllerçš„æ–¹å¼&lt;/h3>
&lt;p>æˆ‘ä»¬ç”¨2ç§æ–¹å¼æ¥æ³¨å†ŒController åˆ†åˆ«æ˜¯ï¼š&lt;/p>
&lt;p>(1) ä½œä¸ºBeançš„å½¢å¼ï¼šå®žçŽ°ControlleræŽ¥å£ï¼Œé‡å†™handleRequestæ–¹æ³•ï¼Œè¯·æ±‚è·¯å¾„ä¸º&amp;quot;/test&amp;quot;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TesrController&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> org.&lt;span style="color:#a6e22e">springframework&lt;/span>.&lt;span style="color:#a6e22e">web&lt;/span>.&lt;span style="color:#a6e22e">servlet&lt;/span>.&lt;span style="color:#a6e22e">mvc&lt;/span>.&lt;span style="color:#a6e22e">Controller&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ModelAndView &lt;span style="color:#a6e22e">handleRequest&lt;/span>(HttpServletRequest request,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletResponse response) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>(2) ä»¥Annotationå½¢å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Controller&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AnnotationController&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@RequestMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Object &lt;span style="color:#a6e22e">test&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;test&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»è¿‡æµ‹è¯•:&lt;/p>
&lt;p>(1)å¯ä»¥å¾—åˆ°ä»¥Beanæ–¹å¼çš„controllerï¼Œæ˜¯é€šè¿‡BeanNameUrlHandlerMappingåŽ»åŒ¹é…&lt;/p>
&lt;p>(2)ä»¥æ³¨è§£æ–¹æ³•çš„controllerï¼Œæ˜¯é€šè¿‡RequestMappingHandlerMappingåŽ»åŒ¹é…&lt;/p>
&lt;h4 id="beannameurlhandlermapping">BeanNameUrlHandlerMapping&lt;/h4>
&lt;p>BeanNameUrlHandlerMappingå¤„ç†beanæ–¹å¼çš„æºç åˆ†æžï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractUrlHandlerMapping#getHandlerInternal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> Object &lt;span style="color:#a6e22e">getHandlerInternal&lt;/span>(HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–è¯·æ±‚çš„è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String lookupPath &lt;span style="color:#f92672">=&lt;/span> initLookupPath(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ°å¯¹åº”çš„handlerï¼ˆé‡ç‚¹ï¼‰è°ƒç”¨ lookupHandler()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (usesPathPatterns()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RequestPath path &lt;span style="color:#f92672">=&lt;/span> ServletRequestPathUtils.&lt;span style="color:#a6e22e">getParsedRequestPath&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> lookupHandler(path, lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> lookupHandler(lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// We need to care for the default handler directly, since we need to&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// expose the PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE for it as well.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object rawHandler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (StringUtils.&lt;span style="color:#a6e22e">matchesCharacter&lt;/span>(lookupPath, &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rawHandler &lt;span style="color:#f92672">=&lt;/span> getRootHandler();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (rawHandler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rawHandler &lt;span style="color:#f92672">=&lt;/span> getDefaultHandler();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (rawHandler &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Bean name or resolved handler?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (rawHandler &lt;span style="color:#66d9ef">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String handlerName &lt;span style="color:#f92672">=&lt;/span> (String) rawHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rawHandler &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext().&lt;span style="color:#a6e22e">getBean&lt;/span>(handlerName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> validateHandler(rawHandler, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> buildPathExposingHandler(rawHandler, lookupPath, lookupPath, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractUrlHandlerMapping#lookupHandler(java.lang.String, javax.servlet.http.HttpServletRequest)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> Object &lt;span style="color:#a6e22e">lookupHandler&lt;/span>(String lookupPath, HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŸ¥çœ‹è¿™é‡Œçš„æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object handler &lt;span style="color:#f92672">=&lt;/span> getDirectMatch(lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Pattern match?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> matchingPatterns &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (String registeredPattern : &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">keySet&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (getPathMatcher().&lt;span style="color:#a6e22e">match&lt;/span>(registeredPattern, lookupPath)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> matchingPatterns.&lt;span style="color:#a6e22e">add&lt;/span>(registeredPattern);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (useTrailingSlashMatch()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>registeredPattern.&lt;span style="color:#a6e22e">endsWith&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> getPathMatcher().&lt;span style="color:#a6e22e">match&lt;/span>(registeredPattern &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>, lookupPath)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> matchingPatterns.&lt;span style="color:#a6e22e">add&lt;/span>(registeredPattern &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String bestMatch &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Comparator&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> patternComparator &lt;span style="color:#f92672">=&lt;/span> getPathMatcher().&lt;span style="color:#a6e22e">getPatternComparator&lt;/span>(lookupPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>matchingPatterns.&lt;span style="color:#a6e22e">isEmpty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> matchingPatterns.&lt;span style="color:#a6e22e">sort&lt;/span>(patternComparator);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> matchingPatterns.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">&amp;gt;&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Matching patterns &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> matchingPatterns);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bestMatch &lt;span style="color:#f92672">=&lt;/span> matchingPatterns.&lt;span style="color:#a6e22e">get&lt;/span>(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (bestMatch &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">get&lt;/span>(bestMatch);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (bestMatch.&lt;span style="color:#a6e22e">endsWith&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">get&lt;/span>(bestMatch.&lt;span style="color:#a6e22e">substring&lt;/span>(0, bestMatch.&lt;span style="color:#a6e22e">length&lt;/span>() &lt;span style="color:#f92672">-&lt;/span> 1));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IllegalStateException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Could not find handler for best pattern match [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> bestMatch &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Bean name or resolved handler?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#66d9ef">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String handlerName &lt;span style="color:#f92672">=&lt;/span> (String) handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext().&lt;span style="color:#a6e22e">getBean&lt;/span>(handlerName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> validateHandler(handler, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String pathWithinMapping &lt;span style="color:#f92672">=&lt;/span> getPathMatcher().&lt;span style="color:#a6e22e">extractPathWithinPattern&lt;/span>(bestMatch, lookupPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// There might be multiple &amp;#39;best patterns&amp;#39;, let&amp;#39;s make sure we have the correct URI template variables&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// for all of them&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> uriTemplateVariables &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> LinkedHashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (String matchingPattern : matchingPatterns) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (patternComparator.&lt;span style="color:#a6e22e">compare&lt;/span>(bestMatch, matchingPattern) &lt;span style="color:#f92672">==&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> vars &lt;span style="color:#f92672">=&lt;/span> getPathMatcher().&lt;span style="color:#a6e22e">extractUriTemplateVariables&lt;/span>(matchingPattern, lookupPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> decodedVars &lt;span style="color:#f92672">=&lt;/span> getUrlPathHelper().&lt;span style="color:#a6e22e">decodePathVariables&lt;/span>(request, vars);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uriTemplateVariables.&lt;span style="color:#a6e22e">putAll&lt;/span>(decodedVars);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> uriTemplateVariables.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">&amp;gt;&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;URI variables &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> uriTemplateVariables);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> buildPathExposingHandler(handler, bestMatch, pathWithinMapping, uriTemplateVariables);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// No handler found...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractUrlHandlerMapping#getDirectMatch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Object &lt;span style="color:#a6e22e">getDirectMatch&lt;/span>(String urlPath, HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡è¯·æ±‚çš„è·¯å¾„ï¼Œåœ¨handlerMapä¸­åŽ»åŒ¹é…ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// handlerMapè¿™ä¸ªå€¼ï¼Œä»€ä¹ˆæ—¶å€™å¡«å……å€¼ï¼Ÿåœ¨initåˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»å­˜æ”¾åœ¨è¿™ä¸ªhandlerMapç§&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object handler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">get&lt;/span>(urlPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Bean name or resolved handler?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (handler &lt;span style="color:#66d9ef">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String handlerName &lt;span style="color:#f92672">=&lt;/span> (String) handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext().&lt;span style="color:#a6e22e">getBean&lt;/span>(handlerName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> validateHandler(handler, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> buildPathExposingHandler(handler, urlPath, urlPath, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>(1) ä»¥Beanæ–¹å¼çš„controllerï¼ŒåŒ¹é…è¯·æ±‚çš„è·¯å¾„ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªhandlerMapåŽ»åŒ¹é…ï¼Œæ¯”è¾ƒç®€å•ã€‚&lt;/p>
&lt;p>(2) è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªhandlerMapçš„å€¼ï¼Œæ˜¯ä»€ä¹ˆæ—¶å€™æ”¾è¿›åŽ»çš„ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>é€šè¿‡æºç åˆ†æžï¼ŒBeanNameUrlHandlerMappingæ˜¯å®žçŽ°äº†ApplicationContextAwareæŽ¥å£ã€‚ å¦‚æžœä½ ç²¾é€šspringçš„æºç ï¼Œå°±çŸ¥é“springçš„å®žä¾‹beançš„æ—¶å€™ï¼Œä¼šå›žè°ƒè¿™äº›ç±»çš„setApplicationContext()æ–¹æ³•ã€‚&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.context.support.ApplicationObjectSupport#setApplicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">setApplicationContext&lt;/span>(&lt;span style="color:#a6e22e">@Nullable&lt;/span> ApplicationContext context) &lt;span style="color:#66d9ef">throws&lt;/span> BeansException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (context &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>isContextRequired()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Reset internal context state.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">applicationContext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">messageSourceAccessor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">applicationContext&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Initialize with passed-in context.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>requiredContextClass().&lt;span style="color:#a6e22e">isInstance&lt;/span>(context)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ApplicationContextException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Invalid application context: needs to be of type [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> requiredContextClass().&lt;span style="color:#a6e22e">getName&lt;/span>() &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">applicationContext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> context;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">messageSourceAccessor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> MessageSourceAccessor(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–ApplicationContextï¼Œå°±ä¼šæ‰§è¡Œåˆ°å­ç±»çš„æ–¹æ³•ï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initApplicationContext(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Ignore reinitialization if same context passed in.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">applicationContext&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ApplicationContextException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Cannot reinitialize with different application context: current one is [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">applicationContext&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;], passed-in one is [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> context &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;]&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ²¡çœ‹æ‡‚æ€Žä¹ˆèµ°åˆ°è¿™é‡Œæ¥å‘¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractDetectingUrlHandlerMapping#initApplicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initApplicationContext&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ApplicationContextException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.&lt;span style="color:#a6e22e">initApplicationContext&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ£€æµ‹å‡ºhandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> detectHandlers();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractDetectingUrlHandlerMapping#detectHandlers&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">detectHandlers&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> BeansException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–spring iocæ‰€æœ‰çš„beanNameï¼Œç„¶åŽåˆ¤æ–­beanNameï¼Œé‚£äº›æ˜¯ä»¥ &amp;#34;/&amp;#34; å¼€å¤´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationContext applicationContext &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String&lt;span style="color:#f92672">[]&lt;/span> beanNames &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">detectHandlersInAncestorContexts&lt;/span> &lt;span style="color:#f92672">?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BeanFactoryUtils.&lt;span style="color:#a6e22e">beanNamesForTypeIncludingAncestors&lt;/span>(applicationContext, Object.&lt;span style="color:#a6e22e">class&lt;/span>) :
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationContext.&lt;span style="color:#a6e22e">getBeanNamesForType&lt;/span>(Object.&lt;span style="color:#a6e22e">class&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Take any bean name that we can determine URLs for.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (String beanName : beanNames) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç„¶åŽåˆ¤æ–­beanNameï¼Œé‚£äº›æ˜¯ä»¥ &amp;#34;/&amp;#34; å¼€å¤´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String&lt;span style="color:#f92672">[]&lt;/span> urls &lt;span style="color:#f92672">=&lt;/span> determineUrlsForHandler(beanName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>ObjectUtils.&lt;span style="color:#a6e22e">isEmpty&lt;/span>(urls)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ³¨å†Œhandlerï¼ˆé‡ç‚¹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// URL paths found: Let&amp;#39;s consider it a handler.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registerHandler(urls, beanName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractUrlHandlerMapping#registerHandler(java.lang.String[], java.lang.String) &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">registerHandler&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> urlPaths, String beanName) &lt;span style="color:#66d9ef">throws&lt;/span> BeansException, IllegalStateException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Assert.&lt;span style="color:#a6e22e">notNull&lt;/span>(urlPaths, &lt;span style="color:#e6db74">&amp;#34;URL path array must not be null&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (String urlPath : urlPaths) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registerHandler(urlPath, beanName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractUrlHandlerMapping#registerHandler(java.lang.String, java.lang.Object)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">registerHandler&lt;/span>(String urlPath, Object handler) &lt;span style="color:#66d9ef">throws&lt;/span> BeansException, IllegalStateException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Assert.&lt;span style="color:#a6e22e">notNull&lt;/span>(urlPath, &lt;span style="color:#e6db74">&amp;#34;URL path must not be null&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Assert.&lt;span style="color:#a6e22e">notNull&lt;/span>(handler, &lt;span style="color:#e6db74">&amp;#34;Handler object must not be null&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object resolvedHandler &lt;span style="color:#f92672">=&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Eagerly resolve handler if referencing singleton via name.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">lazyInitHandlers&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> handler &lt;span style="color:#66d9ef">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String handlerName &lt;span style="color:#f92672">=&lt;/span> (String) handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationContext applicationContext &lt;span style="color:#f92672">=&lt;/span> obtainApplicationContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (applicationContext.&lt;span style="color:#a6e22e">isSingleton&lt;/span>(handlerName)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resolvedHandler &lt;span style="color:#f92672">=&lt;/span> applicationContext.&lt;span style="color:#a6e22e">getBean&lt;/span>(handlerName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object mappedHandler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">get&lt;/span>(urlPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mappedHandler &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mappedHandler &lt;span style="color:#f92672">!=&lt;/span> resolvedHandler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IllegalStateException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Cannot map &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getHandlerDescription(handler) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34; to URL path [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> urlPath &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;]: There is already &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getHandlerDescription(mappedHandler) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34; mapped.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (urlPath.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Root mapping to &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getHandlerDescription(handler));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setRootHandler(resolvedHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (urlPath.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/*&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Default mapping to &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getHandlerDescription(handler));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setDefaultHandler(resolvedHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€ç»ˆputåˆ°mapé›†åˆä¸­ï¼ˆçœç•¥å…¶ä»–æ— å…³ä»£ç ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerMap&lt;/span>.&lt;span style="color:#a6e22e">put&lt;/span>(urlPath, resolvedHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (getPatternParser() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">pathPatternHandlerMap&lt;/span>.&lt;span style="color:#a6e22e">put&lt;/span>(getPatternParser().&lt;span style="color:#a6e22e">parse&lt;/span>(urlPath), resolvedHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Mapped [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> urlPath &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;] onto &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> getHandlerDescription(handler));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>BeanNameUrlHandlerMappingå¤„ç†beanæ–¹å¼çš„æºç åˆ†æžï¼Œå…¶å®žæ˜¯å¾ˆç®€å•ï¼š&lt;/p>
&lt;p>(1) åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»å°†æ‰€æœ‰å®žçŽ°äº†ControlleræŽ¥å£çš„controllerç±»ï¼Œæ‹¿åˆ°ä»–ä»¬çš„@Componet(&amp;rsquo;/test')&lt;/p>
&lt;p>(2) ç„¶åŽå°†&amp;rsquo;/test&amp;rsquo;è¿™ä¸ªä½œä¸ºkeyï¼Œcontrollerç±»ä½œä¸ºvalueï¼Œæ”¾å…¥åˆ°ä¸€ä¸ªmapé›†åˆã€‚&lt;/p>
&lt;p>(3) å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œæ‹¿åˆ°è¿™ä¸ªè¯·æ±‚çš„uriï¼Œåœ¨mapé‡Œé¢æ‰¾ï¼Œæ‰¾åˆ°äº†å³è¡¨ç¤ºåŒ¹é…ä¸Š&lt;/p>&lt;/blockquote>
&lt;h4 id="requestmappinghandlermapping">RequestMappingHandlerMapping&lt;/h4>
&lt;p>å¤„ç†æ³¨è§£æ–¹å¼çš„æºç åˆ†æžï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¹äºŽRequestMappingHandlerMappingï¼ŒindexController.index()ï¼Œæ–¹æ³•çš„è¯·æ±‚è·¯å¾„æ˜ å°„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> HandlerMethod &lt;span style="color:#a6e22e">getHandlerInternal&lt;/span>(HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–è¯·æ±‚è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String lookupPath &lt;span style="color:#f92672">=&lt;/span> initLookupPath(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">mappingRegistry&lt;/span>.&lt;span style="color:#a6e22e">acquireReadLock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡è¯·æ±‚è·¯å¾„ï¼ŒèŽ·å–handler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerMethod handlerMethod &lt;span style="color:#f92672">=&lt;/span> lookupHandlerMethod(lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (handlerMethod &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> handlerMethod.&lt;span style="color:#a6e22e">createWithResolvedBean&lt;/span>() : &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">mappingRegistry&lt;/span>.&lt;span style="color:#a6e22e">releaseReadLock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.handler.AbstractHandlerMethodMapping#lookupHandlerMethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> HandlerMethod &lt;span style="color:#a6e22e">lookupHandlerMethod&lt;/span>(String lookupPath, HttpServletRequest request) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Match&lt;span style="color:#f92672">&amp;gt;&lt;/span> matches &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»ŽmappingRegistryçš„urlLookupï¼ŒåŒ¹é…è¯·æ±‚è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> directPathMatches &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">mappingRegistry&lt;/span>.&lt;span style="color:#a6e22e">getMappingsByDirectPath&lt;/span>(lookupPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (directPathMatches &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addMatchingMappings(directPathMatches, matches, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (matches.&lt;span style="color:#a6e22e">isEmpty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addMatchingMappings(&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">mappingRegistry&lt;/span>.&lt;span style="color:#a6e22e">getRegistrations&lt;/span>().&lt;span style="color:#a6e22e">keySet&lt;/span>(), matches, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>matches.&lt;span style="color:#a6e22e">isEmpty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Match bestMatch &lt;span style="color:#f92672">=&lt;/span> matches.&lt;span style="color:#a6e22e">get&lt;/span>(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (matches.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">&amp;gt;&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Comparator&lt;span style="color:#f92672">&amp;lt;&lt;/span>Match&lt;span style="color:#f92672">&amp;gt;&lt;/span> comparator &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> MatchComparator(getMappingComparator(request));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> matches.&lt;span style="color:#a6e22e">sort&lt;/span>(comparator);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bestMatch &lt;span style="color:#f92672">=&lt;/span> matches.&lt;span style="color:#a6e22e">get&lt;/span>(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (logger.&lt;span style="color:#a6e22e">isTraceEnabled&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> logger.&lt;span style="color:#a6e22e">trace&lt;/span>(matches.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34; matching mappings: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> matches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (CorsUtils.&lt;span style="color:#a6e22e">isPreFlightRequest&lt;/span>(request)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (Match match : matches) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (match.&lt;span style="color:#a6e22e">hasCorsConfig&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> PREFLIGHT_AMBIGUOUS_MATCH;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Match secondBestMatch &lt;span style="color:#f92672">=&lt;/span> matches.&lt;span style="color:#a6e22e">get&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (comparator.&lt;span style="color:#a6e22e">compare&lt;/span>(bestMatch, secondBestMatch) &lt;span style="color:#f92672">==&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Method m1 &lt;span style="color:#f92672">=&lt;/span> bestMatch.&lt;span style="color:#a6e22e">getHandlerMethod&lt;/span>().&lt;span style="color:#a6e22e">getMethod&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Method m2 &lt;span style="color:#f92672">=&lt;/span> secondBestMatch.&lt;span style="color:#a6e22e">getHandlerMethod&lt;/span>().&lt;span style="color:#a6e22e">getMethod&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String uri &lt;span style="color:#f92672">=&lt;/span> request.&lt;span style="color:#a6e22e">getRequestURI&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IllegalStateException(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Ambiguous handler methods mapped for &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> uri &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;: {&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> m1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> m2 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;}&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> request.&lt;span style="color:#a6e22e">setAttribute&lt;/span>(BEST_MATCHING_HANDLER_ATTRIBUTE, bestMatch.&lt;span style="color:#a6e22e">getHandlerMethod&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handleMatch(bestMatch.&lt;span style="color:#a6e22e">mapping&lt;/span>, lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›žhandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> bestMatch.&lt;span style="color:#a6e22e">getHandlerMethod&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handleNoMatch(&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">mappingRegistry&lt;/span>.&lt;span style="color:#a6e22e">getRegistrations&lt;/span>().&lt;span style="color:#a6e22e">keySet&lt;/span>(), lookupPath, request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 3.AbstractHandlerMethodMapping.MappingRegistry#getMappingsByDirectPath&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Nullable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getMappingsByDirectPath&lt;/span>(String urlPath) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">pathLookup&lt;/span>.&lt;span style="color:#a6e22e">get&lt;/span>(urlPath);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>RequestMappingHandlerMappingå¤„ç†æ³¨è§£æ–¹å¼çš„æºç åˆ†æžï¼Œæ¯”è¾ƒå¤æ‚ï¼Œç”¨ä¸€ä¸ªMappingRegistryç»´æŠ¤æ‰€æœ‰çš„è¯·æ±‚è·¯å¾„æ˜ å°„ã€‚&lt;/p>
&lt;p>MappingRegistryçš„åˆå§‹åŒ–ï¼Œä¹Ÿæ˜¯åœ¨è¯¥beanå®žä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»åšå¥½çš„äº†ã€‚&lt;/p>
&lt;p>åŽŸç†ä¹Ÿæ˜¯å’Œä¸Šä¸€ä¸ªå·®ä¸å¤šï¼Œéƒ½æ˜¯ä»Žä¸€ä¸ªmapé›†åˆé‡Œé¢åŒ¹é…ã€‚æ‰€ä»¥è¿™é‡Œå°±ä¸å†åšè§£æžäº†&lt;/p>
&lt;blockquote>
&lt;p>æ€»ç»“ï¼šgetHandler()&lt;/p>&lt;/blockquote>
&lt;p>æ‰¾é€‚é…å™¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.springframework.web.servlet.DispatcherServlet#getHandlerAdapter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> HandlerAdapter &lt;span style="color:#a6e22e">getHandlerAdapter&lt;/span>(Object handler) &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerAdapters&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (HandlerAdapter adapter : &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">handlerAdapters&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (adapter.&lt;span style="color:#a6e22e">supports&lt;/span>(handler)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> adapter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServletException(&lt;span style="color:#e6db74">&amp;#34;No adapter for handler [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> handler &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>å…¶å®žèƒ½çœ‹è§ä»–æ˜¯ä»Žä¸€ä¸ªhandlerAdapterså±žæ€§é‡Œé¢éåŽ†äº†æˆ‘ä»¬çš„é€‚é…å™¨ è¿™ä¸ªhandlerAdapterså“ªæ¥çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>è·Ÿæˆ‘ä»¬çš„HandlerMappingsä¸€æ · åœ¨ä»–çš„é…ç½®æ–‡ä»¶é‡Œé¢æœ‰å†™ï¼Œå°±æ˜¯æˆ‘ä»¬åˆšåˆšæ‰€è¯´çš„ ã€‚&lt;/p>
&lt;p>è‡³äºŽä»€ä¹ˆæ˜¯é€‚é…å™¨ï¼Œæˆ‘ä»¬ç»“åˆHandleræ¥è®²ï¼Œ å°±å¦‚æˆ‘ä»¬åœ¨æœ€å¼€å§‹çš„æ€»ç»“æ—¶æ‰€è¯´çš„ï¼Œ ä¸€å¼€å§‹åªæ˜¯æ‰¾åˆ°äº†Handler çŽ°åœ¨è¦æ‰§è¡Œäº†ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼ŒHandlerä¸æ­¢ä¸€ä¸ªï¼Œ è‡ªç„¶è€Œç„¶å¯¹åº”çš„æ‰§è¡Œæ–¹å¼å°±ä¸åŒäº†ï¼Œ è¿™æ—¶å€™é€‚é…å™¨çš„æ¦‚å¿µå°±å‡ºæ¥äº†ï¼šå¯¹åº”ä¸åŒçš„Handlerçš„æ‰§è¡Œæ–¹æ¡ˆã€‚å½“æ‰¾åˆ°åˆé€‚çš„é€‚é…å™¨çš„æ—¶å€™ï¼Œ åŸºæœ¬ä¸Šå°±å·²ç»æ”¶å°¾äº†ï¼Œå› ä¸ºåŽé¢åœ¨åšäº†ä¸€äº›åˆ¤æ–­ä¹‹åŽï¼ˆåˆ¤æ–­è¯·æ±‚ç±»åž‹ä¹‹ç±»çš„ï¼‰ï¼Œå°±å¼€å§‹æ‰§è¡Œäº†ä½ çš„Handleräº†ï¼Œä¸Šä»£ç ï¼š&lt;/p>
&lt;p>&lt;code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªmvå°±æ˜¯æˆ‘ä»¬çš„ModlAndView å…¶å®žæ‰§è¡Œå®Œè¿™ä¸€è¡Œ æˆ‘ä»¬çš„Controllerçš„é€»è¾‘å·²ç»æ‰§è¡Œå®Œäº†ï¼Œ å‰©ä¸‹çš„å°±æ˜¯å¯»æ‰¾è§†å›¾ æ¸²æŸ“å›¾çš„äº‹æƒ…äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>æ€»ç»“ï¼š å…¶å®žæˆ‘ä»¬çš„SpringMVCå…³é”®çš„æ¦‚å¿µå°±åœ¨äºŽHandlerï¼ˆå¤„ç†å™¨ï¼‰ å’ŒAdapter(é€‚é…å™¨) é€šè¿‡ä¸€ä¸ªå…³é”®çš„HandlerMappings æ‰¾åˆ°åˆé€‚å¤„ç†ä½ çš„Controllerçš„Handler ç„¶åŽå†é€šè¿‡HandlerAdaptersæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„HandlerAdapter æ¥æ‰§è¡ŒHandlerå³Controlleré‡Œé¢çš„é€»è¾‘ã€‚ æœ€åŽå†è¿”å›žModlAndView&amp;hellip;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>å‚è€ƒ:https://juejin.cn/post/6991290858880368676&lt;/p>&lt;/blockquote>
&lt;h1 id="spring">Spring&lt;/h1>
&lt;h2 id="äº‹åŠ¡çš„ä¼ æ’­">äº‹åŠ¡çš„ä¼ æ’­&lt;/h2>
&lt;blockquote>
&lt;p>å‚è€ƒ:https://segmentfault.com/a/1190000013341344&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ä¼ æ’­ç­‰çº§&lt;/th>
&lt;th>æè¿°&lt;/th>
&lt;th>ç†è§£&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>REQUIRED&lt;/td>
&lt;td>é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­çº§åˆ«&lt;br />è¡¨ç¤ºå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›&lt;br />å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚&lt;/td>
&lt;td>Aæœ‰äº‹åŠ¡,Bå°±è·Ÿç€ç”¨&lt;br />Aæ²¡æœ‰äº‹åŠ¡,Bå°±å¼€å¯è‡ªå·±çš„äº‹åŠ¡,åªBæ–¹æ³•ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SUPPORTS&lt;/td>
&lt;td>å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›&lt;br />å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éžäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MANDATORY&lt;/td>
&lt;td>å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›&lt;br />å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>REQUIRES_NEW&lt;/td>
&lt;td>è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡&lt;br />å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚&lt;br />ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡å¤–éƒ¨æ–¹æ³•æ˜¯å¦å¼€å¯äº‹åŠ¡ï¼ŒPropagation.REQUIRES_NEW ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NOT_SUPPORTED&lt;/td>
&lt;td>ä»¥éžäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œ&lt;br />å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NEVER&lt;/td>
&lt;td>ä»¥éžäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œ&lt;br />å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NESTED&lt;/td>
&lt;td>å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›&lt;br />å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äºŽREQUIREDã€‚&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>é»˜è®¤æ•°æ®æ˜¯anthonyå’Œ0&lt;/p>
&lt;p>&lt;strong>REQUIRED&lt;/strong>&lt;/p>
&lt;p>Aæ–¹æ³•&lt;code>æœ‰&lt;/code>äº‹åŠ¡,Aæ–¹æ³•æŠ¥é”™,æœ‰ä¸€ä¸ªæŠ¥é”™éƒ½ä¼šå›žæ»š,ç»“æžœæ˜¯:anthonyå’Œ0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ–¹æ³•&lt;code>æ²¡æœ‰&lt;/code>äº‹åŠ¡,Aæ–¹æ³•æœ‰æŠ¥é”™,ç»“æžœæ˜¯:anthony2å’Œ1&lt;/p>
&lt;p>Bæ–¹æ³•è‡ªå·±å¼€å¯äº‹åŠ¡,å°±ä¸ç®¡Aäº‹åŠ¡äº†,æ‰€ä»¥Aæ–¹æ³•,å°±ç®—æŠ¥é”™äº†,ä¹ŸæˆåŠŸå†™å…¥æ•°æ®åº“,Bäº‹åŠ¡æ²¡æœ‰æŠ¥é”™,ä¹ŸæˆåŠŸå†™å…¥æ•°æ®åº“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ–¹æ³•æ²¡æœ‰äº‹åŠ¡,Aæ–¹æ³•å’ŒBæ–¹æ³•éƒ½æŠ¥é”™,,ç»“æžœæ˜¯:anthony2å’Œ0&lt;/p>
&lt;p>Aæ–¹æ³•æ²¡æœ‰äº‹åŠ¡,æ‰€ä»¥Aæ–¹æ³•æ’å…¥æ•°æ®åº“æˆåŠŸ,å°±ç®—æŠ¥é”™,ä¹Ÿæ²¡æœ‰å›žæ»š&lt;/p>
&lt;p>Bæ–¹æ³•è‡ªå·±å¼€å§‹äº‹åŠ¡,Bæ–¹æ³•æŠ¥é”™,æ‰€ä»¥å›žæ»š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>SUPPORTS&lt;/strong>&lt;/p>
&lt;p>Aæ–¹æ³•æœ‰äº‹åŠ¡,Aæ–¹æ³•æŠ¥é”™,éƒ½å›žæ»š,,ç»“æžœæ˜¯:anthonyå’Œ0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">SUPPORTS&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ²¡æœ‰äº‹åŠ¡,,Aæ–¹æ³•æŠ¥é”™,éƒ½æ²¡æœ‰å›žæ»š,ç»“æžœæ˜¯:anthony2å’Œ1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">SUPPORTS&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ²¡æœ‰äº‹åŠ¡,,A,Bæ–¹æ³•éƒ½æŠ¥é”™,éƒ½æ²¡æœ‰å›žæ»š,ç»“æžœæ˜¯:anthony2å’Œ1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">SUPPORTS&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>MANDATORY&lt;/strong>&lt;/p>
&lt;p>Aæœ‰äº‹åŠ¡,AæŠ¥é”™,éƒ½å›žæ»š,ç»“æžœæ˜¯:anthonyå’Œ0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">MANDATORY&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ²¡æœ‰äº‹åŠ¡,è¿è¡ŒæŠ¥é”™äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">MANDATORY&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>REQUIRES_NEW&lt;/strong>&lt;/p>
&lt;p>æµ‹è¯•çš„æ—¶å€™,ä¸è¦æ“ä½œåŒä¸€æ¡æ•°æ®,å®¹æ˜“è¶…æ—¶&amp;hellip;..&lt;/p>
&lt;p>Aå¼€å§‹äº‹åŠ¡,Bä¹Ÿå¼€å§‹äº‹åŠ¡,BæŠ¥é”™äº†,Bå›žæ»š,Aæ’å…¥æˆåŠŸ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRES_NEW&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·æ²¡æœ‰å¤çŽ°å‡ºé—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRES_NEW&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Aæ²¡æœ‰äº‹åŠ¡,Bæœ‰äº‹åŠ¡&lt;/li>
&lt;li>AæŠ¥é”™,æ²¡æœ‰å›žæ»š,
Bæ’å…¥æ•°æ®æˆåŠŸ&lt;/li>
&lt;li>&lt;code>å¤–å›´æ–¹æ³•å¼‚å¸¸,ä¸å½±å“å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRES_NEW&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Aæ²¡æœ‰äº‹åŠ¡,Bæœ‰äº‹åŠ¡&lt;/li>
&lt;li>Aæ’å…¥æ•°æ®æˆåŠŸ,Bå›žæ»š&lt;/li>
&lt;li>&lt;code>å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•,ä¸å½±å“å¤–å›´çš„æ–¹æ³•æˆåŠŸæ’å…¥&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">REQUIRES_NEW&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>NOT_SUPPORTED&lt;/strong>&lt;/p>
&lt;p>Aæœ‰äº‹åŠ¡,Bä¹Ÿæœ‰äº‹åŠ¡,Aå›žæ»šäº†,BæŠ¥é”™äº†,æ²¡æœ‰å›žæ»š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NOT_SUPPORTED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæœ‰äº‹åŠ¡,Bä¹Ÿæœ‰äº‹åŠ¡,Aå›žæ»šäº†,Bæ²¡æœ‰å›žæ»š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NOT_SUPPORTED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>NEVER&lt;/strong>&lt;/p>
&lt;p>ç›´æŽ¥æŠ¥é”™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NEVER&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>NESTED&lt;/strong>&lt;/p>
&lt;p>å…¨éƒ¨æäº¤æˆåŠŸ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NESTED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¨éƒ¨å¤±è´¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NESTED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Aæ²¡æœ‰äº‹åŠ¡,Bæœ‰äº‹åŠ¡&lt;/p>
&lt;p>Aæ‰§è¡ŒæˆåŠŸ,Bå›žæ»šæˆåŠŸ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodA&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setUsername&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transactionalController.&lt;span style="color:#a6e22e">methodB&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Transactional&lt;/span>(propagation&lt;span style="color:#f92672">=&lt;/span> Propagation.&lt;span style="color:#a6e22e">NESTED&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">methodB&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Test byId &lt;span style="color:#f92672">=&lt;/span> testService.&lt;span style="color:#a6e22e">getById&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">setParentId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byId.&lt;span style="color:#a6e22e">updateById&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 1 &lt;span style="color:#f92672">/&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨">æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨&lt;/h1>
&lt;p>1ã€è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨&lt;strong>è§¦å‘æ—¶æœºä¸ä¸€æ ·&lt;/strong>ï¼Œå…ˆæ‹¦æˆªå™¨,åŽè¿‡æ»¤å™¨&lt;/p>
&lt;p>2ã€&lt;strong>æ‹¦æˆªå™¨&lt;/strong>å¯ä»¥èŽ·å–IOCå®¹å™¨ä¸­çš„å„ä¸ªbeanï¼Œè€Œè¿‡æ»¤å™¨å°±ä¸è¡Œï¼Œå› ä¸ºæ‹¦&lt;strong>æˆªå™¨æ˜¯springæä¾›å¹¶ç®¡ç†çš„&lt;/strong>ï¼Œspringçš„åŠŸèƒ½å¯ä»¥è¢«æ‹¦æˆªå™¨ä½¿ç”¨ï¼Œåœ¨æ‹¦æˆªå™¨é‡Œæ³¨å…¥ä¸€ä¸ªserviceï¼Œå¯ä»¥è°ƒç”¨ä¸šåŠ¡é€»è¾‘ã€‚è€Œè¿‡æ»¤å™¨æ˜¯JavaEEæ ‡å‡†ï¼Œåªéœ€ä¾èµ–servlet api ï¼Œä¸éœ€è¦ä¾èµ–springã€‚&lt;/p>
&lt;p>3ã€&lt;strong>è¿‡æ»¤å™¨çš„å®žçŽ°&lt;/strong>åŸºäºŽ&lt;strong>å›žè°ƒå‡½æ•°&lt;/strong>ã€‚è€Œ&lt;strong>æ‹¦æˆªå™¨&lt;/strong>ï¼ˆä»£ç†æ¨¡å¼ï¼‰çš„å®žçŽ°&lt;strong>åŸºäºŽåå°„&lt;/strong>&lt;/p>
&lt;p>4ã€&lt;strong>è¿‡æ»¤å™¨&lt;/strong>æ˜¯ä¾&lt;strong>èµ–äºŽServletå®¹&lt;/strong>å™¨ï¼Œ&lt;strong>å±žäºŽServletè§„èŒƒçš„ä¸€éƒ¨åˆ†&lt;/strong>ï¼Œè€Œ&lt;strong>æ‹¦æˆªå™¨åˆ™æ˜¯ç‹¬ç«‹å­˜&lt;/strong>åœ¨çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•æƒ…å†µä¸‹ä½¿ç”¨ã€‚&lt;/p>
&lt;p>5ã€&lt;strong>Filte&lt;/strong>rçš„æ‰§è¡Œç”±&lt;strong>Servletå®¹å™¨å›žè°ƒå®Œæˆ&lt;/strong>ï¼Œè€Œ&lt;strong>æ‹¦æˆªå™¨&lt;/strong>é€šå¸¸é€š**è¿‡åŠ¨æ€ä»£ç†ï¼ˆåå°„ï¼‰**çš„æ–¹å¼æ¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>6ã€&lt;strong>Filterçš„ç”Ÿå‘½å‘¨&lt;/strong>æœŸ&lt;strong>ç”±Servletå®¹å™¨ç®¡ç†&lt;/strong>ï¼Œè€Œ&lt;strong>æ‹¦æˆªå™¨åˆ™&lt;/strong>å¯ä»¥é€šè¿‡I&lt;strong>oCå®¹å™¨æ¥ç®¡ç†&lt;/strong>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ³¨å…¥ç­‰æ–¹å¼æ¥èŽ·å–å…¶ä»–Beançš„å®žä¾‹ï¼Œå› æ­¤ä½¿ç”¨ä¼šæ›´æ–¹ä¾¿ã€‚&lt;/p>
&lt;p>7ã€&lt;strong>è¿‡æ»¤å™¨åªèƒ½åœ¨è¯·æ±‚çš„å‰åŽä½¿ç”¨ï¼Œè€Œæ‹¦æˆªå™¨å¯ä»¥è¯¦ç»†åˆ°æ¯ä¸ªæ–¹æ³•&lt;/strong>
&lt;img src="https://image.runtimes.cc/202404051459166.png" alt="">&lt;/p>
&lt;h1 id="spring-ioc">Spring IOC&lt;/h1>
&lt;p>Springæä¾›äº†ä¸¤ç§å®¹å™¨ï¼šBeanFactoryå’ŒApplicationContext&lt;/p>
&lt;ul>
&lt;li>**BeanFactoryï¼š**åŸºæœ¬çš„IoCå®¹å™¨ï¼Œé»˜è®¤é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–ç­–ç•¥ï¼ˆlazy-loadï¼‰ï¼Œå³åªæœ‰å½“å®¢æˆ·ç«¯å¯¹è±¡éœ€è¦è®¿é—®å®¹å™¨ä¸­æŸä¸ªbeanå¯¹è±¡çš„æ—¶å€™ï¼Œæ‰ä¼šå¯¹è¯¥beanå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ä»¥åŠä¾èµ–æ³¨å…¥æ“ä½œã€‚æ‰€ä»¥BeanFactoryå®¹å™¨çš„ç‰¹ç‚¹æ˜¯å¯åŠ¨åˆæœŸé€Ÿåº¦å¿«ï¼Œæ‰€éœ€èµ„æºæœ‰é™ï¼Œé€‚åˆäºŽèµ„æºæœ‰é™åŠŸèƒ½è¦æ±‚ä¸ä¸¥æ ¼çš„åœºæ™¯ã€‚&lt;/li>
&lt;li>&lt;strong>ApplicationContextï¼š&lt;/strong> ApplicationContextåœ¨BeanFactoryåŸºç¡€ä¸Šæž„å»ºï¼Œæ”¯æŒå…¶ä»–çš„é«˜çº§ç‰¹æ€§ï¼Œå¦‚å›½é™…åŒ–ï¼Œäº‹ä»¶å‘å¸ƒç­‰ã€‚ç›¸å¯¹äºŽBeanFactoryå®¹å™¨æ¥è¯´ï¼ŒApplicationContextåœ¨å¯åŠ¨çš„æ—¶å€™å³å®Œæˆèµ„æºçš„åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯åŠ¨æ—¶é—´è¾ƒé•¿ï¼Œé€‚åˆäºŽç³»ç»Ÿèµ„æºå……è¶³ï¼Œéœ€è¦æ›´å¤šåŠŸèƒ½çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h1 id="spring-bean">Spring Bean&lt;/h1>
&lt;p>Java ä¸­Beançš„å®šä¹‰ï¼š&lt;/p>
&lt;ul>
&lt;li>ç±»ä¸­æ‰€æœ‰çš„å±žæ€§éƒ½å¿…é¡»å°è£…ï¼Œå³ï¼šä½¿ç”¨privateå£°æ˜Žï¼›&lt;code>è¿™ä¸ªä¸å¤ªç¡®å®š&lt;/code>&lt;/li>
&lt;li>å°è£…çš„å±žæ€§å¦‚æžœéœ€è¦è¢«å¤–éƒ¨æ‰€æ“ä½œï¼Œåˆ™å¿…é¡»ç¼–å†™å¯¹åº”çš„setterã€getteræ–¹æ³•ï¼›&lt;/li>
&lt;li>ä¸€ä¸ªJavaBeanä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªæ— å‚æž„é€ æ–¹æ³•ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Staff&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">setName&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">setAge&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> age) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">getName&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">getAge&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€ŒSpring IoCå®¹å™¨å°±æ˜¯ç®¡ç†beançš„å·¥åŽ‚ã€‚Springä¸­bean æ˜¯ä¸€ä¸ªè¢«å®žä¾‹åŒ–ï¼Œç»„è£…ï¼Œå¹¶é€šè¿‡ Spring IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚è¿™äº› bean æ˜¯ç”±ç”¨å®¹å™¨æä¾›çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ã€‚Springå¯ä»¥é‡‡ç”¨XMLé…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥ç®¡ç†å’Œé…ç½®Beanä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;beans&lt;/span> &lt;span style="color:#a6e22e">xmlns=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xmlns:xsi=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xsi:schemaLocation=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;bean&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">class=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.wgs.spring.bean.User&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/bean&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/beans&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>&amp;lt;beans&amp;gt;&lt;/code>æ˜¯XMLé…ç½®æ–‡ä»¶ä¸­æ ¹èŠ‚ç‚¹ï¼Œä¸‹é¢å¯åŒ…å«å¤šä¸ª&lt;code>&amp;lt;bean&amp;gt;&lt;/code>å­èŠ‚ç‚¹ã€‚Springçš„XMLé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¸Ž&lt;code>&amp;lt;bean&amp;gt;&lt;/code>å…ƒç´ æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å±žæ€§&lt;/th>
&lt;th>æè¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>id&lt;/td>
&lt;td>æ³¨å†Œåˆ°å®¹å™¨çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„idå€¼ï¼Œå¦‚id=&amp;ldquo;user&amp;rdquo;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>name&lt;/td>
&lt;td>beançš„åˆ«å,nameå¯ä»¥ä½¿ç”¨é€—å·ã€ç©ºæ ¼æˆ–å†’å·ç­‰åˆ†å‰²æŒ‡å®šå¤šä¸ªnameï¼Œè€Œidå°±ä¸å¯ä»¥&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>scope&lt;/td>
&lt;td>ä½œç”¨åŸŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>constructor-arg&lt;/td>
&lt;td>ç”¨æ¥æ³¨å…¥ä¾èµ–å…³ç³»&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>properties&lt;/td>
&lt;td>ç”¨æ¥æ³¨å…¥ä¾èµ–å…³ç³»&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>autowiring mode&lt;/td>
&lt;td>ç”¨æ¥æ³¨å…¥ä¾èµ–å…³ç³»&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lazy-initialization mode&lt;/td>
&lt;td>æ˜¯å¦å»¶è¿ŸåŠ è½½&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>initialization method&lt;/td>
&lt;td>beanè¢«åˆ›å»ºçš„æ—¶å€™,åˆå§‹åŒ–çš„çš„æ–¹æ³•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>destruction method&lt;/td>
&lt;td>é”€æ¯æŒ‡å®šçš„æ–¹æ³•&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051459690.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051458611.png" alt="">&lt;/p>
&lt;h1 id="spring-bean-ç”Ÿå‘½å‘¨æœŸ">Spring Bean ç”Ÿå‘½å‘¨æœŸ&lt;/h1>
&lt;p>2.ä½Žæ˜‚registerBeanFactoryPostProcessor Â å®Œæˆæ‰«æ,è¿è¡Œä¹‹å‰,ä¸ä¼šæœ‰æˆ‘ä»¬è‡ªå·±çš„ç±»,é™¤äº†&lt;code>@componentScan&lt;/code>è¿™ä¸ªæ³¨è§£çš„è¿™ä¸ªç±»,ç­‰å®Œæˆä¹‹åŽ,å°±ä¼šæœ‰æˆ‘ä»¬è‡ªå·±çš„ç±»&lt;/p>
&lt;p>1ï¼šå®žä¾‹åŒ–ä¸€ä¸ªApplicationContextçš„å¯¹è±¡ï¼›2ï¼šè°ƒç”¨beanå·¥åŽ‚åŽç½®å¤„ç†å™¨å®Œæˆæ‰«æï¼›3ï¼šå¾ªçŽ¯è§£æžæ‰«æå‡ºæ¥çš„ç±»ä¿¡æ¯ï¼›4ï¼šå®žä¾‹åŒ–ä¸€ä¸ªBeanDefinitionå¯¹è±¡æ¥å­˜å‚¨è§£æžå‡ºæ¥çš„ä¿¡æ¯ï¼›5ï¼šæŠŠå®žä¾‹åŒ–å¥½çš„beanDefinitionå¯¹è±¡putåˆ°&lt;code>beanDefinitionMap&lt;/code>å½“ä¸­ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿åŽé¢å®žä¾‹åŒ–beanï¼›6ï¼šå†æ¬¡è°ƒç”¨beanå·¥åŽ‚åŽç½®å¤„ç†å™¨ï¼›7ï¼šå½“ç„¶springè¿˜ä¼šå¹²å¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚å›½é™…åŒ–ï¼Œæ¯”å¦‚æ³¨å†ŒBeanPostProcessorç­‰ç­‰ï¼Œå¦‚æžœæˆ‘ä»¬åªå…³å¿ƒå¦‚ä½•å®žä¾‹åŒ–ä¸€ä¸ªbeançš„è¯é‚£ä¹ˆè¿™ä¸€æ­¥å°±æ˜¯springè°ƒç”¨&lt;code>finishBeanFactoryInitialization&lt;/code>æ–¹æ³•æ¥å®žä¾‹åŒ–å•ä¾‹çš„beanï¼Œå®žä¾‹åŒ–ä¹‹å‰springè¦åšéªŒè¯ï¼Œéœ€è¦éåŽ†æ‰€æœ‰æ‰«æå‡ºæ¥çš„ç±»ï¼Œä¾æ¬¡åˆ¤æ–­è¿™ä¸ªbeanæ˜¯å¦Lazyï¼Œæ˜¯å¦prototypeï¼Œæ˜¯å¦abstractç­‰ç­‰ï¼›8ï¼šå¦‚æžœéªŒè¯å®Œæˆspringåœ¨å®žä¾‹åŒ–ä¸€ä¸ªbeanä¹‹å‰éœ€è¦æŽ¨æ–­æž„é€ æ–¹æ³•ï¼Œå› ä¸ºspringå®žä¾‹åŒ–å¯¹è±¡æ˜¯é€šè¿‡æž„é€ æ–¹æ³•åå°„ï¼Œæ•…è€Œéœ€è¦çŸ¥é“ç”¨å“ªä¸ªæž„é€ æ–¹æ³•ï¼›9ï¼šæŽ¨æ–­å®Œæž„é€ æ–¹æ³•ä¹‹åŽspringè°ƒç”¨æž„é€ æ–¹æ³•åå°„å®žä¾‹åŒ–ä¸€ä¸ª&lt;strong>å¯¹è±¡&lt;/strong>ï¼›æ³¨æ„æˆ‘è¿™é‡Œè¯´çš„æ˜¯å¯¹è±¡ã€å¯¹è±¡ã€å¯¹è±¡ï¼›è¿™ä¸ªæ—¶å€™å¯¹è±¡å·²ç»å®žä¾‹åŒ–å‡ºæ¥äº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„beanï¼Œæœ€ç®€å•çš„ä½“çŽ°æ˜¯è¿™ä¸ªæ—¶å€™å®žä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡å±žæ€§æ˜¯æ²¡æœ‰æ³¨å…¥ï¼Œæ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„beanï¼›10ï¼šspringå¤„ç†åˆå¹¶åŽçš„beanDefinition(åˆå¹¶ï¼Ÿæ˜¯springå½“ä¸­éžå¸¸é‡è¦çš„ä¸€å—å†…å®¹ï¼ŒåŽé¢çš„æ–‡ç« æˆ‘ä¼šåˆ†æž)ï¼›11ï¼šåˆ¤æ–­æ˜¯å¦æ”¯æŒå¾ªçŽ¯ä¾èµ–ï¼Œå¦‚æžœæ”¯æŒåˆ™æå‰æŠŠä¸€ä¸ªå·¥åŽ‚å­˜å…¥singletonFactoriesâ€”â€”mapï¼›12ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦å®Œæˆå±žæ€§æ³¨å…¥13ï¼šå¦‚æžœéœ€è¦å®Œæˆå±žæ€§æ³¨å…¥ï¼Œåˆ™å¼€å§‹æ³¨å…¥å±žæ€§14ï¼šåˆ¤æ–­beançš„ç±»åž‹å›žè°ƒAwareæŽ¥å£15ï¼šè°ƒç”¨ç”Ÿå‘½å‘¨æœŸå›žè°ƒæ–¹æ³•16ï¼šå¦‚æžœéœ€è¦ä»£ç†åˆ™å®Œæˆä»£ç†17ï¼šputåˆ°å•ä¾‹æ± â€”â€”beanå®Œæˆâ€”â€”å­˜åœ¨springå®¹å™¨å½“ä¸­&lt;/p>
&lt;h1 id="spring-bean-å¾ªçŽ¯ä¾èµ–">Spring Bean å¾ªçŽ¯ä¾èµ–&lt;/h1>
&lt;p>&lt;a href="https://juejin.im/post/6844904166351978504#h5">https://juejin.im/post/6844904166351978504#h5&lt;/a>&lt;/p>
&lt;p>AnnotationConfigApplicationContext#AnnotationConfigApplicationContext&lt;/p>
&lt;pre tabindex="0">&lt;code>public AnnotationConfigApplicationContext(Class&amp;lt;?&amp;gt;... componentClasses) {
this();
register(componentClasses);
// å…³é”®æ–¹æ³•
refresh();
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.context.support.AbstractApplicationContext#refresh&lt;/p>
&lt;pre tabindex="0">&lt;code>@Override
public void refresh() throws BeansException, IllegalStateException {
synchronized (this.startupShutdownMonitor) {
// Prepare this context for refreshing.
prepareRefresh();
// Tell the subclass to refresh the internal bean factory.
ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();
// Prepare the bean factory for use in this context.
prepareBeanFactory(beanFactory);
try {
// Allows post-processing of the bean factory in context subclasses.
postProcessBeanFactory(beanFactory);
// Invoke factory processors registered as beans in the context.
invokeBeanFactoryPostProcessors(beanFactory);
// Register bean processors that intercept bean creation.
registerBeanPostProcessors(beanFactory);
// Initialize message source for this context.
initMessageSource();
// Initialize event multicaster for this context.
// å®Œæˆæ‰€æœ‰çš„æ‰«æ
initApplicationEventMulticaster();
// Initialize other special beans in specific context subclasses.
onRefresh();
// Check for listener beans and register them.
registerListeners();
// Instantiate all remaining (non-lazy-init) singletons.
// å®žä¾‹åŒ–æ‰€æœ‰æ²¡æœ‰å»¶è¿Ÿçš„å•ä¾‹ç±»
finishBeanFactoryInitialization(beanFactory);
// Last step: publish corresponding event.
finishRefresh();
}
}
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.context.support.AbstractApplicationContext#finishBeanFactoryInitialization&lt;/p>
&lt;pre tabindex="0">&lt;code>protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) {
// ....
// Instantiate all remaining (non-lazy-init) singletons.
// å®žä¾‹åŒ–æ‰€æœ‰å•ä¾‹,éžlazy
beanFactory.preInstantiateSingletons();
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.DefaultListableBeanFactory#preInstantiateSingletons&lt;/p>
&lt;pre tabindex="0">&lt;code>@Override
public void preInstantiateSingletons() throws BeansException {
if (logger.isTraceEnabled()) {
logger.trace(&amp;#34;Pre-instantiating singletons in &amp;#34; + this);
}
// Iterate over a copy to allow for init methods which in turn register new bean definitions.
// While this may not be part of the regular factory bootstrap, it does otherwise work fine.
List&amp;lt;String&amp;gt; beanNames = new ArrayList&amp;lt;&amp;gt;(this.beanDefinitionNames);
// Trigger initialization of all non-lazy singleton beans...
for (String beanName : beanNames) {
RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);
// éªŒè¯,åˆ¤æ–­è¿™ä¸ªæ˜¯æ˜¯ä¸æ˜¯æŠ½è±¡çš„å’Œæ˜¯ä¸æ˜¯å•ä¾‹çš„å’Œæ˜¯ä¸æ˜¯å»¶è¿ŸåŠ è½½çš„
if (!bd.isAbstract() &amp;amp;&amp;amp; bd.isSingleton() &amp;amp;&amp;amp; !bd.isLazyInit()) {
if (isFactoryBean(beanName)) {
Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);
if (bean instanceof FactoryBean) {
FactoryBean&amp;lt;?&amp;gt; factory = (FactoryBean&amp;lt;?&amp;gt;) bean;
boolean isEagerInit;
if (System.getSecurityManager() != null &amp;amp;&amp;amp; factory instanceof SmartFactoryBean) {
isEagerInit = AccessController.doPrivileged(
(PrivilegedAction&amp;lt;Boolean&amp;gt;) ((SmartFactoryBean&amp;lt;?&amp;gt;) factory)::isEagerInit,
getAccessControlContext());
}
else {
isEagerInit = (factory instanceof SmartFactoryBean &amp;amp;&amp;amp;
((SmartFactoryBean&amp;lt;?&amp;gt;) factory).isEagerInit());
}
if (isEagerInit) {
getBean(beanName);
}
}
}
else {
// éªŒè¯ä¸€åˆ‡éƒ½é€šè¿‡çš„ç±»,å¼€å§‹å®žä¾‹åŒ–æ™®é€šçš„bean,è¿˜ä¸æ˜¯spring bean
getBean(beanName);
}
}
}
// ....
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractBeanFactory#getBean(java.lang.String)&lt;/p>
&lt;pre tabindex="0">&lt;code>@Override
public Object getBean(String name) throws BeansException {
return doGetBean(name, null, null, false);
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractBeanFactory#doGetBean&lt;/p>
&lt;p>è¿™é‡Œé¢å¤§éƒ¨åˆ†éƒ½æ˜¯éªŒè¯,æ¯”å¦‚depenon,æˆ–è€…import&lt;/p>
&lt;pre tabindex="0">&lt;code>protected &amp;lt;T&amp;gt; T doGetBean(
String name, @Nullable Class&amp;lt;T&amp;gt; requiredType, @Nullable Object[] args, boolean typeCheckOnly)
throws BeansException {
// ç†è§£beançš„åå­—æ˜¯å¦éžæ³•
String beanName = transformedBeanName(name);
Object bean;
// Eagerly check singleton cache for manually registered singletons.
// è¿™é‡Œçš„æ–¹æ³•å•Š
Object sharedInstance = getSingleton(beanName);
if (sharedInstance != null &amp;amp;&amp;amp; args == null) {
bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);
}
else {
// Fail if we&amp;#39;re already creating this bean instance:
// We&amp;#39;re assumably within a circular reference.
// åˆ¤æ–­è¿™ä¸ªç±»æ˜¯ä¸æ˜¯åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­,å¾ªçŽ¯ä¾èµ–çš„æ—¶å€™è¦ç”¨
if (isPrototypeCurrentlyInCreation(beanName)) {
throw new BeanCurrentlyInCreationException(beanName);
}
// Check if bean definition exists in this factory.
BeanFactory parentBeanFactory = getParentBeanFactory();
if (parentBeanFactory != null &amp;amp;&amp;amp; !containsBeanDefinition(beanName)) {
// æ–¹æ³•æ³¨å…¥
// Not found -&amp;gt; check parent.
String nameToLookup = originalBeanName(name);
if (parentBeanFactory instanceof AbstractBeanFactory) {
return ((AbstractBeanFactory) parentBeanFactory).doGetBean(
nameToLookup, requiredType, args, typeCheckOnly);
}
else if (args != null) {
// Delegation to parent with explicit args.
return (T) parentBeanFactory.getBean(nameToLookup, args);
}
else if (requiredType != null) {
// No args -&amp;gt; delegate to standard getBean method.
return parentBeanFactory.getBean(nameToLookup, requiredType);
}
else {
return (T) parentBeanFactory.getBean(nameToLookup);
}
}
if (!typeCheckOnly) {
markBeanAsCreated(beanName);
}
try {
RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
checkMergedBeanDefinition(mbd, beanName, args);
// Guarantee initialization of beans that the current bean depends on.
String[] dependsOn = mbd.getDependsOn();
if (dependsOn != null) {
for (String dep : dependsOn) {
if (isDependent(beanName, dep)) {
throw new BeanCreationException(mbd.getResourceDescription(), beanName,
&amp;#34;Circular depends-on relationship between &amp;#39;&amp;#34; + beanName + &amp;#34;&amp;#39; and &amp;#39;&amp;#34; + dep + &amp;#34;&amp;#39;&amp;#34;);
}
registerDependentBean(dep, beanName);
try {
getBean(dep);
}
catch (NoSuchBeanDefinitionException ex) {
throw new BeanCreationException(mbd.getResourceDescription(), beanName,
&amp;#34;&amp;#39;&amp;#34; + beanName + &amp;#34;&amp;#39; depends on missing bean &amp;#39;&amp;#34; + dep + &amp;#34;&amp;#39;&amp;#34;, ex);
}
}
}
// Create bean instance.
// åˆ¤æ–­ç±»æ˜¯ä¸æ˜¯å•ä¾‹
if (mbd.isSingleton()) {
// getSingleton(String,facotory) è¿™ä¸ªæ–¹æ³•é‡Œæœ‰æ­£åœ¨åˆ›å»ºä¸­çš„æ ‡è¯†è®¾ç½®
sharedInstance = getSingleton(beanName, () -&amp;gt; {
try {
// å®Œæˆäº†ç›®æ ‡å¯¹è±¡çš„åˆ›å»º
// å¦‚æžœéœ€è¦ä»£ç†,è¿˜åˆ›å»ºäº†ä»£ç†
return createBean(beanName, mbd, args);
}
catch (BeansException ex) {
// Explicitly remove instance from singleton cache: It might have been put there
// eagerly by the creation process, to allow for circular reference resolution.
// Also remove any beans that received a temporary reference to the bean.
destroySingleton(beanName);
throw ex;
}
});
bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
}
else if (mbd.isPrototype()) {
// It&amp;#39;s a prototype -&amp;gt; create a new instance.
Object prototypeInstance = null;
try {
beforePrototypeCreation(beanName);
prototypeInstance = createBean(beanName, mbd, args);
}
finally {
afterPrototypeCreation(beanName);
}
bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);
}
else {
String scopeName = mbd.getScope();
if (!StringUtils.hasLength(scopeName)) {
throw new IllegalStateException(&amp;#34;No scope name defined for bean Â´&amp;#34; + beanName + &amp;#34;&amp;#39;&amp;#34;);
}
Scope scope = this.scopes.get(scopeName);
if (scope == null) {
throw new IllegalStateException(&amp;#34;No Scope registered for scope name &amp;#39;&amp;#34; + scopeName + &amp;#34;&amp;#39;&amp;#34;);
}
try {
Object scopedInstance = scope.get(beanName, () -&amp;gt; {
beforePrototypeCreation(beanName);
try {
return createBean(beanName, mbd, args);
}
finally {
afterPrototypeCreation(beanName);
}
});
bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);
}
catch (IllegalStateException ex) {
throw new BeanCreationException(beanName,
&amp;#34;Scope &amp;#39;&amp;#34; + scopeName + &amp;#34;&amp;#39; is not active for the current thread; consider &amp;#34; +
&amp;#34;defining a scoped proxy for this bean if you intend to refer to it from a singleton&amp;#34;,
ex);
}
}
}
catch (BeansException ex) {
cleanupAfterBeanCreationFailure(beanName);
throw ex;
}
}
// Check if required type matches the type of the actual bean instance.
if (requiredType != null &amp;amp;&amp;amp; !requiredType.isInstance(bean)) {
try {
T convertedBean = getTypeConverter().convertIfNecessary(bean, requiredType);
if (convertedBean == null) {
throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());
}
return convertedBean;
}
catch (TypeMismatchException ex) {
if (logger.isTraceEnabled()) {
logger.trace(&amp;#34;Failed to convert bean &amp;#39;&amp;#34; + name + &amp;#34;&amp;#39; to required type &amp;#39;&amp;#34; +
ClassUtils.getQualifiedName(requiredType) + &amp;#34;&amp;#39;&amp;#34;, ex);
}
throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());
}
}
return (T) bean;
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String)&lt;/p>
&lt;pre tabindex="0">&lt;code>// ä¸Šä¸ªä»£ç å—ç¬¬ä¸ƒè¡Œè°ƒç”¨çš„
@Override
@Nullable
public Object getSingleton(String beanName) {
return getSingleton(beanName, true);
}
/** Cache of singleton objects: bean name to bean instance. */
/** ç¼“å­˜å•ä¾‹å¯¹è±¡: bean name to bean instance. */
private final Map&amp;lt;String, Object&amp;gt; singletonObjects = new ConcurrentHashMap&amp;lt;&amp;gt;(256);
@Nullable
protected Object getSingleton(String beanName, boolean allowEarlyReference) {
// åˆå§‹åŒ–çš„æ—¶å€™è¿™é‡Œè‚¯å®šæ˜¯null,ä½†æ˜¯åœ¨åˆå§‹åŒ–å®Œæˆä¹‹åŽ,å†è°ƒç”¨getBeanå°±è‚¯å®šä¸æ˜¯null
// isSingletonCurrentlyInCreation è¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦,è¯´æ˜Žå¯¹è±¡æ˜¯ä¸æ˜¯æ­£åœ¨åˆ›å»º
// singletonFactories ä¹Ÿå¾ˆé‡è¦
Object singletonObject = this.singletonObjects.get(beanName);
// åˆ¤æ–­å¾ªçŽ¯ä¾èµ–çš„æ—¶å€™
if (singletonObject == null &amp;amp;&amp;amp; isSingletonCurrentlyInCreation(beanName)) {
synchronized (this.singletonObjects) {
singletonObject = this.earlySingletonObjects.get(beanName);
if (singletonObject == null &amp;amp;&amp;amp; allowEarlyReference) {
ObjectFactory&amp;lt;?&amp;gt; singletonFactory = this.singletonFactories.get(beanName);
if (singletonFactory != null) {
singletonObject = singletonFactory.getObject();
this.earlySingletonObjects.put(beanName, singletonObject);
this.singletonFactories.remove(beanName);
}
}
}
}
return singletonObject;
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean&lt;/p>
&lt;pre tabindex="0">&lt;code>@Override
protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
throws BeanCreationException {
if (logger.isTraceEnabled()) {
logger.trace(&amp;#34;Creating instance of bean &amp;#39;&amp;#34; + beanName + &amp;#34;&amp;#39;&amp;#34;);
}
RootBeanDefinition mbdToUse = mbd;
// Make sure bean class is actually resolved at this point, and
// clone the bean definition in case of a dynamically resolved Class
// which cannot be stored in the shared merged bean definition.
// ä»ŽbeanDefinitionå¯¹è±¡ä¸­èŽ·å–å‡ºæ¥beançš„ç±»åž‹
Class&amp;lt;?&amp;gt; resolvedClass = resolveBeanClass(mbd, beanName);
if (resolvedClass != null &amp;amp;&amp;amp; !mbd.hasBeanClass() &amp;amp;&amp;amp; mbd.getBeanClassName() != null) {
mbdToUse = new RootBeanDefinition(mbd);
mbdToUse.setBeanClass(resolvedClass);
}
// Prepare method overrides.
try {
mbdToUse.prepareMethodOverrides();
}
catch (BeanDefinitionValidationException ex) {
throw new BeanDefinitionStoreException(mbdToUse.getResourceDescription(),
beanName, &amp;#34;Validation of method overrides failed&amp;#34;, ex);
}
try {
// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.
// ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸ªåŽç½®å¤„ç†å™¨
Object bean = resolveBeforeInstantiation(beanName, mbdToUse);
if (bean != null) {
return bean;
}
}
catch (Throwable ex) {
throw new BeanCreationException(mbdToUse.getResourceDescription(), beanName,
&amp;#34;BeanPostProcessor before instantiation of bean failed&amp;#34;, ex);
}
try {
// è°ƒç”¨æ–¹æ³•
Object beanInstance = doCreateBean(beanName, mbdToUse, args);
if (logger.isTraceEnabled()) {
logger.trace(&amp;#34;Finished creating instance of bean &amp;#39;&amp;#34; + beanName + &amp;#34;&amp;#39;&amp;#34;);
}
return beanInstance;
}
catch (BeanCreationException | ImplicitlyAppearedSingletonException ex) {
// A previously detected exception with proper bean creation context already,
// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.
throw ex;
}
catch (Throwable ex) {
throw new BeanCreationException(
mbdToUse.getResourceDescription(), beanName, &amp;#34;Unexpected exception during bean creation&amp;#34;, ex);
}
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean&lt;/p>
&lt;pre tabindex="0">&lt;code>protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
throws BeanCreationException {
// Instantiate the bean.
BeanWrapper instanceWrapper = null;
if (mbd.isSingleton()) {
instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);
}
if (instanceWrapper == null) {
// å®žä¾‹åŒ–å¯¹è±¡,é‡Œé¢ç¬¬äºŒæ¬¡è°ƒè°ƒç”¨åŽç½®å¤„ç†å™¨
// åå°„è°ƒç”¨å¯¹è±¡çš„æž„é€ æ–¹æ³•
// è¿™é‡Œjavaå¯¹è±¡å°±å·²ç»æœ‰äº†
instanceWrapper = createBeanInstance(beanName, mbd, args);
}
Object bean = instanceWrapper.getWrappedInstance();
Class&amp;lt;?&amp;gt; beanType = instanceWrapper.getWrappedClass();
if (beanType != NullBean.class) {
mbd.resolvedTargetType = beanType;
}
// Allow post-processors to modify the merged bean definition.
synchronized (mbd.postProcessingLock) {
if (!mbd.postProcessed) {
try {
// ç¬¬ä¸‰æ¬¡è°ƒç”¨åŽç½®å¤„ç†å™¨
applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);
}
mbd.postProcessed = true;
}
}
// Eagerly cache singletons to be able to resolve circular references
// even when triggered by lifecycle interfaces like BeanFactoryAware.
// åˆ¤æ–­æ˜¯å¦éœ€è¦å¾ªçŽ¯ä¾èµ–
boolean earlySingletonExposure =
// åˆ°è¿™é‡Œäº†,ä¹Ÿè‚¯å®šæ˜¯true
(mbd.isSingleton() &amp;amp;&amp;amp;
// é»˜è®¤å€¼æ˜¯true
this.allowCircularReferences &amp;amp;&amp;amp;
isSingletonCurrentlyInCreation(beanName));
if (earlySingletonExposure) {
// ç¬¬å››æ¬¡è°ƒç”¨åŽç½®å¤„ç†å™¨,åˆ¤æ–­æ˜¯å¦éœ€è¦AOP
addSingletonFactory(beanName, () -&amp;gt; getEarlyBeanReference(beanName, mbd, bean));
}
// Initialize the bean instance.
Object exposedObject = bean;
try {
// å¡«å……å±žæ€§,ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„è‡ªåŠ¨æ³¨å…¥
// é‡Œé¢ä¼šå®Œæˆç¬¬äº”æ¬¡å’Œç¬¬å…­æ¬¡åŽç½®å¤„ç†å™¨çš„è°ƒç”¨
// çœ‹è¿™é‡Œ
populateBean(beanName, mbd, instanceWrapper);
// åˆå§‹åŒ–spring
// é‡Œé¢ä¼šè¿›è¡Œç¬¬ä¸ƒæ¬¡å’Œç¬¬å…«æ¬¡åŽç½®å¤„ç†çš„è°ƒç”¨ä¸ª
exposedObject = initializeBean(beanName, exposedObject, mbd);
}
catch (Throwable ex) {
if (ex instanceof BeanCreationException &amp;amp;&amp;amp; beanName.equals(((BeanCreationException) ex).getBeanName())) {
throw (BeanCreationException) ex;
}
else {
throw new BeanCreationException(
mbd.getResourceDescription(), beanName, &amp;#34;Initialization of bean failed&amp;#34;, ex);
}
}
if (earlySingletonExposure) {
Object earlySingletonReference = getSingleton(beanName, false);
if (earlySingletonReference != null) {
if (exposedObject == bean) {
exposedObject = earlySingletonReference;
}
else if (!this.allowRawInjectionDespiteWrapping &amp;amp;&amp;amp; hasDependentBean(beanName)) {
String[] dependentBeans = getDependentBeans(beanName);
Set&amp;lt;String&amp;gt; actualDependentBeans = new LinkedHashSet&amp;lt;&amp;gt;(dependentBeans.length);
for (String dependentBean : dependentBeans) {
if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {
actualDependentBeans.add(dependentBean);
}
}
// çœç•¥ä»£ç 
}
}
}
// Register bean as disposable.
try {
registerDisposableBeanIfNecessary(beanName, bean, mbd);
}
catch (BeanDefinitionValidationException ex) {
throw new BeanCreationException(
mbd.getResourceDescription(), beanName, &amp;#34;Invalid destruction signature&amp;#34;, ex);
}
return exposedObject;
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBeanInstance&lt;/p>
&lt;pre tabindex="0">&lt;code>protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) {
// Make sure bean class is actually resolved at this point.
Class&amp;lt;?&amp;gt; beanClass = resolveBeanClass(mbd, beanName);
if (beanClass != null &amp;amp;&amp;amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;amp;&amp;amp; !mbd.isNonPublicAccessAllowed()) {
throw new BeanCreationException(mbd.getResourceDescription(), beanName,
&amp;#34;Bean class isn&amp;#39;t public, and non-public access not allowed: &amp;#34; + beanClass.getName());
}
Supplier&amp;lt;?&amp;gt; instanceSupplier = mbd.getInstanceSupplier();
if (instanceSupplier != null) {
return obtainFromSupplier(instanceSupplier, beanName);
}
if (mbd.getFactoryMethodName() != null) {
return instantiateUsingFactoryMethod(beanName, mbd, args);
}
// Shortcut when re-creating the same bean...
boolean resolved = false;
boolean autowireNecessary = false;
if (args == null) {
synchronized (mbd.constructorArgumentLock) {
if (mbd.resolvedConstructorOrFactoryMethod != null) {
resolved = true;
autowireNecessary = mbd.constructorArgumentsResolved;
}
}
}
if (resolved) {
if (autowireNecessary) {
return autowireConstructor(beanName, mbd, null, null);
}
else {
return instantiateBean(beanName, mbd);
}
}
// Candidate constructors for autowiring?
// ç¬¬äºŒæ¬¡è°ƒç”¨åŽç½®å¤„ç†å™¨æž„é€ æ–¹æ³•,é€šè¿‡åå°„å®žä¾‹åŒ–å¯¹è±¡,è¿™æ—¶å€™æž„é€ æ–¹æ³•é‡Œæœ‰æ‰“å°,å°±ä¼šæ‰“å°å‡ºæ—¥å¿—
Constructor&amp;lt;?&amp;gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);
if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||
mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {
return autowireConstructor(beanName, mbd, ctors, args);
}
// Preferred constructors for default construction?
ctors = mbd.getPreferredConstructors();
if (ctors != null) {
return autowireConstructor(beanName, mbd, ctors, null);
}
// No special handling: simply use no-arg constructor.
return instantiateBean(beanName, mbd);
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#populateBean&lt;/p>
&lt;pre tabindex="0">&lt;code>protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
if (bw == null) {
if (mbd.hasPropertyValues()) {
throw new BeanCreationException(
mbd.getResourceDescription(), beanName, &amp;#34;Cannot apply property values to null instance&amp;#34;);
}
else {
// Skip property population phase for null instance.
return;
}
}
// Give any InstantiationAwareBeanPostProcessors the opportunity to modify the
// state of the bean before properties are set. This can be used, for example,
// to support styles of field injection.
if (!mbd.isSynthetic() &amp;amp;&amp;amp; hasInstantiationAwareBeanPostProcessors()) {
for (BeanPostProcessor bp : getBeanPostProcessors()) {
if (bp instanceof InstantiationAwareBeanPostProcessor) {
InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;
if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {
return;
}
}
}
}
PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);
int resolvedAutowireMode = mbd.getResolvedAutowireMode();
if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
MutablePropertyValues newPvs = new MutablePropertyValues(pvs);
// Add property values based on autowire by name if applicable.
if (resolvedAutowireMode == AUTOWIRE_BY_NAME) {
autowireByName(beanName, mbd, bw, newPvs);
}
// Add property values based on autowire by type if applicable.
if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
autowireByType(beanName, mbd, bw, newPvs);
}
pvs = newPvs;
}
boolean hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors();
boolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);
PropertyDescriptor[] filteredPds = null;
if (hasInstAwareBpps) {
if (pvs == null) {
pvs = mbd.getPropertyValues();
}
for (BeanPostProcessor bp : getBeanPostProcessors()) {
if (bp instanceof InstantiationAwareBeanPostProcessor) {
// è¿™é‡Œçš„ibpå¸¸ç”¨çš„æœ‰ä¸¤ç§ç±»åž‹
// 1.@Resouce ä½¿ç”¨çš„æ˜¯CommonAnnotationBeanPostProcessor
// 2.@Autowire ä½¿ç”¨çš„æ˜¯AutoWireAnnotationBeanPostProcessor
InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;
// è¿™é‡Œä¼šè°ƒç”¨å±žæ€§çš„æ³¨å…¥,ä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œ,ç¢°åˆ°å¾ªçŽ¯ä¾èµ–çš„æ—¶å€™,å°±ä¼šè°ƒç”¨ä¸ª
// org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton
PropertyValues pvsToUse = ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);
if (pvsToUse == null) {
if (filteredPds == null) {
filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
}
pvsToUse = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName);
if (pvsToUse == null) {
return;
}
}
pvs = pvsToUse;
}
}
}
if (needsDepCheck) {
if (filteredPds == null) {
filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
}
checkDependencies(beanName, mbd, filteredPds, pvs);
}
if (pvs != null) {
applyPropertyValues(beanName, mbd, bw, pvs);
}
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String, org.springframework.beans.factory.ObjectFactory&lt;?>)&lt;/p>
&lt;pre tabindex="0">&lt;code>public Object getSingleton(String beanName, ObjectFactory&amp;lt;?&amp;gt; singletonFactory) {
Assert.notNull(beanName, &amp;#34;Bean name must not be null&amp;#34;);
synchronized (this.singletonObjects) {
Object singletonObject = this.singletonObjects.get(beanName);
if (singletonObject == null) {
if (this.singletonsCurrentlyInDestruction) {
throw new BeanCreationNotAllowedException(beanName,
&amp;#34;Singleton bean creation not allowed while singletons of this factory are in destruction &amp;#34; +
&amp;#34;(Do not request a bean from a BeanFactory in a destroy method implementation!)&amp;#34;);
}
if (logger.isDebugEnabled()) {
logger.debug(&amp;#34;Creating shared instance of singleton bean &amp;#39;&amp;#34; + beanName + &amp;#34;&amp;#39;&amp;#34;);
}
// é‡ç‚¹,å¦‚æžœæ²¡æœ‰èŽ·å–åˆ°,å°±è®¾ç½®ä¸ªæ ‡è¯†,è¡¨ç¤ºæ­£åœ¨åˆ›å»º
beforeSingletonCreation(beanName);
boolean newSingleton = false;
boolean recordSuppressedExceptions = (this.suppressedExceptions == null);
if (recordSuppressedExceptions) {
this.suppressedExceptions = new LinkedHashSet&amp;lt;&amp;gt;();
}
try {
singletonObject = singletonFactory.getObject();
newSingleton = true;
}
catch (IllegalStateException ex) {
// Has the singleton object implicitly appeared in the meantime -&amp;gt;
// if yes, proceed with it since the exception indicates that state.
singletonObject = this.singletonObjects.get(beanName);
if (singletonObject == null) {
throw ex;
}
}
catch (BeanCreationException ex) {
if (recordSuppressedExceptions) {
for (Exception suppressedException : this.suppressedExceptions) {
ex.addRelatedCause(suppressedException);
}
}
throw ex;
}
finally {
if (recordSuppressedExceptions) {
this.suppressedExceptions = null;
}
afterSingletonCreation(beanName);
}
if (newSingleton) {
addSingleton(beanName, singletonObject);
}
}
return singletonObject;
}
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#beforeSingletonCreation&lt;/p>
&lt;pre tabindex="0">&lt;code>/** Names of beans that are currently in creation. */
// æ·»åŠ åˆ°è¿™é‡Œæ¥äº†ä¹‹åŽå°±æ ‡è¯†å½“å‰è¿™ä¸ªbeanæ­£åœ¨åˆ›å»º
private final Set&amp;lt;String&amp;gt; singletonsCurrentlyInCreation =
Collections.newSetFromMap(new ConcurrentHashMap&amp;lt;&amp;gt;(16));
protected void beforeSingletonCreation(String beanName) {
if (!this.inCreationCheckExclusions.contains(beanName) &amp;amp;&amp;amp; !this.singletonsCurrentlyInCreation.add(beanName)) {
throw new BeanCurrentlyInCreationException(beanName);
}
}
&lt;/code>&lt;/pre>&lt;p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#addSingletonFactory&lt;/p>
&lt;p>äºŒçº§ç¼“å­˜&lt;/p>
&lt;pre tabindex="0">&lt;code>protected void addSingletonFactory(String beanName, ObjectFactory&amp;lt;?&amp;gt; singletonFactory) {
Assert.notNull(singletonFactory, &amp;#34;Singleton factory must not be null&amp;#34;);
synchronized (this.singletonObjects) {
if (!this.singletonObjects.containsKey(beanName)) {
this.singletonFactories.put(beanName, singletonFactory);
this.earlySingletonObjects.remove(beanName);
this.registeredSingletons.add(beanName);
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="ä¸‰ä¸ªç¼“å­˜">ä¸‰ä¸ªç¼“å­˜&lt;/h3>
&lt;pre tabindex="0">&lt;code>// singletonObjectsï¼šç¬¬ä¸€çº§ç¼“å­˜ï¼Œé‡Œé¢å­˜æ”¾çš„éƒ½æ˜¯åˆ›å»ºå¥½çš„æˆå“Beanã€‚
privateÂ finalÂ Map&amp;lt;String,Â Object&amp;gt;Â singletonObjectsÂ =Â newÂ ConcurrentHashMap&amp;lt;String,Â Object(256);
// earlySingletonObjects : ç¬¬äºŒçº§ç¼“å­˜ï¼Œé‡Œé¢å­˜æ”¾çš„éƒ½æ˜¯åŠæˆå“çš„Bean
privateÂ finalÂ Map&amp;lt;String,Â Object&amp;gt;Â earlySingletonObjectsÂ =Â newÂ HashMap&amp;lt;String,Â Object(16);
// singletonFactories ï¼šç¬¬ä¸‰çº§ç¼“å­˜ï¼Œ ä¸åŒäºŽå‰ä¸¤ä¸ªå­˜çš„æ˜¯ Beanå¯¹è±¡å¼•ç”¨ï¼Œæ­¤ç¼“å­˜å­˜çš„bean å·¥åŽ‚å¯¹è±¡ï¼Œä¹Ÿå°±å­˜çš„æ˜¯ ä¸“é—¨åˆ›å»ºBeançš„ä¸€ä¸ªå·¥åŽ‚å¯¹è±¡ã€‚æ­¤ç¼“å­˜ç”¨äºŽè§£å†³å¾ªçŽ¯ä¾èµ–
privateÂ finalÂ Map&amp;lt;String,Â ObjectFactory&amp;lt;?&amp;gt;&amp;gt;Â singletonFactoriesÂ =Â newÂ HashMap&amp;lt;String,Â ObjectFactory&amp;lt;?&amp;gt;&amp;gt;(16);
&lt;/code>&lt;/pre>&lt;h3 id="ä¸¤ä¸ªç¼“å­˜èƒ½è§£å†³ä¸">ä¸¤ä¸ªç¼“å­˜èƒ½è§£å†³ä¸&lt;/h3>
&lt;p>Aå¼•ç”¨åˆ›å»ºåŽï¼Œæå‰æš´éœ²åˆ°&lt;code>åŠæˆå“ç¼“å­˜ä¸­&lt;/code>&lt;/p>
&lt;p>ä¾èµ–Bï¼Œåˆ›å»ºB ï¼ŒBå¡«å……å±žæ€§æ—¶å‘çŽ°ä¾èµ–Aï¼Œ &lt;code>å…ˆä»Žæˆå“ç¼“å­˜æŸ¥æ‰¾ï¼Œæ²¡æœ‰,å†ä»ŽåŠæˆå“ç¼“å­˜æŸ¥æ‰¾&lt;/code> å–åˆ°Açš„&lt;code>æ—©æœŸå¼•ç”¨&lt;/code>ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>Bé¡ºåˆ©èµ°å®Œåˆ›å»ºè¿‡ç¨‹`, å°†`Bçš„æ—©æœŸå¼•ç”¨ä»ŽåŠæˆå“ç¼“å­˜ç§»åŠ¨åˆ°æˆå“ç¼“å­˜
&lt;/code>&lt;/pre>&lt;p>Båˆ›å»ºå®Œæˆï¼ŒAèŽ·å–åˆ°Bçš„å¼•ç”¨ï¼Œç»§ç»­åˆ›å»ºã€‚&lt;/p>
&lt;p>Aåˆ›å»ºå®Œæˆï¼Œå°†&lt;code>Açš„æ—©æœŸå¼•ç”¨ä»ŽåŠæˆå“ç¼“å­˜ç§»åŠ¨åˆ°æˆå“ç¼“å­˜&lt;/code>&lt;/p>
&lt;h3 id="ä¸ºå•¥éœ€è¦ä¸‰ä¸ªç¼“å­˜">ä¸ºå•¥éœ€è¦ä¸‰ä¸ªç¼“å­˜&lt;/h3>
&lt;p>ä¸Šé¢ä¸¤ä¸ªç¼“å­˜çš„åœ°æ–¹ï¼Œæˆ‘ä»¬åªæ˜¯æ²¡æœ‰è€ƒè™‘ä»£ç†çš„æƒ…å†µã€‚&lt;/p>
&lt;p>Beanåœ¨åˆ›å»ºçš„æœ€åŽé˜¶æ®µï¼Œä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºä»£ç†ï¼Œå¦‚æžœåˆ›å»ºäº†ä»£ç†ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿”å›žçš„å°±æ˜¯ä»£ç†å®žä¾‹çš„å¼•ç”¨ã€‚æˆ‘ä»¬é€šè¿‡beannameèŽ·å–åˆ°æœ€ç»ˆæ˜¯ä»£ç†å®žä¾‹çš„å¼•ç”¨&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼šå‡è®¾Aæœ€ç»ˆä¼šåˆ›å»ºä»£ç†ï¼Œæå‰æš´éœ²Açš„å¼•ç”¨ï¼Œ Bå¡«å……å±žæ€§æ—¶å¡«å……çš„æ˜¯Açš„åŽŸå§‹å¯¹è±¡å¼•ç”¨ã€‚Aæœ€ç»ˆæ”¾å…¥æˆå“åº“é‡Œæ˜¯ä»£ç†çš„å¼•ç”¨ã€‚é‚£ä¹ˆBä¸­ä¾ç„¶æ˜¯Açš„æ—©æœŸå¼•ç”¨ã€‚è¿™ç§ç»“æžœæœ€ç»ˆä¼šä¸Žæˆ‘ä»¬çš„æœŸæœ›çš„å¤§ç›¸å¾„åº­äº†ã€‚&lt;/p>
&lt;h3 id="å®Œæ•´çš„æµç¨‹">å®Œæ•´çš„æµç¨‹&lt;/h3>
&lt;p>å…³é”®ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>Aç»‘å®šåˆ°ObjectFactory æ³¨å†Œåˆ°&lt;code>å·¥åŽ‚ç¼“å­˜singletonFactory&lt;/code>ä¸­ï¼Œ&lt;/li>
&lt;li>Båœ¨å¡«å……Aæ—¶ï¼Œ&lt;code>å…ˆæŸ¥æˆå“ç¼“å­˜&lt;/code>æœ‰æ²¡æœ‰ï¼Œ&lt;code>å†æŸ¥åŠæˆå“ç¼“å­˜&lt;/code>æœ‰æ²¡æœ‰ï¼Œ&lt;code>æœ€åŽçœ‹å·¥åŽ‚ç¼“å­˜æœ‰æ²¡æœ‰å•ä¾‹å·¥åŽ‚ç±»&lt;/code>ï¼Œæœ‰Açš„ObjectFactoryã€‚è°ƒç”¨getObject ï¼Œæ‰§è¡Œæ‰©å±•é€»è¾‘ï¼Œå¯èƒ½è¿”å›žçš„ä»£ç†å¼•ç”¨ï¼Œä¹Ÿå¯èƒ½è¿”å›žåŽŸå§‹å¼•ç”¨ã€‚&lt;/li>
&lt;li>æˆåŠŸèŽ·å–åˆ°Açš„æ—©æœŸå¼•ç”¨ï¼Œå°†Aæ”¾å…¥åˆ°&lt;code>åŠæˆå“ç¼“å­˜&lt;/code>ä¸­ï¼ŒBå¡«å……Aå¼•ç”¨å®Œæ¯•ã€‚&lt;/li>
&lt;li>ä»£ç†é—®é¢˜ï¼Œ å¾ªçŽ¯ä¾èµ–é—®é¢˜éƒ½è§£å†³äº†&lt;/li>
&lt;/ul>
&lt;h1 id="spring-bean-äºŒæ¬¡å¼€å‘">Spring Bean äºŒæ¬¡å¼€å‘&lt;/h1>
&lt;p>åœ¨å®žä¾‹åŒ–Beanä¹‹å‰,Springä¼šè°ƒç”¨æ‰©å±•çš„ç±»,å®žçŽ°&lt;code>BeanFactoryPostProcessor&lt;/code>,å¹¶ä¸”æœºä¸Š&lt;code>@component&lt;/code>æ³¨è§£,å¦‚æžœæ²¡æœ‰å®žçŽ°,springå°±ä¸ä¼šè°ƒç”¨&lt;/p>
&lt;h1 id="spring-aop">Spring AOP&lt;/h1>
&lt;h1 id="aopæ˜¯ä»€ä¹ˆ">AOPæ˜¯ä»€ä¹ˆ&lt;/h1>
&lt;p>AOPçš„å…¨ç§°æ˜¯Aspect Orient Programmingï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚æ˜¯å¯¹OOPï¼ˆObject Orient Programmingï¼‰çš„ä¸€ç§è¡¥å……ï¼Œæˆ˜é—¨ç”¨äºŽå¤„ç†ä¸€äº›å…·æœ‰æ¨ªåˆ‡æ€§è´¨çš„æœåŠ¡ã€‚å¸¸å¸¸ç”¨äºŽæ—¥å¿—è¾“å‡ºã€å®‰å…¨æŽ§åˆ¶ç­‰ã€‚&lt;/p>
&lt;p>ä¸Šé¢è¯´åˆ°æ˜¯å¯¹OOPçš„ä¸€ç§è¡¥å……ï¼Œå…·ä½“è¡¥å……çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè€ƒè™‘ä¸€ç§æƒ…å†µï¼Œå¦‚æžœæˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰æ–¹æ³•æ‰§è¡Œå‰æ‰“å°ä¸€å¥æ—¥å¿—ï¼ŒæŒ‰ç…§OOPçš„å¤„ç†æ€æƒ³ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¼€å§‹æ—¶åŠ å…¥ä¸€äº›è¯­å¥ï¼Œä½†æ˜¯æˆ‘ä»¬è¾›è¾›è‹¦è‹¦åŠ å®Œä¹‹åŽï¼Œå¦‚æžœåˆè¦æ±‚åœ¨è¿™å¥æ—¥å¿—æ‰“å°åŽå†æ‰“å°ä¸€å¥ï¼Œé‚£æ˜¯ä¸æ˜¯åˆè¦åŠ ä¸€éï¼Ÿè¿™æ—¶å€™ä½ ä¸€å®šä¼šæƒ³åˆ°ï¼Œåœ¨æŸä¸ªç±»ä¸­ç¼–å†™ä¸€ä¸ªæ—¥å¿—æ‰“å°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œè¿™äº›æ—¥å¿—æ‰“å°æ“ä½œï¼Œç„¶åŽåœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¹‹å‰åŠ å…¥è¿™å¥æ–¹æ³•è°ƒç”¨ï¼Œè¿™å°±æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ã€‚ä½†æ˜¯å¦‚æžœè¦æ±‚æˆ‘ä»¬åœ¨ä¸šåŠ¡æ–¹æ³•ç»“æŸæ—¶å†æ‰“å°ä¸€äº›æ—¥å¿—å‘¢ï¼Œæ˜¯ä¸æ˜¯è¿˜è¦åŽ»æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ç»“æŸæ—¶åŠ ä¸€éï¼Ÿè¿™æ ·å§‹ç»ˆä¸æ˜¯åŠžæ³•ï¼Œè€Œä¸”æˆ‘ä»¬æ€»æ˜¯åœ¨æ”¹ä¸šåŠ¡æ–¹æ³•ï¼Œåœ¨ä¸šåŠ¡æ–¹æ³•é‡Œé¢æŽºæ‚äº†å¤ªå¤šçš„å…¶ä»–æ“ä½œï¼Œä¾µå…¥æ€§å¤ªé«˜ã€‚&lt;/p>
&lt;p>è¿™æ—¶å€™AOPå°±èµ·åˆ°ä½œç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåˆ‡é¢ç±»ï¼ˆAspectï¼‰ï¼Œåœ¨å…¶ä¸­çš„æ–¹æ³•ä¸­æ¥ç¼–å†™æ¨ªåˆ‡é€»è¾‘ï¼ˆå¦‚æ‰“å°æ—¥å¿—ï¼‰ï¼Œç„¶åŽé€šè¿‡é…ç½®æˆ–è€…æ³¨è§£çš„æ–¹å¼æ¥å£°æ˜Žè¯¥æ¨ªåˆ‡é€»è¾‘èµ·ä½œç”¨çš„ä½ç½®ã€‚&lt;/p>
&lt;h1 id="å®žçŽ°æŠ€æœ¯">å®žçŽ°æŠ€æœ¯&lt;/h1>
&lt;p>AOPï¼ˆè¿™é‡Œçš„AOPæŒ‡çš„æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³ï¼Œè€Œä¸æ˜¯Spring AOPï¼‰ä¸»è¦çš„çš„å®žçŽ°æŠ€æœ¯ä¸»è¦æœ‰Spring AOPå’ŒAspectJã€‚&lt;/p>
&lt;p>1ã€AspectJçš„åº•å±‚æŠ€æœ¯ã€‚&lt;/p>
&lt;p>AspectJçš„åº•å±‚æŠ€æœ¯æ˜¯é™æ€ä»£ç†ï¼Œå³ç”¨ä¸€ç§AspectJæ”¯æŒçš„ç‰¹å®šè¯­è¨€ç¼–å†™åˆ‡é¢ï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥ç¼–è¯‘ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ä»£ç†ç±»ï¼Œè¯¥ä»£ç†ç±»å¢žå¼ºäº†ä¸šåŠ¡ç±»ï¼Œè¿™æ˜¯åœ¨ç¼–è¯‘æ—¶å¢žå¼ºï¼Œç›¸å¯¹äºŽä¸‹é¢è¯´çš„è¿è¡Œæ—¶å¢žå¼ºï¼Œç¼–è¯‘æ—¶å¢žå¼ºçš„æ€§èƒ½æ›´å¥½ã€‚&lt;/p>
&lt;p>2ã€Spring AOP&lt;/p>
&lt;p>Spring AOPé‡‡ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†ï¼Œåœ¨è¿è¡ŒæœŸé—´å¯¹ä¸šåŠ¡æ–¹æ³•è¿›è¡Œå¢žå¼ºï¼Œæ‰€ä»¥ä¸ä¼šç”Ÿæˆæ–°ç±»ï¼Œå¯¹äºŽåŠ¨æ€ä»£ç†æŠ€æœ¯ï¼ŒSpring AOPæä¾›äº†å¯¹JDKåŠ¨æ€ä»£ç†çš„æ”¯æŒä»¥åŠCGLibçš„æ”¯æŒã€‚&lt;/p>
&lt;p>JDKåŠ¨æ€ä»£ç†åªèƒ½ä¸ºæŽ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†å®žä¾‹ï¼Œè€Œä¸èƒ½å¯¹ç±»åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚éœ€è¦èŽ·å¾—è¢«ç›®æ ‡ç±»çš„æŽ¥å£ä¿¡æ¯ï¼ˆåº”ç”¨Javaçš„åå°„æŠ€æœ¯ï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå®žçŽ°äº†ä»£ç†æŽ¥å£çš„åŠ¨æ€ä»£ç†ç±»ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œå†é€šè¿‡åå°„æœºåˆ¶èŽ·å¾—åŠ¨æ€ä»£ç†ç±»çš„æž„é€ å‡½æ•°ï¼Œåˆ©ç”¨æž„é€ å‡½æ•°ç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„å®žä¾‹å¯¹è±¡ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨invokeHandleræ–¹æ³•æ¥å¤„ç†ã€‚&lt;/p>
&lt;p>CGLibåŠ¨æ€ä»£ç†éœ€è¦ä¾èµ–asmåŒ…ï¼ŒæŠŠè¢«ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»ã€‚&lt;/p>
&lt;p>ä½†æ˜¯Spring AOPåŸºäºŽæ³¨è§£é…ç½®çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä¾èµ–äºŽAspectJåŒ…çš„æ ‡å‡†æ³¨è§£ï¼Œä½†æ˜¯ä¸éœ€è¦é¢å¤–çš„ç¼–è¯‘ä»¥åŠAspectJçš„ç»‡å…¥å™¨ï¼Œè€ŒåŸºäºŽXMLé…ç½®ä¸éœ€è¦ã€‚&lt;/p>
&lt;h1 id="çŸ¥è¯†ç‚¹">çŸ¥è¯†ç‚¹&lt;/h1>
&lt;h3 id="pointcut">PointCut&lt;/h3>
&lt;p>ä½ æƒ³è¦åŽ»åˆ‡æŸä¸ªä¸œè¥¿ä¹‹å‰æ€»å¾—å…ˆçŸ¥é“è¦åœ¨å“ªé‡Œåˆ‡å…¥æ˜¯å§ï¼Œåˆ‡ç‚¹æ ¼å¼å¦‚ä¸‹ï¼š&lt;code>execution(* com.nuofankj.springdemo.aop.*Service.*(..))&lt;/code>æ ¼å¼ä½¿ç”¨äº†æ­£å¸¸è¡¨è¾¾å¼æ¥å®šä¹‰é‚£ä¸ªèŒƒå›´å†…çš„ç±»ã€é‚£äº›æŽ¥å£ä¼šè¢«å½“æˆåˆ‡ç‚¹&lt;/p>
&lt;h3 id="advice">Advice&lt;/h3>
&lt;p>é€šçŸ¥,æ‰€è°“çš„Adviceå…¶å®žå°±æ˜¯å®šä¹‰äº†Aopä½•æ—¶è¢«è°ƒç”¨ï¼Œç¡®å®žæœ‰ç§é€šçŸ¥çš„æ„Ÿè§‰&lt;/p>
&lt;ul>
&lt;li>Before åœ¨æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰è°ƒç”¨&lt;/li>
&lt;li>After åœ¨æ–¹æ³•å®Œæˆä¹‹åŽè°ƒç”¨&lt;/li>
&lt;li>After-returning åœ¨æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åŽè°ƒç”¨&lt;/li>
&lt;li>After-throwing åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ä¹‹åŽè°ƒç”¨&lt;/li>
&lt;li>Around åœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åŽè°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h3 id="joinpoint">JoinPoint&lt;/h3>
&lt;p>JoinPointè¿žæŽ¥ç‚¹ï¼Œå…¶å®žå¾ˆå¥½ç†è§£ï¼Œä¸Šé¢åˆæœ‰é€šçŸ¥ã€åˆæœ‰åˆ‡ç‚¹ï¼Œé‚£å’Œå…·ä½“ä¸šåŠ¡çš„è¿žæŽ¥ç‚¹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ²¡é”™ï¼Œå…¶å®žå°±æ˜¯å¯¹åº”ä¸šåŠ¡çš„æ–¹æ³•å¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¨ªåˆ‡ä»£ç ä¸­æ˜¯æœ‰å¯èƒ½éœ€è¦ç”¨åˆ°å…·ä½“æ–¹æ³•ä¸­çš„å…·ä½“æ•°æ®çš„ï¼Œè€Œè¿žæŽ¥ç‚¹ä¾¿å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p>
&lt;h3 id="aspect">Aspect&lt;/h3>
&lt;p>å°±æ˜¯æˆ‘ä»¬å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–ã€‚è¿™ä¸ªå…³æ³¨ç‚¹å¯èƒ½ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡å’Œæ¨¡å—ï¼Œäº‹åŠ¡ç®¡ç†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¾ˆå¥½çš„ä¾‹å­ã€‚å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œä»Žè½¯ä»¶çš„è§’åº¦æ¥è¯´æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºä¸åŒæ¨¡å—ä¸­çš„æŸä¸€ä¸ªé¢†åŸŸæˆ–æ–¹é¢ã€‚åˆpointcut å’Œadviceç»„æˆã€‚&lt;/p>
&lt;h3 id="weaving">Weaving&lt;/h3>
&lt;p>æŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ advised å¯¹è±¡çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;h1 id="åŽŸç†">åŽŸç†&lt;/h1>
&lt;h3 id="ç®€å•è¯´è¯´-aop-çš„è®¾è®¡">ç®€å•è¯´è¯´ AOP çš„è®¾è®¡&lt;/h3>
&lt;ol>
&lt;li>æ¯ä¸ª Bean éƒ½ä¼šè¢« JDK æˆ–è€… Cglib ä»£ç†ã€‚å–å†³äºŽæ˜¯å¦æœ‰æŽ¥å£ã€‚&lt;/li>
&lt;li>æ¯ä¸ª Bean ä¼šæœ‰å¤šä¸ªâ€œæ–¹æ³•æ‹¦æˆªå™¨â€ã€‚æ³¨æ„ï¼šæ‹¦æˆªå™¨åˆ†ä¸ºä¸¤å±‚ï¼Œå¤–å±‚ç”± Spring å†…æ ¸æŽ§åˆ¶æµç¨‹ï¼Œå†…å±‚æ‹¦æˆªå™¨æ˜¯ç”¨æˆ·è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯ AOPã€‚&lt;/li>
&lt;li>å½“ä»£ç†æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…ˆç»è¿‡å¤–å±‚æ‹¦æˆªå™¨ï¼Œå¤–å±‚æ‹¦æˆªå™¨æ ¹æ®æ–¹æ³•çš„å„ç§ä¿¡æ¯åˆ¤æ–­è¯¥æ–¹æ³•åº”è¯¥æ‰§è¡Œå“ªäº›â€œå†…å±‚æ‹¦æˆªå™¨â€ã€‚å†…å±‚æ‹¦æˆªå™¨çš„è®¾è®¡å°±æ˜¯èŒè´£è¿žçš„è®¾è®¡ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="æµç¨‹">æµç¨‹&lt;/h3>
&lt;p>ä»£ç†çš„åˆ›å»ºï¼ˆæŒ‰æ­¥éª¤ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä»£ç†å·¥åŽ‚ï¼Œä»£ç†å·¥åŽ‚éœ€è¦ 3 ä¸ªé‡è¦çš„ä¿¡æ¯ï¼šæ‹¦æˆªå™¨æ•°ç»„ï¼Œç›®æ ‡å¯¹è±¡æŽ¥å£æ•°ç»„ï¼Œç›®æ ‡å¯¹è±¡ã€‚&lt;/li>
&lt;li>åˆ›å»ºä»£ç†å·¥åŽ‚æ—¶ï¼Œé»˜è®¤ä¼šåœ¨æ‹¦æˆªå™¨æ•°ç»„å°¾éƒ¨å†å¢žåŠ ä¸€ä¸ªé»˜è®¤æ‹¦æˆªå™¨ â€”â€” ç”¨äºŽæœ€ç»ˆçš„è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚&lt;/li>
&lt;li>å½“è°ƒç”¨ getProxy æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æŽ¥å£æ•°é‡å¤§ä½™ 0 æ¡ä»¶è¿”å›žä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆJDK orÂ Cglibï¼‰ã€‚&lt;/li>
&lt;li>æ³¨æ„ï¼šåˆ›å»ºä»£ç†å¯¹è±¡æ—¶ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªå¤–å±‚æ‹¦æˆªå™¨ï¼Œè¿™ä¸ªæ‹¦æˆªå™¨å°±æ˜¯ Spring å†…æ ¸çš„æ‹¦æˆªå™¨ã€‚ç”¨äºŽæŽ§åˆ¶æ•´ä¸ª AOP çš„æµç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»£ç†çš„è°ƒç”¨&lt;/p>
&lt;ul>
&lt;li>å½“å¯¹ä»£ç†å¯¹è±¡è¿›è¡Œè°ƒç”¨æ—¶ï¼Œå°±ä¼šè§¦å‘å¤–å±‚æ‹¦æˆªå™¨ã€‚&lt;/li>
&lt;li>å¤–å±‚æ‹¦æˆªå™¨æ ¹æ®ä»£ç†é…ç½®ä¿¡æ¯ï¼Œåˆ›å»ºå†…å±‚æ‹¦æˆªå™¨é“¾ã€‚åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ®è¡¨è¾¾å¼åˆ¤æ–­å½“å‰æ‹¦æˆªæ˜¯å¦åŒ¹é…è¿™ä¸ªæ‹¦æˆªå™¨ã€‚è€Œè¿™ä¸ªæ‹¦æˆªå™¨é“¾è®¾è®¡æ¨¡å¼å°±æ˜¯èŒè´£é“¾æ¨¡å¼ã€‚&lt;/li>
&lt;li>å½“æ•´ä¸ªé“¾æ¡æ‰§è¡Œåˆ°æœ€åŽæ—¶ï¼Œå°±ä¼šè§¦å‘åˆ›å»ºä»£ç†æ—¶é‚£ä¸ªå°¾éƒ¨çš„é»˜è®¤æ‹¦æˆªå™¨ï¼Œä»Žè€Œè°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚æœ€åŽè¿”å›žã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="springmccä¸´æ—¶ç”¨çš„">SpringMCCä¸´æ—¶ç”¨çš„&lt;/h1>
&lt;p>&lt;a href="https://zhuanlan.zhihu.com/p/62562499">https://zhuanlan.zhihu.com/p/62562499&lt;/a>&lt;/p>
&lt;h1 id="è®¾ç½®å±žæ€§">è®¾ç½®å±žæ€§&lt;/h1>
&lt;pre tabindex="0">&lt;code>// 1. è®¾ç½®å±žæ€§
// Make web application context available
request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());
// Make locale resolver available
request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);
// Make theme resolver available
request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);
&lt;/code>&lt;/pre>&lt;h1 id="æ ¹æ®-request-è¯·æ±‚çš„-url-å¾—åˆ°å¯¹åº”çš„-handler-æ‰§è¡Œé“¾å…¶å®žå°±æ˜¯æ‹¦æˆªå™¨å’Œ-controller-ä»£ç†å¯¹è±¡">æ ¹æ® Request è¯·æ±‚çš„ URL å¾—åˆ°å¯¹åº”çš„ handler æ‰§è¡Œé“¾ï¼Œå…¶å®žå°±æ˜¯æ‹¦æˆªå™¨å’Œ Controller ä»£ç†å¯¹è±¡&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2. æ‰¾ handler è¿”å›žæ‰§è¡Œé“¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HandlerExecutionChain mappedHandler &lt;span style="color:#f92672">=&lt;/span> getHandler(request);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å¾—åˆ°-handler-çš„é€‚é…å™¨">å¾—åˆ° handler çš„é€‚é…å™¨&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// This will throw an exception if no adapter is found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 3. è¿”å›ž handler çš„é€‚é…å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HandlerAdapter ha &lt;span style="color:#f92672">=&lt;/span> getHandlerAdapter(mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å¾ªçŽ¯æ‰§è¡Œ-handler-çš„-pre-æ‹¦æˆªå™¨">å¾ªçŽ¯æ‰§è¡Œ handler çš„ pre æ‹¦æˆªå™¨&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 4. å¾ªçŽ¯æ‰§è¡Œ handler çš„ pre æ‹¦æˆªå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> mappedHandler.&lt;span style="color:#a6e22e">getInterceptors&lt;/span>().&lt;span style="color:#a6e22e">length&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerInterceptor interceptor &lt;span style="color:#f92672">=&lt;/span> mappedHandler.&lt;span style="color:#a6e22e">getInterceptors&lt;/span>()&lt;span style="color:#f92672">[&lt;/span>i&lt;span style="color:#f92672">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pre æ‹¦æˆªå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>interceptor.&lt;span style="color:#a6e22e">preHandle&lt;/span>(request, response, mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>())) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æ‰§è¡ŒçœŸæ­£çš„-handlerå¹¶è¿”å›ž-modelandviewhandler-æ˜¯ä¸ªä»£ç†å¯¹è±¡å¯èƒ½ä¼šæ‰§è¡Œ-aop-">æ‰§è¡ŒçœŸæ­£çš„ handlerï¼Œå¹¶è¿”å›ž ModelAndView(Handler æ˜¯ä¸ªä»£ç†å¯¹è±¡ï¼Œå¯èƒ½ä¼šæ‰§è¡Œ AOP )&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 5. æ‰§è¡ŒçœŸæ­£çš„ handlerï¼Œå¹¶è¿”å›ž ModelAndView(Handler æ˜¯ä¸ªä»£ç†å¯¹è±¡ï¼Œå¯èƒ½ä¼šæ‰§è¡Œ AOP )&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ModelAndView mv &lt;span style="color:#f92672">=&lt;/span> ha.&lt;span style="color:#a6e22e">handle&lt;/span>(request, response, mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å¾ªçŽ¯æ‰§è¡Œ-handler-çš„-post-æ‹¦æˆªå™¨">å¾ªçŽ¯æ‰§è¡Œ handler çš„ post æ‹¦æˆªå™¨&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 6. å¾ªçŽ¯æ‰§è¡Œ handler çš„ post æ‹¦æˆªå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> mappedHandler.&lt;span style="color:#a6e22e">getInterceptors&lt;/span>().&lt;span style="color:#a6e22e">length&lt;/span> &lt;span style="color:#f92672">-&lt;/span> 1; i &lt;span style="color:#f92672">&amp;gt;=&lt;/span>0 ; i&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HandlerInterceptor interceptor &lt;span style="color:#f92672">=&lt;/span> mappedHandler.&lt;span style="color:#a6e22e">getInterceptors&lt;/span>()&lt;span style="color:#f92672">[&lt;/span>i&lt;span style="color:#f92672">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// post æ‹¦æˆªå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interceptor.&lt;span style="color:#a6e22e">postHandle&lt;/span>(request, response, mappedHandler.&lt;span style="color:#a6e22e">getHandler&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> æ ¹æ® ModelAndView ä¿¡æ¯å¾—åˆ° View å®žä¾‹
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> View view &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (mv.&lt;span style="color:#a6e22e">isReference&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// We need to resolve this view name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 7. æ ¹æ® ModelAndView ä¿¡æ¯å¾—åˆ° View å®žä¾‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> view &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">viewResolver&lt;/span>.&lt;span style="color:#a6e22e">resolveViewName&lt;/span>(mv.&lt;span style="color:#a6e22e">getViewName&lt;/span>(), locale);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> æ¸²æŸ“ View è¿”å›ž
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 8. æ¸²æŸ“ View è¿”å›ž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>view.&lt;span style="color:#a6e22e">render&lt;/span>(mv.&lt;span style="color:#a6e22e">getModel&lt;/span>(), request, response);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶å®žç†è§£è¿™äº›æ‰æ˜¯æœ€é‡è¦çš„ã€‚&lt;/p>
&lt;ol>
&lt;li>ç”¨æˆ·å‘é€è¯·æ±‚è‡³å‰ç«¯æŽ§åˆ¶å™¨DispatcherServlet&lt;/li>
&lt;li>DispatcherServletæ”¶åˆ°è¯·æ±‚è°ƒç”¨HandlerMappingå¤„ç†å™¨æ˜ å°„å™¨ã€‚&lt;/li>
&lt;li>å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®è¯·æ±‚urlæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡åŠå¤„ç†å™¨æ‹¦æˆªå™¨(å¦‚æžœæœ‰åˆ™ç”Ÿæˆ)ä¸€å¹¶è¿”å›žç»™DispatcherServletã€‚&lt;/li>
&lt;li>DispatcherServleté€šè¿‡HandlerAdapterå¤„ç†å™¨é€‚é…å™¨è°ƒç”¨å¤„ç†å™¨&lt;/li>
&lt;li>HandlerAdapteræ‰§è¡Œå¤„ç†å™¨(handlerï¼Œä¹Ÿå«åŽç«¯æŽ§åˆ¶å™¨)ã€‚&lt;/li>
&lt;li>Controlleræ‰§è¡Œå®Œæˆè¿”å›žModelAndView&lt;/li>
&lt;li>HandlerAdapterå°†handleræ‰§è¡Œç»“æžœModelAndViewè¿”å›žç»™DispatcherServlet&lt;/li>
&lt;li>DispatcherServletå°†ModelAndViewä¼ ç»™ViewResloverè§†å›¾è§£æžå™¨&lt;/li>
&lt;li>ViewResloverè§£æžåŽè¿”å›žå…·ä½“Viewå¯¹è±¡&lt;/li>
&lt;li>DispatcherServletå¯¹Viewè¿›è¡Œæ¸²æŸ“è§†å›¾ï¼ˆå³å°†æ¨¡åž‹æ•°æ®å¡«å……è‡³è§†å›¾ä¸­ï¼‰ã€‚&lt;/li>
&lt;li>DispatcherServletå“åº”ç”¨æˆ·&lt;/li>
&lt;/ol>
&lt;h1 id="springboot-å¯åŠ¨æµç¨‹">Springboot å¯åŠ¨æµç¨‹&lt;/h1>
&lt;p>&lt;a href="https://juejin.im/post/6844903669998026759">https://juejin.im/post/6844903669998026759&lt;/a>&lt;/p>
&lt;p>é€šè¿‡ &lt;code>SpringFactoriesLoader&lt;/code> åŠ è½½ &lt;code>META-INF/spring.factories&lt;/code> æ–‡ä»¶ï¼ŒèŽ·å–å¹¶åˆ›å»º &lt;code>SpringApplicationRunListener&lt;/code> å¯¹è±¡&lt;/p>
&lt;p>ç„¶åŽç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º starting æ¶ˆæ¯&lt;/p>
&lt;p>åˆ›å»ºå‚æ•°ï¼Œå¹¶é…ç½®å½“å‰ SpringBoot åº”ç”¨å°†è¦ä½¿ç”¨çš„ Environment&lt;/p>
&lt;p>å®Œæˆä¹‹åŽï¼Œä¾ç„¶ç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º environmentPrepared æ¶ˆæ¯&lt;/p>
&lt;p>åˆ›å»º &lt;code>ApplicationContext&lt;/code>&lt;/p>
&lt;p>åˆå§‹åŒ– &lt;code>ApplicationContext&lt;/code>ï¼Œå¹¶è®¾ç½® Environmentï¼ŒåŠ è½½ç›¸å…³é…ç½®ç­‰&lt;/p>
&lt;p>ç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º &lt;code>contextPrepared&lt;/code> æ¶ˆæ¯ï¼Œå‘ŠçŸ¥SpringBoot åº”ç”¨ä½¿ç”¨çš„ &lt;code>ApplicationContext&lt;/code> å·²å‡†å¤‡OK&lt;/p>
&lt;p>å°†å„ç§ beans è£…è½½å…¥ &lt;code>ApplicationContext&lt;/code>ï¼Œç»§ç»­ç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º contextLoaded æ¶ˆæ¯ï¼Œå‘ŠçŸ¥ SpringBoot åº”ç”¨ä½¿ç”¨çš„ &lt;code>ApplicationContext&lt;/code> å·²è£…å¡«OK&lt;/p>
&lt;p>refresh ApplicationContextï¼Œå®ŒæˆIoCå®¹å™¨å¯ç”¨çš„æœ€åŽä¸€æ­¥&lt;/p>
&lt;p>ç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º started æ¶ˆæ¯&lt;/p>
&lt;p>å®Œæˆæœ€ç»ˆçš„ç¨‹åºçš„å¯åŠ¨&lt;/p>
&lt;p>ç”± &lt;code>SpringApplicationRunListener&lt;/code> æ¥å‘å‡º running æ¶ˆæ¯ï¼Œå‘ŠçŸ¥ç¨‹åºå·²è¿è¡Œèµ·æ¥äº†&lt;/p>
&lt;h1 id="é™æ€å˜é‡æ³¨å…¥">é™æ€å˜é‡æ³¨å…¥&lt;/h1>
&lt;pre tabindex="0">&lt;code>application.propertiesä¸­é…ç½®ä¸‹é¢ä¸¤ä¸ªé…ç½®é¡¹
ccb.ip.address=10.25.177.31
ccb.ip.port=1600
ä¸‹é¢é—®é¢˜ä»£ç ä¸­è¯»å–ä¸åˆ°application.propertiesé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>@Component
public class BISFrontFileUtil {
private static Logger logger = LoggerFactory.getLogger(BISFrontFileUtil.class);
private static String CCBIPADDRESS;
private static int CCBIPPORT;
@Value(&amp;#34;${ccb.ip.address}&amp;#34;)
public void setCCBIPADDRESS(String cCBIPADDRESS) {
CCBIPADDRESS = cCBIPADDRESS;
}
@Value(&amp;#34;${ccb.ip.port}&amp;#34;)
public void setCCBIPPORT(int cCBIPPORT) {
CCBIPPORT = cCBIPPORT;
}
}
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„:&lt;/p>
&lt;ol>
&lt;li>ä¿®æ­£ä»£ç ä¸­çš„@Componentä¸å¯ä¸¢æŽ‰äº†&lt;/li>
&lt;li>setæ–¹æ³•è¦æ˜¯éžé™æ€çš„&lt;/li>
&lt;/ol>
&lt;h1 id="springbootçš„æ³¨è§£">SpringBootçš„æ³¨è§£&lt;/h1>
&lt;ul>
&lt;li>&lt;a href="https://juejin.cn/post/6844903842476195848#heading-12">@Configuration&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="configuration">&lt;a href="#ZgotmplZ">@Configuration&lt;/a>&lt;/h1>
&lt;h3 id="é…ç½®å¹¶å¯åŠ¨springå®¹å™¨">é…ç½®å¹¶å¯åŠ¨Springå®¹å™¨&lt;/h3>
&lt;p>@Configurationæ ‡æ³¨åœ¨ç±»ä¸Šï¼Œç›¸å½“äºŽæŠŠè¯¥ç±»ä½œä¸ºspringçš„xmlé…ç½®æ–‡ä»¶ä¸­çš„ï¼Œä½œç”¨ä¸ºï¼šé…ç½®springå®¹å™¨(åº”ç”¨ä¸Šä¸‹æ–‡)&lt;/p>
&lt;pre tabindex="0">&lt;code>import org.springframework.context.annotation.Configuration;
@Configuration
public class TestConfig {
public TestConfig(){
System.out.println(&amp;#34;testconfig collection init success&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>ç›¸å½“äºŽ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;beans&lt;/span> &lt;span style="color:#a6e22e">xmlns=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xmlns:xsi=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xmlns:context=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/context&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xmlns:jdbc=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/jdbc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xmlns:jee=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/jee&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xmlns:tx=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/tx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xmlns:util=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/util&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xmlns:task=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.springframework.org/schema/task&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xsi:schemaLocation=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.0.xsd&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">default-lazy-init=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/beans&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸»æ–¹æ³•è¿›è¡Œæµ‹è¯•:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.ApplicationContext;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.annotation.AnnotationConfigApplicationContext;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationContext context &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> AnnotationConfigApplicationContext(TestConfig.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœåŠ è½½spring-context.xmlæ–‡ä»¶ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ApplicationContext context = new&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ClassPathXmlApplicationContext(&amp;#34;spring-context.xml&amp;#34;);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: All illegal access operations will be denied in a future release
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>testconfig collection init success
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Process finished with exit code 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="configurationå¯åŠ¨å®¹å™¨beanæ³¨å†Œbean">@Configurationå¯åŠ¨å®¹å™¨+@Beanæ³¨å†ŒBean&lt;/h3>
&lt;p>@Beanæ ‡æ³¨åœ¨æ–¹æ³•ä¸Š(è¿”å›žæŸä¸ªå®žä¾‹çš„æ–¹æ³•)ï¼Œç­‰ä»·äºŽspringçš„xmlé…ç½®æ–‡ä»¶ä¸­çš„ï¼Œä½œç”¨ä¸ºï¼šæ³¨å†Œbeanå¯¹è±¡&lt;/p>
&lt;pre tabindex="0">&lt;code>@Configuration
public class TestConfig {
public TestConfig(){
System.out.println(&amp;#34;testconfig collection init success&amp;#34;);
}
// @Beanæ³¨è§£æ³¨å†Œbean,åŒæ—¶å¯ä»¥æŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•
// @Bean(name=&amp;#34;testBean&amp;#34;,initMethod=&amp;#34;start&amp;#34;,destroyMethod=&amp;#34;cleanup&amp;#34;)
//nameå±žæ€§ç›¸å½“äºŽ&amp;lt;bean&amp;gt;æ ‡ç­¾çš„id
@Bean
@Scope(&amp;#34;prototype&amp;#34;)
public TestBean testBean() {
return new TestBean();
}
}
class TestBean {
private String username;
private String url;
private String password;
public void sayHello() {
System.out.println(&amp;#34;TestBean sayHello...&amp;#34;);
}
public void start() {
System.out.println(&amp;#34;TestBean init...&amp;#34;);
}
public void cleanup() {
System.out.println(&amp;#34;TestBean destroy...&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>æµ‹è¯•ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>public class Main {
public static void main(String[] args) {
// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext
ApplicationContext context = new AnnotationConfigApplicationContext(TestConfig.class);
System.out.println(context);
// å¦‚æžœåŠ è½½spring-context.xmlæ–‡ä»¶ï¼š
// ApplicationContext context = new
// ClassPathXmlApplicationContext(&amp;#34;spring-context.xml&amp;#34;);
//èŽ·å–bean
TestBean testBean = (TestBean) context.getBean(&amp;#34;testBean&amp;#34;);
testBean.sayHello();
}
}
// ç»“æžœ
ç»“æžœï¼š
testconfig collection init success
TestBean sayHello...
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>@Beanæ³¨è§£åœ¨è¿”å›žå®žä¾‹çš„æ–¹æ³•ä¸Šï¼Œå¦‚æžœæœªé€šè¿‡@BeanæŒ‡å®šbeançš„åç§°ï¼Œåˆ™é»˜è®¤ä¸Žæ ‡æ³¨çš„æ–¹æ³•åç›¸åŒï¼ˆç¬¬ä¸€ä¸ªå•è¯è½¬å°å†™ï¼‰&lt;/li>
&lt;li>@Beanæ³¨è§£é»˜è®¤ä½œç”¨åŸŸä¸ºå•ä¾‹singletonä½œç”¨åŸŸï¼Œå¯é€šè¿‡@Scope(â€œprototypeâ€)è®¾ç½®ä¸ºåŽŸåž‹ä½œç”¨åŸŸ&lt;/li>
&lt;li>æ—¢ç„¶@Beançš„ä½œç”¨æ˜¯æ³¨å†Œbeanå¯¹è±¡ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥ä½¿ç”¨@Componentã€@Controllerã€@Serviceã€@Ripositoryç­‰æ³¨è§£æ³¨å†Œbeanï¼Œå½“ç„¶éœ€è¦é…ç½®@ComponentScanæ³¨è§£è¿›è¡Œè‡ªåŠ¨æ‰«æ&lt;/li>
&lt;/ul>
&lt;p>scopeå±žæ€§1). Â singletonå±žæ€§å€¼ï¼ˆæŽŒæ¡ï¼‰ï¼šé»˜è®¤å€¼ï¼Œå•ä¾‹2). prototypeå±žæ€§å€¼ï¼ˆæŽŒæ¡ï¼‰ï¼šå¤šä¾‹ï¼ˆåŽŸåž‹ä½œç”¨åŸŸï¼‰3). requestå±žæ€§å€¼(äº†è§£ï¼‰ï¼šåˆ›å»ºå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡æ”¾åˆ°requeståŸŸé‡Œ4). sessionå±žæ€§å€¼(äº†è§£ï¼‰ï¼šåˆ›å»ºå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡æ”¾åˆ°sessionåŸŸé‡Œ5). globalSessionå±žæ€§å€¼(äº†è§£ï¼‰ï¼šåˆ›å»ºå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡æ”¾åˆ°globalSessionåŸŸé‡Œ&lt;/p>
&lt;h3 id="beanä¸‹ç®¡ç†beançš„ç”Ÿå‘½å‘¨æœŸ">@Beanä¸‹ç®¡ç†beançš„ç”Ÿå‘½å‘¨æœŸ&lt;/h3>
&lt;pre tabindex="0">&lt;code>// ç”¨ä¸Šé¢çš„ä¾‹å­
//@Beanæ³¨è§£æ³¨å†Œbean,åŒæ—¶å¯ä»¥æŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•
@Bean(name=&amp;#34;testBean&amp;#34;,initMethod=&amp;#34;start&amp;#34;,destroyMethod=&amp;#34;cleanUp&amp;#34;)
@Scope(&amp;#34;prototype&amp;#34;)
public TestBean testBean() {
return new TestBean();
}
&lt;/code>&lt;/pre>&lt;p>æµ‹è¯•ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>// ç»“æžœ
testconfig collection init success
org.springframework.context.annotation.AnnotationConfigApplicationContext@41975e01, started on Mon Jul 19 09:51:42 PST 2021
TestBean init...
TestBean sayHello...
&lt;/code>&lt;/pre>&lt;h3 id="configurationå¯åŠ¨å®¹å™¨componentæ³¨å†Œbean">@Configurationå¯åŠ¨å®¹å™¨+@Componentæ³¨å†ŒBean&lt;/h3>
&lt;p>beanç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>//æ·»åŠ æ³¨å†Œbeançš„æ³¨è§£
@Component
public class TestBean {
private String username;
private String url;
private String password;
public void sayHello() {
System.out.println(&amp;#34;TestBean sayHello...&amp;#34;);
}
public void start() {
System.out.println(&amp;#34;TestBean init...&amp;#34;);
}
public void cleanup() {
System.out.println(&amp;#34;TestBean destroy...&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>é…ç½®ç±»ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>@Configuration
//æ·»åŠ è‡ªåŠ¨æ‰«ææ³¨è§£ï¼ŒbasePackagesä¸ºTestBeanåŒ…è·¯å¾„
@ComponentScan(basePackages = &amp;#34;com.example.demo.spring2&amp;#34;)
public class TestConfig {
public TestConfig(){
System.out.println(&amp;#34;testconfig collection init success&amp;#34;);
}
// @Beanæ³¨è§£æ³¨å†Œbean,åŒæ—¶å¯ä»¥æŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•
// @Bean(name=&amp;#34;testBean&amp;#34;,initMethod=&amp;#34;start&amp;#34;,destroyMethod=&amp;#34;cleanup&amp;#34;)
//// @Bean
// @Scope(&amp;#34;prototype&amp;#34;)
// public TestBean testBean() {
// return new TestBean();
// }
}
&lt;/code>&lt;/pre>&lt;p>æµ‹è¯•ç±»:&lt;/p>
&lt;pre tabindex="0">&lt;code>public class Main {
public static void main(String[] args) {
// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext
ApplicationContext context = new AnnotationConfigApplicationContext(TestConfig.class);
// å¦‚æžœåŠ è½½spring-context.xmlæ–‡ä»¶ï¼š
// ApplicationContext context = new ClassPathXmlApplicationContext(&amp;#34;spring-context.xml&amp;#34;);
//èŽ·å–bean
TestBean testBean1 = (TestBean) context.getBean(&amp;#34;testBean&amp;#34;);
testBean1.sayHello();
}
}
// ç»“æžœ
testconfig collection init success
TestBean sayHello...
&lt;/code>&lt;/pre>&lt;h3 id="annotationconfigapplicationcontext-æ³¨å†Œ-appcontext-ç±»çš„ä¸¤ç§æ–¹æ³•">AnnotationConfigApplicationContext æ³¨å†Œ AppContext ç±»çš„ä¸¤ç§æ–¹æ³•&lt;/h3>
&lt;p>ç¬¬ä¸€ç§:&lt;/p>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) {
// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext
ApplicationContext context = new AnnotationConfigApplicationContext(TestConfig.class);
//èŽ·å–bean
TestBean tb = (TestBean) context.getBean(&amp;#34;testBean&amp;#34;);
tb.sayHello();
}
&lt;/code>&lt;/pre>&lt;p>ç¬¬äºŒç§:&lt;/p>
&lt;pre tabindex="0">&lt;code>public class Main {
public static void main(String[] args) {
AnnotationConfigApplicationContext annotationConfigApplicationContext = new AnnotationConfigApplicationContext();
annotationConfigApplicationContext.register(TestConfig.class);
annotationConfigApplicationContext.refresh();
}
}
&lt;/code>&lt;/pre>&lt;h3 id="configurationç»„åˆxml">@Configurationç»„åˆxml&lt;/h3>
&lt;p>é…ç½®ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>@Configuration
@ImportResource(&amp;#34;classpath:configtest.xml&amp;#34;)
public class WebConfig {
public WebConfig(){
System.out.println(&amp;#34;WebConfig coolection init success&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>å®žä½“ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>public class TestBean2 {
private String username;
private String url;
private String password;
public void setUsername(String username) {
this.username = username;
}
public void setUrl(String url) {
this.url = url;
}
public void setPassword(String password) {
this.password = password;
}
public void sayHello() {
System.out.println(&amp;#34;TestBean2 sayHello...&amp;#34;+username);
}
public void start() {
System.out.println(&amp;#34;TestBean2 init...&amp;#34;);
}
public void cleanUp() {
System.out.println(&amp;#34;TestBean2 destroy...&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>springçš„xmlé…ç½®æ–‡ä»¶&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;beans xmlns=&amp;#34;http://www.springframework.org/schema/beans&amp;#34;
xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
xsi:schemaLocation=&amp;#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;#34;&amp;gt;
&amp;lt;bean id=&amp;#34;testBean2&amp;#34; class=&amp;#34;com.example.demo.spring3.TestBean2&amp;#34;&amp;gt;
&amp;lt;property name=&amp;#34;username&amp;#34; value=&amp;#34;ranjun&amp;#34;/&amp;gt;
&amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;
&lt;/code>&lt;/pre>&lt;p>æµ‹è¯•ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>public class TestMain2 {
public static void main(String[] args) {
// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext
ApplicationContext context = new AnnotationConfigApplicationContext(WebConfig.class);
// å¦‚æžœåŠ è½½spring-context.xmlæ–‡ä»¶ï¼š
// ApplicationContext context = new ClassPathXmlApplicationContext(&amp;#34;spring-context.xml&amp;#34;);
// èŽ·å–bean
TestBean2 tb = (TestBean2) context.getBean(&amp;#34;testBean2&amp;#34;);
tb.sayHello();
}
}
// ç»“æžœ
WebConfig coolection init success
TestBean2 sayHello...ranjun
&lt;/code>&lt;/pre>&lt;h3 id="configurationç»„åˆxmlå’Œå…¶å®ƒæ³¨è§£">@Configurationç»„åˆxmlå’Œå…¶å®ƒæ³¨è§£&lt;/h3>
&lt;p>å®žä½“ç±»:&lt;/p>
&lt;pre tabindex="0">&lt;code>public class TestBean {
private String username;
private String url;
private String password;
public void sayHello() {
System.out.println(&amp;#34;TestBean sayHello...&amp;#34;);
}
public void start() {
System.out.println(&amp;#34;TestBean init...&amp;#34;);
}
public void cleanup() {
System.out.println(&amp;#34;TestBean destroy...&amp;#34;);
}
}
public class TestBean2 {
private String username;
private String url;
private String password;
public void setUsername(String username) {
this.username = username;
}
public void setUrl(String url) {
this.url = url;
}
public void setPassword(String password) {
this.password = password;
}
public void sayHello() {
System.out.println(&amp;#34;TestBean2 sayHello...&amp;#34;+username);
}
public void start() {
System.out.println(&amp;#34;TestBean2 init...&amp;#34;);
}
public void cleanUp() {
System.out.println(&amp;#34;TestBean2 destroy...&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>é…ç½®ç±»&lt;/p>
&lt;pre tabindex="0">&lt;code>@Configuration
public class TestConfig {
public TestConfig(){
System.out.println(&amp;#34;testconfig collection init success&amp;#34;);
}
@Bean
@Scope(&amp;#34;prototype&amp;#34;)
public TestBean testBean() {
return new TestBean();
}
}
@Configuration
@ImportResource(&amp;#34;classpath:configtest.xml&amp;#34;)
@Import(TestConfig.class)
public class WebConfig {
public WebConfig(){
System.out.println(&amp;#34;WebConfig coolection init success&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>æµ‹è¯•ç±»:&lt;/p>
&lt;pre tabindex="0">&lt;code>public class TestMain2 {
public static void main(String[] args) {
// @Configurationæ³¨è§£çš„springå®¹å™¨åŠ è½½æ–¹å¼ï¼Œç”¨AnnotationConfigApplicationContextæ›¿æ¢ClassPathXmlApplicationContext
ApplicationContext context = new AnnotationConfigApplicationContext(WebConfig.class);
// èŽ·å–bean
TestBean tb = (TestBean) context.getBean(&amp;#34;testBean&amp;#34;);
tb.sayHello();
TestBean2 tb2 = (TestBean2) context.getBean(&amp;#34;testBean2&amp;#34;);
tb2.sayHello();
}
}
// ç»“æžœ
WebConfig coolection init success
testconfig collection init success
TestBean sayHello...
TestBean2 sayHello...ranjun
&lt;/code>&lt;/pre></content></item><item><title>SpringBoot</title><link>https://connorzhangyu.com/posts/springboot/</link><pubDate>Sat, 15 Jul 2023 14:58:26 +0000</pubDate><guid>https://connorzhangyu.com/posts/springboot/</guid><description>&lt;h1 id="å®šæ—¶å™¨">å®šæ—¶å™¨&lt;/h1>
&lt;p>å®šæ—¶å™¨çš„æ•°å€¼æ”¾åˆ°é…ç½®æ–‡ä»¶,å¦‚æžœä½¿ç”¨&lt;code>@Scheduled(fixedDelay = ç±»ä¸­çš„å˜é‡)&lt;/code>è¿™ç§æ–¹å¼è¯•è¿‡ä¸è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Scheduled&lt;/span>(fixedDelayString &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;${fixedDelayString}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">open&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-properties" data-lang="properties">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">fixedDelayString&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="rocketmq">RocketMQ&lt;/h1>
&lt;p>ä¸‹è½½æºç æˆ–è€…äºŒè¿›åˆ¶åŒ…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æºç å®‰è£…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è§£åŽ‹æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unzip rocketmq-all-5.2.0-source-release.zip
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd rocketmq-all-5.2.0-source-release/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¯‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mvn -Prelease-all -DskipTests -Dspotbugs.skip&lt;span style="color:#f92672">=&lt;/span>true clean install -U
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¯‘åŽçš„äºŒè¿›åˆ¶çš„ç›®å½•,é…ç½®æ–‡ä»¶åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ./distribution
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹å†…å­˜é…ç½®,è™šæ‹Ÿæœºçš„å†…å­˜å¤ªå°äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># vim ./bin/runserver.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JAVA_OPT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>JAVA_OPT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -server -Xms512m -Xmx521m -Xmn256g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># vim ./bin/runbroker.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JAVA_OPT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>JAVA_OPT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -server -Xms512m -Xmx512m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬ä¸€æ­¥.å¯åŠ¨Name Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh bin/mqnamesrv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The Name Server boot success...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬äºŒæ­¥.å¯åŠ¨Broker&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh bin/mqbroker -n localhost:9876
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> The broker&lt;span style="color:#f92672">[&lt;/span>%s, 172.30.30.233:10911&lt;span style="color:#f92672">]&lt;/span> boot success...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹è¯•å‘é€æ¶ˆæ¯&lt;/p></description><content>&lt;h1 id="å®šæ—¶å™¨">å®šæ—¶å™¨&lt;/h1>
&lt;p>å®šæ—¶å™¨çš„æ•°å€¼æ”¾åˆ°é…ç½®æ–‡ä»¶,å¦‚æžœä½¿ç”¨&lt;code>@Scheduled(fixedDelay = ç±»ä¸­çš„å˜é‡)&lt;/code>è¿™ç§æ–¹å¼è¯•è¿‡ä¸è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Scheduled&lt;/span>(fixedDelayString &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;${fixedDelayString}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">open&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-properties" data-lang="properties">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">fixedDelayString&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="rocketmq">RocketMQ&lt;/h1>
&lt;p>ä¸‹è½½æºç æˆ–è€…äºŒè¿›åˆ¶åŒ…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æºç å®‰è£…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è§£åŽ‹æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unzip rocketmq-all-5.2.0-source-release.zip
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd rocketmq-all-5.2.0-source-release/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¯‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mvn -Prelease-all -DskipTests -Dspotbugs.skip&lt;span style="color:#f92672">=&lt;/span>true clean install -U
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¯‘åŽçš„äºŒè¿›åˆ¶çš„ç›®å½•,é…ç½®æ–‡ä»¶åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ./distribution
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹å†…å­˜é…ç½®,è™šæ‹Ÿæœºçš„å†…å­˜å¤ªå°äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># vim ./bin/runserver.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JAVA_OPT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>JAVA_OPT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -server -Xms512m -Xmx521m -Xmn256g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># vim ./bin/runbroker.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JAVA_OPT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>JAVA_OPT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -server -Xms512m -Xmx512m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬ä¸€æ­¥.å¯åŠ¨Name Server&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh bin/mqnamesrv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The Name Server boot success...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬äºŒæ­¥.å¯åŠ¨Broker&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh bin/mqbroker -n localhost:9876
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> The broker&lt;span style="color:#f92672">[&lt;/span>%s, 172.30.30.233:10911&lt;span style="color:#f92672">]&lt;/span> boot success...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹è¯•å‘é€æ¶ˆæ¯&lt;/p>
&lt;pre tabindex="0">&lt;code>export NAMESRV_ADDR=localhost:9876
# å‘é€æ¶ˆæ¯
sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
# æŽ¥æ”¶æ¶ˆæ¯
sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer
&lt;/code>&lt;/pre>&lt;h2 id="å…³é—­æœåŠ¡">å…³é—­æœåŠ¡&lt;/h2>
&lt;pre tabindex="0">&lt;code>sh bin/mqshutdown broker
sh bin/mqshutdown namesrv
&lt;/code>&lt;/pre>&lt;h2 id="ç›‘æŽ§">ç›‘æŽ§&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®°å¾—checkout release-rocketmq-console-1.0.0åˆ†æ”¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git clone https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œçš„rocketMQè¿œç¨‹åœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NameSvrAddrList &lt;span style="color:#f92672">=&lt;/span> 192.168.254.124:9876
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ–è€…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rocketmq.config.namesrvAddr&lt;span style="color:#f92672">=&lt;/span>192.168.254.124:9876
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä»£ç ">ä»£ç &lt;/h2>
&lt;h3 id="å•ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…">å•ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Provider&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQProducer producer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQProducer(&lt;span style="color:#e6db74">&amp;#34;group1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ä»€ä¹ˆé¬¼,å’‹èŽ«åå…¶å¦™å°±æ”¶åˆ°äº†&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Message(&lt;span style="color:#e6db74">&amp;#34;topic1&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;tag1&amp;#34;&lt;/span>, msg.&lt;span style="color:#a6e22e">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SendResult sendResult &lt;span style="color:#f92672">=&lt;/span> producer.&lt;span style="color:#a6e22e">send&lt;/span>(message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s%n&amp;#34;&lt;/span>, sendResult);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">shutdown&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic1&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å•ä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…">å•ä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…&lt;/h2>
&lt;h3 id="ç›¸åŒçš„topicç›¸åŒçš„group-è´Ÿè½½å‡è¡¡">ç›¸åŒçš„Topic,ç›¸åŒçš„Group-è´Ÿè½½å‡è¡¡&lt;/h3>
&lt;p>é»˜è®¤å°±æ˜¯è´Ÿè½½å‡è¡¡,å¤šä¸ªæ¶ˆè´¹è€…,æ¯ä¸ªäººæ”¶ä¸€æ¡ä¿¡æ¯,ä¸é‡å¤&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051459670.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Provider&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQProducer producer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQProducer(&lt;span style="color:#e6db74">&amp;#34;group2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Message(&lt;span style="color:#e6db74">&amp;#34;topic2&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;tag1&amp;#34;&lt;/span>, msg.&lt;span style="color:#a6e22e">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SendResult sendResult &lt;span style="color:#f92672">=&lt;/span> producer.&lt;span style="color:#a6e22e">send&lt;/span>(message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s%n&amp;#34;&lt;/span>, sendResult);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">shutdown&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è°æ¥æ”¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žå“ªé‡Œæ”¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬é˜Ÿåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic2&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡9
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬äºŒä¸ªæ¶ˆè´¹è€…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç›¸åŒçš„topicç›¸åŒçš„group-è½®è®­">ç›¸åŒçš„Topic,ç›¸åŒçš„Group-è½®è®­&lt;/h3>
&lt;p>åªæ˜¯æ·»åŠ äº†æ¶ˆè´¹è€…çš„ä¸€æ®µä»£ç :&lt;code>consumer.setMessageModel(MessageModel.BROADCASTING);&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051459646.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Provider&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è°æ¥å‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQProducer producer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQProducer(&lt;span style="color:#e6db74">&amp;#34;group3&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘ç»™è°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Message(&lt;span style="color:#e6db74">&amp;#34;topic3&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;tag1&amp;#34;&lt;/span>, msg.&lt;span style="color:#a6e22e">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SendResult sendResult &lt;span style="color:#f92672">=&lt;/span> producer.&lt;span style="color:#a6e22e">send&lt;/span>(message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s%n&amp;#34;&lt;/span>, sendResult);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#a6e22e">shutdown&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group3&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic3&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setMessageModel&lt;/span>(MessageModel.&lt;span style="color:#a6e22e">BROADCASTING&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½æ˜¯æ”¶åˆ°ç›¸åŒçš„æ¶ˆæ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡9
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¸åŒçš„topicä¸åŒçš„group">ä¸åŒçš„Topic,ä¸åŒçš„Group&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051459641.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group4&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic4&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group4&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic4&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Consumer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> MQClientException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DefaultMQPushConsumer consumer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultMQPushConsumer(&lt;span style="color:#e6db74">&amp;#34;group4-1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">setNamesrvAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;192.168.254.190:9876&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">subscribe&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;topic4&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">registerMessageListener&lt;/span>((MessageListenerConcurrently) (list, consumeConcurrentlyContext) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸šåŠ¡é€»è¾‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">forEach&lt;/span>(one&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> body &lt;span style="color:#f92672">=&lt;/span> one.&lt;span style="color:#a6e22e">getBody&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> String(body));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ConsumeConcurrentlyStatus.&lt;span style="color:#a6e22e">CONSUME_SUCCESS&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…å¯èµ·æ¥äº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡9
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>é»˜è®¤æŽ¥å—è€…æ˜¯è´Ÿè½½å‡è¡¡9
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="swagger">Swagger&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- å¼•å…¥Swagger3ä¾èµ– --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>io.springfox&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>springfox-boot-starter&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>3.0.0&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> io.swagger.annotations.ApiOperation;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.annotation.Bean;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.annotation.Configuration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.builders.ApiInfoBuilder;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.builders.PathSelectors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.builders.RequestHandlerSelectors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.oas.annotations.EnableOpenApi;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.service.ApiInfo;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.service.Contact;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.spi.DocumentationType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> springfox.documentation.spring.web.plugins.Docket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Swaggeré…ç½®ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@EnableOpenApi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SwaggerConfig&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Docket &lt;span style="color:#a6e22e">docket&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Docket(DocumentationType.&lt;span style="color:#a6e22e">OAS_30&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">apiInfo&lt;/span>(apiInfo()).&lt;span style="color:#a6e22e">enable&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">select&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//apisï¼š æ·»åŠ swaggeræŽ¥å£æå–èŒƒå›´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">apis&lt;/span>(RequestHandlerSelectors.&lt;span style="color:#a6e22e">basePackage&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;com.example.study.controller&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">apis&lt;/span>(RequestHandlerSelectors.&lt;span style="color:#a6e22e">withMethodAnnotation&lt;/span>(ApiOperation.&lt;span style="color:#a6e22e">class&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">paths&lt;/span>(PathSelectors.&lt;span style="color:#a6e22e">any&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">build&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> ApiInfo &lt;span style="color:#a6e22e">apiInfo&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ApiInfoBuilder()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">title&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;XXé¡¹ç›®æŽ¥å£æ–‡æ¡£&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">description&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;XXé¡¹ç›®æè¿°&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">contact&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> Contact(&lt;span style="color:#e6db74">&amp;#34;ä½œè€…&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;ä½œè€…URL&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;ä½œè€…Email&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">version&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;1.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">build&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åŽŸå› æ˜¯åœ¨springboot 2.6.0ä¸­å°†SpringMVC é»˜è®¤è·¯å¾„åŒ¹é…ç­–ç•¥ä»ŽAntPathMatcher&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ›´æ”¹ä¸ºPathPatternParserï¼Œå¯¼è‡´å‡ºé”™ï¼Œè§£å†³åŠžæ³•æ˜¯åˆ‡æ¢å›žåŽŸå…ˆçš„AntPathMatcher&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>spring.mvc.pathmatch.matching-strategy=ant_path_matcher
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="knife4j">knife4j&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.github.xiaoymin&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>knife4j-spring-boot-starter&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>3.0.3&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>application.properties&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>spring.mvc.pathmatch.matching-strategy=ant_path_matcher
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>knife4j.enable: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RequestMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Api&lt;/span>(tags &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æµ‹è¯•2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŽ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@ApiSort&lt;/span>(value &lt;span style="color:#f92672">=&lt;/span> 1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestController2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@GetMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/3&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiOperation&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">method&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#34;hello wolrd&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@GetMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/4&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiOperation&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;4&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">method2&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#34;hello wolrd&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="log4j2">Log4j2&lt;/h1>
&lt;h2 id="log4j2-1">Log4j2&lt;/h2>
&lt;p>æ—¥å¿—æ‰€æœ‰çº§åˆ«çº§åˆ«ä»Žä¸Šåˆ°ä¸‹ ,çº§åˆ«ä»Žä½Žåˆ°é«˜,æŠ¥é”™(æ›´é‡è¦)è¿™ç§,çº§åˆ«æœ€é«˜,info,debugç›¸å¯¹ä¸æ€Žä¹ˆé‡è¦&lt;/p>
&lt;ul>
&lt;li>all&lt;/li>
&lt;li>trace&lt;/li>
&lt;li>debug&lt;/li>
&lt;li>info&lt;/li>
&lt;li>warn&lt;/li>
&lt;li>error&lt;/li>
&lt;li>fail&lt;/li>
&lt;/ul>
&lt;p>Log4j2.xmlé…ç½®ä¾‹å­&lt;/p>
&lt;p>{% tabs Log4j2 %}&lt;/p>
&lt;!-- tab æŠ„ç½‘ä¸Šçš„ç¤ºä¾‹ -->
&lt;pre tabindex="0">&lt;code>infoçº§åˆ«è¾“å‡ºåˆ°info.log
warnçº§åˆ«è¾“å‡ºwarn.log
errorçº§åˆ«è¾“å‡ºåˆ°error.log
debugçº§åˆ«è¾“å‡ºåˆ°debug.log
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;Configuration status=&amp;#34;WARN&amp;#34; monitorInterval=&amp;#34;30&amp;#34;&amp;gt; --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;properties&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;LOG_HOME&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>./service-logs&lt;span style="color:#f92672">&amp;lt;/property&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/properties&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--*********************æŽ§åˆ¶å°æ—¥å¿—***********************--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Console&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;consoleAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">target=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;SYSTEM_OUT&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼åŠé¢œè‰²--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">pattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;%style{%d{ISO8601}}{bright,green} %highlight{%-5level} [%style{%t}{bright,blue}] %style{%C{}}{bright,yellow}: %msg%n%style{%throwable}{red}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">disableAnsi=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;false&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">noConsoleNoAnsi=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Console&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--*********************æ–‡ä»¶æ—¥å¿—***********************--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--allçº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;allFileAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/all.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/$${date:yyyy-MM}/all-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d %p %C{} [%t] %m%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- è®¾ç½®æ—¥å¿—æ–‡ä»¶åˆ‡åˆ†å‚æ•° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;OnStartupTriggeringPolicy/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—åŸºç¡€æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¯¥å¤§å°å°±è§¦å‘æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°çš„æ—¶é—´ï¼Œä¾èµ–äºŽæ–‡ä»¶å‘½åfilePatternçš„è®¾ç½®--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶ä¸ªæ•°ä¸Šé™ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º7ä¸ªï¼Œè¶…è¿‡å¤§å°åŽä¼šè¢«è¦†ç›–ï¼›ä¾èµ–äºŽfilePatternä¸­çš„%i--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;DefaultRolloverStrategy&lt;/span> &lt;span style="color:#a6e22e">max=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--debugçº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debugFileAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/debug.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/$${date:yyyy-MM}/debug-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è¿‡æ»¤æŽ‰infoåŠæ›´é«˜çº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;info&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;NEUTRAL&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d %p %C{} [%t] %m%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- è®¾ç½®æ—¥å¿—æ–‡ä»¶åˆ‡åˆ†å‚æ•° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;OnStartupTriggeringPolicy/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—åŸºç¡€æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¯¥å¤§å°å°±è§¦å‘æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°çš„æ—¶é—´ï¼Œä¾èµ–äºŽæ–‡ä»¶å‘½åfilePatternçš„è®¾ç½®--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶ä¸ªæ•°ä¸Šé™ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º7ä¸ªï¼Œè¶…è¿‡å¤§å°åŽä¼šè¢«è¦†ç›–ï¼›ä¾èµ–äºŽfilePatternä¸­çš„%i--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;DefaultRolloverStrategy&lt;/span> &lt;span style="color:#a6e22e">max=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--infoçº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;infoFileAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/info.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è¿‡æ»¤æŽ‰warnåŠæ›´é«˜çº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warn&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;NEUTRAL&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d %p %C{} [%t] %m%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- è®¾ç½®æ—¥å¿—æ–‡ä»¶åˆ‡åˆ†å‚æ•° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;OnStartupTriggeringPolicy/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—åŸºç¡€æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¯¥å¤§å°å°±è§¦å‘æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°çš„æ—¶é—´ï¼Œä¾èµ–äºŽæ–‡ä»¶å‘½åfilePatternçš„è®¾ç½®--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">interval=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">modulate=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶ä¸ªæ•°ä¸Šé™ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º7ä¸ªï¼Œè¶…è¿‡å¤§å°åŽä¼šè¢«è¦†ç›–ï¼›ä¾èµ–äºŽfilePatternä¸­çš„%i--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;DefaultRolloverStrategy max=&amp;#34;100&amp;#34;/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--warnçº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warnFileAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/warn.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/$${date:yyyy-MM}/warn-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è¿‡æ»¤æŽ‰erroråŠæ›´é«˜çº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;error&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;NEUTRAL&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d %p %C{} [%t] %m%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- è®¾ç½®æ—¥å¿—æ–‡ä»¶åˆ‡åˆ†å‚æ•° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;OnStartupTriggeringPolicy/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—åŸºç¡€æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¯¥å¤§å°å°±è§¦å‘æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°çš„æ—¶é—´ï¼Œä¾èµ–äºŽæ–‡ä»¶å‘½åfilePatternçš„è®¾ç½®--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶ä¸ªæ•°ä¸Šé™ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º7ä¸ªï¼Œè¶…è¿‡å¤§å°åŽä¼šè¢«è¦†ç›–ï¼›ä¾èµ–äºŽfilePatternä¸­çš„%i--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;DefaultRolloverStrategy&lt;/span> &lt;span style="color:#a6e22e">max=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--erroråŠæ›´é«˜çº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;errorFileAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/error.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/$${date:yyyy-MM}/error-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ ¼å¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d %p %C{} [%t] %m%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/PatternLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- è®¾ç½®æ—¥å¿—æ–‡ä»¶åˆ‡åˆ†å‚æ•° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--&amp;lt;OnStartupTriggeringPolicy/&amp;gt;--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—åŸºç¡€æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¯¥å¤§å°å°±è§¦å‘æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨æ›´æ–°çš„æ—¶é—´ï¼Œä¾èµ–äºŽæ–‡ä»¶å‘½åfilePatternçš„è®¾ç½®--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶ä¸ªæ•°ä¸Šé™ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º7ä¸ªï¼Œè¶…è¿‡å¤§å°åŽä¼šè¢«è¦†ç›–ï¼›ä¾èµ–äºŽfilePatternä¸­çš„%i--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;DefaultRolloverStrategy&lt;/span> &lt;span style="color:#a6e22e">max=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--jsonæ ¼å¼errorçº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;errorJsonAppender&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/error-json.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">filePattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;${LOG_HOME}/error-json-%d{yyyy-MM-dd}-%i.log.gz&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;JSONLayout&lt;/span> &lt;span style="color:#a6e22e">compact=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">eventEol=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">locationInfo=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">size=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;100 MB&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TimeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#a6e22e">interval=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">modulate=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æ ¹æ—¥å¿—è®¾ç½® --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Root&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debug&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;allFileAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;all&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;consoleAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debug&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debugFileAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debug&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;infoFileAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warnFileAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warn&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;errorFileAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;error&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;errorJsonAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;error&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Root&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--springæ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;org.springframework&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debug&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--druidæ•°æ®æºæ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;druid.sql.Statement&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warn&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- mybatisæ—¥å¿— --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.mybatis&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warn&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;org.hibernate&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;warn&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.zaxxer.hikari&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;org.quartz&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Logger&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.andya.demo&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;debug&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;!-- tab å®žé™…å¼€å‘ç”¨çš„-->
&lt;pre tabindex="0">&lt;code>errorçº§åˆ« æ‰“å°error.log
infoçº§åˆ« æ‰“å°info,error æ—¥å¿—åˆ°info.log
debugçº§åˆ« æ‰“å°info,error,debugæ—¥å¿—åˆ°debug.log
&lt;/code>&lt;/pre>&lt;!-- endtab -->
&lt;p>{% endtabs %}&lt;/p>
&lt;p>åŸºæœ¬ç»“æž„æ˜¯:&lt;/p>
&lt;ul>
&lt;li>Configuration
&lt;ul>
&lt;li>properties å±žæ€§é…ç½®,å¯ä»¥åœ¨è¿™é‡Œé…ç½®å…¨å±€å˜é‡,å¯ä»¥åœ¨xmlåˆ«çš„åœ°æ–¹å¼•å…¥&lt;/li>
&lt;li>Appenders å…·ä½“é…ç½®æ—¥å¿—æ¡†æž¶è¯¥å¦‚ä½•æ”¶é›†æ—¥å¿—çš„åŠ¨ä½œ
&lt;ul>
&lt;li>Console æŽ§åˆ¶å°è¾“å‡º&lt;/li>
&lt;li>RollingFile æ»šåŠ¨æ—¥å¿—æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Loggers
&lt;ul>
&lt;li>Root ç†è®ºä¸Šåªæœ‰ä¸€ä¸ªRoot,levelå±žæ€§,æ˜¯å…¨å±€æ—¥å¿—çº§åˆ«,å¦‚æžœAppenderRefæ²¡æœ‰é…ç½®level,å°±ä½¿ç”¨å…¨å±€çº§åˆ«
&lt;ul>
&lt;li>AppenderRef å¼•ç”¨å…·ä½“é…ç½®çš„åŠ¨ä½œ,level æ²¡æœ‰çš„è¯,å°±ä½¿ç”¨å…¨å±€çº§åˆ«,å°±åƒ&lt;code>CSS&lt;/code>å±žæ€§é‚£æ ·,æ ‡ç­¾é‡Œçš„å±žæ€§ä¼˜å…ˆçº§æœ€é«˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Logger å•ç‹¬é…ç½®ä¸€äº›ç±»,level æ²¡æœ‰çš„è¯,å°±ä½¿ç”¨å…¨å±€çº§åˆ«,å°±åƒ&lt;code>CSS&lt;/code>å±žæ€§é‚£æ ·,æ ‡ç­¾é‡Œçš„å±žæ€§ä¼˜å…ˆçº§æœ€é«˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¿‡æ»¤å™¨çš„å…·ä½“ä½¿ç”¨æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!--è¿‡æ»¤æŽ‰infoåŠæ›´é«˜çº§åˆ«æ—¥å¿—--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;info&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;NEUTRAL&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>level&lt;/code>æŒ‡å®šæ—¥å¿—ç­‰çº§çš„é˜ˆå€¼ã€‚&lt;/p>
&lt;p>&lt;code>onMatch&lt;/code> å®šä¹‰å½“æ—¥å¿—äº‹ä»¶ç­‰çº§ç­‰äºŽæˆ–é«˜äºŽ &lt;code>level&lt;/code> å±žæ€§æŒ‡å®šçš„ç­‰çº§æ—¶çš„è¡Œä¸ºã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>ACCEPT&lt;/code>ï¼šæŽ¥å—æ—¥å¿—äº‹ä»¶ï¼Œè®©å®ƒé€šè¿‡è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;li>&lt;code>DENY&lt;/code>ï¼šæ‹’ç»æ—¥å¿—äº‹ä»¶ï¼Œä¸è®©å®ƒé€šè¿‡è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;li>&lt;code>NEUTRAL&lt;/code>ï¼šå¯¹æ—¥å¿—äº‹ä»¶ä¸åšå†³å®šï¼Œç»§ç»­åº”ç”¨å…¶ä»–çš„è¿‡æ»¤è§„åˆ™ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>onMismatch&lt;/code> å®šä¹‰å½“æ—¥å¿—äº‹ä»¶ç­‰çº§ä½ŽäºŽ &lt;code>level&lt;/code> å±žæ€§æŒ‡å®šçš„ç­‰çº§æ—¶çš„è¡Œä¸ºã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>ACCEPT&lt;/code>ï¼šæŽ¥å—æ—¥å¿—äº‹ä»¶ï¼Œè®©å®ƒé€šè¿‡è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;li>&lt;code>DENY&lt;/code>ï¼šæ‹’ç»æ—¥å¿—äº‹ä»¶ï¼Œä¸è®©å®ƒé€šè¿‡è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;li>&lt;code>NEUTRAL&lt;/code>ï¼šå¯¹æ—¥å¿—äº‹ä»¶ä¸åšå†³å®šï¼Œç»§ç»­åº”ç”¨å…¶ä»–çš„è¿‡æ»¤è§„åˆ™ã€‚&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>if æ—¥å¿—çš„çº§åˆ« &amp;gt;= levelé…ç½®çš„çº§åˆ«
ACCEPT æŽ¥å—æ—¥å¿—
DENY æ‹’ç»æ—¥å¿—
NEUTRAL å¯¹æ—¥å¿—äº‹ä»¶ä¸åšå†³å®šï¼Œç»§ç»­åº”ç”¨å…¶ä»–çš„è¿‡æ»¤è§„åˆ™
if æ—¥å¿—çš„çº§åˆ« &amp;lt; levelé…ç½®çš„çº§åˆ«
ACCEPT æŽ¥å—æ—¥å¿—
DENY æ‹’ç»æ—¥å¿—
NEUTRAL å¯¹æ—¥å¿—äº‹ä»¶ä¸åšå†³å®šï¼Œç»§ç»­åº”ç”¨å…¶ä»–çš„è¿‡æ»¤è§„åˆ™
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>è¿˜æ˜¯æ²¡æœ‰æžæ¸…æ¥š onMismatch=&amp;ldquo;NEUTRAL&amp;rdquo; çš„ä½œç”¨æ˜¯æ€Žæ ·çš„&lt;/p>
&lt;p>ä½¿ç”¨ChatGPTæä¾›çš„demo,æ²¡æœ‰éªŒè¯&lt;/p>
&lt;p>infoçº§åˆ« è®°å½•åˆ°info.log
errorçº§åˆ« è®°å½•åˆ°error.log
infoçº§åˆ«å’Œerrorçº§åˆ« è®°å½•åˆ°dev.log&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- Info çº§åˆ«æ—¥å¿—çš„ Appender --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;File&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;InfoAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;logs/info.log&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;INFO&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ACCEPT&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span> &lt;span style="color:#a6e22e">pattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;%d{yyyy-MM-dd HH:mm:ss} [%t] %-5level %logger{36} - %msg%n&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/File&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- Error çº§åˆ«æ—¥å¿—çš„ Appender --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;File&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ErrorAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;logs/error.log&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ERROR&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ACCEPT&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span> &lt;span style="color:#a6e22e">pattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;%d{yyyy-MM-dd HH:mm:ss} [%t] %-5level %logger{36} - %msg%n&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/File&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- åŒæ—¶è®°å½• Info å’Œ Error çº§åˆ«æ—¥å¿—çš„ Appender --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;File&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DevAppender&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">fileName=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;logs/dev.log&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;INFO&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ACCEPT&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DENY&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;ThresholdFilter&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ERROR&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ACCEPT&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">onMismatch=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;NEUTRAL&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Filters&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span> &lt;span style="color:#a6e22e">pattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;%d{yyyy-MM-dd HH:mm:ss} [%t] %-5level %logger{36} - %msg%n&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/File&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Root&lt;/span> &lt;span style="color:#a6e22e">level=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DEBUG&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;InfoAppender&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ErrorAppender&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#a6e22e">ref=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;DevAppender&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Root&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/blockquote>
&lt;h2 id="åªæ˜¯å¼•å…¥webæ¡†æž¶">åªæ˜¯å¼•å…¥webæ¡†æž¶&lt;/h2>
&lt;p>åªæ˜¯å¼•å…¥webæ¡†æž¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-web&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@GetMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">test&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¼å¼åŒ–å½“å‰æ—¥æœŸæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String formattedDateTime &lt;span style="color:#f92672">=&lt;/span> LocalDateTime.&lt;span style="color:#a6e22e">now&lt;/span>().&lt;span style="color:#a6e22e">format&lt;/span>(DateTimeFormatter.&lt;span style="color:#a6e22e">ofPattern&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">debug&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å½“å‰æ—¥æœŸæ—¶é—´ï¼š{}&amp;#34;&lt;/span>, formattedDateTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å½“å‰æ—¥æœŸæ—¶é—´ï¼š{}&amp;#34;&lt;/span>, formattedDateTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">error&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å½“å‰æ—¥æœŸæ—¶é—´ï¼š{}&amp;#34;&lt;/span>, formattedDateTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">warn&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å½“å‰æ—¥æœŸæ—¶é—´ï¼š{}&amp;#34;&lt;/span>, formattedDateTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">trace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å½“å‰æ—¥æœŸæ—¶é—´ï¼š{}&amp;#34;&lt;/span>, formattedDateTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> formattedDateTime;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŽ§åˆ¶å°æ‰“å°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>INFO &lt;span style="color:#ae81ff">64710&lt;/span> --- &lt;span style="color:#f92672">[&lt;/span>nio-8080-exec-1&lt;span style="color:#f92672">]&lt;/span> c.e.s.controller.IndexController : å½“å‰æ—¥æœŸæ—¶é—´ï¼š2024-03-03 21:37:40
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ERROR &lt;span style="color:#ae81ff">64710&lt;/span> --- &lt;span style="color:#f92672">[&lt;/span>nio-8080-exec-1&lt;span style="color:#f92672">]&lt;/span> c.e.s.controller.IndexController : å½“å‰æ—¥æœŸæ—¶é—´ï¼š2024-03-03 21:37:40
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARN &lt;span style="color:#ae81ff">64710&lt;/span> --- &lt;span style="color:#f92672">[&lt;/span>nio-8080-exec-1&lt;span style="color:#f92672">]&lt;/span> c.e.s.controller.IndexController : å½“å‰æ—¥æœŸæ—¶é—´ï¼š2024-03-03 21:37:40
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¸ºä»€ä¹ˆæŽ§åˆ¶å°æ²¡æœ‰æ‰“å° traceå’Œdebugæ—¥å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>ElasticSearch</title><link>https://connorzhangyu.com/posts/elasticsearch/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/elasticsearch/</guid><description>&lt;h1 id="æ‰‹åŠ¨å®‰è£…7x">æ‰‹åŠ¨å®‰è£…7.x&lt;/h1>
&lt;h2 id="æ‰‹åŠ¨å®‰è£…å•æœºelasticsearch7x">æ‰‹åŠ¨å®‰è£…å•æœºElasticSearch7.x&lt;/h2>
&lt;pre tabindex="0">&lt;code># ä¸‹è½½taråŒ…,(6.6.2)
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.2.tar.gz
# è§£åŽ‹ç¼©ä¹‹åŽä¿®æ”¹é…ç½®æ–‡ä»¶
vi /elasticsearch-7.10.1/config/elasticsearch.yml
network.host: 0.0.0.0 #è®¾ç½®æˆå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—®
# è¿½åŠ å†…å®¹,ä¿®æ”¹ç³»ç»ŸçŽ¯å¢ƒè¯¥å˜é‡,ä¿®æ”¹å®Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ
vi /etc/sysctl.conf
vm.max_map_count=262144
# åŠ è½½å‚æ•°
anthony@base:/usr/local/elasticsearch-6.6.2$ sudo sysctl -p
vm.max_map_count = 262144
# å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°,åŠ å…¥
vim /etc/security/limits.conf
* soft nofile 65536
* hard nofile 65536
* soft nproc 4096 æˆ–è€…(65536)
* hard nproc 4096 æˆ–è€…(65536)
# ä¿®æ”¹JVMåˆ†é…å¤§å° è¿™ä¸¤ä¸ªå€¼è¦ä¸€è‡´
vi config/jvm.options
-Xms4g
-Xmx4g
# å¯åŠ¨
bin/elasticsearch
bin/elasticsearch -d #åŽå°å¯åŠ¨
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>å®‰è£…åˆ†è¯å™¨ä¸‹è½½è§£åŽ‹ç¼©çš„å“¦elasticsearchçš„pluginç›®å½•ä¸‹IKåˆ†è¯å™¨&lt;a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2&lt;/a>&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>POST /_analyze { &amp;#34;analyzer&amp;#34;: &amp;#34;ik_smart&amp;#34;, &amp;#34;text&amp;#34;: &amp;#34; ç¨‹åºå‘˜ }
&lt;/code>&lt;/pre>&lt;p>æ‹¼éŸ³åˆ†è¯å™¨&lt;a href="https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2">https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2&lt;/a>&lt;/p></description><content>&lt;h1 id="æ‰‹åŠ¨å®‰è£…7x">æ‰‹åŠ¨å®‰è£…7.x&lt;/h1>
&lt;h2 id="æ‰‹åŠ¨å®‰è£…å•æœºelasticsearch7x">æ‰‹åŠ¨å®‰è£…å•æœºElasticSearch7.x&lt;/h2>
&lt;pre tabindex="0">&lt;code># ä¸‹è½½taråŒ…,(6.6.2)
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.2.tar.gz
# è§£åŽ‹ç¼©ä¹‹åŽä¿®æ”¹é…ç½®æ–‡ä»¶
vi /elasticsearch-7.10.1/config/elasticsearch.yml
network.host: 0.0.0.0 #è®¾ç½®æˆå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—®
# è¿½åŠ å†…å®¹,ä¿®æ”¹ç³»ç»ŸçŽ¯å¢ƒè¯¥å˜é‡,ä¿®æ”¹å®Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ
vi /etc/sysctl.conf
vm.max_map_count=262144
# åŠ è½½å‚æ•°
anthony@base:/usr/local/elasticsearch-6.6.2$ sudo sysctl -p
vm.max_map_count = 262144
# å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°,åŠ å…¥
vim /etc/security/limits.conf
* soft nofile 65536
* hard nofile 65536
* soft nproc 4096 æˆ–è€…(65536)
* hard nproc 4096 æˆ–è€…(65536)
# ä¿®æ”¹JVMåˆ†é…å¤§å° è¿™ä¸¤ä¸ªå€¼è¦ä¸€è‡´
vi config/jvm.options
-Xms4g
-Xmx4g
# å¯åŠ¨
bin/elasticsearch
bin/elasticsearch -d #åŽå°å¯åŠ¨
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>å®‰è£…åˆ†è¯å™¨ä¸‹è½½è§£åŽ‹ç¼©çš„å“¦elasticsearchçš„pluginç›®å½•ä¸‹IKåˆ†è¯å™¨&lt;a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2&lt;/a>&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>POST /_analyze { &amp;#34;analyzer&amp;#34;: &amp;#34;ik_smart&amp;#34;, &amp;#34;text&amp;#34;: &amp;#34; ç¨‹åºå‘˜ }
&lt;/code>&lt;/pre>&lt;p>æ‹¼éŸ³åˆ†è¯å™¨&lt;a href="https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2">https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /medcl/_analyze
{
&amp;#34;text&amp;#34;: [&amp;#34;ç¨‹åºå‘˜&amp;#34;],
&amp;#34;analyzer&amp;#34;: &amp;#34;pinyin_analyzer&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>æŠ¥é”™åŽŸå› :&lt;/p>
&lt;pre tabindex="0">&lt;code># chown -R ç”¨æˆ·å:ç”¨æˆ·å ç›®å½•å
Exception in thread &amp;#34;main&amp;#34; java.nio.file.AccessDeniedException: /root/home/searchengine/elasticsearch-6.2.4/config/jvm.options
at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)
at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)
at java.nio.file.Files.newByteChannel(Files.java:361)
at java.nio.file.Files.newByteChannel(Files.java:407)
at java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:384)
at java.nio.file.Files.newInputStream(Files.java:152)
at org.elasticsearch.tools.launchers.JvmOptionsParser.main(JvmOptionsParser.java:58)
&lt;/code>&lt;/pre>&lt;h2 id="æ‰‹åŠ¨å®‰è£…é›†ç¾¤elasticsearch7x">æ‰‹åŠ¨å®‰è£…é›†ç¾¤ElasticSearch7.x&lt;/h2>
&lt;p>1.ä¿®æ”¹ä¸€å°elasticsearchçš„elasticsearch.yml&lt;/p>
&lt;pre tabindex="0">&lt;code>cluster.name: kkb-es
node.name: node0
node.master: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: [&amp;#34;127.0.0.1:9300&amp;#34;,&amp;#34;127.0.0.1:9301&amp;#34;,&amp;#34;127.0.0
.1:9302&amp;#34;]
discovery.zen.minimum_master_nodes: 2
http.cors.enabled: true
http.cors.allow-origin: &amp;#34;*&amp;#34;
&lt;/code>&lt;/pre>&lt;p>2.æ‹·è´åˆ°å…¶ä»–çš„æœåŠ¡å™¨&lt;/p>
&lt;p>ä¿®æ”¹ä¸Šé¢å‘¢çš„é…ç½®æ–‡ä»¶ä¸­çš„3ä¸ªé…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>node.name: node0
http.port: 9200
transport.tcp.port: 9300
&lt;/code>&lt;/pre>&lt;p>3.æ£€æŸ¥å¥åº·çŠ¶æ€&lt;/p>
&lt;pre tabindex="0">&lt;code>http://localhost:9200/_cat/health?v
&lt;/code>&lt;/pre>&lt;h2 id="æ‰‹åŠ¨å•æœºkibana7xå®‰è£…">æ‰‹åŠ¨å•æœºKibana7.xå®‰è£…&lt;/h2>
&lt;pre tabindex="0">&lt;code># ä¸‹è½½è§£åŽ‹
https://artifacts.elastic.co/downloads/kibana/kibana-6.6.2-linux-x86_64.tar.gz
# ä¿®æ”¹é…ç½®æ–‡ä»¶
vi kibana-6.4.2-linux-x86_64/config/kibana.yml
server.port: 5600
server.host: &amp;#34;0.0.0.0&amp;#34;
elasticsearch.url: &amp;#34;http://localhost:9200&amp;#34;
# å¯åŠ¨,åŽå°å¯åŠ¨
./bin/kibana &amp;amp;
&lt;/code>&lt;/pre>&lt;h2 id="æ‰‹åŠ¨å•æœºlogstash7xå®‰è£…">æ‰‹åŠ¨å•æœºLogstash7.xå®‰è£…&lt;/h2>
&lt;p>&lt;code>mysql-connector-java-5.1.48.jar&lt;/code>æ˜¯æ”¾åœ¨&lt;code>logstash-6.6.2/logstash-core/lib/jars&lt;/code>,è¿™æ ·å°±ä¸éœ€è¦å†™ç›¸å¯¹è·¯å¾„äº†&lt;/p>
&lt;pre tabindex="0">&lt;code>input {
jdbc {
jdbc_driver_library =&amp;gt; &amp;#34;mysql-connector-java-5.1.48.jar&amp;#34;
jdbc_driver_class =&amp;gt; &amp;#34;com.mysql.jdbc.Driver&amp;#34;
jdbc_connection_string =&amp;gt; &amp;#34;jdbc:mysql://192.168.111.128:3306/ssm&amp;#34;
jdbc_user =&amp;gt; &amp;#34;root&amp;#34;
jdbc_password =&amp;gt; &amp;#34;123456&amp;#34;
jdbc_paging_enabled =&amp;gt; &amp;#34;true&amp;#34;
jdbc_page_size =&amp;gt; &amp;#34;2&amp;#34;
statement =&amp;gt; &amp;#34;SELECT id,&amp;#39;name&amp;#39;,phone FROM phone where update_data &amp;gt;= :sql_last_value&amp;#34;
tracking_column_type =&amp;gt; &amp;#34;timestamp&amp;#34;
tracking_column =&amp;gt; &amp;#34;update_date&amp;#34;
schedule =&amp;gt; &amp;#34;* * * * *&amp;#34;
}
}
output {
elasticsearch {
index =&amp;gt; &amp;#34;phone&amp;#34;
document_id=&amp;gt; &amp;#34;%{id}&amp;#34;
hosts =&amp;gt; [&amp;#34;http://192.168.111.128:9200&amp;#34;]
}
}
&lt;/code>&lt;/pre>&lt;p>å¯åŠ¨å‘½ä»¤&lt;/p>
&lt;pre tabindex="0">&lt;code>./logstash -f ../config/logstash-sample.conf
&lt;/code>&lt;/pre>&lt;h1 id="æ‰‹åŠ¨å®‰è£…8x">æ‰‹åŠ¨å®‰è£…8.x&lt;/h1>
&lt;aside>
ðŸ“Œ 8.0 å·²ç»è‡ªå¸¦äº†jdk
&lt;/aside>
&lt;h2 id="äºŒè¿›åˆ¶åŒ…å®‰è£…es">äºŒè¿›åˆ¶åŒ…å®‰è£…ES&lt;/h2>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¸‹è½½åŒ…å¹¶è§£åŽ‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://xxxx.tar
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯åŠ¨./elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./bin/elasticsearch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¿è¡Œç»“æžœ">è¿è¡Œç»“æžœ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>âœ… Elasticsearch security features have been automatically configured!
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>âœ… Authentication is enabled and cluster connections are encrypted.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â„¹ï¸ Password &lt;span style="color:#66d9ef">for&lt;/span> the elastic user &lt;span style="color:#f92672">(&lt;/span>reset with &lt;span style="color:#e6db74">`&lt;/span>bin/elasticsearch-reset-password -u elastic&lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#f92672">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Shb2+OuCKthxFTxD-*jE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â„¹ï¸ HTTP CA certificate SHA-256 fingerprint:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ceb6add33653a4c8f3493bddde839cdfcf1035a3a50cb01247962495f15ea40f
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â„¹ï¸ Configure Kibana to use this cluster:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€¢ Copy the following enrollment token and paste it into Kibana in your browser &lt;span style="color:#f92672">(&lt;/span>valid &lt;span style="color:#66d9ef">for&lt;/span> the next &lt;span style="color:#ae81ff">30&lt;/span> minutes&lt;span style="color:#f92672">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> eyJ2ZXIiOiI4LjAuMCIsImFkciI6WyIxMC4wLjIuNDo5MjAwIl0sImZnciI6ImNlYjZhZGQzMzY1M2E0YzhmMzQ5M2JkZGRlODM5Y2RmY2YxMDM1YTNhNTBjYjAxMjQ3OTYyNDk1ZjE1ZWE0MGYiLCJrZXkiOiJXaEV4SDM4QlZXV242cU9KejgxNTprUVliUEY0dlJfaU56MnRFaDlRY0hnIn0&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â„¹ï¸ Configure other nodes to join this cluster:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€¢ On this node:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> âƒ Create an enrollment token with &lt;span style="color:#e6db74">`&lt;/span>bin/elasticsearch-create-enrollment-token -s node&lt;span style="color:#e6db74">`&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> âƒ Uncomment the transport.host setting at the end of config/elasticsearch.yml.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> âƒ Restart Elasticsearch.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€¢ On other nodes:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> âƒ Start Elasticsearch with &lt;span style="color:#e6db74">`&lt;/span>bin/elasticsearch --enrollment-token &amp;lt;token&amp;gt;&lt;span style="color:#e6db74">`&lt;/span>, using the enrollment token that you generated.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åœæ­¢æœåŠ¡ä¿®æ”¹é…ç½®æ–‡ä»¶">åœæ­¢æœåŠ¡,ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/h3>
&lt;p>ç„¶åŽè¾“å…¥ï¼šcurl 127.0.0.1:9200,è¿”å›žæ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>hy@localhost ~&lt;span style="color:#f92672">]&lt;/span>$ curl 127.0.0.1:9200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl: &lt;span style="color:#f92672">(&lt;/span>52&lt;span style="color:#f92672">)&lt;/span> Empty reply from server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€ŒESé‚£è¾¹ä¹Ÿæœ‰å“åº”&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># çœ‹æ¥è¿™å’Œä»¥å‰çš„7.1.1ç‰ˆæœ¬ä¸ä¸€æ ·äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>2022-02-19T05:02:02,812&lt;span style="color:#f92672">][&lt;/span>WARN &lt;span style="color:#f92672">][&lt;/span>o.e.x.s.t.n.SecurityNetty4HttpServerTransport&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">[&lt;/span>localhost.localdomain&lt;span style="color:#f92672">]&lt;/span> received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&lt;span style="color:#f92672">{&lt;/span>localAddress&lt;span style="color:#f92672">=&lt;/span>/127.0.0.1:9200, remoteAddress&lt;span style="color:#f92672">=&lt;/span>/127.0.0.1:38518&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>2022-02-19T05:02:27,144&lt;span style="color:#f92672">][&lt;/span>WARN &lt;span style="color:#f92672">][&lt;/span>o.e.x.s.t.n.SecurityNetty4HttpServerTransport&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">[&lt;/span>localhost.localdomain&lt;span style="color:#f92672">]&lt;/span> received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&lt;span style="color:#f92672">{&lt;/span>localAddress&lt;span style="color:#f92672">=&lt;/span>/&lt;span style="color:#f92672">[&lt;/span>0:0:0:0:0:0:0:1&lt;span style="color:#f92672">]&lt;/span>:9200, remoteAddress&lt;span style="color:#f92672">=&lt;/span>/&lt;span style="color:#f92672">[&lt;/span>0:0:0:0:0:0:0:1&lt;span style="color:#f92672">]&lt;/span>:56174&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># éœ€è¦æŠŠsecurity featureséƒ½å…³é—­ï¼Œå¦åˆ™httpä¸å¯¹å¤–æœåŠ¡äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># trueæ”¹æˆfalse&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xpack.security.http.ssl:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> enabled: false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> keystore.path: certs/http.p12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Enable encryption and mutual authentication between cluster nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xpack.security.transport.ssl:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> enabled: false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•è®¿é—®">æµ‹è¯•è®¿é—®&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>http://localhost:9200
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç :elastic / Shb2+OuCKthxFTxD-*jE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="javaè®¿é—®æµ‹è¯•">javaè®¿é—®æµ‹è¯•&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>org.elasticsearch.client&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>elasticsearch-rest-client&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>8.0.0&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>@Bean(destroyMethod = &amp;#34;close&amp;#34;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>public RestClient restClient() throws CertificateException, IOException, KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> final CredentialsProvider credentialsProvider =
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new BasicCredentialsProvider();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> credentialsProvider.setCredentials(AuthScope.ANY,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new UsernamePasswordCredentials(&amp;#34;elastic&amp;#34;, &amp;#34;VWFjE60dbpKIjbajGJQ4&amp;#34;));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Path caCertificatePath = Paths.get(&amp;#34;E:\\es\\elasticsearch-8.0.0-windows-x86_64\\elasticsearch-8.0.0\\config\\certs\\http_ca.crt&amp;#34;);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CertificateFactory factory =
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CertificateFactory.getInstance(&amp;#34;X.509&amp;#34;);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Certificate trustedCa;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> try (InputStream is = Files.newInputStream(caCertificatePath)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> trustedCa = factory.generateCertificate(is);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> KeyStore trustStore = KeyStore.getInstance(&amp;#34;pkcs12&amp;#34;);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> trustStore.load(null, null);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> trustStore.setCertificateEntry(&amp;#34;ca&amp;#34;, trustedCa);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SSLContextBuilder sslContextBuilder = SSLContexts.custom()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .loadTrustMaterial(trustStore, null);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> final SSLContext sslContext = sslContextBuilder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RestClientBuilder builder = RestClient.builder(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new HttpHost(&amp;#34;localhost&amp;#34;, 9200, &amp;#34;https&amp;#34;))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setHttpClientConfigCallback(httpClientBuilder -&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return httpClientBuilder.setSSLContext(sslContext);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return builder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//æ³¨å…¥client&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RestClient restClient;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Request request &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Request(&lt;span style="color:#e6db74">&amp;#34;GET&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;/ess_book/_doc/1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Response response &lt;span style="color:#f92672">=&lt;/span> restClient.&lt;span style="color:#a6e22e">performRequest&lt;/span>(request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> EntityUtils.&lt;span style="color:#a6e22e">toString&lt;/span>(response.&lt;span style="color:#a6e22e">getEntity&lt;/span>());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é›†ç¾¤å®‰è£…es">é›†ç¾¤å®‰è£…ES&lt;/h2>
&lt;p>&lt;a href="https://juejin.cn/post/7066717637564170271">å…¨æ ˆå¼€å‘ä¹‹ElasticSearch8.0åˆ†å¸ƒå¼æœç´¢å¼•æ“Žé›†ç¾¤åŠå…¶é«˜å¯ç”¨æµ‹è¯• - æŽ˜é‡‘&lt;/a>&lt;/p>
&lt;h2 id="å®‰è£…kibana">å®‰è£…Kibana&lt;/h2>
&lt;h1 id="å®‰è£…æŠ¥é”™">å®‰è£…æŠ¥é”™&lt;/h1>
&lt;p>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vm.max_map_count&lt;span style="color:#f92672">=&lt;/span>****262144
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä½¿ç”Ÿæ•ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sysctl -p****
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å®‰è£…æ’ä»¶">å®‰è£…æ’ä»¶&lt;/h1>
&lt;h3 id="å®‰è£…head">å®‰è£…HEAD&lt;/h3>
&lt;p>Headæ˜¯elasticsearchçš„é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºŽæ•°æ®çš„æµè§ˆå’ŒæŸ¥è¯¢&lt;/p>
&lt;p>(1)elasticsearch-headæ˜¯ä¸€æ¬¾å¼€æºè½¯ä»¶ï¼Œè¢«æ‰˜ç®¡åœ¨githubä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æžœæˆ‘ä»¬è¦ä½¿ç”¨å®ƒï¼Œå¿…é¡»å…ˆå®‰è£…gitï¼Œé€šè¿‡gitèŽ·å–elasticsearch-head&lt;/p>
&lt;p>(2)è¿è¡Œelasticsearch-headä¼šç”¨åˆ°gruntï¼Œè€Œgruntéœ€è¦npmåŒ…ç®¡ç†å™¨ï¼Œæ‰€ä»¥nodejsæ˜¯å¿…é¡»è¦å®‰è£…çš„&lt;/p>
&lt;p>(3)elasticsearch5.0ä¹‹åŽï¼Œelasticsearch-headä¸åšä¸ºæ’ä»¶æ”¾åœ¨å…¶pluginsç›®å½•ä¸‹äº†ã€‚ä½¿ç”¨gitæ‹·è´elasticsearch-headåˆ°æœ¬åœ°&lt;/p>
&lt;p>cd /usr/local/&lt;/p>
&lt;p>git clone git://github.com/mobz/elasticsearch-head.git&lt;/p>
&lt;p>(4)å®‰è£…elasticsearch-headä¾èµ–åŒ…&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> local]# npm install -g grunt-cli&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> _site]# cd /usr/local/elasticsearch-head/&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# cnpm install&lt;/p>
&lt;p>(5)ä¿®æ”¹Gruntfile.js&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> _site]# cd /usr/local/elasticsearch-head/&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# vi Gruntfile.js&lt;/p>
&lt;p>åœ¨connect&amp;ndash;&amp;gt;server&amp;ndash;&amp;gt;optionsä¸‹é¢æ·»åŠ ï¼šhostname:â€™*â€™ï¼Œå…è®¸æ‰€æœ‰IPå¯ä»¥è®¿é—®&lt;/p>
&lt;p>(6)ä¿®æ”¹elasticsearch-headé»˜è®¤è¿žæŽ¥åœ°å€[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# cd /usr/local/elasticsearch-head/_site/&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> _site]# vi app.js&lt;/p>
&lt;p>å°†this.base_uri = this.config.base_uri || this.prefs.get(&amp;ldquo;app-base_uri&amp;rdquo;) || &amp;ldquo;http://localhost:9200&amp;rdquo;;ä¸­çš„localhostä¿®æ”¹æˆä½ esçš„æœåŠ¡å™¨åœ°å€&lt;/p>
&lt;p>(7)é…ç½®elasticsearchå…è®¸è·¨åŸŸè®¿é—®&lt;/p>
&lt;p>æ‰“å¼€elasticsearchçš„é…ç½®æ–‡ä»¶elasticsearch.ymlï¼Œåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä¸‹é¢ä¸¤è¡Œä»£ç å³å¯ï¼š&lt;/p>
&lt;p>http.cors.enabled: true&lt;/p>
&lt;p>http.cors.allow-origin: &amp;ldquo;*&amp;rdquo;&lt;/p>
&lt;p>(8)æ‰“å¼€9100ç«¯å£&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# firewall-cmd &amp;ndash;zone=public &amp;ndash;add-port=9100/tcp &amp;ndash;permanent&lt;/p>
&lt;p>é‡å¯é˜²ç«å¢™&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# firewall-cmd &amp;ndash;reload&lt;/p>
&lt;p>(9)å¯åŠ¨elasticsearch&lt;/p>
&lt;p>(10)å¯åŠ¨elasticsearch-head&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> _site]# cd /usr/local/elasticsearch-head/&lt;/p>
&lt;p>[root&lt;a href="#ZgotmplZ">@localhost&lt;/a> elasticsearch-head]# node_modules/grunt/bin/grunt server&lt;/p>
&lt;p>(11)è®¿é—®elasticsearch-head&lt;/p>
&lt;p>å…³é—­é˜²ç«å¢™ï¼šsystemctl stop firewalld.service&lt;/p>
&lt;p>æµè§ˆå™¨è¾“å…¥ç½‘å€ï¼š&lt;a href="http://192.168.25.131:9100/">http://192.168.25.131:9100/&lt;/a>&lt;/p>
&lt;h3 id="å®‰è£…ä¸­æ–‡åˆ†è¯å™¨">å®‰è£…ä¸­æ–‡åˆ†è¯å™¨&lt;/h3>
&lt;p>(1)ä¸‹è½½ä¸­æ–‡åˆ†è¯å™¨&lt;a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>ä¸‹è½½elasticsearch-analysis-ik-master.zip
&lt;/code>&lt;/pre>&lt;p>(2)è§£åŽ‹elasticsearch-analysis-ik-master.zip&lt;/p>
&lt;p>unzip elasticsearch-analysis-ik-master.zip&lt;/p>
&lt;p>(3)è¿›å…¥elasticsearch-analysis-ik-masterï¼Œç¼–è¯‘æºç &lt;/p>
&lt;p>mvn clean install -Dmaven.test.skip=true&lt;/p>
&lt;p>(4)åœ¨esçš„pluginsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºç›®å½•ik&lt;/p>
&lt;p>(5)å°†ç¼–è¯‘åŽç”Ÿæˆçš„elasticsearch-analysis-ik-ç‰ˆæœ¬.zipç§»åŠ¨åˆ°ikä¸‹ï¼Œå¹¶è§£åŽ‹&lt;/p>
&lt;p>(6)è§£åŽ‹åŽçš„å†…å®¹ç§»åŠ¨åˆ°ikç›®å½•ä¸‹&lt;/p>
&lt;h3 id="åˆ†è¯å™¨ä»‹ç»åŠå†…ç½®åˆ†è¯å™¨">åˆ†è¯å™¨ä»‹ç»åŠå†…ç½®åˆ†è¯å™¨&lt;/h3>
&lt;p>åˆ†è¯å™¨ï¼šä»Žä¸€ä¸²æ–‡æœ¬ä¸­åˆ‡åˆ†å‡ºä¸€ä¸ªä¸€ä¸ªçš„è¯æ¡ï¼Œå¹¶å¯¹æ¯ä¸ªè¯æ¡è¿›è¡Œæ ‡å‡†åŒ–&lt;/p>
&lt;p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š&lt;/p>
&lt;p>character filterï¼šåˆ†è¯ä¹‹å‰çš„é¢„å¤„ç†ï¼Œè¿‡æ»¤æŽ‰HTMLæ ‡ç­¾ï¼Œç‰¹æ®Šç¬¦å·è½¬æ¢ç­‰&lt;/p>
&lt;p>tokenizerï¼šåˆ†è¯&lt;/p>
&lt;p>token filterï¼šæ ‡å‡†åŒ–&lt;/p>
&lt;p>å†…ç½®åˆ†è¯å™¨ï¼š&lt;/p>
&lt;p>standard åˆ†è¯å™¨ï¼š(é»˜è®¤çš„)ä»–ä¼šå°†è¯æ±‡å•å…ƒè½¬æ¢æˆå°å†™å½¢å¼ï¼Œå¹¶åŽ»é™¤åœç”¨è¯å’Œæ ‡ç‚¹ç¬¦å·ï¼Œæ”¯æŒä¸­æ–‡é‡‡ç”¨çš„æ–¹æ³•ä¸ºå•å­—åˆ‡åˆ†&lt;/p>
&lt;p>simple åˆ†è¯å™¨ï¼šé¦–å…ˆä¼šé€šè¿‡éžå­—æ¯å­—ç¬¦æ¥åˆ†å‰²æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åŽå°†è¯æ±‡å•å…ƒç»Ÿä¸€ä¸ºå°å†™å½¢å¼ã€‚è¯¥åˆ†æžå™¨ä¼šåŽ»æŽ‰æ•°å­—ç±»åž‹çš„å­—ç¬¦ã€‚&lt;/p>
&lt;p>Whitespace åˆ†è¯å™¨ï¼šä»…ä»…æ˜¯åŽ»é™¤ç©ºæ ¼ï¼Œå¯¹å­—ç¬¦æ²¡æœ‰lowcaseåŒ–,ä¸æ”¯æŒä¸­æ–‡ï¼›å¹¶ä¸”ä¸å¯¹ç”Ÿæˆçš„è¯æ±‡å•å…ƒè¿›è¡Œå…¶ä»–çš„æ ‡å‡†åŒ–å¤„ç†ã€‚&lt;/p>
&lt;p>language åˆ†è¯å™¨ï¼šç‰¹å®šè¯­è¨€çš„åˆ†è¯å™¨ï¼Œä¸æ”¯æŒä¸­æ–‡&lt;/p>
&lt;h1 id="apiç®€å•ä½¿ç”¨">APIç®€å•ä½¿ç”¨&lt;/h1>
&lt;h1 id="æŸ¥è¯¢ç´¢å¼•å’Œæ˜ å°„">æŸ¥è¯¢ç´¢å¼•å’Œæ˜ å°„&lt;/h1>
&lt;pre tabindex="0">&lt;code># è¿™ä¸¤ä¸ªéƒ½æ˜¯æŸ¥çœ‹ç´¢å¼•,åªæ˜¯ç¬¬ä¸‰è¡Œæ¯”ç¬¬ä¸‰è¡Œå¤šå‡ ä¸ªå­—æ®µ
GET lib
GET /lib/_settings
# æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•
GET /_all/_settings
# æŸ¥è¯¢æ˜ å°„
GET /lib2/_mapping
&lt;/code>&lt;/pre>&lt;h1 id="æ·»åŠ ç´¢å¼•">æ·»åŠ ç´¢å¼•&lt;/h1>
&lt;pre tabindex="0">&lt;code># æ–¹å¼ä¸€,ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®
PUT /lib
# æ–¹å¼äºŒ
PUT /lib/
{
&amp;#34;settings&amp;#34;: {
&amp;#34;index&amp;#34;: {
&amp;#34;number_of_shards&amp;#34;: 5,
&amp;#34;number_of_replicas&amp;#34;: 1
}
}
}
# æ–¹å¼ä¸‰,æŒ‡å®šå­—æ®µç±»åž‹
PUT /lib3
{
&amp;#34;mappings&amp;#34;: {
&amp;#34;user&amp;#34;:{
&amp;#34;properties&amp;#34;:{
&amp;#34;name&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;address&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;age&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;interests&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;birthday&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;}
}
}
}
}
&lt;/code>&lt;/pre>&lt;h1 id="æ·»åŠ æ–‡æ¡£">æ·»åŠ æ–‡æ¡£&lt;/h1>
&lt;pre tabindex="0">&lt;code># æŒ‡å®šidçš„æ—¶å€™ç”¨PUT
PUT /lib/user/1
{
&amp;#34;first_name&amp;#34;:&amp;#34;Jame&amp;#34;,
&amp;#34;last_name&amp;#34;:&amp;#34;Smith&amp;#34;,
&amp;#34;age&amp;#34;:&amp;#34;32&amp;#34;,
&amp;#34;about&amp;#34;:&amp;#34;I like to collect rock albums&amp;#34;,
&amp;#34;interests&amp;#34;:[&amp;#34;music&amp;#34;]
}
# æ²¡æœ‰æŒ‡å®šIDç”¨POST,åˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨ç”ŸæˆID
POST /lib/user/
{
&amp;#34;first_name&amp;#34;:&amp;#34;anthony&amp;#34;,
&amp;#34;last_name&amp;#34;:&amp;#34;Smith&amp;#34;,
&amp;#34;age&amp;#34;:&amp;#34;32&amp;#34;,
&amp;#34;about&amp;#34;:&amp;#34;I like to collect rock albums&amp;#34;,
&amp;#34;interests&amp;#34;:[&amp;#34;music&amp;#34;]
}
&lt;/code>&lt;/pre>&lt;h1 id="æŸ¥è¯¢æ–‡æ¡£">æŸ¥è¯¢æ–‡æ¡£&lt;/h1>
&lt;pre tabindex="0">&lt;code># æŒ‡å®šID
GET /lib/user/1
# æŸ¥çœ‹æ–‡æ¡£ä¸­çš„æŒ‡å®šå­—æ®µ
GET /lib/user/1?_source=age,about
# æŸ¥è¯¢ç´¢å¼•ä¸‹çš„æ‰€æœ‰æ–‡æ¡£
GET /tt/ttt/_search
&lt;/code>&lt;/pre>&lt;h1 id="æ›´æ–°æ–‡æ¡£">æ›´æ–°æ–‡æ¡£&lt;/h1>
&lt;pre tabindex="0">&lt;code># ä»¥è¦†ç›–çš„æ–¹å¼,å¦‚æžœæœ‰è¿™ä¸ªid,å°±è¦†ç›–æ›´æ–°,å¦‚æžœæ²¡æœ‰id,å°±åˆ›å»º
PUT /lib/user/1
{
&amp;#34;first_name&amp;#34;:&amp;#34;Jame&amp;#34;,
&amp;#34;last_name&amp;#34;:&amp;#34;Smith&amp;#34;,
&amp;#34;age&amp;#34;:&amp;#34;36&amp;#34;,
&amp;#34;about&amp;#34;:&amp;#34;I like to collect rock albums&amp;#34;,
&amp;#34;interests&amp;#34;:[&amp;#34;music&amp;#34;]
}
# åªæ˜¯æ›´æ–°æ–‡æ¡£
POST /lib/user/1/_update
{
&amp;#34;doc&amp;#34;:{
&amp;#34;age&amp;#34;:&amp;#34;37&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;h1 id="åˆ é™¤æ–‡æ¡£å’Œç´¢å¼•">åˆ é™¤æ–‡æ¡£å’Œç´¢å¼•&lt;/h1>
&lt;pre tabindex="0">&lt;code># åˆ é™¤æ–‡æ¡£
DELETE /lib/user/1
# åˆ é™¤ç´¢å¼•
DELETE /lib
&lt;/code>&lt;/pre>&lt;h1 id="muliget">MuliGet&lt;/h1>
&lt;p>MuliGet éœ€è¦ID,æ‰èƒ½å®žçŽ°&lt;/p>
&lt;pre tabindex="0">&lt;code># æ‰¹é‡æŸ¥è¯¢,è¿™æ˜¯æŸ¥å‡ºå…¨éƒ¨æ•°æ®
GET /_mget
{
&amp;#34;docs&amp;#34;:[
{
&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,
&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;:1
},
{
&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,
&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;:2
},
{
&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,
&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;:3
}
]
}
# æ‰¹é‡æŸ¥è¯¢,ç­›é€‰å­—æ®µ
GET /_mget
{
&amp;#34;docs&amp;#34;:[
{
&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,
&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;:1,
&amp;#34;_source&amp;#34;:&amp;#34;interests&amp;#34;
},
{
&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,
&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;:2,
&amp;#34;_source&amp;#34;:[&amp;#34;interests&amp;#34;,&amp;#34;age&amp;#34;]
}]
}
# MuliGetæ‰¹é‡æŸ¥è¯¢çš„æ˜¯åŒä¸€ä¸ªæ–‡æ¡£æ—¶å€™,å¯ä»¥ç®€å†™æ–¹å¼
GET /lib/user/_mget
{
&amp;#34;docs&amp;#34;: [
{
&amp;#34;_id&amp;#34;: 1
},
{
&amp;#34;_type&amp;#34;: &amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;: 2
}
]
}
# æ›´ç®€å•çš„æ–¹å¼
GET /lib/user/_mget
{
&amp;#34;ids&amp;#34;: [&amp;#34;1&amp;#34;,&amp;#34;2&amp;#34;]
}
&lt;/code>&lt;/pre>&lt;h1 id="bulkæ‰¹é‡æ’å…¥">Bulkæ‰¹é‡æ’å…¥&lt;/h1>
&lt;p>bulkçš„æ ¼å¼ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>{action:{metadata}}
{requstbody}
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>action:&lt;/li>
&lt;li>createï¼šæ–‡æ¡£ä¸å­˜åœ¨æ—¶åˆ›å»º&lt;/li>
&lt;li>update:æ›´æ–°æ–‡æ¡£&lt;/li>
&lt;li>index:åˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£&lt;/li>
&lt;li>delete:åˆ é™¤ä¸€ä¸ªæ–‡æ¡£&lt;/li>
&lt;li>metadata:&lt;/li>
&lt;li>index&lt;/li>
&lt;li>_type&lt;/li>
&lt;li>_id&lt;/li>
&lt;/ul>
&lt;p>create å’Œindexçš„åŒºåˆ«:å¦‚æžœæ•°æ®å­˜åœ¨ï¼Œä½¿ç”¨createæ“ä½œå¤±è´¥ï¼Œä¼šæç¤ºæ–‡æ¡£å·²ç»å­˜åœ¨ï¼Œä½¿ç”¨indexåˆ™å¯ä»¥æˆåŠŸæ‰§è¡Œã€‚&lt;/p>
&lt;p>bulkä¸€æ¬¡æœ€å¤§å¤„ç†å¤šå°‘æ•°æ®é‡:&lt;/p>
&lt;p>bulkä¼šæŠŠå°†è¦å¤„ç†çš„æ•°æ®è½½å…¥å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ•°æ®é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœ€ä½³çš„æ•°æ®é‡ä¸æ˜¯ä¸€ä¸ªç¡®å®šçš„æ•°å€¼ï¼Œå®ƒå–å†³äºŽä½ çš„ç¡¬ä»¶ï¼Œä½ çš„æ–‡æ¡£å¤§å°ä»¥åŠå¤æ‚æ€§ï¼Œä½ çš„ç´¢å¼•ä»¥åŠæœç´¢çš„è´Ÿè½½ã€‚ä¸€èˆ¬å»ºè®®æ˜¯1000-5000ä¸ªæ–‡æ¡£ï¼Œå¤§å°å»ºè®®æ˜¯5-15MBï¼Œé»˜è®¤ä¸èƒ½è¶…è¿‡100Mï¼Œå¯ä»¥åœ¨esçš„é…ç½®æ–‡ä»¶ï¼ˆå³$ES_HOMEä¸‹çš„configä¸‹çš„elasticsearch.ymlï¼‰ä¸­ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code># æ‰¹é‡åˆ é™¤,deleteä¸éœ€è¦è¯·æ±‚ä½“
{&amp;#34;delete&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;lib&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;user&amp;#34;,&amp;#34;_id&amp;#34;:&amp;#34;1&amp;#34;}}
# æ‰¹é‡æ·»åŠ 
POST /lib2/books/_bulk
{&amp;#34;index&amp;#34;:{&amp;#34;_id&amp;#34;:1}}
{&amp;#34;title&amp;#34;:&amp;#34;java&amp;#34;,&amp;#34;price&amp;#34;:55}
{&amp;#34;index&amp;#34;:{&amp;#34;_id&amp;#34;:2}}
{&amp;#34;title&amp;#34;:&amp;#34;html5&amp;#34;,&amp;#34;price&amp;#34;:55}
{&amp;#34;index&amp;#34;:{&amp;#34;_id&amp;#34;:3}}
{&amp;#34;title&amp;#34;:&amp;#34;php&amp;#34;,&amp;#34;price&amp;#34;:35}
{&amp;#34;index&amp;#34;:{&amp;#34;_id&amp;#34;:4}}
{&amp;#34;title&amp;#34;:&amp;#34;python&amp;#34;,&amp;#34;price&amp;#34;:50}
# æ‰¹é‡èŽ·å–
GET /lib2/books/_mget
{
&amp;#34;ids&amp;#34;: [&amp;#34;1&amp;#34;,&amp;#34;2&amp;#34;,&amp;#34;3&amp;#34;,&amp;#34;4&amp;#34;]
}
# æ‰¹é‡æ“ä½œ
POST /lib2/books/_bulk
{&amp;#34;delete&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;lib2&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;books&amp;#34;,&amp;#34;_id&amp;#34;:4}}
{&amp;#34;create&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;tt&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;ttt&amp;#34;,&amp;#34;_id&amp;#34;:&amp;#34;100&amp;#34;}}
{&amp;#34;name&amp;#34;:&amp;#34;lisi&amp;#34;}
{&amp;#34;index&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;tt&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;ttt&amp;#34;}}
{&amp;#34;name&amp;#34;:&amp;#34;zhaosi&amp;#34;}
{&amp;#34;update&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;lib2&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;books&amp;#34;,&amp;#34;_id&amp;#34;:&amp;#34;4&amp;#34;}}
{&amp;#34;doc&amp;#34;:{&amp;#34;price&amp;#34;:58}}
&lt;/code>&lt;/pre>&lt;h1 id="åŸºæœ¬æŸ¥è¯¢queryæŸ¥è¯¢">åŸºæœ¬æŸ¥è¯¢(QueryæŸ¥è¯¢)&lt;/h1>
&lt;h3 id="termå’ŒtermsæŸ¥è¯¢">termå’ŒtermsæŸ¥è¯¢&lt;/h3>
&lt;ul>
&lt;li>term æŸ¥è¯¢ä¼šåŽ»å€’æŽ’ç´¢å¼•ä¸­å¯»æ‰¾ç¡®åˆ‡çš„tem,å®ƒå¹¶ä¸çŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨,è¿™ç§æŸ¥è¯¢ä½¿ç”¨keyword,numeric,date,åœ¨æ²¡æœ‰ä½¿ç”¨åˆ†è¯å™¨çš„æ—¶å€™ä½¿ç”¨&lt;/li>
&lt;li>term æŸ¥è¯¢æŸä¸ªå­—æ®µé‡Œå«æœ‰æŸä¸ªå…³é”®è¯çš„æ–‡æ¡£&lt;/li>
&lt;li>terms:æŸ¥è¯¢æŸä¸ªå­—æ®µé‡Œå«æœ‰å¤šä¸ªå…³é”®è¯çš„æ–‡æ¡£&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code># termï¼Œnameå«æœ‰â€œzhaomingâ€
GET /lib3/user/_search/
{
&amp;#34;query&amp;#34;:{
&amp;#34;term&amp;#34;: {&amp;#34;name&amp;#34;: &amp;#34;zhaoming&amp;#34;}
}
}
# termsï¼Œnameå«æœ‰â€œzhouâ€æˆ–è€…è¿˜æœ‰&amp;#34;yang&amp;#34;çš„æŸ¥å‡ºæ¥
GET /lib3/user/_search/
{
&amp;#34;query&amp;#34;:{
&amp;#34;terms&amp;#34;: {
&amp;#34;name&amp;#34;: [&amp;#34;zhou&amp;#34;,&amp;#34;yang&amp;#34;]
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="formå’Œsizeåˆ†é¡µ">formå’Œsizeåˆ†é¡µ&lt;/h3>
&lt;p>formæ˜¯ä»Ž0å¼€å§‹çš„,sizeæ˜¯å–å¤šå°‘ä¸ª&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search/
{
&amp;#34;version&amp;#34;: true, # æŸ¥è¯¢çš„æ—¶å€™å¦‚æžœéœ€è¦è¿”å›žversionçš„è¯
&amp;#34;from&amp;#34;: 0,
&amp;#34;size&amp;#34;: 1,
&amp;#34;query&amp;#34;:{
&amp;#34;terms&amp;#34;: {
&amp;#34;name&amp;#34;: [&amp;#34;zhou&amp;#34;,&amp;#34;lisi&amp;#34;]
}
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>GET article/_count
{
&amp;#34;query&amp;#34;: {
&amp;#34;match&amp;#34;: {
&amp;#34;title&amp;#34;: &amp;#34;é‡‘èž&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="matchæŸ¥è¯¢">matchæŸ¥è¯¢&lt;/h3>
&lt;p>match queryçŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨ï¼Œä¼šå¯¹filedè¿›è¡Œåˆ†è¯æ“ä½œï¼Œç„¶åŽå†æŸ¥è¯¢&lt;/p>
&lt;ul>
&lt;li>match_all:æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£&lt;/li>
&lt;li>match:æŸ¥è¯¢ä¸€ä¸ªå­—æ®µ&lt;/li>
&lt;li>multi_match:æŸ¥è¯¢å¤šä¸ªå­—æ®µ&lt;/li>
&lt;li>match_phrase:åŒ…å«å¾—å«æœ‰ä¸€æ ·çš„,è€Œä¸”é¡ºåºè¿˜ä¸€æ ·çš„,å¯ä»¥ä¸ç”¨å®Œæ•´&lt;/li>
&lt;li>match_phrase_prefix: å‰ç¼€åŒ¹é…&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code># matchæ˜¯çŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨çš„,æ‰€ä»¥ä¼šåŽ»æŸ¥è¯¢nameæ˜¯lisiçš„,æˆ–è€…nameæ˜¯zhaomingçš„(orçš„å…³ç³»)
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;match&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;lisi zhaoming&amp;#34;
}
}
}
# å¯ä»¥æŒ‡å®šå¤šä¸ªå­—æ®µ
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;multi_match&amp;#34;: {
&amp;#34;query&amp;#34;: &amp;#34;lvyou&amp;#34;,
&amp;#34;fields&amp;#34;: [&amp;#34;interests&amp;#34;,&amp;#34;name&amp;#34;]
}
}
}
# çŸ­è¯­åŒ¹é…(è¦å®Œå…¨åŒ¹é…),åŒ…å«çš„å…³ç³»
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;match_phrase&amp;#34;: {
&amp;#34;interests&amp;#34;: &amp;#34;lvyou, duanlian &amp;#34;
}
}
}
# å‰ç¼€åŒ¹é…
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;match_phrase_prefix&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;zhao&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="_sourceæŽ§åˆ¶è¿”å›žå­—æ®µ">_sourceæŽ§åˆ¶è¿”å›žå­—æ®µ&lt;/h3>
&lt;pre tabindex="0">&lt;code># æŒ‡å®šè¿”å›žçš„å­—æ®µ
GET /lib3/user/_search
{
&amp;#34;_source&amp;#34;: [&amp;#34;address&amp;#34;,&amp;#34;name&amp;#34;],
&amp;#34;query&amp;#34;: {
&amp;#34;match&amp;#34;: {
&amp;#34;interests&amp;#34;: &amp;#34;changge&amp;#34;
}
}
}
# åŒ…å«å’ŒæŽ’é™¤è¿”å›žå­—æ®µ
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;_source&amp;#34;: {
&amp;#34;includes&amp;#34;: [&amp;#34;name&amp;#34;,&amp;#34;address&amp;#34;], # åŒ…å«è¿™äº›å­—æ®µ
&amp;#34;excludes&amp;#34;: [&amp;#34;age&amp;#34;,&amp;#34;birthday&amp;#34;] # æŽ’é™¤è¿™äº›å­—æ®µ
}
}
# ä½¿ç”¨é€šé…ç¬¦*
GET /lib3/user/_search
{
&amp;#34;_source&amp;#34;: {
&amp;#34;includes&amp;#34;: &amp;#34;addr*&amp;#34;,
&amp;#34;excludes&amp;#34;: [&amp;#34;name&amp;#34;,&amp;#34;bir*&amp;#34;]
},
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="sortæŽ’åº">sortæŽ’åº&lt;/h3>
&lt;pre tabindex="0">&lt;code># æŒ‡å®šæŽ’åºå­—æ®µ
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;sort&amp;#34;: [
{
&amp;#34;age&amp;#34;: {
&amp;#34;order&amp;#34;: &amp;#34;desc&amp;#34;
}
}
]
}
# æŽ§åˆ¶èŒƒå›´
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;:{
&amp;#34;range&amp;#34;: {
&amp;#34;age&amp;#34;: {
&amp;#34;gte&amp;#34;: 20,
&amp;#34;lte&amp;#34;: 38,
&amp;#34;include_lower&amp;#34;:true, # trueåŒ…å«,falseä¸åŒ…å«,ä¸‹é™
&amp;#34;include_upper&amp;#34;:true # trueåŒ…å«,falseä¸åŒ…å«,ä¸Šé™
}
}
},
&amp;#34;sort&amp;#34;: [
{
&amp;#34;age&amp;#34;: {
&amp;#34;order&amp;#34;: &amp;#34;asc&amp;#34;
}
}
]
}
&lt;/code>&lt;/pre>&lt;h3 id="wildcardé€šé…ç¬¦æŸ¥è¯¢">wildcardé€šé…ç¬¦æŸ¥è¯¢&lt;/h3>
&lt;p>å…è®¸ä½¿ç”¨é€šé…ç¬¦* å’Œ ?æ¥è¿›è¡ŒæŸ¥è¯¢&lt;/p>
&lt;ul>
&lt;li>ä»£è¡¨0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦&lt;/li>
&lt;/ul>
&lt;p>ï¼Ÿä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;wildcard&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;zhao*&amp;#34;
}
}
}
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;wildcard&amp;#34;: {
&amp;#34;name&amp;#34;: {
&amp;#34;value&amp;#34;: &amp;#34;li?i&amp;#34;
}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="fuzzyæ¨¡ç³ŠæŸ¥è¯¢">fuzzyæ¨¡ç³ŠæŸ¥è¯¢&lt;/h3>
&lt;ul>
&lt;li>valueï¼šæŸ¥è¯¢çš„å…³é”®å­—&lt;/li>
&lt;li>boostï¼šæŸ¥è¯¢çš„æƒå€¼ï¼Œé»˜è®¤å€¼æ˜¯1.0&lt;/li>
&lt;li>min_similarity:è®¾ç½®åŒ¹é…çš„æœ€å°ç›¸ä¼¼åº¦ï¼Œé»˜è®¤å€¼ä¸º0.5ï¼Œå¯¹äºŽå­—ç¬¦ä¸²ï¼Œå–å€¼ä¸º0-1(åŒ…æ‹¬0å’Œ1);å¯¹äºŽæ•°å€¼ï¼Œå–å€¼å¯èƒ½å¤§äºŽ1;å¯¹äºŽæ—¥æœŸåž‹å–å€¼ä¸º1d,1mç­‰ï¼Œ1då°±ä»£è¡¨1å¤©&lt;/li>
&lt;li>prefix_length:æŒ‡æ˜ŽåŒºåˆ†è¯é¡¹çš„å…±åŒå‰ç¼€é•¿åº¦ï¼Œé»˜è®¤æ˜¯0&lt;/li>
&lt;li>max_expansions:æŸ¥è¯¢ä¸­çš„è¯é¡¹å¯ä»¥æ‰©å±•çš„æ•°ç›®ï¼Œé»˜è®¤å¯ä»¥æ— é™å¤§&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;fuzzy&amp;#34;: {
&amp;#34;name&amp;#34;: {
&amp;#34;value&amp;#34;: &amp;#34;zhaoimng&amp;#34; # zhaomingå†™åäº†,ä¹Ÿå¯ä»¥æŸ¥å‡ºæ¥
}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="é«˜äº®æœç´¢">é«˜äº®æœç´¢&lt;/h3>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;fuzzy&amp;#34;: {
&amp;#34;name&amp;#34;: {
&amp;#34;value&amp;#34;: &amp;#34;zhaoimng&amp;#34;
}
}
},
&amp;#34;highlight&amp;#34;: {
&amp;#34;fields&amp;#34;: {
&amp;#34;name&amp;#34;:{}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="filteræŸ¥è¯¢">FilteræŸ¥è¯¢&lt;/h3>
&lt;p>æ˜¯ä¸è®¡ç®—ç›¸å…³æ€§çš„,åŒæ—¶å¯ä»¥ç¼“å­˜,å› æ­¤,filteré€Ÿåº¦è¦å¿«äºŽquery&lt;/p>
&lt;pre tabindex="0">&lt;code># è¿‡æ»¤ä»·æ ¼æ˜¯40çš„
GET /lib4/items/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;bool&amp;#34;: {
&amp;#34;filter&amp;#34;: {
&amp;#34;term&amp;#34;:{&amp;#34;price&amp;#34;: &amp;#34;40&amp;#34;}
}
}
}
}
# è¿‡æ»¤ä»·æ ¼æ˜¯25çš„å’Œ40çš„
GET /lib4/items/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;bool&amp;#34;: {
&amp;#34;filter&amp;#34;: {
&amp;#34;terms&amp;#34;:{&amp;#34;price&amp;#34;: [25,40]}
}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="boolè¿‡æ»¤æŸ¥è¯¢">boolè¿‡æ»¤æŸ¥è¯¢&lt;/h3>
&lt;p>å¯ä»¥å®žçŽ°ç»„åˆè¿‡æ»¤æŸ¥è¯¢&lt;/p>
&lt;p>æ ¼å¼ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>{
&amp;#34;bool&amp;#34;: {
&amp;#34;must&amp;#34;: [],
&amp;#34;should&amp;#34;: [],
&amp;#34;must_not&amp;#34;: []
}
}
&lt;/code>&lt;/pre>&lt;p>must:å¿…é¡»æ»¡è¶³çš„æ¡ä»¶&amp;mdash;and&lt;/p>
&lt;p>shouldï¼šå¯ä»¥æ»¡è¶³ä¹Ÿå¯ä»¥ä¸æ»¡è¶³çš„æ¡ä»¶&amp;ndash;or&lt;/p>
&lt;p>must_not:ä¸éœ€è¦æ»¡è¶³çš„æ¡ä»¶&amp;ndash;not&lt;/p>
&lt;pre tabindex="0">&lt;code># ç¿»è¯‘è¿‡æ¥:è¦æ˜¯æ˜¯ä»·æ ¼æ˜¯250,æˆ–è€…æ˜¯itemIDæ˜¯:id100123,å¹¶ä¸”priceä¸èƒ½æ˜¯30
GET /lib4/items/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;bool&amp;#34;: {
&amp;#34;should&amp;#34;: [
{&amp;#34;term&amp;#34;:{&amp;#34;price&amp;#34;:250}},
{&amp;#34;term&amp;#34;:{&amp;#34;itemID&amp;#34;:&amp;#34;id100123&amp;#34;}}
],
&amp;#34;must_not&amp;#34;: [
{&amp;#34;term&amp;#34;:{&amp;#34;price&amp;#34;:30}}
]
}
}
}
&lt;/code>&lt;/pre>&lt;p>è¿‡æ»¤,è¦æƒ³æ˜Žç™½è·Ÿæ™®é€šæŸ¥è¯¢çš„è¿‡æ»¤æœ‰ä»€ä¹ˆä¸ä¸€æ ·&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /lib4/items/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;bool&amp;#34;: {
&amp;#34;filter&amp;#34;: {
&amp;#34;range&amp;#34;: {
&amp;#34;price&amp;#34;: {
&amp;#34;gte&amp;#34;: 40,
&amp;#34;lte&amp;#34;: 250
}
}
}
}
}
}
&lt;/code>&lt;/pre>&lt;p>èŽ·å–éžç©ºçš„æ–‡æ¡£&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /lib4/items/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;bool&amp;#34;: {
&amp;#34;filter&amp;#34;: {
&amp;#34;exists&amp;#34;: {
&amp;#34;field&amp;#34;: &amp;#34;price&amp;#34;
}
}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="èšåˆæŸ¥è¯¢">èšåˆæŸ¥è¯¢&lt;/h3>
&lt;pre tabindex="0">&lt;code>GET /lib4/items/_search
{
&amp;#34;size&amp;#34;:0, # åªæ˜¾ç¤ºæ€»å’Œ
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{
&amp;#34;sum&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
# æœ€å¤§å€¼
GET /lib4/items/_search
{
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{
&amp;#34;max&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
# æœ€å°å€¼
GET /lib4/items/_search
{
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{ # price_of_sumè¿™ä¸ªåå­—éšä¾¿èµ·çš„
&amp;#34;min&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
# æ±‚å¹³å‡æ•°
GET /lib4/items/_search
{
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{
&amp;#34;avg&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
# ä»·æ ¼æœ‰ä¸ç›¸åŒçš„æ•°
GET /lib4/items/_search
{
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{
&amp;#34;cardinality&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
# åˆ†ç»„
GET /lib4/items/_search
{
&amp;#34;size&amp;#34;: 0,
&amp;#34;aggs&amp;#34;:{
&amp;#34;price_of_sum&amp;#34;:{
&amp;#34;terms&amp;#34;:{
&amp;#34;field&amp;#34;:&amp;#34;price&amp;#34;
}
}
}
}
&lt;/code>&lt;/pre>&lt;h1 id="apié«˜çº§">APIé«˜çº§&lt;/h1>
&lt;h3 id="ç‰ˆæœ¬æŽ§åˆ¶">ç‰ˆæœ¬æŽ§åˆ¶&lt;/h3>
&lt;p>ElasticSearché‡‡ç”¨äº†ä¹è§‚é”æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”¨æˆ·å¯¹documentè¿›è¡Œæ“ä½œæ—¶ï¼Œå¹¶ä¸éœ€è¦å¯¹è¯¥documentä½œåŠ é”å’Œè§£é”çš„æ“ä½œï¼Œåªéœ€è¦æŒ‡å®šè¦æ“ä½œçš„ç‰ˆæœ¬å³å¯ã€‚å½“ç‰ˆæœ¬å·ä¸€è‡´æ—¶ï¼ŒElasticSearchä¼šå…è®¸è¯¥æ“ä½œé¡ºåˆ©æ‰§è¡Œï¼Œè€Œå½“ç‰ˆæœ¬å·å­˜åœ¨å†²çªæ—¶ï¼ŒElasticSearchä¼šæç¤ºå†²çªå¹¶æŠ›å‡ºå¼‚å¸¸ï¼ˆVersionConflictEngineExceptionå¼‚å¸¸ï¼‰ã€‚&lt;/p>
&lt;p>ElasticSearchçš„ç‰ˆæœ¬å·çš„å–å€¼èŒƒå›´ä¸º1åˆ°2^63-1ã€‚&lt;/p>
&lt;p>å†…éƒ¨ç‰ˆæœ¬æŽ§åˆ¶ï¼šä½¿ç”¨çš„æ˜¯_version&lt;/p>
&lt;p>å¤–éƒ¨ç‰ˆæœ¬æŽ§åˆ¶ï¼šelasticsearchåœ¨å¤„ç†å¤–éƒ¨ç‰ˆæœ¬å·æ—¶ä¼šä¸Žå¯¹å†…éƒ¨ç‰ˆæœ¬å·çš„å¤„ç†æœ‰äº›ä¸åŒã€‚å®ƒä¸å†æ˜¯æ£€æŸ¥&lt;em>versionæ˜¯å¦ä¸Žè¯·æ±‚ä¸­æŒ‡å®šçš„æ•°å€¼&lt;/em>ç›¸åŒ*,è€Œæ˜¯æ£€æŸ¥å½“å‰çš„*versionæ˜¯å¦æ¯”æŒ‡å®šçš„æ•°å€¼å°ã€‚å¦‚æžœè¯·æ±‚æˆåŠŸï¼Œé‚£ä¹ˆå¤–éƒ¨çš„ç‰ˆæœ¬å·å°±ä¼šè¢«å­˜å‚¨åˆ°æ–‡æ¡£ä¸­çš„_versionä¸­ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¿æŒ_versionä¸Žå¤–éƒ¨ç‰ˆæœ¬æŽ§åˆ¶çš„æ•°æ®ä¸€è‡´ä½¿ç”¨version_type=external&lt;/p>
&lt;h3 id="æ•°æ®ç±»åž‹">æ•°æ®ç±»åž‹&lt;/h3>
&lt;p>æ ¸å¿ƒæ•°æ®ç±»åž‹ï¼ˆCore datatypesï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>å­—ç¬¦åž‹ï¼šstringï¼Œstringç±»åž‹åŒ…æ‹¬
text å’Œ keyword
textç±»åž‹è¢«ç”¨æ¥ç´¢å¼•é•¿æ–‡æœ¬ï¼Œåœ¨å»ºç«‹ç´¢å¼•å‰ä¼šå°†è¿™äº›æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè½¬åŒ–ä¸ºè¯çš„ç»„åˆï¼Œå»ºç«‹ç´¢å¼•ã€‚å…è®¸esæ¥æ£€ç´¢è¿™äº›è¯è¯­ã€‚textç±»åž‹ä¸èƒ½ç”¨æ¥æŽ’åºå’Œèšåˆã€‚
Keywordç±»åž‹ä¸éœ€è¦è¿›è¡Œåˆ†è¯ï¼Œå¯ä»¥è¢«ç”¨æ¥æ£€ç´¢è¿‡æ»¤ã€æŽ’åºå’Œèšåˆã€‚keyword ç±»åž‹å­—æ®µåªèƒ½ç”¨æœ¬èº«æ¥è¿›è¡Œæ£€ç´¢
æ•°å­—åž‹ï¼šlong, integer, short, byte, double, float
æ—¥æœŸåž‹ï¼šdate
å¸ƒå°”åž‹ï¼šboolean
äºŒè¿›åˆ¶åž‹ï¼šbinary
&lt;/code>&lt;/pre>&lt;p>å¤æ‚æ•°æ®ç±»åž‹ï¼ˆComplex datatypesï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>æ•°ç»„ç±»åž‹ï¼ˆArray datatypeï¼‰ï¼šæ•°ç»„ç±»åž‹ä¸éœ€è¦ä¸“é—¨æŒ‡å®šæ•°ç»„å…ƒç´ çš„typeï¼Œä¾‹å¦‚ï¼š
å­—ç¬¦åž‹æ•°ç»„: [ &amp;#34;one&amp;#34;, &amp;#34;two&amp;#34; ]
æ•´åž‹æ•°ç»„ï¼š[ 1, 2 ]
æ•°ç»„åž‹æ•°ç»„ï¼š[ 1, [ 2, 3 ]] ç­‰ä»·äºŽ[ 1, 2, 3 ]
å¯¹è±¡æ•°ç»„ï¼š[ { &amp;#34;name&amp;#34;: &amp;#34;Mary&amp;#34;, &amp;#34;age&amp;#34;: 12 }, { &amp;#34;name&amp;#34;: &amp;#34;John&amp;#34;, &amp;#34;age&amp;#34;: 10 }]
å¯¹è±¡ç±»åž‹ï¼ˆObject datatypeï¼‰ï¼š_ object _ ç”¨äºŽå•ä¸ªJSONå¯¹è±¡ï¼›
åµŒå¥—ç±»åž‹ï¼ˆNested datatypeï¼‰ï¼š_ nested _ ç”¨äºŽJSONæ•°ç»„ï¼›
&lt;/code>&lt;/pre>&lt;p>åœ°ç†ä½ç½®ç±»åž‹ï¼ˆGeo datatypesï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>åœ°ç†åæ ‡ç±»åž‹ï¼ˆGeo-point datatypeï¼‰ï¼š_ geo_point _ ç”¨äºŽç»çº¬åº¦åæ ‡ï¼›
åœ°ç†å½¢çŠ¶ç±»åž‹ï¼ˆGeo-Shape datatypeï¼‰ï¼š_ geo_shape _ ç”¨äºŽç±»ä¼¼äºŽå¤šè¾¹å½¢çš„å¤æ‚å½¢çŠ¶ï¼›
&lt;/code>&lt;/pre>&lt;p>ç‰¹å®šç±»åž‹ï¼ˆSpecialised datatypesï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>IPv4 ç±»åž‹ï¼ˆIPv4 datatypeï¼‰ï¼š_ ip _ ç”¨äºŽIPv4 åœ°å€ï¼›
Completion ç±»åž‹ï¼ˆCompletion datatypeï¼‰ï¼š_ completion _æä¾›è‡ªåŠ¨è¡¥å…¨å»ºè®®ï¼›
Token count ç±»åž‹ï¼ˆToken count datatypeï¼‰ï¼š_ token_count _ ç”¨äºŽç»Ÿè®¡åšäº†æ ‡è®°çš„å­—æ®µçš„indexæ•°ç›®ï¼Œè¯¥å€¼ä¼šä¸€ç›´å¢žåŠ ï¼Œä¸ä¼šå› ä¸ºè¿‡æ»¤æ¡ä»¶è€Œå‡å°‘ã€‚
mapper-murmur3
ç±»åž‹ï¼šé€šè¿‡æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ _ murmur3 _ æ¥è®¡ç®— index çš„ hash å€¼ï¼›
é™„åŠ ç±»åž‹ï¼ˆAttachment datatypeï¼‰ï¼šé‡‡ç”¨ mapper-attachments
æ’ä»¶ï¼Œå¯æ”¯æŒ_ attachments _ ç´¢å¼•ï¼Œä¾‹å¦‚ Microsoft Office æ ¼å¼ï¼ŒOpen Document æ ¼å¼ï¼ŒePub, HTML ç­‰ã€‚
&lt;/code>&lt;/pre>&lt;p>æ”¯æŒçš„å±žæ€§ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#34;store&amp;#34;:false//æ˜¯å¦å•ç‹¬è®¾ç½®æ­¤å­—æ®µçš„æ˜¯å¦å­˜å‚¨è€Œä»Ž_sourceå­—æ®µä¸­åˆ†ç¦»ï¼Œé»˜è®¤æ˜¯falseï¼Œåªèƒ½æœç´¢ï¼Œä¸èƒ½èŽ·å–å€¼
&amp;#34;index&amp;#34;: true//åˆ†è¯ï¼Œä¸åˆ†è¯æ˜¯ï¼šfalseï¼Œè®¾ç½®æˆfalseï¼Œå­—æ®µå°†ä¸ä¼šè¢«ç´¢å¼•
&amp;#34;analyzer&amp;#34;:&amp;#34;ik&amp;#34;//æŒ‡å®šåˆ†è¯å™¨,é»˜è®¤åˆ†è¯å™¨ä¸ºstandard analyzer
&amp;#34;boost&amp;#34;:1.23//å­—æ®µçº§åˆ«çš„åˆ†æ•°åŠ æƒï¼Œé»˜è®¤å€¼æ˜¯1.0
&amp;#34;doc_values&amp;#34;:false//å¯¹not_analyzedå­—æ®µï¼Œé»˜è®¤éƒ½æ˜¯å¼€å¯ï¼Œåˆ†è¯å­—æ®µä¸èƒ½ä½¿ç”¨ï¼Œå¯¹æŽ’åºå’Œèšåˆèƒ½æå‡è¾ƒå¤§æ€§èƒ½ï¼ŒèŠ‚çº¦å†…å­˜
&amp;#34;fielddata&amp;#34;:{&amp;#34;format&amp;#34;:&amp;#34;disabled&amp;#34;}//é’ˆå¯¹åˆ†è¯å­—æ®µï¼Œå‚ä¸ŽæŽ’åºæˆ–èšåˆæ—¶èƒ½æé«˜æ€§èƒ½ï¼Œä¸åˆ†è¯å­—æ®µç»Ÿä¸€å»ºè®®ä½¿ç”¨doc_value
&amp;#34;fields&amp;#34;:{&amp;#34;raw&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;string&amp;#34;,&amp;#34;index&amp;#34;:&amp;#34;not_analyzed&amp;#34;}} //å¯ä»¥å¯¹ä¸€ä¸ªå­—æ®µæä¾›å¤šç§ç´¢å¼•æ¨¡å¼ï¼ŒåŒä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œä¸€ä¸ªåˆ†è¯ï¼Œä¸€ä¸ªä¸åˆ†è¯
&amp;#34;ignore_above&amp;#34;:100 //è¶…è¿‡100ä¸ªå­—ç¬¦çš„æ–‡æœ¬ï¼Œå°†ä¼šè¢«å¿½ç•¥ï¼Œä¸è¢«ç´¢å¼•
&amp;#34;include_in_all&amp;#34;:ture//è®¾ç½®æ˜¯å¦æ­¤å­—æ®µåŒ…å«åœ¨_allå­—æ®µä¸­ï¼Œé»˜è®¤æ˜¯trueï¼Œé™¤éžindexè®¾ç½®æˆnoé€‰é¡¹
&amp;#34;index_options&amp;#34;:&amp;#34;docs&amp;#34;//4ä¸ªå¯é€‰å‚æ•°docsï¼ˆç´¢å¼•æ–‡æ¡£å·ï¼‰ ,freqsï¼ˆæ–‡æ¡£å·+è¯é¢‘ï¼‰ï¼Œpositionsï¼ˆæ–‡æ¡£å·+è¯é¢‘+ä½ç½®ï¼Œé€šå¸¸ç”¨æ¥è·ç¦»æŸ¥è¯¢ï¼‰ï¼Œoffsetsï¼ˆæ–‡æ¡£å·+è¯é¢‘+ä½ç½®+åç§»é‡ï¼Œé€šå¸¸è¢«ä½¿ç”¨åœ¨é«˜äº®å­—æ®µï¼‰åˆ†è¯å­—æ®µé»˜è®¤æ˜¯positionï¼Œå…¶ä»–çš„é»˜è®¤æ˜¯docs
&amp;#34;norms&amp;#34;:{&amp;#34;enable&amp;#34;:true,&amp;#34;loading&amp;#34;:&amp;#34;lazy&amp;#34;}//åˆ†è¯å­—æ®µé»˜è®¤é…ç½®ï¼Œä¸åˆ†è¯å­—æ®µï¼šé»˜è®¤{&amp;#34;enable&amp;#34;:false}ï¼Œå­˜å‚¨é•¿åº¦å› å­å’Œç´¢å¼•æ—¶boostï¼Œå»ºè®®å¯¹éœ€è¦å‚ä¸Žè¯„åˆ†å­—æ®µä½¿ç”¨ ï¼Œä¼šé¢å¤–å¢žåŠ å†…å­˜æ¶ˆè€—é‡
&amp;#34;null_value&amp;#34;:&amp;#34;NULL&amp;#34;//è®¾ç½®ä¸€äº›ç¼ºå¤±å­—æ®µçš„åˆå§‹åŒ–å€¼ï¼Œåªæœ‰stringå¯ä»¥ä½¿ç”¨ï¼Œåˆ†è¯å­—æ®µçš„nullå€¼ä¹Ÿä¼šè¢«åˆ†è¯
&amp;#34;position_increament_gap&amp;#34;:0//å½±å“è·ç¦»æŸ¥è¯¢æˆ–è¿‘ä¼¼æŸ¥è¯¢ï¼Œå¯ä»¥è®¾ç½®åœ¨å¤šå€¼å­—æ®µçš„æ•°æ®ä¸Šç«åˆ†è¯å­—æ®µä¸Šï¼ŒæŸ¥è¯¢æ—¶å¯æŒ‡å®šslopé—´éš”ï¼Œé»˜è®¤å€¼æ˜¯100
&amp;#34;search_analyzer&amp;#34;:&amp;#34;ik&amp;#34;//è®¾ç½®æœç´¢æ—¶çš„åˆ†è¯å™¨ï¼Œé»˜è®¤è·Ÿananlyzeræ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚indexæ—¶ç”¨standard+ngramï¼Œæœç´¢æ—¶ç”¨standardç”¨æ¥å®Œæˆè‡ªåŠ¨æç¤ºåŠŸèƒ½
&amp;#34;similarity&amp;#34;:&amp;#34;BM25&amp;#34;//é»˜è®¤æ˜¯TF/IDFç®—æ³•ï¼ŒæŒ‡å®šä¸€ä¸ªå­—æ®µè¯„åˆ†ç­–ç•¥ï¼Œä»…ä»…å¯¹å­—ç¬¦ä¸²åž‹å’Œåˆ†è¯ç±»åž‹æœ‰æ•ˆ
&amp;#34;term_vector&amp;#34;:&amp;#34;no&amp;#34;//é»˜è®¤ä¸å­˜å‚¨å‘é‡ä¿¡æ¯ï¼Œæ”¯æŒå‚æ•°yesï¼ˆtermå­˜å‚¨ï¼‰ï¼Œwith_positionsï¼ˆterm+ä½ç½®ï¼‰,with_offsetsï¼ˆterm+åç§»é‡ï¼‰ï¼Œwith_positions_offsets(term+ä½ç½®+åç§»é‡) å¯¹å¿«é€Ÿé«˜äº®fast vector highlighterèƒ½æå‡æ€§èƒ½ï¼Œä½†å¼€å¯åˆä¼šåŠ å¤§ç´¢å¼•ä½“ç§¯ï¼Œä¸é€‚åˆå¤§æ•°æ®é‡ç”¨
&lt;/code>&lt;/pre>&lt;h1 id="elasticsearchåŽŸç†">ElasticSearchåŽŸç†&lt;/h1>
&lt;h3 id="è§£æžesçš„åˆ†å¸ƒå¼æž¶æž„">è§£æžesçš„åˆ†å¸ƒå¼æž¶æž„&lt;/h3>
&lt;p>åˆ†ç‰‡çš„å‰¯æœ¬ï¼š&lt;/p>
&lt;p>é›†ç¾¤å‘çŽ°æœºåˆ¶(cluster discovery)ï¼šæ¯”å¦‚å½“å‰æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªesè¿›ç¨‹ï¼Œå½“å¯åŠ¨äº†ç¬¬äºŒä¸ªesè¿›ç¨‹æ—¶ï¼Œè¿™ä¸ªè¿›ç¨‹ä½œä¸ºä¸€ä¸ªnodeè‡ªåŠ¨å°±å‘çŽ°äº†é›†ç¾¤ï¼Œå¹¶ä¸”åŠ å…¥äº†è¿›åŽ»&lt;/p>
&lt;p>shardè´Ÿè½½å‡è¡¡ï¼šæ¯”å¦‚çŽ°åœ¨æœ‰10shardï¼Œé›†ç¾¤ä¸­æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œesä¼šè¿›è¡Œå‡è¡¡çš„è¿›è¡Œåˆ†é…ï¼Œä»¥ä¿æŒæ¯ä¸ªèŠ‚ç‚¹å‡è¡¡çš„è´Ÿè½½è¯·æ±‚&lt;/p>
&lt;p>è¯·æ±‚è·¯ç”±&lt;/p>
&lt;h3 id="æ‰©å®¹æœºåˆ¶">æ‰©å®¹æœºåˆ¶&lt;/h3>
&lt;p>åž‚ç›´æ‰©å®¹ï¼šè´­ç½®æ–°çš„æœºå™¨ï¼Œæ›¿æ¢å·²æœ‰çš„æœºå™¨&lt;/p>
&lt;p>ä¾‹å­:ä¸€å°æœ‰6å°æœºå™¨,æ¯å°1T,ä¸€å…±6T,çŽ°åœ¨æ›¿æ¢æŽ‰å…¶ä¸­çš„ä¸¤å°,1Tå‡çº§åˆ°2T,è¿™æ ·ä¸€å…±å°±æœ‰8T&lt;/p>
&lt;p>æ°´å¹³æ‰©å®¹ï¼šç›´æŽ¥å¢žåŠ æœºå™¨&lt;/p>
&lt;h3 id="rebalance">rebalance&lt;/h3>
&lt;p>å¢žåŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ä¼šè‡ªåŠ¨å‡è¡¡&lt;/p>
&lt;h3 id="masterèŠ‚ç‚¹">masterèŠ‚ç‚¹&lt;/h3>
&lt;p>ä¸»èŠ‚ç‚¹çš„ä¸»è¦èŒè´£æ˜¯å’Œé›†ç¾¤æ“ä½œç›¸å…³çš„å†…å®¹ï¼Œå¦‚åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œè·Ÿè¸ªå“ªäº›èŠ‚ç‚¹æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶å†³å®šå“ªäº›åˆ†ç‰‡åˆ†é…ç»™ç›¸å…³çš„èŠ‚ç‚¹ã€‚ç¨³å®šçš„ä¸»èŠ‚ç‚¹å¯¹é›†ç¾¤çš„å¥åº·æ˜¯éžå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªé›†ç¾¤,è‡³å°‘æœ‰ä¸€ä¸ªmaster.å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½è¯·æ±‚master&lt;/p>
&lt;h3 id="èŠ‚ç‚¹å¯¹ç­‰">èŠ‚ç‚¹å¯¹ç­‰&lt;/h3>
&lt;p>æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½æŽ¥æ”¶è¯·æ±‚æ¯ä¸ªèŠ‚ç‚¹æŽ¥æ”¶åˆ°è¯·æ±‚åŽéƒ½èƒ½æŠŠè¯¥è¯·æ±‚è·¯ç”±åˆ°æœ‰ç›¸å…³æ•°æ®çš„å…¶å®ƒèŠ‚ç‚¹ä¸ŠæŽ¥æ”¶åŽŸå§‹è¯·æ±‚çš„èŠ‚ç‚¹è´Ÿè´£é‡‡é›†æ•°æ®å¹¶è¿”å›žç»™å®¢æˆ·ç«¯&lt;/p>
&lt;h3 id="åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶">åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶&lt;/h3>
&lt;ol>
&lt;li>indexåŒ…å«å¤šä¸ªshard&lt;/li>
&lt;li>æ¯ä¸ªshardéƒ½æ˜¯ä¸€ä¸ªæœ€å°å·¥ä½œå•å…ƒï¼Œæ‰¿è½½éƒ¨åˆ†æ•°æ®ï¼›æ¯ä¸ªshardéƒ½æ˜¯ä¸€ä¸ªluceneå®žä¾‹ï¼Œæœ‰å®Œæ•´çš„å»ºç«‹ç´¢å¼•å’Œå¤„ç†è¯·æ±‚çš„èƒ½åŠ›&lt;/li>
&lt;li>å¢žå‡èŠ‚ç‚¹æ—¶ï¼Œshardä¼šè‡ªåŠ¨åœ¨nodesä¸­è´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>primary shardå’Œreplica shardï¼Œæ¯ä¸ªdocumentè‚¯å®šåªå­˜åœ¨äºŽæŸä¸€ä¸ªprimary shardä»¥åŠå…¶å¯¹åº”çš„replica shardä¸­ï¼Œä¸å¯èƒ½å­˜åœ¨äºŽå¤šä¸ªprimary shard&lt;/li>
&lt;li>replica shardæ˜¯primary shardçš„å‰¯æœ¬ï¼Œè´Ÿè´£å®¹é”™ï¼Œä»¥åŠæ‰¿æ‹…è¯»è¯·æ±‚è´Ÿè½½&lt;/li>
&lt;li>primary shardçš„æ•°é‡åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±å›ºå®šäº†ï¼Œreplica shardçš„æ•°é‡å¯ä»¥éšæ—¶ä¿®æ”¹&lt;/li>
&lt;li>primary shardçš„é»˜è®¤æ•°é‡æ˜¯5ï¼Œreplicaé»˜è®¤æ˜¯1ï¼Œé»˜è®¤æœ‰10ä¸ªshardï¼Œ5ä¸ªprimary shardï¼Œ5ä¸ªreplica shard&lt;/li>
&lt;li>primary shardä¸èƒ½å’Œè‡ªå·±çš„replica shardæ”¾åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆå¦åˆ™èŠ‚ç‚¹å®•æœºï¼Œprimary shardå’Œå‰¯æœ¬éƒ½ä¸¢å¤±ï¼Œèµ·ä¸åˆ°å®¹é”™çš„ä½œç”¨ï¼‰ï¼Œä½†æ˜¯å¯ä»¥å’Œå…¶ä»–primary shardçš„replica shardæ”¾åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Š&lt;/li>
&lt;/ol>
&lt;h3 id="å•èŠ‚ç‚¹çŽ¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æž">å•èŠ‚ç‚¹çŽ¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æž&lt;/h3>
&lt;pre tabindex="0">&lt;code>PUT /myindex
{
&amp;#34;settings&amp;#34; : {
&amp;#34;number_of_shards&amp;#34; : 3, # 3ä¸ªæœ±åˆ†ç‰‡
&amp;#34;number_of_replicas&amp;#34; : 1 # 1ä¸ªè´Ÿåˆ†ç‰‡
}
}
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªæ—¶å€™ï¼Œåªä¼šå°†3ä¸ªprimary shardåˆ†é…åˆ°ä»…æœ‰çš„ä¸€ä¸ªnodeä¸ŠåŽ»ï¼Œå¦å¤–3ä¸ªreplica shardæ˜¯æ— æ³•åˆ†é…çš„ï¼ˆä¸€ä¸ªshardçš„å‰¯æœ¬replicaï¼Œä»–ä»¬ä¸¤ä¸ªæ˜¯ä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„ï¼‰ã€‚é›†ç¾¤å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä¸€æ—¦å‡ºçŽ°èŠ‚ç‚¹å®•æœºï¼Œæ•°æ®å…¨éƒ¨ä¸¢å¤±ï¼Œè€Œä¸”é›†ç¾¤ä¸å¯ç”¨ï¼Œæ— æ³•æŽ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚&lt;/p>
&lt;h3 id="ä¸¤ä¸ªèŠ‚ç‚¹çŽ¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æž">ä¸¤ä¸ªèŠ‚ç‚¹çŽ¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æž&lt;/h3>
&lt;p>å°†3ä¸ªprimary shardåˆ†é…åˆ°ä¸€ä¸ªnodeä¸ŠåŽ»ï¼Œå¦å¤–3ä¸ªreplica shardåˆ†é…åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Š&lt;/p>
&lt;p>primary shard å’Œreplica shard ä¿æŒåŒæ­¥&lt;/p>
&lt;p>primary shard å’Œreplica shard éƒ½å¯ä»¥å¤„ç†å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚&lt;/p>
&lt;h3 id="æ°´å¹³æ‰©å®¹çš„è¿‡ç¨‹">æ°´å¹³æ‰©å®¹çš„è¿‡ç¨‹&lt;/h3>
&lt;ol>
&lt;li>æ‰©å®¹åŽprimary shardå’Œreplica shardä¼šè‡ªåŠ¨çš„è´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>æ‰©å®¹åŽæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„shardä¼šå‡å°‘ï¼Œé‚£ä¹ˆåˆ†é…ç»™æ¯ä¸ªshardçš„CPUï¼Œå†…å­˜ï¼ŒIOèµ„æºä¼šæ›´å¤šï¼Œæ€§èƒ½æé«˜&lt;/li>
&lt;li>æ‰©å®¹çš„æžé™ï¼Œå¦‚æžœæœ‰6ä¸ªshardï¼Œæ‰©å®¹çš„æžé™å°±æ˜¯6ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸€ä¸ªshardï¼Œå¦‚æžœæƒ³è¶…å‡ºæ‰©å®¹çš„æžé™ï¼Œæ¯”å¦‚è¯´æ‰©å®¹åˆ°9ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥å¢žåŠ replica shardçš„ä¸ªæ•°&lt;/li>
&lt;li>6ä¸ªshardï¼Œ3ä¸ªèŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½æ‰¿å—å‡ ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„æœåŠ¡å™¨å®•æœºï¼Ÿ(å®¹é”™æ€§)ä»»ä½•ä¸€å°æœåŠ¡å™¨å®•æœºéƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®&lt;/li>
&lt;/ol>
&lt;p>ä¸ºäº†æé«˜å®¹é”™æ€§ï¼Œå¢žåŠ shardçš„ä¸ªæ•°ï¼š9ä¸ªshardï¼Œ(3ä¸ªprimary shardï¼Œ6ä¸ªreplicashard)ï¼Œè¿™æ ·å°±èƒ½å®¹å¿æœ€å¤šä¸¤å°æœåŠ¡å™¨å®•æœºäº†&lt;/p>
&lt;p>æ€»ç»“ï¼šæ‰©å®¹æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„åžåé‡ï¼ŒåŒæ—¶ä¹Ÿè¦è€ƒè™‘å®¹é”™æ€§ï¼Œä¹Ÿå°±æ˜¯è®©å°½å¯èƒ½å¤šçš„æœåŠ¡å™¨å®•æœºè¿˜èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±&lt;/p>
&lt;h3 id="elasticsearchçš„å®¹é”™æœºåˆ¶">ElasticSearchçš„å®¹é”™æœºåˆ¶&lt;/h3>
&lt;p>ä»¥9ä¸ªshardï¼Œ3ä¸ªèŠ‚ç‚¹ä¸ºä¾‹ï¼š&lt;/p>
&lt;p>1.å¦‚æžœmaster node å®•æœºï¼Œæ­¤æ—¶ä¸æ˜¯æ‰€æœ‰çš„primary shardéƒ½æ˜¯Active statusï¼Œæ‰€ä»¥æ­¤æ—¶çš„é›†ç¾¤çŠ¶æ€æ˜¯redã€‚&lt;/p>
&lt;p>å®¹é”™å¤„ç†çš„ç¬¬ä¸€æ­¥:æ˜¯é€‰ä¸¾ä¸€å°æœåŠ¡å™¨ä½œä¸ºmasterå®¹é”™å¤„ç†çš„ç¬¬äºŒæ­¥:æ–°é€‰ä¸¾å‡ºçš„masterä¼šæŠŠæŒ‚æŽ‰çš„primary shardçš„æŸä¸ªreplica shard æå‡ä¸ºprimary shard,æ­¤æ—¶é›†ç¾¤çš„çŠ¶æ€ä¸ºyellowï¼Œå› ä¸ºå°‘äº†ä¸€ä¸ªreplica shardï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„replica shardéƒ½æ˜¯active status&lt;/p>
&lt;p>å®¹é”™å¤„ç†çš„ç¬¬ä¸‰æ­¥ï¼šé‡å¯æ•…éšœæœºï¼Œæ–°masterä¼šæŠŠæ‰€æœ‰çš„å‰¯æœ¬éƒ½å¤åˆ¶ä¸€ä»½åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œï¼ˆåŒæ­¥ä¸€ä¸‹å®•æœºåŽå‘ç”Ÿçš„ä¿®æ”¹ï¼‰ï¼Œæ­¤æ—¶é›†ç¾¤çš„çŠ¶æ€ä¸ºgreenï¼Œå› ä¸ºæ‰€æœ‰çš„primary shardå’Œreplica shardéƒ½æ˜¯Active status&lt;/p>
&lt;h3 id="æ–‡æ¡£çš„æ ¸å¿ƒå…ƒæ•°æ®">æ–‡æ¡£çš„æ ¸å¿ƒå…ƒæ•°æ®&lt;/h3>
&lt;ol>
&lt;li>&lt;code>_index&lt;/code>:&lt;/li>
&lt;/ol>
&lt;p>è¯´æ˜Žäº†ä¸€ä¸ªæ–‡æ¡£å­˜å‚¨åœ¨å“ªä¸ªç´¢å¼•ä¸­&lt;/p>
&lt;p>åŒä¸€ä¸ªç´¢å¼•ä¸‹å­˜æ”¾çš„æ˜¯ç›¸ä¼¼çš„æ–‡æ¡£(æ–‡æ¡£çš„fieldå¤šæ•°æ˜¯ç›¸åŒçš„)&lt;/p>
&lt;p>ç´¢å¼•åå¿…é¡»æ˜¯å°å†™çš„ï¼Œä¸èƒ½ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸èƒ½åŒ…æ‹¬é€—å·&lt;/p>
&lt;ol>
&lt;li>&lt;code>_type&lt;/code>:&lt;/li>
&lt;/ol>
&lt;p>è¡¨ç¤ºæ–‡æ¡£å±žäºŽç´¢å¼•ä¸­çš„å“ªä¸ªç±»åž‹&lt;/p>
&lt;p>ä¸€ä¸ªç´¢å¼•ä¸‹åªèƒ½æœ‰ä¸€ä¸ªtype&lt;/p>
&lt;p>ç±»åž‹åå¯ä»¥æ˜¯å¤§å†™ä¹Ÿå¯ä»¥æ˜¯å°å†™çš„ï¼Œä¸èƒ½ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸èƒ½åŒ…æ‹¬é€—å·&lt;/p>
&lt;ol>
&lt;li>&lt;code>_id&lt;/code>:&lt;/li>
&lt;/ol>
&lt;p>æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ï¼Œå’Œç´¢å¼•ï¼Œç±»åž‹ç»„åˆåœ¨ä¸€èµ·å”¯ä¸€æ ‡è¯†äº†ä¸€ä¸ªæ–‡æ¡£&lt;/p>
&lt;p>å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå€¼ï¼Œä¹Ÿå¯ä»¥ç”±esæ¥ç”Ÿæˆè¿™ä¸ªå€¼&lt;/p>
&lt;h3 id="æ–‡æ¡£idç”Ÿæˆæ–¹å¼">æ–‡æ¡£idç”Ÿæˆæ–¹å¼&lt;/h3>
&lt;p>1.æ‰‹åŠ¨æŒ‡å®š&lt;/p>
&lt;pre tabindex="0">&lt;code>put /index/type/66
&lt;/code>&lt;/pre>&lt;p>é€šå¸¸æ˜¯æŠŠå…¶å®ƒç³»ç»Ÿçš„å·²æœ‰æ•°æ®å¯¼å…¥åˆ°esæ—¶&lt;/p>
&lt;p>2.ç”±esç”Ÿæˆidå€¼&lt;/p>
&lt;pre tabindex="0">&lt;code>post /index/type
&lt;/code>&lt;/pre>&lt;p>esç”Ÿæˆçš„idé•¿åº¦ä¸º20ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨çš„æ˜¯base64ç¼–ç ï¼ŒURLå®‰å…¨ï¼Œä½¿ç”¨çš„æ˜¯GUIDç®—æ³•ï¼Œåˆ†å¸ƒå¼ä¸‹å¹¶å‘ç”Ÿæˆidå€¼æ—¶ä¸ä¼šå†²çª&lt;/p>
&lt;h3 id="_sourceå…ƒæ•°æ®åˆ†æž">_sourceå…ƒæ•°æ®åˆ†æž&lt;/h3>
&lt;p>å…¶å®žå°±æ˜¯æˆ‘ä»¬åœ¨æ·»åŠ æ–‡æ¡£æ—¶request bodyä¸­çš„å†…å®¹&lt;/p>
&lt;p>æŒ‡å®šè¿”å›žçš„ç»“æžœä¸­å«æœ‰å“ªäº›å­—æ®µï¼š&lt;/p>
&lt;p>get /index/type/1?_source=name&lt;/p>
&lt;h3 id="æ”¹å˜æ–‡æ¡£å†…å®¹åŽŸç†è§£æž">æ”¹å˜æ–‡æ¡£å†…å®¹åŽŸç†è§£æž&lt;/h3>
&lt;p>æ›¿æ¢æ–¹å¼(å…¨éƒ¨æ›¿æ¢)ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>PUT /lib/user/4
{
&amp;#34;first_name&amp;#34; : &amp;#34;Jane&amp;#34;,
&amp;#34;last_name&amp;#34; : &amp;#34;Lucy&amp;#34;,
&amp;#34;age&amp;#34; : 24,
&amp;#34;about&amp;#34; : &amp;#34;I like to collect rock albums&amp;#34;,
&amp;#34;interests&amp;#34;: [ &amp;#34;music&amp;#34; ]
}
&lt;/code>&lt;/pre>&lt;p>ä¿®æ”¹æ–¹å¼(éƒ¨åˆ†ä¿®æ”¹)ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /lib/user/2/_update
{
&amp;#34;doc&amp;#34;:{
&amp;#34;age&amp;#34;:26
}
}
&lt;/code>&lt;/pre>&lt;p>åˆ é™¤æ–‡æ¡£:&lt;/p>
&lt;pre tabindex="0">&lt;code>delete /lib
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Š3ä¸ªæ“ä½œæ–‡æ¡£çš„æ–¹å¼,éƒ½æ˜¯æŠŠå·²æœ‰çš„documentæ ‡è®°ä¸ºdeletedï¼Œéšç€æ•°æ®é‡çš„å¢žåŠ ï¼Œesä¼šé€‰æ‹©åˆé€‚çš„æ—¶é—´åˆ é™¤æŽ‰&lt;/p>
&lt;h3 id="åŸºäºŽgroovyè„šæœ¬æ‰§è¡Œpartial-update">åŸºäºŽgroovyè„šæœ¬æ‰§è¡Œpartial update&lt;/h3>
&lt;p>esæœ‰å†…ç½®çš„è„šæœ¬æ”¯æŒï¼Œå¯ä»¥åŸºäºŽgroovyè„šæœ¬å®žçŽ°å¤æ‚çš„æ“ä½œ&lt;/p>
&lt;pre tabindex="0">&lt;code>1.ä¿®æ”¹å¹´é¾„
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: &amp;#34;ctx._source.age+=1&amp;#34;
}
2.ä¿®æ”¹åå­—
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: &amp;#34;ctx._source.last_name+=&amp;#39;hehe&amp;#39;&amp;#34;
}
3.æ·»åŠ çˆ±å¥½
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: {
&amp;#34;source&amp;#34;: &amp;#34;ctx._source.interests.add(params.tag)&amp;#34;,
&amp;#34;params&amp;#34;: {
&amp;#34;tag&amp;#34;:&amp;#34;picture&amp;#34;
}
}
}
4.åˆ é™¤çˆ±å¥½
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: {
&amp;#34;source&amp;#34;: &amp;#34;ctx._source.interests.remove(ctx._source.interests.indexOf(params.tag))&amp;#34;,
&amp;#34;params&amp;#34;: {
&amp;#34;tag&amp;#34;:&amp;#34;picture&amp;#34;
}
}
}
5.åˆ é™¤æ–‡æ¡£
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: {
&amp;#34;source&amp;#34;: &amp;#34;ctx.op=ctx._source.age==params.count?&amp;#39;delete&amp;#39;:&amp;#39;none&amp;#39;&amp;#34;,
&amp;#34;params&amp;#34;: {
&amp;#34;count&amp;#34;:29
}
}
}
6.upsert
POST /lib/user/4/_update
{
&amp;#34;script&amp;#34;: &amp;#34;ctx._source.age += 1&amp;#34;,
&amp;#34;upsert&amp;#34;: {
&amp;#34;first_name&amp;#34; : &amp;#34;Jane&amp;#34;,
&amp;#34;last_name&amp;#34; : &amp;#34;Lucy&amp;#34;,
&amp;#34;age&amp;#34; : 20,
&amp;#34;about&amp;#34; : &amp;#34;I like to collect rock albums&amp;#34;,
&amp;#34;interests&amp;#34;: [ &amp;#34;music&amp;#34; ]
}
}
&lt;/code>&lt;/pre>&lt;h3 id="partial-update-å¤„ç†å¹¶å‘å†²çª">partial update å¤„ç†å¹¶å‘å†²çª&lt;/h3>
&lt;p>ä½¿ç”¨çš„æ˜¯ä¹è§‚é”:_version&lt;/p>
&lt;p>retry_on_conflict:&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /lib/user/4/_update?retry_on_conflict=3
&lt;/code>&lt;/pre>&lt;p>é‡æ–°èŽ·å–æ–‡æ¡£æ•°æ®å’Œç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ›´æ–°ï¼Œä¸æ–­çš„æ“ä½œï¼Œæœ€å¤šæ“ä½œçš„æ¬¡æ•°å°±æ˜¯retry_on_conflictçš„å€¼&lt;/p>
&lt;h3 id="æ–‡æ¡£æ•°æ®è·¯ç”±åŽŸç†è§£æž">æ–‡æ¡£æ•°æ®è·¯ç”±åŽŸç†è§£æž&lt;/h3>
&lt;p>1.æ–‡æ¡£è·¯ç”±åˆ°åˆ†ç‰‡ä¸Šï¼š&lt;/p>
&lt;p>ä¸€ä¸ªç´¢å¼•ç”±å¤šä¸ªåˆ†ç‰‡æž„æˆï¼Œå½“æ·»åŠ (åˆ é™¤ï¼Œä¿®æ”¹)ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œeså°±éœ€è¦å†³å®šè¿™ä¸ªæ–‡æ¡£å­˜å‚¨åœ¨å“ªä¸ªåˆ†ç‰‡ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæ•°æ®è·¯ç”±(routing)&lt;/p>
&lt;p>2.è·¯ç”±ç®—æ³•ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code> shard=hash(routing) % number_of_pirmary_shards
&lt;/code>&lt;/pre>&lt;p>ç¤ºä¾‹ï¼šä¸€ä¸ªç´¢å¼•ï¼Œ3ä¸ªprimary shard&lt;/p>
&lt;p>(1)æ¯æ¬¡å¢žåˆ æ”¹æŸ¥æ—¶ï¼Œéƒ½æœ‰ä¸€ä¸ªroutingå€¼ï¼Œé»˜è®¤æ˜¯æ–‡æ¡£çš„_idçš„å€¼&lt;/p>
&lt;p>(2)å¯¹è¿™ä¸ªroutingå€¼ä½¿ç”¨å“ˆå¸Œå‡½æ•°è¿›è¡Œè®¡ç®—&lt;/p>
&lt;p>(3)è®¡ç®—å‡ºçš„å€¼å†å’Œä¸»åˆ†ç‰‡ä¸ªæ•°å–ä½™æ•°&lt;/p>
&lt;p>ä½™æ•°è‚¯å®šåœ¨0&amp;mdash;ï¼ˆnumber_of_pirmary_shards-1ï¼‰ä¹‹é—´ï¼Œæ–‡æ¡£å°±åœ¨å¯¹åº”çš„shardä¸Š&lt;/p>
&lt;p>routingå€¼é»˜è®¤æ˜¯æ–‡æ¡£çš„_idçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªå€¼ï¼Œæ‰‹åŠ¨æŒ‡å®šå¯¹äºŽè´Ÿè½½å‡è¡¡ä»¥åŠæé«˜æ‰¹é‡è¯»å–çš„æ€§èƒ½éƒ½æœ‰å¸®åŠ©&lt;/p>
&lt;p>3.primary shardä¸ªæ•°ä¸€æ—¦ç¡®å®šå°±ä¸èƒ½ä¿®æ”¹äº†&lt;/p>
&lt;h3 id="æ–‡æ¡£å¢žåˆ æ”¹å†…éƒ¨åŽŸç†">æ–‡æ¡£å¢žåˆ æ”¹å†…éƒ¨åŽŸç†&lt;/h3>
&lt;p>1:å‘é€å¢žåˆ æ”¹è¯·æ±‚æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æˆäº†åè°ƒèŠ‚ç‚¹(coordinating node)&lt;/p>
&lt;p>2.åè°ƒèŠ‚ç‚¹ä½¿ç”¨è·¯ç”±ç®—æ³•è¿›è¡Œè·¯ç”±ï¼Œç„¶åŽå°†è¯·æ±‚è½¬åˆ°primary shardæ‰€åœ¨èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å¤„ç†è¯·æ±‚ï¼Œå¹¶æŠŠæ•°æ®åŒæ­¥åˆ°å®ƒçš„replica shard&lt;/p>
&lt;p>3.åè°ƒèŠ‚ç‚¹å¯¹å®¢æˆ·ç«¯åšå‡ºå“åº”&lt;/p>
&lt;h3 id="å†™ä¸€è‡´æ€§åŽŸç†å’Œquorumæœºåˆ¶">å†™ä¸€è‡´æ€§åŽŸç†å’Œquorumæœºåˆ¶&lt;/h3>
&lt;ol>
&lt;li>ä»»ä½•ä¸€ä¸ªå¢žåˆ æ”¹æ“ä½œéƒ½å¯ä»¥è·Ÿä¸Šä¸€ä¸ªå‚æ•°:``consistency`&lt;/li>
&lt;/ol>
&lt;p>å¯ä»¥ç»™è¯¥å‚æ•°æŒ‡å®šçš„å€¼ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>one: (primary shard)åªè¦æœ‰ä¸€ä¸ªprimary shardæ˜¯æ´»è·ƒçš„å°±å¯ä»¥æ‰§è¡Œ
all: (all shard)æ‰€æœ‰çš„primary shardå’Œreplica shardéƒ½æ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œ
quorum: (default) é»˜è®¤å€¼ï¼Œå¤§éƒ¨åˆ†shardæ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œ ï¼ˆä¾‹å¦‚å…±æœ‰6ä¸ªshardï¼Œè‡³å°‘æœ‰3ä¸ªshardæ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œå†™æ“ä½œï¼‰
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>quorumæœºåˆ¶ï¼šå¤šæ•°shardéƒ½æ˜¯å¯ç”¨çš„ï¼Œ&lt;/li>
&lt;/ol>
&lt;p>int((primary+number_of_replica)/2)+1&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š3ä¸ªprimary shardï¼Œ1ä¸ªreplica&lt;/p>
&lt;p>int((3+1)/2)+1=3&lt;/p>
&lt;p>è‡³å°‘3ä¸ªshardæ˜¯æ´»è·ƒçš„&lt;/p>
&lt;p>æ³¨æ„ï¼šå¯èƒ½å‡ºçŽ°shardä¸èƒ½åˆ†é…é½å…¨çš„æƒ…å†µ&lt;/p>
&lt;p>æ¯”å¦‚ï¼š1ä¸ªprimary shard,1ä¸ªreplicaint((1+1)/2)+1=2ä½†æ˜¯å¦‚æžœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºprimary shardå’Œreplica shardä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥ä»ç„¶ä¸èƒ½æ‰§è¡Œå†™æ“ä½œ&lt;/p>
&lt;p>å†ä¸¾ä¾‹ï¼š1ä¸ªprimary shard,3ä¸ªreplica,2ä¸ªèŠ‚ç‚¹&lt;/p>
&lt;p>int((1+3)/2)+1=3&lt;/p>
&lt;p>æœ€åŽ:å½“æ´»è·ƒçš„shardçš„ä¸ªæ•°æ²¡æœ‰è¾¾åˆ°è¦æ±‚æ—¶ï¼Œesé»˜è®¤ä¼šç­‰å¾…ä¸€åˆ†é’Ÿï¼Œå¦‚æžœåœ¨ç­‰å¾…çš„æœŸé—´æ´»è·ƒçš„shardçš„ä¸ªæ•°æ²¡æœ‰å¢žåŠ ï¼Œåˆ™æ˜¾ç¤ºtimeout&lt;/p>
&lt;p>put /index/type/id?timeout=60s&lt;/p>
&lt;h3 id="æ–‡æ¡£æŸ¥è¯¢å†…éƒ¨åŽŸç†">æ–‡æ¡£æŸ¥è¯¢å†…éƒ¨åŽŸç†&lt;/h3>
&lt;p>ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢è¯·æ±‚å‘ç»™ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æˆäº†coordinating nodeï¼Œè¯¥èŠ‚ç‚¹ä½¿ç”¨è·¯ç”±ç®—æ³•ç®—å‡ºæ–‡æ¡£æ‰€åœ¨çš„primary shard&lt;/p>
&lt;p>ç¬¬äºŒæ­¥ï¼šåè°ƒèŠ‚ç‚¹æŠŠè¯·æ±‚è½¬å‘ç»™primary shardä¹Ÿå¯ä»¥è½¬å‘ç»™replica shard(ä½¿ç”¨è½®è¯¢è°ƒåº¦ç®—æ³•(Round-Robin Schedulingï¼ŒæŠŠè¯·æ±‚å¹³å‡åˆ†é…è‡³primary shard å’Œreplica shard)&lt;/p>
&lt;p>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†è¯·æ±‚çš„èŠ‚ç‚¹æŠŠç»“æžœè¿”å›žç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹å†è¿”å›žç»™åº”ç”¨ç¨‹åº&lt;/p>
&lt;p>ç‰¹æ®Šæƒ…å†µï¼šè¯·æ±‚çš„æ–‡æ¡£è¿˜åœ¨å»ºç«‹ç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼Œprimary shardä¸Šå­˜åœ¨ï¼Œä½†replica sharä¸Šä¸å­˜åœ¨ï¼Œä½†æ˜¯è¯·æ±‚è¢«è½¬å‘åˆ°äº†replica shardä¸Šï¼Œè¿™æ—¶å°±ä¼šæç¤ºæ‰¾ä¸åˆ°æ–‡æ¡£&lt;/p>
&lt;h3 id="bulkæ‰¹é‡æ“ä½œçš„jsonæ ¼å¼è§£æž">bulkæ‰¹é‡æ“ä½œçš„jsonæ ¼å¼è§£æž&lt;/h3>
&lt;p>bulkçš„æ ¼å¼ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>{action:{metadata}}\n
{requstbody}\n
&lt;/code>&lt;/pre>&lt;p>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>[{
&amp;#34;action&amp;#34;: {
},
&amp;#34;data&amp;#34;: {
}
}]
&lt;/code>&lt;/pre>&lt;p>è¿™ç§æ–¹å¼å¯è¯»æ€§å¥½ï¼Œä½†æ˜¯å†…éƒ¨å¤„ç†å°±éº»çƒ¦äº†ï¼š&lt;/p>
&lt;p>1.å°†jsonæ•°ç»„è§£æžä¸ºJSONArrayå¯¹è±¡ï¼Œåœ¨å†…å­˜ä¸­å°±éœ€è¦æœ‰ä¸€ä»½jsonæ–‡æœ¬çš„æ‹·è´ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªJSONArrayå¯¹è±¡ã€‚&lt;/p>
&lt;p>2.è§£æžjsonæ•°ç»„é‡Œçš„æ¯ä¸ªjsonï¼Œå¯¹æ¯ä¸ªè¯·æ±‚ä¸­çš„documentè¿›è¡Œè·¯ç”±&lt;/p>
&lt;p>3.ä¸ºè·¯ç”±åˆ°åŒä¸€ä¸ªshardä¸Šçš„å¤šä¸ªè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªè¯·æ±‚æ•°ç»„&lt;/p>
&lt;p>4.å°†è¿™ä¸ªè¯·æ±‚æ•°ç»„åºåˆ—åŒ–&lt;/p>
&lt;p>5.å°†åºåˆ—åŒ–åŽçš„è¯·æ±‚æ•°ç»„å‘é€åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸ŠåŽ»&lt;/p>
&lt;p>è€—è´¹æ›´å¤šå†…å­˜ï¼Œå¢žåŠ javaè™šæ‹Ÿæœºå¼€é”€&lt;/p>
&lt;p>1.ä¸ç”¨å°†å…¶è½¬æ¢ä¸ºjsonå¯¹è±¡ï¼Œç›´æŽ¥æŒ‰ç…§æ¢è¡Œç¬¦åˆ‡å‰²jsonï¼Œå†…å­˜ä¸­ä¸éœ€è¦jsonæ–‡æœ¬çš„æ‹·è´&lt;/p>
&lt;p>2.å¯¹æ¯ä¸¤ä¸ªä¸€ç»„çš„jsonï¼Œè¯»å–metaï¼Œè¿›è¡Œdocumentè·¯ç”±&lt;/p>
&lt;p>3.ç›´æŽ¥å°†å¯¹åº”çš„jsonå‘é€åˆ°nodeä¸ŠåŽ»&lt;/p>
&lt;h3 id="æŸ¥è¯¢ç»“æžœåˆ†æž">æŸ¥è¯¢ç»“æžœåˆ†æž&lt;/h3>
&lt;pre tabindex="0">&lt;code>{
# æŸ¥è¯¢è€—è´¹çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
&amp;#34;took&amp;#34;: 419,
# è¶…æ—¶æ—¶é—´
&amp;#34;timed_out&amp;#34;: false,
# å…±è¯·æ±‚äº†å¤šå°‘ä¸ªshard
&amp;#34;_shards&amp;#34;: {
# æŸ¥è¯¢å‡ºçš„æ–‡æ¡£æ€»ä¸ªæ•°
&amp;#34;total&amp;#34;: 3,
&amp;#34;successful&amp;#34;: 3,
&amp;#34;skipped&amp;#34;: 0,
&amp;#34;failed&amp;#34;: 0
},
&amp;#34;hits&amp;#34;: {
&amp;#34;total&amp;#34;: 3,
# æœ¬æ¬¡æŸ¥è¯¢ä¸­ï¼Œç›¸å…³åº¦åˆ†æ•°çš„æœ€å¤§å€¼ï¼Œæ–‡æ¡£å’Œæ­¤æ¬¡æŸ¥è¯¢çš„åŒ¹é…åº¦è¶Šé«˜ï¼Œ_scoreçš„å€¼è¶Šå¤§ï¼ŒæŽ’ä½è¶Šé å‰
&amp;#34;max_score&amp;#34;: 0.6931472,
# é»˜è®¤æŸ¥è¯¢å‰10ä¸ªæ–‡æ¡£
&amp;#34;hits&amp;#34;: [
{
&amp;#34;_index&amp;#34;: &amp;#34;lib3&amp;#34;,
&amp;#34;_type&amp;#34;: &amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;: &amp;#34;3&amp;#34;,
&amp;#34;_score&amp;#34;: 0.6931472,
&amp;#34;_source&amp;#34;: {
&amp;#34;address&amp;#34;: &amp;#34;bei jing hai dian qu qing he zhen&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;lisi&amp;#34;
}
},
{
&amp;#34;_index&amp;#34;: &amp;#34;lib3&amp;#34;,
&amp;#34;_type&amp;#34;: &amp;#34;user&amp;#34;,
&amp;#34;_id&amp;#34;: &amp;#34;2&amp;#34;,
&amp;#34;_score&amp;#34;: 0.47000363,
&amp;#34;_source&amp;#34;: {
&amp;#34;address&amp;#34;: &amp;#34;bei jing hai dian qu qing he zhen&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;zhaoming&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code># è®¾ç½®è¶…æ—¶æ—¶é—´
GET /lib3/user/_search?timeout=10ms
{
&amp;#34;_source&amp;#34;: [&amp;#34;address&amp;#34;,&amp;#34;name&amp;#34;],
&amp;#34;query&amp;#34;: {
&amp;#34;match&amp;#34;: {
&amp;#34;interests&amp;#34;: &amp;#34;changge&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="åˆ†é¡µæŸ¥è¯¢ä¸­çš„deep-pagingé—®é¢˜">åˆ†é¡µæŸ¥è¯¢ä¸­çš„deep pagingé—®é¢˜&lt;/h3>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search
{
&amp;#34;from&amp;#34;:0,
&amp;#34;size&amp;#34;:2,
&amp;#34;query&amp;#34;:{
&amp;#34;terms&amp;#34;:{
&amp;#34;interests&amp;#34;: [&amp;#34;hejiu&amp;#34;,&amp;#34;changge&amp;#34;]
}
}
}
GET /_search?from=0&amp;amp;size=3
&lt;/code>&lt;/pre>&lt;p>deep paging:æŸ¥è¯¢çš„å¾ˆæ·±ï¼Œæ¯”å¦‚ä¸€ä¸ªç´¢å¼•æœ‰ä¸‰ä¸ªprimary shardï¼Œåˆ†åˆ«å­˜å‚¨äº†6000æ¡æ•°æ®ï¼Œæˆ‘ä»¬è¦å¾—åˆ°ç¬¬100é¡µçš„æ•°æ®(æ¯é¡µ10æ¡)ï¼Œç±»ä¼¼è¿™ç§æƒ…å†µå°±å«deep paging&lt;/p>
&lt;p>å¦‚ä½•å¾—åˆ°ç¬¬100é¡µçš„10æ¡æ•°æ®ï¼Ÿ&lt;/p>
&lt;p>åœ¨æ¯ä¸ªshardä¸­æœç´¢990åˆ°999è¿™10æ¡æ•°æ®ï¼Œç„¶åŽç”¨è¿™30æ¡æ•°æ®æŽ’åºï¼ŒæŽ’åºä¹‹åŽå–10æ¡æ•°æ®å°±æ˜¯è¦æœç´¢çš„æ•°æ®ï¼Œè¿™ç§åšæ³•æ˜¯é”™çš„ï¼Œå› ä¸º3ä¸ªshardä¸­çš„æ•°æ®çš„&lt;em>scoreåˆ†æ•°ä¸ä¸€æ ·ï¼Œå¯èƒ½è¿™æŸä¸€ä¸ªshardä¸­ç¬¬ä¸€æ¡æ•°æ®çš„&lt;/em>scoreåˆ†æ•°æ¯”å¦ä¸€ä¸ªshardä¸­ç¬¬1000æ¡éƒ½è¦é«˜ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªshardä¸­æœç´¢990åˆ°999è¿™10æ¡æ•°æ®ç„¶åŽæŽ’åºçš„åšæ³•æ˜¯ä¸æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>æ­£ç¡®çš„åšæ³•æ˜¯æ¯ä¸ªshardæŠŠ0åˆ°999æ¡æ•°æ®å…¨éƒ¨æœç´¢å‡ºæ¥ï¼ˆæŒ‰æŽ’åºé¡ºåºï¼‰ï¼Œç„¶åŽå…¨éƒ¨è¿”å›žç»™coordinate nodeï¼Œç”±coordinate nodeæŒ‰_scoreåˆ†æ•°æŽ’åºåŽï¼Œå–å‡ºç¬¬100é¡µçš„10æ¡æ•°æ®ï¼Œç„¶åŽè¿”å›žç»™å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>deep pagingæ€§èƒ½é—®é¢˜&lt;/p>
&lt;p>1.è€—è´¹ç½‘ç»œå¸¦å®½ï¼Œå› ä¸ºæœç´¢è¿‡æ·±çš„è¯ï¼Œå„shardè¦æŠŠæ•°æ®ä¼ é€ç»™coordinate nodeï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æœ‰å¤§é‡æ•°æ®ä¼ é€’çš„ï¼Œæ¶ˆè€—ç½‘ç»œï¼Œ&lt;/p>
&lt;p>2.æ¶ˆè€—å†…å­˜ï¼Œå„shardè¦æŠŠæ•°æ®ä¼ é€ç»™coordinate nodeï¼Œè¿™ä¸ªä¼ é€’å›žæ¥çš„æ•°æ®ï¼Œæ˜¯è¢«coordinate nodeä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™æ ·ä¼šå¤§é‡æ¶ˆè€—å†…å­˜ã€‚&lt;/p>
&lt;p>3.æ¶ˆè€—cpu coordinate nodeè¦æŠŠä¼ å›žæ¥çš„æ•°æ®è¿›è¡ŒæŽ’åºï¼Œè¿™ä¸ªæŽ’åºè¿‡ç¨‹å¾ˆæ¶ˆè€—cpu.&lt;/p>
&lt;p>é‰´äºŽdeep pagingçš„æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥åº”å°½é‡å‡å°‘ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="query-stringæŸ¥è¯¢åŠcopy_toè§£æž">query stringæŸ¥è¯¢åŠcopy_toè§£æž&lt;/h3>
&lt;p>GET /lib3/user/_search?q=interests:changge&lt;/p>
&lt;p>GET /lib3/user/_search?q=+interests:changge&lt;/p>
&lt;p>GET /lib3/user/_search?q=-interests:changge&lt;/p>
&lt;p>copy_toå­—æ®µæ˜¯æŠŠå…¶å®ƒå­—æ®µä¸­çš„å€¼ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ç»„æˆä¸€ä¸ªå¤§å­—ç¬¦ä¸²ï¼Œç„¶åŽè¢«åˆ†æžå’Œç´¢å¼•ï¼Œä½†æ˜¯ä¸å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½è¢«æŸ¥è¯¢ï¼Œä½†ä¸èƒ½è¢«å–å›žæ˜¾ç¤ºã€‚&lt;/p>
&lt;p>æ³¨æ„:copy_toæŒ‡å‘çš„å­—æ®µå­—æ®µç±»åž‹è¦ä¸ºï¼štext&lt;/p>
&lt;p>å½“æ²¡æœ‰æŒ‡å®šfieldæ—¶ï¼Œå°±ä¼šä»Žcopy_toå­—æ®µä¸­æŸ¥è¯¢GET /lib3/user/_search?q=changge&lt;/p>
&lt;h3 id="å­—ç¬¦ä¸²æŽ’åºé—®é¢˜">å­—ç¬¦ä¸²æŽ’åºé—®é¢˜&lt;/h3>
&lt;p>å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²ç±»åž‹çš„å­—æ®µè¿›è¡ŒæŽ’åºé€šå¸¸ä¸å‡†ç¡®ï¼Œå› ä¸ºå·²ç»è¢«åˆ†è¯æˆå¤šä¸ªè¯æ¡äº†&lt;/p>
&lt;p>è§£å†³æ–¹å¼ï¼šå¯¹å­—æ®µç´¢å¼•ä¸¤æ¬¡ï¼Œä¸€æ¬¡ç´¢å¼•åˆ†è¯ï¼ˆç”¨äºŽæœç´¢ï¼‰ï¼Œä¸€æ¬¡ç´¢å¼•ä¸åˆ†è¯(ç”¨äºŽæŽ’åº)&lt;/p>
&lt;pre tabindex="0">&lt;code># è®¾ç½®mapping
PUT /lib3
{
&amp;#34;settings&amp;#34;:{
&amp;#34;number_of_shards&amp;#34; : 3,
&amp;#34;number_of_replicas&amp;#34; : 0
},
&amp;#34;mappings&amp;#34;:{
&amp;#34;user&amp;#34;:{
&amp;#34;properties&amp;#34;:{
&amp;#34;name&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;address&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;age&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;integer&amp;#34;},
&amp;#34;birthday&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;date&amp;#34;},
&amp;#34;interests&amp;#34;: {
&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;,
# é‡ç‚¹æ˜¯åœ¨è¿™ä¸‹é¢
&amp;#34;fields&amp;#34;: {
&amp;#34;raw&amp;#34;:{
&amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
}
},
&amp;#34;fielddata&amp;#34;: true
}
}
}
}
}
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;sort&amp;#34;: [
{
&amp;#34;interests&amp;#34;: {
&amp;#34;order&amp;#34;: &amp;#34;desc&amp;#34;
}
}
]
}
GET /lib3/user/_search
{
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;sort&amp;#34;: [
{
&amp;#34;interests.raw&amp;#34;: {
&amp;#34;order&amp;#34;: &amp;#34;asc&amp;#34;
}
}
]
}
&lt;/code>&lt;/pre>&lt;h3 id="å¦‚ä½•è®¡ç®—ç›¸å…³åº¦åˆ†æ•°">å¦‚ä½•è®¡ç®—ç›¸å…³åº¦åˆ†æ•°&lt;/h3>
&lt;p>ä½¿ç”¨çš„æ˜¯TF/IDFç®—æ³•(Term Frequency&amp;amp;Inverse Document Frequency)&lt;/p>
&lt;p>1.Term Frequency:æˆ‘ä»¬æŸ¥è¯¢çš„æ–‡æœ¬ä¸­çš„è¯æ¡åœ¨documentæœ¬ä¸­å‡ºçŽ°äº†å¤šå°‘æ¬¡ï¼Œå‡ºçŽ°æ¬¡æ•°è¶Šå¤šï¼Œç›¸å…³åº¦è¶Šé«˜&lt;/p>
&lt;p>æœç´¢å†…å®¹ï¼š hello world&lt;/p>
&lt;p>Helloï¼ŒI love china.&lt;/p>
&lt;p>Hello world,how are you!&lt;/p>
&lt;p>2.Inverse Document Frequencyï¼šæˆ‘ä»¬æŸ¥è¯¢çš„æ–‡æœ¬ä¸­çš„è¯æ¡åœ¨ç´¢å¼•çš„æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºçŽ°äº†å¤šå°‘æ¬¡ï¼Œå‡ºçŽ°çš„æ¬¡æ•°è¶Šå¤šï¼Œç›¸å…³åº¦è¶Šä½Ž&lt;/p>
&lt;p>æœç´¢å†…å®¹ï¼šhello world&lt;/p>
&lt;p>helloï¼Œwhat are you doing?&lt;/p>
&lt;p>I like the world.&lt;/p>
&lt;p>hello åœ¨ç´¢å¼•çš„æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºçŽ°äº†500æ¬¡ï¼Œworldå‡ºçŽ°äº†100æ¬¡&lt;/p>
&lt;p>3.Field-length(å­—æ®µé•¿åº¦å½’çº¦) norm:fieldè¶Šé•¿ï¼Œç›¸å…³åº¦è¶Šä½Ž&lt;/p>
&lt;p>æœç´¢å†…å®¹ï¼šhello world&lt;/p>
&lt;p>{&amp;ldquo;title&amp;rdquo;:&amp;ldquo;hello,what&amp;rsquo;s your name?&amp;rdquo;,&amp;ldquo;content&amp;rdquo;:{&amp;ldquo;owieurowieuolsdjflk&amp;rdquo;}}&lt;/p>
&lt;p>{&amp;ldquo;title&amp;rdquo;:&amp;ldquo;hi,good morning&amp;rdquo;,&amp;ldquo;content&amp;rdquo;:{&amp;ldquo;lkjkljkj&amp;hellip;&amp;hellip;.world&amp;rdquo;}}&lt;/p>
&lt;p>æŸ¥çœ‹åˆ†æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼š&lt;/p>
&lt;p>GET /lib3/user/_search?explain=true{&amp;ldquo;query&amp;rdquo;:{&amp;ldquo;match&amp;rdquo;:{&amp;ldquo;interests&amp;rdquo;: &amp;ldquo;duanlian,changge&amp;rdquo;}}}&lt;/p>
&lt;p>æŸ¥çœ‹ä¸€ä¸ªæ–‡æ¡£èƒ½å¦åŒ¹é…ä¸ŠæŸä¸ªæŸ¥è¯¢ï¼š&lt;/p>
&lt;p>GET /lib3/user/2/_explain{&amp;ldquo;query&amp;rdquo;:{&amp;ldquo;match&amp;rdquo;:{&amp;ldquo;interests&amp;rdquo;: &amp;ldquo;duanlian,changge&amp;rdquo;}}}&lt;/p>
&lt;h3 id="doc-values-è§£æž">Doc Values è§£æž&lt;/h3>
&lt;p>DocValueså…¶å®žæ˜¯Luceneåœ¨æž„å»ºå€’æŽ’ç´¢å¼•æ—¶ï¼Œä¼šé¢å¤–å»ºç«‹ä¸€ä¸ªæœ‰åºçš„æ­£æŽ’ç´¢å¼•(åŸºäºŽdocument =&amp;gt; field valueçš„æ˜ å°„åˆ—è¡¨),å­—ç¬¦ä¸²ä¸ä¼šåˆ›å»ºæ­£æŽ’ç´¢å¼•&lt;/p>
&lt;pre tabindex="0">&lt;code>{&amp;#34;birthday&amp;#34;:&amp;#34;1985-11-11&amp;#34;,age:23}
{&amp;#34;birthday&amp;#34;:&amp;#34;1989-11-11&amp;#34;,age:29}
document age birthday
doc1 23 1985-11-11
doc2 29 1989-11-11
&lt;/code>&lt;/pre>&lt;p>å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒèŠ‚çœå†…å­˜&lt;/p>
&lt;p>å¯¹æŽ’åºï¼Œåˆ†ç»„å’Œä¸€äº›èšåˆæ“ä½œèƒ½å¤Ÿå¤§å¤§æå‡æ€§èƒ½&lt;/p>
&lt;p>æ³¨æ„ï¼šé»˜è®¤å¯¹ä¸åˆ†è¯çš„å­—æ®µæ˜¯å¼€å¯çš„ï¼Œå¯¹åˆ†è¯å­—æ®µæ— æ•ˆï¼ˆéœ€è¦æŠŠfielddataè®¾ç½®ä¸ºtrueï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>PUT /lib3
{
&amp;#34;settings&amp;#34;:{
&amp;#34;number_of_shards&amp;#34; : 3,
&amp;#34;number_of_replicas&amp;#34; : 0
},
&amp;#34;mappings&amp;#34;:{
&amp;#34;user&amp;#34;:{
&amp;#34;properties&amp;#34;:{
&amp;#34;name&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;address&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;age&amp;#34;: {
&amp;#34;type&amp;#34;:&amp;#34;integer&amp;#34;,
&amp;#34;doc_values&amp;#34;:false
},
&amp;#34;interests&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;text&amp;#34;},
&amp;#34;birthday&amp;#34;: {&amp;#34;type&amp;#34;:&amp;#34;date&amp;#34;}
}
}
}
}
&lt;/code>&lt;/pre>&lt;h3 id="åŸºäºŽscrollæŠ€æœ¯æ»šåŠ¨æœç´¢å¤§é‡æ•°æ®">åŸºäºŽscrollæŠ€æœ¯æ»šåŠ¨æœç´¢å¤§é‡æ•°æ®&lt;/h3>
&lt;p>å¦‚æžœä¸€æ¬¡æ€§è¦æŸ¥å‡ºæ¥æ¯”å¦‚10ä¸‡æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šå¾ˆå·®ï¼Œæ­¤æ—¶ä¸€èˆ¬ä¼šé‡‡å–ç”¨scollæ»šåŠ¨æŸ¥è¯¢ï¼Œä¸€æ‰¹ä¸€æ‰¹çš„æŸ¥ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½æŸ¥è¯¢å®Œä¸ºæ­¢ã€‚&lt;/p>
&lt;p>1.scollæœç´¢ä¼šåœ¨ç¬¬ä¸€æ¬¡æœç´¢çš„æ—¶å€™ï¼Œä¿å­˜ä¸€ä¸ªå½“æ—¶çš„è§†å›¾å¿«ç…§ï¼Œä¹‹åŽåªä¼šåŸºäºŽè¯¥æ—§çš„è§†å›¾å¿«ç…§æä¾›æ•°æ®æœç´¢ï¼Œå¦‚æžœè¿™ä¸ªæœŸé—´æ•°æ®å˜æ›´ï¼Œæ˜¯ä¸ä¼šè®©ç”¨æˆ·çœ‹åˆ°çš„&lt;/p>
&lt;p>2.é‡‡ç”¨åŸºäºŽ&lt;em>doc(ä¸ä½¿ç”¨&lt;/em>score)è¿›è¡ŒæŽ’åºçš„æ–¹å¼ï¼Œæ€§èƒ½è¾ƒé«˜&lt;/p>
&lt;p>3.æ¯æ¬¡å‘é€scrollè¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªscollå‚æ•°ï¼ŒæŒ‡å®šä¸€ä¸ªæ—¶é—´çª—å£ï¼Œæ¯æ¬¡æœç´¢è¯·æ±‚åªè¦åœ¨è¿™ä¸ªæ—¶é—´çª—å£å†…èƒ½å®Œæˆå°±å¯ä»¥äº†&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /lib3/user/_search?scroll=1m
{
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;sort&amp;#34;:[&amp;#34;_doc&amp;#34;],
# ä¸€æ‰¹æŸ¥å¤šå°‘ä¸ª
&amp;#34;size&amp;#34;:3
}
GET /_search/scroll
{
&amp;#34;scroll&amp;#34;: &amp;#34;1m&amp;#34;,
# è¿™ä¸ªæ˜¯ä¸Šé¢é‚£ä¸ªæŸ¥è¯¢é‡ŒèŽ·å–åˆ°çš„
&amp;#34;scroll_id&amp;#34;: &amp;#34;DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAAAdFkEwRENOVTdnUUJPWVZUd1p2WE5hV2cAAAAAAAAAHhZBMERDTlU3Z1FCT1lWVHdadlhOYVdnAAAAAAAAAB8WQTBEQ05VN2dRQk9ZVlR3WnZYTmFXZw==&amp;#34;
}
&lt;/code>&lt;/pre>&lt;h3 id="dynamic-mappingç­–ç•¥">dynamic mappingç­–ç•¥&lt;/h3>
&lt;p>&lt;strong>dynamic&lt;/strong>:&lt;/p>
&lt;p>1.true:é‡åˆ°é™Œç”Ÿå­—æ®µå°± dynamic mapping&lt;/p>
&lt;p>2.false:é‡åˆ°é™Œç”Ÿå­—æ®µå°±å¿½ç•¥&lt;/p>
&lt;p>3.strict:çº¦åˆ°é™Œç”Ÿå­—æ®µå°±æŠ¥é”™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">PUT&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">/lib&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>{&lt;span style="color:#f92672">&amp;#34;settings&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;number_of_shards&amp;#34;&lt;/span> : &lt;span style="color:#ae81ff">3&lt;/span>,&lt;span style="color:#f92672">&amp;#34;number_of_replicas&amp;#34;&lt;/span> : &lt;span style="color:#ae81ff">0&lt;/span>},&lt;span style="color:#f92672">&amp;#34;mappings&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;user&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;dynamic&amp;#34;&lt;/span>:&lt;span style="color:#960050;background-color:#1e0010">strict&lt;/span>,&lt;span style="color:#f92672">&amp;#34;properties&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;name&amp;#34;&lt;/span>: {&lt;span style="color:#f92672">&amp;#34;type&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>},&lt;span style="color:#f92672">&amp;#34;address&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;type&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;object&amp;#34;&lt;/span>,&lt;span style="color:#f92672">&amp;#34;dynamic&amp;#34;&lt;/span>:&lt;span style="color:#66d9ef">true&lt;/span>},}}}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šæŠ¥é”™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">PUT&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">/lib&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/user/&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>{&lt;span style="color:#f92672">&amp;#34;name&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;lisi&amp;#34;&lt;/span>,&lt;span style="color:#f92672">&amp;#34;age&amp;#34;&lt;/span>:&lt;span style="color:#ae81ff">20&lt;/span>,&lt;span style="color:#f92672">&amp;#34;address&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;province&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;beijing&amp;#34;&lt;/span>,&lt;span style="color:#f92672">&amp;#34;city&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;beijing&amp;#34;&lt;/span>}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>date_detection&lt;/strong>:é»˜è®¤ä¼šæŒ‰ç…§ä¸€å®šæ ¼å¼è¯†åˆ«dateï¼Œæ¯”å¦‚yyyy-MM-dd&lt;/p>
&lt;p>å¯ä»¥æ‰‹åŠ¨å…³é—­æŸä¸ªtypeçš„date_detection&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">PUT&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">/lib&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>{&lt;span style="color:#f92672">&amp;#34;settings&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;number_of_shards&amp;#34;&lt;/span> : &lt;span style="color:#ae81ff">3&lt;/span>,&lt;span style="color:#f92672">&amp;#34;number_of_replicas&amp;#34;&lt;/span> : &lt;span style="color:#ae81ff">0&lt;/span>},&lt;span style="color:#f92672">&amp;#34;mappings&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;user&amp;#34;&lt;/span>:{&lt;span style="color:#f92672">&amp;#34;date_detection&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span>,}}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å®šåˆ¶ dynamic mapping template(type)&lt;/strong>&lt;/p>
&lt;p>PUT /my_index{&amp;ldquo;mappings&amp;rdquo;: {&amp;ldquo;my_type&amp;rdquo;: {&amp;ldquo;dynamic_templates&amp;rdquo;: [{&amp;ldquo;en&amp;rdquo;: {&amp;ldquo;match&amp;rdquo;: &amp;ldquo;*_en&amp;rdquo;,&amp;ldquo;match_mapping_type&amp;rdquo;: &amp;ldquo;string&amp;rdquo;,&amp;ldquo;mapping&amp;rdquo;: {&amp;ldquo;type&amp;rdquo;: &amp;ldquo;text&amp;rdquo;,&amp;ldquo;analyzer&amp;rdquo;: &amp;ldquo;english&amp;rdquo;}}}]}}}#ä½¿ç”¨äº†æ¨¡æ¿&lt;/p>
&lt;p>PUT /my_index/my_type/3{&amp;ldquo;title_en&amp;rdquo;: &amp;ldquo;this is my dog&amp;rdquo;&lt;/p>
&lt;p>}#æ²¡æœ‰ä½¿ç”¨æ¨¡æ¿&lt;/p>
&lt;p>PUT /my_index/my_type/5{&amp;ldquo;title&amp;rdquo;: &amp;ldquo;this is my cat&amp;rdquo;}&lt;/p>
&lt;p>GET my_index/my_type/_search{&amp;ldquo;query&amp;rdquo;: {&amp;ldquo;match&amp;rdquo;: {&amp;ldquo;title&amp;rdquo;: &amp;ldquo;is&amp;rdquo;}}}&lt;/p>
&lt;h3 id="é‡å»ºç´¢å¼•">é‡å»ºç´¢å¼•&lt;/h3>
&lt;p>ä¸€ä¸ªfieldçš„è®¾ç½®æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå¦‚æžœè¦ä¿®æ”¹ä¸€ä¸ªfieldï¼Œé‚£ä¹ˆåº”è¯¥é‡æ–°æŒ‰ç…§æ–°çš„mappingï¼Œå»ºç«‹ä¸€ä¸ªindexï¼Œç„¶åŽå°†æ•°æ®æ‰¹é‡æŸ¥è¯¢å‡ºæ¥ï¼Œé‡æ–°ç”¨bulk apiå†™å…¥åˆ°indexä¸­ã€‚&lt;/p>
&lt;p>æ‰¹é‡æŸ¥è¯¢çš„æ—¶å€™ï¼Œå»ºè®®é‡‡ç”¨scroll apiï¼Œå¹¶ä¸”é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘çš„æ–¹å¼æ¥reindexæ•°æ®ï¼Œæ¯æ¬¡scrollå°±æŸ¥è¯¢æŒ‡å®šæ—¥æœŸçš„ä¸€æ®µæ•°æ®ï¼Œäº¤ç»™ä¸€ä¸ªçº¿ç¨‹å³å¯ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code># åŽŸå§‹çš„æ•°æ®
PUT /index1/type1/4
{
&amp;#34;content&amp;#34;:&amp;#34;1990-12-12&amp;#34;
}
#æŠ¥é”™
PUT /index1/type1/4
{
&amp;#34;content&amp;#34;:&amp;#34;I am very happy.&amp;#34;
}
#ä¿®æ”¹contentçš„ç±»åž‹ä¸ºstringç±»åž‹,æŠ¥é”™ï¼Œä¸å…è®¸ä¿®æ”¹
PUT /index1/_mapping/type1
{
&amp;#34;properties&amp;#34;: {
&amp;#34;content&amp;#34;:{
&amp;#34;type&amp;#34;: &amp;#34;text&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠindex1ç´¢å¼•ä¸­çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥å¯¼å…¥åˆ°æ–°çš„ç´¢å¼•ä¸­,ä½†æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ˜¯ä¹‹å‰çš„ç´¢å¼•ï¼Œä¸ºäº†ä¸ç”¨é‡å¯åº”ç”¨ç¨‹åºï¼Œç»™index1è¿™ä¸ªç´¢å¼•èµ·ä¸ª&lt;/p>
&lt;pre tabindex="0">&lt;code># èµ·åˆ«å
PUT /index1/_alias/index2
# åˆ›å»ºæ–°çš„ç´¢å¼•ï¼ŒæŠŠcontentçš„ç±»åž‹æ”¹ä¸ºå­—ç¬¦ä¸²
PUT /newindex
{
&amp;#34;mappings&amp;#34;: {
&amp;#34;type1&amp;#34;:{
&amp;#34;properties&amp;#34;: {
&amp;#34;content&amp;#34;:{
&amp;#34;type&amp;#34;: &amp;#34;text&amp;#34;
}
}
}
}
}
# ä½¿ç”¨scrollæ‰¹é‡æŸ¥è¯¢
GET /index1/type1/_search?scroll=1m
{
&amp;#34;query&amp;#34;: {
&amp;#34;match_all&amp;#34;: {}
},
&amp;#34;sort&amp;#34;: [&amp;#34;_doc&amp;#34;],
&amp;#34;size&amp;#34;: 2
}
#ä½¿ç”¨bulkæ‰¹é‡å†™å…¥æ–°çš„ç´¢å¼•
POST /_bulk
{&amp;#34;index&amp;#34;:{&amp;#34;_index&amp;#34;:&amp;#34;newindex&amp;#34;,&amp;#34;_type&amp;#34;:&amp;#34;type1&amp;#34;,&amp;#34;_id&amp;#34;:1}}
{&amp;#34;content&amp;#34;:&amp;#34;1982-12-12&amp;#34;}
#å°†åˆ«åindex2å’Œæ–°çš„ç´¢å¼•å…³è”ï¼Œåº”ç”¨ç¨‹åºä¸ç”¨é‡å¯
POST /_aliases
{
&amp;#34;actions&amp;#34;: [
{&amp;#34;remove&amp;#34;: {&amp;#34;index&amp;#34;:&amp;#34;index1&amp;#34;,&amp;#34;alias&amp;#34;:&amp;#34;index2&amp;#34;}},
{&amp;#34;add&amp;#34;: {&amp;#34;index&amp;#34;: &amp;#34;newindex&amp;#34;,&amp;#34;alias&amp;#34;: &amp;#34;index2&amp;#34;}}
]
}
GET index2/type1/_search
&lt;/code>&lt;/pre>&lt;h3 id="ç´¢å¼•ä¸å¯å˜çš„åŽŸå› ">ç´¢å¼•ä¸å¯å˜çš„åŽŸå› &lt;/h3>
&lt;p>å€’æŽ’ç´¢å¼•åŒ…æ‹¬ï¼š&lt;/p>
&lt;p>æ–‡æ¡£çš„åˆ—è¡¨ï¼Œæ–‡æ¡£çš„æ•°é‡ï¼Œè¯æ¡åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­å‡ºçŽ°çš„æ¬¡æ•°ï¼Œå‡ºçŽ°çš„ä½ç½®ï¼Œæ¯ä¸ªæ–‡æ¡£çš„é•¿åº¦ï¼Œæ‰€æœ‰æ–‡æ¡£çš„å¹³å‡é•¿åº¦&lt;/p>
&lt;p>ç´¢å¼•ä¸å˜çš„åŽŸå› ï¼š&lt;/p>
&lt;p>ä¸éœ€è¦é”ï¼Œæå‡äº†å¹¶å‘æ€§èƒ½&lt;/p>
&lt;p>å¯ä»¥ä¸€ç›´ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼ˆfilterï¼‰&lt;/p>
&lt;p>èŠ‚çœcpuå’Œioå¼€é”€&lt;/p>
&lt;h1 id="å…ˆè®°ç€">å…ˆè®°ç€&lt;/h1>
&lt;p>ç”¨logstashåŽ»åŒæ­¥mysqlçš„çš„å¢žé‡,,éœ€è¦ä¸¤ä¸ªå­—æ®µ,ç¬¬ä¸€ä¸ªæ˜¯ id,ä¸»é”®,ç¬¬äºŒä¸ªæ˜¯update_date, ç”¨ç¬¬äºŒä¸ªå­—æ®µåŽ»æŸ¥è¯¢,é»˜è®¤ç”¨idåŽ»åŽ»é‡&lt;/p>
&lt;p>group by çš„æ—¶å€™æŠ¥é”™äº†&lt;/p>
&lt;p>esè¿›è¡Œèšåˆæ“ä½œæ—¶æç¤ºFielddata is disabled on text fields by default&lt;/p>
&lt;p>&lt;a href="https://blog.csdn.net/u011403655/article/details/71107415/">https://blog.csdn.net/u011403655/article/details/71107415/&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code># å……å€¼ç¬”æ•°
GET /shouye/rukuan/_search
{
&amp;#34;aggs&amp;#34;: {
&amp;#34;my_cre&amp;#34;: {
&amp;#34;terms&amp;#34;: {
&amp;#34;field&amp;#34;: &amp;#34;orderId&amp;#34;
}
}
}
}
GET /shouye/rukuan/_count
GET /shouye/_mapping
PUT shouye/_mapping/rukuan/
{
&amp;#34;properties&amp;#34;: {
&amp;#34;orderId&amp;#34;: {
&amp;#34;type&amp;#34;: &amp;#34;text&amp;#34;,
&amp;#34;fielddata&amp;#34;: true
}
}
}
&lt;/code>&lt;/pre>&lt;h1 id="springbootæ•´åˆelasticsearch">springbootæ•´åˆElasticsearch&lt;/h1>
&lt;pre tabindex="0">&lt;code>&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;project xmlns=&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34; xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
xsi:schemaLocation=&amp;#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&amp;gt;
&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
&amp;lt;parent&amp;gt;
&amp;lt;groupId&amp;gt;com.lzkj&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;item2&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;
&amp;lt;/parent&amp;gt;
&amp;lt;groupId&amp;gt;com.es&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;es-server&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;
&amp;lt;name&amp;gt;es-server&amp;lt;/name&amp;gt;
&amp;lt;description&amp;gt;Demo project for Spring Boot&amp;lt;/description&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;dependencies&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-data-elasticsearch&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-maven-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
&amp;lt;/project&amp;gt;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>spring.elasticsearch.rest.uris=http://192.168.111.132:9200
&lt;/code>&lt;/pre></content></item><item><title>Flink</title><link>https://connorzhangyu.com/posts/flink/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/flink/</guid><description>&lt;h1 id="flink">Flink&lt;/h1>
&lt;h2 id="å°è¯•flink">å°è¯•flink&lt;/h2>
&lt;h3 id="æœ¬åœ°å®‰è£…">æœ¬åœ°å®‰è£…&lt;/h3>
&lt;p>æ­¥éª¤ä¸€:ä¸‹è½½&lt;/p>
&lt;p>ä¸ºäº†èƒ½å¤Ÿè¿è¡ŒFlinkï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯å®‰è£…æœ‰æ•ˆçš„&lt;strong>Java 8æˆ–11&lt;/strong>ã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥Javaçš„æ­£ç¡®å®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¦å®‰è£…javaçŽ¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>java -version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¸‹è½½è§£åŽ‹flink&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -xzf flink-1.11.2-bin-scala_2.11.tgz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd flink-1.11.2-bin-scala_2.11
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¥éª¤äºŒ:å¯åŠ¨æœ¬åœ°é›†ç¾¤&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/start-cluster.sh
Starting cluster.
Starting standalonesession daemon on host.
Starting taskexecutor daemon on host.
&lt;/code>&lt;/pre>&lt;p>æ­¥éª¤ä¸‰:æäº¤ä¸€ä¸ªjob&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/flink run examples/streaming/WordCount.jar
$ tail log/flink-*-taskexecutor-*.out
(to,1)
(be,1)
(or,1)
(not,1)
(to,2)
(be,2)
&lt;/code>&lt;/pre>&lt;p>æ­¥éª¤å››:åœæ­¢é›†ç¾¤&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/stop-cluster.sh
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨datastream-apiè¿›è¡Œæ¬ºè¯ˆæ£€æµ‹">ä½¿ç”¨DataStream APIè¿›è¡Œæ¬ºè¯ˆæ£€æµ‹&lt;/h2>
&lt;h3 id="javaçŽ¯å¢ƒ">JavaçŽ¯å¢ƒ&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;project xmlns=&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34; xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
xsi:schemaLocation=&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&amp;gt;
&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
&amp;lt;groupId&amp;gt;frauddetection&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;frauddetection&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;0.1&amp;lt;/version&amp;gt;
&amp;lt;packaging&amp;gt;jar&amp;lt;/packaging&amp;gt;
&amp;lt;name&amp;gt;Flink Walkthrough DataStream Java&amp;lt;/name&amp;gt;
&amp;lt;url&amp;gt;https://flink.apache.org&amp;lt;/url&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;
&amp;lt;flink.version&amp;gt;1.10.2&amp;lt;/flink.version&amp;gt;
&amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;
&amp;lt;scala.binary.version&amp;gt;2.11&amp;lt;/scala.binary.version&amp;gt;
&amp;lt;maven.compiler.source&amp;gt;${java.version}&amp;lt;/maven.compiler.source&amp;gt;
&amp;lt;maven.compiler.target&amp;gt;${java.version}&amp;lt;/maven.compiler.target&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;dependencies&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-walkthrough-common_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- This dependency is provided, because it should not be packaged into the JAR file. --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-streaming-java_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;!-- &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;--&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.18.0&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Add connector dependencies here. They must be in the default scope (compile). --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-connector-kafka-0.10_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Add logging framework, to produce console output when running in the IDE. --&amp;gt;
&amp;lt;!-- These dependencies are excluded from the application JAR by default. --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.7.7&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;log4j&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;log4j&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.2.17&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;!-- Java Compiler --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.1&amp;lt;/version&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;source&amp;gt;${java.version}&amp;lt;/source&amp;gt;
&amp;lt;target&amp;gt;${java.version}&amp;lt;/target&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;!-- We use the maven-shade plugin to create a fat jar that contains all necessary dependencies. --&amp;gt;
&amp;lt;!-- Change the value of &amp;lt;mainClass&amp;gt;...&amp;lt;/mainClass&amp;gt; if your program entry point changes. --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-shade-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.0.0&amp;lt;/version&amp;gt;
&amp;lt;executions&amp;gt;
&amp;lt;!-- Run shade goal on package phase --&amp;gt;
&amp;lt;execution&amp;gt;
&amp;lt;phase&amp;gt;package&amp;lt;/phase&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;shade&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;artifactSet&amp;gt;
&amp;lt;excludes&amp;gt;
&amp;lt;exclude&amp;gt;org.apache.flink:force-shading&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;com.google.code.findbugs:jsr305&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;org.slf4j:*&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;log4j:*&amp;lt;/exclude&amp;gt;
&amp;lt;/excludes&amp;gt;
&amp;lt;/artifactSet&amp;gt;
&amp;lt;filters&amp;gt;
&amp;lt;filter&amp;gt;
&amp;lt;!-- Do not copy the signatures in the META-INF folder.
Otherwise, this might cause SecurityExceptions when using the JAR. --&amp;gt;
&amp;lt;artifact&amp;gt;*:*&amp;lt;/artifact&amp;gt;
&amp;lt;excludes&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.SF&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.DSA&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.RSA&amp;lt;/exclude&amp;gt;
&amp;lt;/excludes&amp;gt;
&amp;lt;/filter&amp;gt;
&amp;lt;/filters&amp;gt;
&amp;lt;transformers&amp;gt;
&amp;lt;transformer implementation=&amp;#34;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&amp;#34;&amp;gt;
&amp;lt;mainClass&amp;gt;spendreport.FraudDetectionJob&amp;lt;/mainClass&amp;gt;
&amp;lt;/transformer&amp;gt;
&amp;lt;/transformers&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/execution&amp;gt;
&amp;lt;/executions&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&amp;lt;pluginManagement&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;!-- This improves the out-of-the-box experience in Eclipse by resolving some warnings. --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.eclipse.m2e&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;lifecycle-mapping&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.0.0&amp;lt;/version&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;lifecycleMappingMetadata&amp;gt;
&amp;lt;pluginExecutions&amp;gt;
&amp;lt;pluginExecution&amp;gt;
&amp;lt;pluginExecutionFilter&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-shade-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;versionRange&amp;gt;[3.0.0,)&amp;lt;/versionRange&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;shade&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;/pluginExecutionFilter&amp;gt;
&amp;lt;action&amp;gt;
&amp;lt;ignore/&amp;gt;
&amp;lt;/action&amp;gt;
&amp;lt;/pluginExecution&amp;gt;
&amp;lt;pluginExecution&amp;gt;
&amp;lt;pluginExecutionFilter&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;versionRange&amp;gt;[3.1,)&amp;lt;/versionRange&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;testCompile&amp;lt;/goal&amp;gt;
&amp;lt;goal&amp;gt;compile&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;/pluginExecutionFilter&amp;gt;
&amp;lt;action&amp;gt;
&amp;lt;ignore/&amp;gt;
&amp;lt;/action&amp;gt;
&amp;lt;/pluginExecution&amp;gt;
&amp;lt;/pluginExecutions&amp;gt;
&amp;lt;/lifecycleMappingMetadata&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&amp;lt;/pluginManagement&amp;gt;
&amp;lt;/build&amp;gt;
&amp;lt;/project&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="è¾“å…¥">è¾“å…¥&lt;/h2>
&lt;h3 id="fileè¾“å…¥">Fileè¾“å…¥&lt;/h3>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
final DataStream&amp;lt;String&amp;gt; stringDataStreamSource = env.readTextFile(&amp;#34;Sensor.txt&amp;#34;);
stringDataStreamSource.print(&amp;#34;data&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;h2 id="kafka">Kafka&lt;/h2>
&lt;p>éœ€è¦å¼•å…¥åŒ…&lt;/p></description><content>&lt;h1 id="flink">Flink&lt;/h1>
&lt;h2 id="å°è¯•flink">å°è¯•flink&lt;/h2>
&lt;h3 id="æœ¬åœ°å®‰è£…">æœ¬åœ°å®‰è£…&lt;/h3>
&lt;p>æ­¥éª¤ä¸€:ä¸‹è½½&lt;/p>
&lt;p>ä¸ºäº†èƒ½å¤Ÿè¿è¡ŒFlinkï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯å®‰è£…æœ‰æ•ˆçš„&lt;strong>Java 8æˆ–11&lt;/strong>ã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥Javaçš„æ­£ç¡®å®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¦å®‰è£…javaçŽ¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>java -version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¸‹è½½è§£åŽ‹flink&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -xzf flink-1.11.2-bin-scala_2.11.tgz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd flink-1.11.2-bin-scala_2.11
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¥éª¤äºŒ:å¯åŠ¨æœ¬åœ°é›†ç¾¤&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/start-cluster.sh
Starting cluster.
Starting standalonesession daemon on host.
Starting taskexecutor daemon on host.
&lt;/code>&lt;/pre>&lt;p>æ­¥éª¤ä¸‰:æäº¤ä¸€ä¸ªjob&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/flink run examples/streaming/WordCount.jar
$ tail log/flink-*-taskexecutor-*.out
(to,1)
(be,1)
(or,1)
(not,1)
(to,2)
(be,2)
&lt;/code>&lt;/pre>&lt;p>æ­¥éª¤å››:åœæ­¢é›†ç¾¤&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ./bin/stop-cluster.sh
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨datastream-apiè¿›è¡Œæ¬ºè¯ˆæ£€æµ‹">ä½¿ç”¨DataStream APIè¿›è¡Œæ¬ºè¯ˆæ£€æµ‹&lt;/h2>
&lt;h3 id="javaçŽ¯å¢ƒ">JavaçŽ¯å¢ƒ&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;project xmlns=&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34; xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
xsi:schemaLocation=&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&amp;gt;
&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
&amp;lt;groupId&amp;gt;frauddetection&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;frauddetection&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;0.1&amp;lt;/version&amp;gt;
&amp;lt;packaging&amp;gt;jar&amp;lt;/packaging&amp;gt;
&amp;lt;name&amp;gt;Flink Walkthrough DataStream Java&amp;lt;/name&amp;gt;
&amp;lt;url&amp;gt;https://flink.apache.org&amp;lt;/url&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;
&amp;lt;flink.version&amp;gt;1.10.2&amp;lt;/flink.version&amp;gt;
&amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;
&amp;lt;scala.binary.version&amp;gt;2.11&amp;lt;/scala.binary.version&amp;gt;
&amp;lt;maven.compiler.source&amp;gt;${java.version}&amp;lt;/maven.compiler.source&amp;gt;
&amp;lt;maven.compiler.target&amp;gt;${java.version}&amp;lt;/maven.compiler.target&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;dependencies&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-walkthrough-common_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- This dependency is provided, because it should not be packaged into the JAR file. --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-streaming-java_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;!-- &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;--&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.18.0&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Add connector dependencies here. They must be in the default scope (compile). --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-connector-kafka-0.10_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Add logging framework, to produce console output when running in the IDE. --&amp;gt;
&amp;lt;!-- These dependencies are excluded from the application JAR by default. --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.7.7&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;log4j&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;log4j&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.2.17&amp;lt;/version&amp;gt;
&amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;!-- Java Compiler --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.1&amp;lt;/version&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;source&amp;gt;${java.version}&amp;lt;/source&amp;gt;
&amp;lt;target&amp;gt;${java.version}&amp;lt;/target&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;!-- We use the maven-shade plugin to create a fat jar that contains all necessary dependencies. --&amp;gt;
&amp;lt;!-- Change the value of &amp;lt;mainClass&amp;gt;...&amp;lt;/mainClass&amp;gt; if your program entry point changes. --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-shade-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.0.0&amp;lt;/version&amp;gt;
&amp;lt;executions&amp;gt;
&amp;lt;!-- Run shade goal on package phase --&amp;gt;
&amp;lt;execution&amp;gt;
&amp;lt;phase&amp;gt;package&amp;lt;/phase&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;shade&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;artifactSet&amp;gt;
&amp;lt;excludes&amp;gt;
&amp;lt;exclude&amp;gt;org.apache.flink:force-shading&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;com.google.code.findbugs:jsr305&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;org.slf4j:*&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;log4j:*&amp;lt;/exclude&amp;gt;
&amp;lt;/excludes&amp;gt;
&amp;lt;/artifactSet&amp;gt;
&amp;lt;filters&amp;gt;
&amp;lt;filter&amp;gt;
&amp;lt;!-- Do not copy the signatures in the META-INF folder.
Otherwise, this might cause SecurityExceptions when using the JAR. --&amp;gt;
&amp;lt;artifact&amp;gt;*:*&amp;lt;/artifact&amp;gt;
&amp;lt;excludes&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.SF&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.DSA&amp;lt;/exclude&amp;gt;
&amp;lt;exclude&amp;gt;META-INF/*.RSA&amp;lt;/exclude&amp;gt;
&amp;lt;/excludes&amp;gt;
&amp;lt;/filter&amp;gt;
&amp;lt;/filters&amp;gt;
&amp;lt;transformers&amp;gt;
&amp;lt;transformer implementation=&amp;#34;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&amp;#34;&amp;gt;
&amp;lt;mainClass&amp;gt;spendreport.FraudDetectionJob&amp;lt;/mainClass&amp;gt;
&amp;lt;/transformer&amp;gt;
&amp;lt;/transformers&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/execution&amp;gt;
&amp;lt;/executions&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&amp;lt;pluginManagement&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;!-- This improves the out-of-the-box experience in Eclipse by resolving some warnings. --&amp;gt;
&amp;lt;plugin&amp;gt;
&amp;lt;groupId&amp;gt;org.eclipse.m2e&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;lifecycle-mapping&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.0.0&amp;lt;/version&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;lifecycleMappingMetadata&amp;gt;
&amp;lt;pluginExecutions&amp;gt;
&amp;lt;pluginExecution&amp;gt;
&amp;lt;pluginExecutionFilter&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-shade-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;versionRange&amp;gt;[3.0.0,)&amp;lt;/versionRange&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;shade&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;/pluginExecutionFilter&amp;gt;
&amp;lt;action&amp;gt;
&amp;lt;ignore/&amp;gt;
&amp;lt;/action&amp;gt;
&amp;lt;/pluginExecution&amp;gt;
&amp;lt;pluginExecution&amp;gt;
&amp;lt;pluginExecutionFilter&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
&amp;lt;versionRange&amp;gt;[3.1,)&amp;lt;/versionRange&amp;gt;
&amp;lt;goals&amp;gt;
&amp;lt;goal&amp;gt;testCompile&amp;lt;/goal&amp;gt;
&amp;lt;goal&amp;gt;compile&amp;lt;/goal&amp;gt;
&amp;lt;/goals&amp;gt;
&amp;lt;/pluginExecutionFilter&amp;gt;
&amp;lt;action&amp;gt;
&amp;lt;ignore/&amp;gt;
&amp;lt;/action&amp;gt;
&amp;lt;/pluginExecution&amp;gt;
&amp;lt;/pluginExecutions&amp;gt;
&amp;lt;/lifecycleMappingMetadata&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&amp;lt;/pluginManagement&amp;gt;
&amp;lt;/build&amp;gt;
&amp;lt;/project&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="è¾“å…¥">è¾“å…¥&lt;/h2>
&lt;h3 id="fileè¾“å…¥">Fileè¾“å…¥&lt;/h3>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
final DataStream&amp;lt;String&amp;gt; stringDataStreamSource = env.readTextFile(&amp;#34;Sensor.txt&amp;#34;);
stringDataStreamSource.print(&amp;#34;data&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;h2 id="kafka">Kafka&lt;/h2>
&lt;p>éœ€è¦å¼•å…¥åŒ…&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;flink-connector-kafka-0.10_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${flink.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
// é…ç½®kafka,è´¦å·å¯†ç 
final Properties properties = new Properties();
final DataStreamSource&amp;lt;String&amp;gt; sensor = env.addSource(new FlinkKafkaConsumer010&amp;lt;String&amp;gt;(&amp;#34;sensor&amp;#34;, new SimpleStringSchema(), properties));
sensor.print(&amp;#34;data&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;h2 id="é›†åˆèŽ·å–">é›†åˆèŽ·å–&lt;/h2>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
DataStream&amp;lt;SensorReading&amp;gt; dataStreamSource = env.fromCollection(Arrays.asList(
new SensorReading(&amp;#34;sen1&amp;#34;, 1l, 37.5),
new SensorReading(&amp;#34;sen2&amp;#34;, 2l, 38.5),
new SensorReading(&amp;#34;sen3&amp;#34;, 3l, 39.5),
new SensorReading(&amp;#34;sen4&amp;#34;, 4l, 40.5)));
final DataStreamSource&amp;lt;Integer&amp;gt; integerDataStreamSource = env.fromElements(11, 12, 13, 14, 15);
dataStreamSource.print(&amp;#34;data&amp;#34;);
integerDataStreamSource.print(&amp;#34;my list&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;h2 id="è¾“å‡º">è¾“å‡º&lt;/h2>
&lt;h2 id="è‡ªå®šä¹‰æ•°æ®æº">è‡ªå®šä¹‰æ•°æ®æº&lt;/h2>
&lt;p>æ¨¡æ‹Ÿä»Žkafkaä¸­èŽ·å–&lt;/p>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
// kafkaé…ç½®
final Properties properties = new Properties();
// åŠ å…¥è‡ªå®šä¹‰çš„æ•°æ®æº
final DataStreamSource sensor = env.addSource(new MySensorce());
sensor.print(&amp;#34;data&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;p>è‡ªå®šä¹‰æ•°æ®æº&lt;/p>
&lt;pre tabindex="0">&lt;code>public class MySensorce implements SourceFunction&amp;lt;SensorReading&amp;gt; {
private boolean running = true;
@Override
public void run(SourceContext&amp;lt;SensorReading&amp;gt; sourceContext) throws Exception {
final Random random = new Random();
final HashMap&amp;lt;String, Double&amp;gt; stringDoubleHashMap = new HashMap&amp;lt;&amp;gt;();
for (int i = 1; i &amp;lt; 11; i++) {
stringDoubleHashMap.put(i + &amp;#34;&amp;#34;, random.nextGaussian());
}
while (running) {
for (String id : stringDoubleHashMap.keySet()) {
final double v = stringDoubleHashMap.get(id) + random.nextGaussian();
final SensorReading sensorReading = new SensorReading(id, System.currentTimeMillis(), v);
sourceContext.collect(sensorReading);
}
Thread.sleep(1000);
}
}
@Override
public void cancel() {
running = false;
}
}
&lt;/code>&lt;/pre>&lt;h2 id="ç®—å­">ç®—å­&lt;/h2>
&lt;h3 id="åŸºæœ¬ç®—å­">åŸºæœ¬ç®—å­&lt;/h3>
&lt;h4 id="map">map&lt;/h4>
&lt;pre tabindex="0">&lt;code>final SingleOutputStreamOperator&amp;lt;Integer&amp;gt; map = inputStream.map(new MapFunction&amp;lt;String, Integer&amp;gt;() {
@Override
public Integer map(String s) throws Exception {
return s.length();
}
});
&lt;/code>&lt;/pre>&lt;h4 id="flatmap">flatmap&lt;/h4>
&lt;pre tabindex="0">&lt;code>final SingleOutputStreamOperator&amp;lt;String&amp;gt; stringSingleOutputStreamOperator = inputStream.flatMap(new FlatMapFunction&amp;lt;String, String&amp;gt;() {
@Override
public void flatMap(String s, Collector&amp;lt;String&amp;gt; collector) throws Exception {
Arrays.stream(s.split(&amp;#34;,&amp;#34;)).forEach(collector::collect);
}
});
&lt;/code>&lt;/pre>&lt;h4 id="filter">filter&lt;/h4>
&lt;pre tabindex="0">&lt;code>final SingleOutputStreamOperator&amp;lt;String&amp;gt; filter = inputStream.filter(new FilterFunction&amp;lt;String&amp;gt;() {
@Override
public boolean filter(String s) throws Exception {
return s.startsWith(&amp;#34;sen&amp;#34;);
}
});
&lt;/code>&lt;/pre>&lt;h3 id="åˆ†æµåˆæµ">åˆ†æµ,åˆæµ&lt;/h3>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
final DataStream&amp;lt;String&amp;gt; inputStream = env.readTextFile(&amp;#34;Sensor.txt&amp;#34;);
final DataStream&amp;lt;SensorReading&amp;gt; map = inputStream.map(line -&amp;gt; {
final String[] split = line.split(&amp;#34;,&amp;#34;);
return new SensorReading(split[0], Long.parseLong(split[1]), Double.parseDouble(split[2]));
});
// åˆ†æµ
final SplitStream&amp;lt;SensorReading&amp;gt; split = map.split(new OutputSelector&amp;lt;SensorReading&amp;gt;() {
@Override
public Iterable&amp;lt;String&amp;gt; select(SensorReading value) {
return value.getTemp() &amp;gt; 30 ? Collections.singletonList(&amp;#34;hight&amp;#34;) : Collections.singletonList(&amp;#34;low&amp;#34;);
}
});
final DataStream&amp;lt;SensorReading&amp;gt; hight = split.select(&amp;#34;hight&amp;#34;);
final DataStream&amp;lt;SensorReading&amp;gt; low = split.select(&amp;#34;low&amp;#34;);
final DataStream&amp;lt;SensorReading&amp;gt; all = split.select(&amp;#34;low&amp;#34;,&amp;#34;hight&amp;#34;);
hight.print(&amp;#34;hight&amp;#34;);
low.print(&amp;#34;low&amp;#34;);
all.print(&amp;#34;all&amp;#34;);
final SingleOutputStreamOperator&amp;lt;Tuple2&amp;lt;String, Double&amp;gt;&amp;gt; warningStream = hight.map(new MapFunction&amp;lt;SensorReading, Tuple2&amp;lt;String, Double&amp;gt;&amp;gt;() {
@Override
public Tuple2&amp;lt;String, Double&amp;gt; map(SensorReading sensorReading) throws Exception {
return new Tuple2&amp;lt;&amp;gt;(sensorReading.getId(), sensorReading.getTemp());
}
});
final ConnectedStreams&amp;lt;Tuple2&amp;lt;String, Double&amp;gt;, SensorReading&amp;gt; connectedStreams = warningStream.connect(low);
// åˆæµ
final SingleOutputStreamOperator&amp;lt;Object&amp;gt; result = connectedStreams.map(new CoMapFunction&amp;lt;Tuple2&amp;lt;String, Double&amp;gt;, SensorReading, Object&amp;gt;() {
@Override
public Object map1(Tuple2&amp;lt;String, Double&amp;gt; value) throws Exception {
return new Tuple3&amp;lt;&amp;gt;(value.f0, value.f1, &amp;#34;é«˜æ¸©æŠ¥è­¦&amp;#34;);
}
@Override
public Object map2(SensorReading value) throws Exception {
return new Tuple2&amp;lt;&amp;gt;(value.getId(), &amp;#34;æ­£å¸¸&amp;#34;);
}
});
// ç¬¬äºŒç§æ–¹æ³•,ubion
final DataStream&amp;lt;SensorReading&amp;gt; union = hight.union(low);
result.print();
union.print(&amp;#34;ubion&amp;#34;);
env.execute();
}
&lt;/code>&lt;/pre>&lt;h3 id="å¯Œå‡½æ•°">å¯Œå‡½æ•°&lt;/h3>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
final DataStream&amp;lt;String&amp;gt; inputStream = env.readTextFile(&amp;#34;Sensor.txt&amp;#34;);
final DataStream&amp;lt;SensorReading&amp;gt; map = inputStream.map(line -&amp;gt; {
final String[] split = line.split(&amp;#34;,&amp;#34;);
return new SensorReading(split[0], Long.parseLong(split[1]), Double.parseDouble(split[2]));
});
DataStream&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; resultStream = map.map(new RichMyMapper());
resultStream.print();
env.execute();
}
public static class MyMapper implements MapFunction&amp;lt;SensorReading, Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; {
@Override
public Tuple2&amp;lt;String, Integer&amp;gt; map(SensorReading sensorReading) throws Exception {
return new Tuple2&amp;lt;&amp;gt;(sensorReading.getId(), sensorReading.getId().length());
}
}
// è‡ªå®šä¹‰å¯Œå‡½æ•°
public static class RichMyMapper extends RichMapFunction&amp;lt;SensorReading, Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; {
@Override
public Tuple2&amp;lt;String, Integer&amp;gt; map(SensorReading value) throws Exception {
// getRuntimeContext().getState();
return new Tuple2&amp;lt;&amp;gt;(value.getId(), getRuntimeContext().getIndexOfThisSubtask());
}
@Override
public void open(Configuration parameters) throws Exception {
// ç”¨æ¥å»ºç«‹æ•°æ®åº“è¿žæŽ¥
super.open(parameters);
}
@Override
public void close() throws Exception {
// å…³é—­æ•°æ®åº“
super.close();
}
}
&lt;/code>&lt;/pre>&lt;h3 id="åˆ†ç»„èšåˆ">åˆ†ç»„,èšåˆ&lt;/h3>
&lt;pre tabindex="0">&lt;code>public static void main(String[] args) throws Exception {
final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
final DataStream&amp;lt;String&amp;gt; inputStream = env.readTextFile(&amp;#34;Sensor.txt&amp;#34;);
final DataStream&amp;lt;SensorReading&amp;gt; map = inputStream.map(line -&amp;gt; {
final String[] split = line.split(&amp;#34;,&amp;#34;);
return new SensorReading(split[0], Long.parseLong(split[1]), Double.parseDouble(split[2]));
});
// åˆ†ç»„
// final KeyedStream&amp;lt;SensorReading, Tuple&amp;gt; id = map.keyBy(&amp;#34;id&amp;#34;);
final KeyedStream&amp;lt;SensorReading, String&amp;gt; keyedStream = map.keyBy(SensorReading::getId);
// reduce
final SingleOutputStreamOperator&amp;lt;SensorReading&amp;gt; reduce = keyedStream.reduce(new ReduceFunction&amp;lt;SensorReading&amp;gt;() {
@Override
public SensorReading reduce(SensorReading valu1, SensorReading valu2) throws Exception {
return new SensorReading(valu1.getId(), valu2.getTimestamp(), Math.max(valu1.getTemp(), valu2.getTemp()));
}
});
reduce.print();
env.execute();
}
&lt;/code>&lt;/pre></content></item><item><title>Java</title><link>https://connorzhangyu.com/posts/java/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/java/</guid><description>&lt;h1 id="åŸºç¡€çŸ¥è¯†ç‚¹">åŸºç¡€çŸ¥è¯†ç‚¹&lt;/h1>
&lt;p>&lt;strong>å¾ªçŽ¯æ ‡ç­¾&lt;/strong>&lt;/p>
&lt;p>å¦‚æžœä¸åœ¨åµŒå¥—å¾ªçŽ¯ä¸­ä½¿ç”¨,ç”¨äº†è·³è½¬,ä¹Ÿå°±ç›¸å½“äºŽ&lt;code>continue&lt;/code>ä¸€æ ·,æ²¡æœ‰åŒºåˆ«&lt;/p>
&lt;p>åœ¨åµŒå¥—å¾ªçŽ¯ä¸­ä½¿ç”¨æ‰æœ‰æ•ˆæžœ,ç”¨äº†&lt;code>innerLoop&lt;/code>ä¹‹åŽ,å¯ä»¥çœ‹åˆ°&lt;/p>
&lt;ul>
&lt;li>j=2 çš„æ—¶å€™æ˜¯ä¸æ‰“å°&lt;/li>
&lt;li>j=3,ç¨‹åºä¸ä¼šåˆ°j=3çš„æ—¶å€™,å› ä¸ºj=2çš„æ—¶å€™å°±å·²ç»è·³å‡ºåŽ»äº†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * -------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> innerLoop:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 3; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> 0; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> 4; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (j &lt;span style="color:#f92672">==&lt;/span> 2) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span> innerLoop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(i&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;====&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="javaå¸¸ç”¨çš„apiæ–¹æ³•">Javaå¸¸ç”¨çš„APIæ–¹æ³•&lt;/h1>
&lt;h2 id="é›†åˆåˆ—è¡¨æ•°ç»„map">é›†åˆ/åˆ—è¡¨/æ•°ç»„/Map&lt;/h2>
&lt;h3 id="æ•°ç»„æ‹¼æŽ¥">æ•°ç»„æ‹¼æŽ¥&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠæ•°ç»„é£Žæ ¼,å†å¾ªçŽ¯æ·»åŠ é€—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>String&lt;span style="color:#f92672">[]&lt;/span> split &lt;span style="color:#f92672">=&lt;/span> result.&lt;span style="color:#a6e22e">split&lt;/span>(&lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StringJoiner stringJoiner &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> StringJoiner(&lt;span style="color:#e6db74">&amp;#34;,&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Arrays.&lt;span style="color:#a6e22e">stream&lt;/span>(split).&lt;span style="color:#a6e22e">forEach&lt;/span>(stringJoiner::add);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å­—ç¬¦ä¸²æ•°ç»„æ•°å­—,è½¬æˆintç±»åž‹,å†è½¬æˆæ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Arrays.&lt;span style="color:#a6e22e">stream&lt;/span>(split).&lt;span style="color:#a6e22e">mapToInt&lt;/span>(Integer::parseInt).&lt;span style="color:#a6e22e">toArray&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// BigDecimalæƒ³åŠ ,ç„¶åŽå¦‚æžœä¸ºç©º,å°±ç»™ä¸ª0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BigDecimal winAmount &lt;span style="color:#f92672">=&lt;/span> list.&lt;span style="color:#a6e22e">stream&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">map&lt;/span>(UserBetOrderRecord::getWinAmount)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">reduce&lt;/span>(BigDecimal::add)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">map&lt;/span>(bigDecimal &lt;span style="color:#f92672">-&amp;gt;&lt;/span> bigDecimal.&lt;span style="color:#a6e22e">multiply&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(&lt;span style="color:#e6db74">&amp;#34;-1&amp;#34;&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">orElse&lt;/span>(BigDecimal.&lt;span style="color:#a6e22e">ZERO&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ•°ç»„è½¬é›†åˆ">æ•°ç»„è½¬é›†åˆ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span>{4, 3, 2, 1, 12, 21, 11};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿™æ ·è½¬æ˜¯æœ‰é—®é¢˜çš„,ä¸æ˜¯æƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// java.util.array&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> Arrays.&lt;span style="color:#a6e22e">asList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(list);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨Hutoolçš„æ–¹æ³•,ä¹Ÿä¸æ­»æƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// cn.hutool.core.collection&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&amp;gt;&lt;/span> ints &lt;span style="color:#f92672">=&lt;/span> CollectionUtil.&lt;span style="color:#a6e22e">newArrayList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ints);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨Springçš„å·¥å…·åŒ…,éœ€è¦å¼ºè½¬,å¼ºè¿«ç—‡å—ä¸äº†è¿™ç§æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// org.springframework.util.CollectionUtils&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> objects &lt;span style="color:#f92672">=&lt;/span> (List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span>) CollectionUtils.&lt;span style="color:#a6e22e">arrayToList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(objects);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ‰“å°æ•°ç»„é›†åˆmap">æ‰“å°æ•°ç»„/é›†åˆ/Map&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> {1, 2, 3, 4, 5};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(arr); &lt;span style="color:#75715e">// [I@17211155&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(Arrays.&lt;span style="color:#a6e22e">toString&lt;/span>(arr)); &lt;span style="color:#75715e">// [1, 2, 3, 4, 5]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> integers &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(integers); &lt;span style="color:#75715e">// [1, 2, 3]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> integerStringHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(1, &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(2, &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(3, &lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(integerStringHashMap); &lt;span style="color:#75715e">// {1=a, 2=b, 3=c}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ•°ç»„æˆªå–">æ•°ç»„æˆªå–&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// java.util.Arrays&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»Ž0å¼€å§‹,å–å‡º6ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> {1, 2, 3, 4, 5, 6};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> ints &lt;span style="color:#f92672">=&lt;/span> Arrays.&lt;span style="color:#a6e22e">copyOfRange&lt;/span>(arr, 0, 6);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(Arrays.&lt;span style="color:#a6e22e">toString&lt;/span>(ints));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ ¼å¼åŒ–">æ ¼å¼åŒ–&lt;/h2>
&lt;h3 id="æ•°å€¼æ ¼å¼åŒ–">æ•°å€¼æ ¼å¼åŒ–&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String format &lt;span style="color:#f92672">=&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%02d&amp;#34;&lt;/span>, 2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(format); &lt;span style="color:#75715e">// 02&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String format2 &lt;span style="color:#f92672">=&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%02d&amp;#34;&lt;/span>, 20);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(format2); &lt;span style="color:#75715e">// 20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ•°å­¦">æ•°å­¦&lt;/h2>
&lt;h3 id="ä½™æ•°å–æ¨¡">ä½™æ•°/å–æ¨¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> 5;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> 3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ % è¿ç®—ç¬¦å–ä½™æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> remainder &lt;span style="color:#f92672">=&lt;/span> a &lt;span style="color:#f92672">%&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(remainder); &lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ Math.floorMod() æ–¹æ³•å–ä½™æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> floorMod &lt;span style="color:#f92672">=&lt;/span> Math.&lt;span style="color:#a6e22e">floorMod&lt;/span>(a, b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(floorMod); &lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="bigdecimalæ¯”è¾ƒ">BigDecimalæ¯”è¾ƒ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(10);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(5);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1: &lt;span style="color:#75715e">// å°äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;lt; b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 0: &lt;span style="color:#75715e">// ç­‰äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a = b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 1: &lt;span style="color:#75715e">// å¤§äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;gt; b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a != b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;gt;= b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;lt;= b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ—¶é—´ç±»åž‹æ¯”è¾ƒ">æ—¶é—´ç±»åž‹æ¯”è¾ƒ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> ParseException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SimpleDateFormat sdf &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SimpleDateFormat(&lt;span style="color:#e6db74">&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date begin &lt;span style="color:#f92672">=&lt;/span> sdf.&lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2020-01-01 00:01:00&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date end &lt;span style="color:#f92672">=&lt;/span> sdf.&lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2020-01-01 00:02:00&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨compareToæ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">compareTo&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´å¤§äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 0:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´ç­‰äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 1:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´å°äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨beforeå’Œafteræ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">before&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">after&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’">å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, User&lt;span style="color:#f92672">&amp;gt;&lt;/span> ingUserHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, User&lt;span style="color:#f92672">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User user &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> User();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user.&lt;span style="color:#a6e22e">setId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ingUserHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(1, user);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// {1=User(id=1, bigDecimal=10)}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ingUserHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žmapé‡Œå–å€¼,ç„¶åŽå†ä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User user1 &lt;span style="color:#f92672">=&lt;/span> ingUserHashMap.&lt;span style="color:#a6e22e">get&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user1.&lt;span style="color:#a6e22e">setBigDecimal&lt;/span>(BigDecimal.&lt;span style="color:#a6e22e">ONE&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰“å°mapæ˜¯ä¿®æ”¹äº†çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// {1=User(id=1, bigDecimal=1)}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ingUserHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@ToString&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">User&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal bigDecimal &lt;span style="color:#f92672">=&lt;/span> BigDecimal.&lt;span style="color:#a6e22e">TEN&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="lambda">Lambda&lt;/h2>
&lt;p>ç»™é›†åˆåˆ†ç»„&lt;/p></description><content>&lt;h1 id="åŸºç¡€çŸ¥è¯†ç‚¹">åŸºç¡€çŸ¥è¯†ç‚¹&lt;/h1>
&lt;p>&lt;strong>å¾ªçŽ¯æ ‡ç­¾&lt;/strong>&lt;/p>
&lt;p>å¦‚æžœä¸åœ¨åµŒå¥—å¾ªçŽ¯ä¸­ä½¿ç”¨,ç”¨äº†è·³è½¬,ä¹Ÿå°±ç›¸å½“äºŽ&lt;code>continue&lt;/code>ä¸€æ ·,æ²¡æœ‰åŒºåˆ«&lt;/p>
&lt;p>åœ¨åµŒå¥—å¾ªçŽ¯ä¸­ä½¿ç”¨æ‰æœ‰æ•ˆæžœ,ç”¨äº†&lt;code>innerLoop&lt;/code>ä¹‹åŽ,å¯ä»¥çœ‹åˆ°&lt;/p>
&lt;ul>
&lt;li>j=2 çš„æ—¶å€™æ˜¯ä¸æ‰“å°&lt;/li>
&lt;li>j=3,ç¨‹åºä¸ä¼šåˆ°j=3çš„æ—¶å€™,å› ä¸ºj=2çš„æ—¶å€™å°±å·²ç»è·³å‡ºåŽ»äº†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * -------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 0====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 2====3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> innerLoop:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 3; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> 0; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> 4; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (j &lt;span style="color:#f92672">==&lt;/span> 2) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span> innerLoop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(i&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;====&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="javaå¸¸ç”¨çš„apiæ–¹æ³•">Javaå¸¸ç”¨çš„APIæ–¹æ³•&lt;/h1>
&lt;h2 id="é›†åˆåˆ—è¡¨æ•°ç»„map">é›†åˆ/åˆ—è¡¨/æ•°ç»„/Map&lt;/h2>
&lt;h3 id="æ•°ç»„æ‹¼æŽ¥">æ•°ç»„æ‹¼æŽ¥&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠæ•°ç»„é£Žæ ¼,å†å¾ªçŽ¯æ·»åŠ é€—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>String&lt;span style="color:#f92672">[]&lt;/span> split &lt;span style="color:#f92672">=&lt;/span> result.&lt;span style="color:#a6e22e">split&lt;/span>(&lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StringJoiner stringJoiner &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> StringJoiner(&lt;span style="color:#e6db74">&amp;#34;,&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Arrays.&lt;span style="color:#a6e22e">stream&lt;/span>(split).&lt;span style="color:#a6e22e">forEach&lt;/span>(stringJoiner::add);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å­—ç¬¦ä¸²æ•°ç»„æ•°å­—,è½¬æˆintç±»åž‹,å†è½¬æˆæ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Arrays.&lt;span style="color:#a6e22e">stream&lt;/span>(split).&lt;span style="color:#a6e22e">mapToInt&lt;/span>(Integer::parseInt).&lt;span style="color:#a6e22e">toArray&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// BigDecimalæƒ³åŠ ,ç„¶åŽå¦‚æžœä¸ºç©º,å°±ç»™ä¸ª0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BigDecimal winAmount &lt;span style="color:#f92672">=&lt;/span> list.&lt;span style="color:#a6e22e">stream&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">map&lt;/span>(UserBetOrderRecord::getWinAmount)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">reduce&lt;/span>(BigDecimal::add)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">map&lt;/span>(bigDecimal &lt;span style="color:#f92672">-&amp;gt;&lt;/span> bigDecimal.&lt;span style="color:#a6e22e">multiply&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(&lt;span style="color:#e6db74">&amp;#34;-1&amp;#34;&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">orElse&lt;/span>(BigDecimal.&lt;span style="color:#a6e22e">ZERO&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ•°ç»„è½¬é›†åˆ">æ•°ç»„è½¬é›†åˆ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span>{4, 3, 2, 1, 12, 21, 11};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿™æ ·è½¬æ˜¯æœ‰é—®é¢˜çš„,ä¸æ˜¯æƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// java.util.array&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> Arrays.&lt;span style="color:#a6e22e">asList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(list);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨Hutoolçš„æ–¹æ³•,ä¹Ÿä¸æ­»æƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// cn.hutool.core.collection&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&amp;gt;&lt;/span> ints &lt;span style="color:#f92672">=&lt;/span> CollectionUtil.&lt;span style="color:#a6e22e">newArrayList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ints);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨Springçš„å·¥å…·åŒ…,éœ€è¦å¼ºè½¬,å¼ºè¿«ç—‡å—ä¸äº†è¿™ç§æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// org.springframework.util.CollectionUtils&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> objects &lt;span style="color:#f92672">=&lt;/span> (List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span>) CollectionUtils.&lt;span style="color:#a6e22e">arrayToList&lt;/span>(arr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(objects);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ‰“å°æ•°ç»„é›†åˆmap">æ‰“å°æ•°ç»„/é›†åˆ/Map&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> {1, 2, 3, 4, 5};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(arr); &lt;span style="color:#75715e">// [I@17211155&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(Arrays.&lt;span style="color:#a6e22e">toString&lt;/span>(arr)); &lt;span style="color:#75715e">// [1, 2, 3, 4, 5]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> integers &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integers.&lt;span style="color:#a6e22e">add&lt;/span>(3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(integers); &lt;span style="color:#75715e">// [1, 2, 3]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, String&lt;span style="color:#f92672">&amp;gt;&lt;/span> integerStringHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(1, &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(2, &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> integerStringHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(3, &lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(integerStringHashMap); &lt;span style="color:#75715e">// {1=a, 2=b, 3=c}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ•°ç»„æˆªå–">æ•°ç»„æˆªå–&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// java.util.Arrays&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»Ž0å¼€å§‹,å–å‡º6ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> arr &lt;span style="color:#f92672">=&lt;/span> {1, 2, 3, 4, 5, 6};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> ints &lt;span style="color:#f92672">=&lt;/span> Arrays.&lt;span style="color:#a6e22e">copyOfRange&lt;/span>(arr, 0, 6);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(Arrays.&lt;span style="color:#a6e22e">toString&lt;/span>(ints));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ ¼å¼åŒ–">æ ¼å¼åŒ–&lt;/h2>
&lt;h3 id="æ•°å€¼æ ¼å¼åŒ–">æ•°å€¼æ ¼å¼åŒ–&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String format &lt;span style="color:#f92672">=&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%02d&amp;#34;&lt;/span>, 2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(format); &lt;span style="color:#75715e">// 02&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String format2 &lt;span style="color:#f92672">=&lt;/span> String.&lt;span style="color:#a6e22e">format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%02d&amp;#34;&lt;/span>, 20);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(format2); &lt;span style="color:#75715e">// 20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ•°å­¦">æ•°å­¦&lt;/h2>
&lt;h3 id="ä½™æ•°å–æ¨¡">ä½™æ•°/å–æ¨¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> 5;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> 3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ % è¿ç®—ç¬¦å–ä½™æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> remainder &lt;span style="color:#f92672">=&lt;/span> a &lt;span style="color:#f92672">%&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(remainder); &lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ Math.floorMod() æ–¹æ³•å–ä½™æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> floorMod &lt;span style="color:#f92672">=&lt;/span> Math.&lt;span style="color:#a6e22e">floorMod&lt;/span>(a, b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(floorMod); &lt;span style="color:#75715e">// 2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="bigdecimalæ¯”è¾ƒ">BigDecimalæ¯”è¾ƒ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(10);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BigDecimal(5);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1: &lt;span style="color:#75715e">// å°äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;lt; b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 0: &lt;span style="color:#75715e">// ç­‰äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a = b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 1: &lt;span style="color:#75715e">// å¤§äºŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;gt; b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a != b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;gt;= b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a.&lt;span style="color:#a6e22e">compareTo&lt;/span>(b) &lt;span style="color:#f92672">!=&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a &amp;lt;= b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ—¶é—´ç±»åž‹æ¯”è¾ƒ">æ—¶é—´ç±»åž‹æ¯”è¾ƒ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> ParseException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SimpleDateFormat sdf &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SimpleDateFormat(&lt;span style="color:#e6db74">&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date begin &lt;span style="color:#f92672">=&lt;/span> sdf.&lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2020-01-01 00:01:00&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date end &lt;span style="color:#f92672">=&lt;/span> sdf.&lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2020-01-01 00:02:00&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨compareToæ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">compareTo&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">-&lt;/span>1:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´å¤§äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 0:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´ç­‰äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> 1:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹æ—¶é—´å°äºŽç»“æŸæ—¶é—´&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨beforeå’Œafteræ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">before&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> begin.&lt;span style="color:#a6e22e">after&lt;/span>(end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’">å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, User&lt;span style="color:#f92672">&amp;gt;&lt;/span> ingUserHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, User&lt;span style="color:#f92672">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User user &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> User();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user.&lt;span style="color:#a6e22e">setId&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ingUserHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(1, user);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// {1=User(id=1, bigDecimal=10)}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ingUserHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žmapé‡Œå–å€¼,ç„¶åŽå†ä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User user1 &lt;span style="color:#f92672">=&lt;/span> ingUserHashMap.&lt;span style="color:#a6e22e">get&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user1.&lt;span style="color:#a6e22e">setBigDecimal&lt;/span>(BigDecimal.&lt;span style="color:#a6e22e">ONE&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰“å°mapæ˜¯ä¿®æ”¹äº†çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// {1=User(id=1, bigDecimal=1)}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(ingUserHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@ToString&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">User&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BigDecimal bigDecimal &lt;span style="color:#f92672">=&lt;/span> BigDecimal.&lt;span style="color:#a6e22e">TEN&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="lambda">Lambda&lt;/h2>
&lt;p>ç»™é›†åˆåˆ†ç»„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ArrayList&lt;span style="color:#f92672">&amp;lt;&lt;/span>User&lt;span style="color:#f92672">&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> User(1, &lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> User(2, &lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> User(1, &lt;span style="color:#e6db74">&amp;#34;didid&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŒ‰ç…§ç”¨æˆ·Idåˆ†ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer, List&lt;span style="color:#f92672">&amp;lt;&lt;/span>User&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> collect &lt;span style="color:#f92672">=&lt;/span> list.&lt;span style="color:#a6e22e">stream&lt;/span>().&lt;span style="color:#a6e22e">collect&lt;/span>(Collectors.&lt;span style="color:#a6e22e">groupingBy&lt;/span>(User::getId));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// {1=[User(id=1, name=anthony), User(id=1, name=didid)], 2=[User(id=2, name=anthony)]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(collect);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1==[User(id=1, name=anthony), User(id=1, name=didid)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2==[User(id=2, name=anthony)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> collect.&lt;span style="color:#a6e22e">forEach&lt;/span>((id,userList)&lt;span style="color:#f92672">-&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(id&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;==&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>userList);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@AllArgsConstructor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">User&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="threadlocal">ThreadLocal&lt;/h1>
&lt;p>&lt;a href="https://juejin.cn/post/7126708538440679460#heading-13">æŽ˜é‡‘&lt;/a>&lt;/p>
&lt;h1 id="hashmap">HashMap&lt;/h1>
&lt;p>é¢è¯•å…«è‚¡æ–‡&amp;hellip;.&lt;/p>
&lt;p>&lt;strong>HashMapå’ŒHashTableçš„åŒºåˆ«&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>HashMap&lt;/th>
&lt;th>HashTable&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>nullå€¼&lt;/td>
&lt;td>å…è®¸key,valueä¸ºnull,ä½†æœ€å¤šå…è®¸ä¸€æ¡è®°å½•çš„keyä¸ºnull&lt;/td>
&lt;td>ä¸å…è®¸æœ‰null&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å®‰å…¨æ€§&lt;/td>
&lt;td>ä¸å®‰å…¨,&lt;br />Collections.synchronizedMapæ–¹æ³•ï¼Œä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›&lt;/td>
&lt;td>çº¿ç¨‹å®‰å…¨çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>éåŽ†&lt;/td>
&lt;td>Iterator è¿›è¡ŒéåŽ†&lt;/td>
&lt;td>ä½¿ç”¨ Enumeration è¿›è¡ŒéåŽ†&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>è´Ÿè½½å› å­&lt;/strong>&lt;/p>
&lt;p>è´Ÿè½½å› å­å’Œæ‰©å®¹æœºåˆ¶æœ‰å…³,æ„æ€æ˜¯å¦‚æžœå½“å‰å®¹å™¨çš„å®¹é‡,è¾¾åˆ°æˆ‘ä»¬è®¾ç½®çš„å®šæœ€å¤§å€¼,å°±è¦å¼€å§‹æ‰©å®¹&lt;/p>
&lt;blockquote>
&lt;p>æ¯”å¦‚è¯´å½“å‰çš„å®¹å™¨å®¹é‡æ˜¯16ï¼Œè´Ÿè½½å› å­æ˜¯0.75,16*0.75=12ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å®¹é‡è¾¾åˆ°äº†12çš„æ—¶å€™å°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œã€‚&lt;/p>&lt;/blockquote>
&lt;p>è´Ÿè½½å› å­æ˜¯1çš„æ—¶å€™:&lt;/p>
&lt;p>åªæœ‰å½“æ•°ç»„çš„16ä¸ªä¸€ç›´éƒ½å¡«æ»¡äº†,æ‰å›žæ‰©å®¹,å› æ­¤åœ¨å¡«æ»¡çš„è¿‡ç¨‹ä¸­,Hashå†²çªæ˜¯é¿å…ä¸äº†çš„,ä¹Ÿå°±æ„å‘³ç€ä¼šå‡ºçŽ°å¤§é‡çš„Hashå†²çª,åº•å±‚çš„çº¢é»‘æ ‘å°±å˜å¾—å¤æ‚,è¿™ç§å°±ç‰ºç‰²äº†æ—¶é—´,ä¿è¯ç©ºé—´çš„åˆ©ç”¨çŽ‡&lt;/p>
&lt;p>è´Ÿè½½å› ä¸ºæ˜¯0.5çš„æ—¶å€™:&lt;/p>
&lt;p>å½“åˆ°è¾¾æ•°ç»„ä¸€åŠçš„å°±å¼€å§‹æ‰©å®¹,æ—¢ç„¶å¡«å……çš„å…ƒç´ å°‘äº†,Hashå†²çªå°±å˜å°‘,é‚£ä¹ˆåº•å±‚çš„é“¾è¡¨é•¿åº¦å’Œçº¢é»‘æ•°ä¹Ÿå°±å˜å°‘,æŸ¥è¯¢æ•ˆçŽ‡å°±é«˜, åŽŸæœ¬å­˜å‚¨1Mçš„æ•°æ®,çŽ°åœ¨éœ€è¦2M,æ—¶é—´æ•ˆçŽ‡æå‡äº†,ä½†æ˜¯ç©ºé—´åˆ©ç”¨çŽ‡é™ä½Žäº†&lt;/p>
&lt;p>&lt;strong>ä¸åŒJDKç‰ˆæœ¬HashMapçš„åŒºåˆ«&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ç»„æˆ&lt;/td>
&lt;td>æ•°ç»„+é“¾è¡¨&lt;/td>
&lt;td>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>hash å€¼æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°æ•°ç»„çš„å…·ä½“ä¸‹æ ‡ï¼Œä½†æ˜¯ä¹‹åŽçš„è¯ï¼Œ éœ€è¦é¡ºç€é“¾è¡¨ä¸€ä¸ªä¸ªæ¯”è¾ƒä¸‹åŽ»æ‰èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ï¼Œæ—¶é—´å¤æ‚åº¦å–å†³äºŽé“¾è¡¨çš„é•¿åº¦&lt;/td>
&lt;td>å½“æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>**é“¾è¡¨è½¬çº¢é»‘æ ‘è¦æ»¡è¶³çš„æ¡ä»¶ **&lt;/p>
&lt;ol>
&lt;li>
&lt;p>é“¾è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°&amp;gt;=8,ä¸ºä»€ä¹ˆ?&lt;/p>
&lt;p>å’Œhashcodeç¢°æ’žæ¬¡æ•°çš„æ³Šæ¾åˆ†å¸ƒæœ‰å…³,ä¸»è¦æ˜¯ä¸ºäº†å¯»æ‰¾ä¸€ç§æ—¶é—´å’Œç©ºé—´çš„å¹³è¡¡&lt;/p>
&lt;p>çº¢é»‘æ•°çš„TreeNode æ˜¯ é“¾è¡¨ä¸­çš„Nodeæ‰€å ç©ºé—´çš„2å€,è™½ç„¶çº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆçŽ‡è¦é«˜äºŽé“¾è¡¨,
ä½†æ˜¯,å½“é“¾è¡¨é•¿åº¦æ¯”è¾ƒå°çš„æ—¶å€™,å³ä½¿å…¨éƒ¨éåŽ†,æ—¶é—´å¤æ‚åº¦ä¹Ÿä¸ä¼šå¤ªé«˜&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆæ˜¯8,JDKæºç ä¹Ÿæ²¡æœ‰è¯´,åªæ˜¯è¯´åšäº†å¾ˆå¤šæ—¶é—´,ç»éªŒçš„é—®é¢˜&lt;/p>
&lt;p>çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜€å€¼æ˜¯6,å› ä¸º:é¿å…çº¢é»‘æ ‘å’Œé“¾è¡¨é¢‘ç¹è½¬æ¢&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“å‰æ•°ç»„çš„é•¿åº¦&amp;gt;=64,ä¸ºä»€ä¹ˆ?&lt;/p>
&lt;p>é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³é“¾è¡¨è¿‡é•¿,å¯¼è‡´æŸ¥è¯¢å’Œæ’å…¥çš„æ•ˆçŽ‡æ…¢çš„é—®é¢˜&lt;/p>
&lt;p>å¦‚æžœè¦è§£å†³è¿™ä¸ªé—®é¢˜,ä¹Ÿå¯ä»¥é€šè¿‡æ•°ç»„æ‰©å®¹,æŠŠé“¾æŽ¥ç¼©çŸ­ä¹Ÿå¯ä»¥è§£å†³é—®é¢˜&lt;/p>
&lt;p>æ‰€ä»¥åœ¨æ•°ç»„é•¿åº¦è¿˜ä¸å¤ªé•¿çš„æƒ…å†µ,å¯ä»¥å…ˆé€šè¿‡æ•°ç»„æ‰©å®¹æ¥è§£å†³é“¾è¡¨è¿‡é•¿çš„é—®é¢˜&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶æ‰ä¼šå˜æˆçº¢é»‘æ ‘&lt;/p>
&lt;p>&lt;strong>HashMapçš„æ•°ç»„çš„å¤§å°æ˜¯2çš„å¹‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>TODO è¿˜æ˜¯æ²¡æœ‰æžæ˜Žç™½&lt;/p>
&lt;p>åªæœ‰æ•°ç»„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹å€æ‰èƒ½å¤Ÿç¡®ä¿æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªä½ç½®å‘ç”Ÿhashå†²çªçš„æ¦‚çŽ‡æ˜¯ç›¸åŒçš„ï¼Œæ•°ç»„é•¿åº¦å‡ä¸€çš„äºŒè¿›åˆ¶ç å¿…é¡»å…¨éƒ¨æ˜¯1ï¼Œå¦åˆ™ä¼šå‡ºçŽ°éƒ¨åˆ†ä½ç½®æ°¸è¿œä¸ä¼šå‘ç”Ÿhashå†²çªè€Œé€ æˆèµ„æºæµªè´¹&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>HashMap putæµç¨‹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>å¯¹keyè¿›è¡Œhashç®—æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªhashcode&lt;/li>
&lt;li>å¦‚æžœæ•°ç»„é•¿åº¦ä¸º0æˆ–è€…ä¸ºnullï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¾—åˆ°æ•°ç»„é•¿åº¦n&lt;/li>
&lt;li>é€šè¿‡ keyçš„hashcode&amp;amp;æ•°ç»„é•¿åº¦n è®¡ç®—å‡ºæ•°ç»„ä¸‹æ ‡&lt;/li>
&lt;li>å¦‚æžœæ•°ç»„ä¸‹æ ‡ä½ç½®ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°†putè¿›æ¥çš„æ•°æ®å°è£…Nodeå¯¹è±¡å¹¶å­˜åˆ°ç»™ä¸‹æ ‡ä½ç½®&lt;/li>
&lt;li>å¦‚æžœæ•°ç»„ä¸‹æ ‡ä½ç½®æœ‰æ•°æ®pï¼Œå³å‘ç”Ÿhashç¢°æ’žï¼Œå¦‚æžœkeyå­˜åœ¨ï¼Œè¦†ç›–æ•°æ®&lt;/li>
&lt;li>å¦‚æžœæ•°æ®på±žäºŽçº¢é»‘æ ‘ï¼Œä¼šæŠŠæ–°æ•°æ®æ’å…¥åˆ°çº¢é»‘æ ‘ä¸­&lt;/li>
&lt;li>å¦‚æžœä»¥ä¸Šéƒ½ä¸æ˜¯å°±éåŽ†é“¾è¡¨ï¼ŒéåŽ†é“¾è¡¨è¿‡ç¨‹ä¸­ç»Ÿè®¡é“¾è¡¨é•¿åº¦ï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡8 è¿›è¡ŒtreeifyBin çº¢é»‘æ ‘åŒ–é“¾è¡¨&lt;/li>
&lt;li>treeifyBinæ ‘åŒ–ä¸­å¦‚æžœæ•°ç»„é•¿åº¦å°äºŽ64æˆ–æ•°ç»„ä¸ºnullåˆ™è¿›è¡Œæ‰©å®¹ï¼Œå¦åˆ™æ•°ç»„é•¿åº¦å¤§äºŽç­‰äºŽ64 é“¾è¡¨è½¬çº¢é»‘æ ‘&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>HashMap æ˜¯å¦‚ä½•æ‰©å®¹çš„ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>HashMapçš„æ‰©å®¹æŒ‡çš„å°±æ˜¯æ•°ç»„çš„æ‰©å®¹ï¼Œ å› ä¸ºæ•°ç»„å ç”¨çš„æ˜¯è¿žç»­å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥æ•°ç»„çš„æ‰©å®¹å…¶å®žåªèƒ½æ–°å¼€ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç„¶åŽæŠŠè€æ•°ç»„ä¸Šçš„å…ƒç´ è½¬ç§»åˆ°æ–°æ•°ç»„ä¸Šæ¥ï¼Œè¿™æ ·æ‰æ˜¯æ•°ç»„çš„æ‰©å®¹&lt;/li>
&lt;li>å…ˆæ–°å»ºä¸€ä¸ª2è¢«æ•°ç»„å¤§å°çš„æ•°ç»„&lt;/li>
&lt;li>ç„¶åŽéåŽ†è€æ•°ç»„ä¸Šçš„æ¯ä¸€ä¸ªä½ç½®ï¼Œå¦‚æžœè¿™ä¸ªä½ç½®ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå°±æŠŠè¿™ä¸ªé“¾è¡¨ä¸Šçš„å…ƒç´ è½¬ç§»åˆ°æ–°æ•°ç»„ä¸ŠåŽ»&lt;/li>
&lt;li>åœ¨jdk8ä¸­ï¼Œå› ä¸ºæ¶‰åŠåˆ°çº¢é»‘æ ‘ï¼Œè¿™ä¸ªå…¶å®žæ¯”è¾ƒå¤æ‚ï¼Œjdk8ä¸­å…¶å®žè¿˜ä¼šç”¨åˆ°ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ç»´æŠ¤çº¢é»‘æ ‘ä¸­çš„å…ƒç´ ï¼Œæ‰€ä»¥jdk8ä¸­åœ¨è½¬ç§»æŸä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ—¶ï¼Œä¼šåŽ»åˆ¤æ–­å¦‚æžœè¿™ä¸ªä½ç½®æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œé‚£ä¹ˆä¼šéåŽ†è¯¥ä½ç½®çš„åŒå‘é“¾è¡¨ï¼ŒéåŽ†åŒå‘é“¾è¡¨ç»Ÿè®¡å“ªäº›å…ƒç´ åœ¨æ‰©å®¹å®Œä¹‹åŽè¿˜æ˜¯åŽŸä½ç½®ï¼Œå“ªäº›å…ƒç´ åœ¨æ‰©å®¹ä¹‹åŽåœ¨æ–°ä½ç½®ï¼Œè¿™æ ·éåŽ†å®ŒåŒå‘é“¾è¡¨åŽï¼Œå°±ä¼šå¾—åˆ°ä¸¤ä¸ªå­é“¾è¡¨ï¼Œä¸€ä¸ªæ”¾åœ¨åŽŸä¸‹æ ‡ä½ç½®ï¼Œä¸€ä¸ªæ”¾åœ¨æ–°ä¸‹æ ‡ä½ç½®ï¼Œå¦‚æžœåŽŸä¸‹æ ‡ä½ç½®æˆ–æ–°ä¸‹æ ‡ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ™çº¢é»‘æ ‘ä¸ç”¨æ‹†åˆ†ï¼Œå¦åˆ™åˆ¤æ–­è¿™ä¸¤ä¸ªå­é“¾è¡¨çš„é•¿åº¦ï¼Œå¦‚æžœè¶…è¿‡8ï¼Œåˆ™è½¬æˆçº¢é»‘æ ‘æ”¾åˆ°å¯¹åº”çš„ä½ç½®ï¼Œå¦åˆ™æŠŠå•å‘é“¾è¡¨æ”¾åˆ°å¯¹åº”çš„ä½ç½®ã€‚&lt;/li>
&lt;li>å…ƒç´ è½¬ç§»å®Œäº†ä¹‹åŽï¼Œåœ¨æŠŠæ–°æ•°ç»„å¯¹è±¡èµ‹å€¼ç»™HashMapçš„tableå±žæ€§ï¼Œè€æ•°ç»„ä¼šè¢«å›žæ”¶åˆ°ã€‚&lt;/li>
&lt;/ol>
&lt;h1 id="å¤šçº¿ç¨‹">å¤šçº¿ç¨‹&lt;/h1>
&lt;h2 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± &lt;/h2>
&lt;h3 id="æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± ">æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± &lt;/h3>
&lt;p>1:ç¼–å†™ä»»åŠ¡ç±»(MyTask),å®žçŽ°RunnableæŽ¥å£;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyTask&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyTask&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> id) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;å³å°†å¼€å§‹ä»»åŠ¡:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(200);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;å®Œæˆäº†ä»»åŠ¡:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">toString&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#34;MyTask{&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;id=&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> id &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#39;}&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>2:ç¼–å†™çº¿ç¨‹ç±»(MyWorker),ç”¨äºŽæ‰§è¡Œä»»åŠ¡,éœ€è¦æŒæœ‰æ‰€æœ‰ä»»åŠ¡;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyWorker&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> Thread{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Runnable&lt;span style="color:#f92672">&amp;gt;&lt;/span> tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyWorker&lt;/span>(String name, List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Runnable&lt;span style="color:#f92672">&amp;gt;&lt;/span> tasks) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.&lt;span style="color:#a6e22e">setName&lt;/span>(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">tasks&lt;/span> &lt;span style="color:#f92672">=&lt;/span> tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­é›†åˆä¸­æ˜¯å¦æœ‰ä»»åŠ¡,å¦‚æžœæœ‰å°±ä¸€ç›´è¿è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>tasks.&lt;span style="color:#a6e22e">isEmpty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Runnable remove &lt;span style="color:#f92672">=&lt;/span> tasks.&lt;span style="color:#a6e22e">remove&lt;/span>(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> remove.&lt;span style="color:#a6e22e">run&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>3:ç¼–å†™çº¿ç¨‹æ± ç±»(MyThreadPool),åŒ…å«æäº¤ä»»åŠ¡,æ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyThreadPool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Runnable&lt;span style="color:#f92672">&amp;gt;&lt;/span> tasks &lt;span style="color:#f92672">=&lt;/span> Collections.&lt;span style="color:#a6e22e">synchronizedList&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> LinkedList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å½“å‰çº¿ç¨‹æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> num;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¸å¿ƒçº¿ç¨‹æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> corePoolSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€å¤§çº¿ç¨‹æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> maxSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> workSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyThreadPool&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> corePoolSize, &lt;span style="color:#66d9ef">int&lt;/span> maxSize, &lt;span style="color:#66d9ef">int&lt;/span> workSize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">corePoolSize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> corePoolSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">maxSize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> maxSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">workSize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> workSize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æäº¤æ–¹æ³•-å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">submit&lt;/span>(Runnable runnable){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­å½“å‰é˜Ÿåˆ—çš„æ•°é‡,æ˜¯å¦è¶…å‡ºäº†æœ€å¤§ä»»åŠ¡æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (tasks.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">&amp;gt;=&lt;/span> workSize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä»»åŠ¡&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>runnable&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;è¢«ä¸¢å¼ƒäº†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tasks.&lt;span style="color:#a6e22e">add&lt;/span>(runnable);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œæ–¹æ³•-åˆ¤æ–­å½“å‰çº¿ç¨‹çš„æ•°é‡,å†³å®šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡è¿˜æ˜¯éžçº¿ç¨‹æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> execTask(runnable);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">execTask&lt;/span>(Runnable runnable) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­å½“å‰çº¿ç¨‹ä¸­çš„çº¿ç¨‹æ€»æ•°é‡,æ˜¯å¦è¶…å‡ºäº†æ ¸å¿ƒçº¿ç¨‹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (num &lt;span style="color:#f92672">&amp;lt;&lt;/span> corePoolSize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> MyWorker(&lt;span style="color:#e6db74">&amp;#34;æ ¸å¿ƒçº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>num, tasks).&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (num &lt;span style="color:#f92672">&amp;lt;&lt;/span> maxSize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºéžæ ¸å¿ƒçº¿ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> MyWorker(&lt;span style="color:#e6db74">&amp;#34;éžæ ¸å¿ƒçº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>num, tasks).&lt;span style="color:#a6e22e">start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>runnable&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;è¢«ç¼“å­˜äº†....&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>4:ç¼–å†™æµ‹è¯•ç±»(MyTest),åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡,æäº¤å¤šä¸ªä»»åŠ¡æµ‹è¯•;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyTest&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyThreadPool myThreadPool &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> MyThreadPool(2, 4, 20);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyTask myTask &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> MyTask(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> myThreadPool.&lt;span style="color:#a6e22e">submit&lt;/span>(myTask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å†…ç½®çº¿ç¨‹æ± ">å†…ç½®çº¿ç¨‹æ± &lt;/h3>
&lt;p>ThreadPoolExecutorçš„ä½¿ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">ThreadPoolExecutor&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> corePoolSize, &lt;span style="color:#75715e">//æ ¸å¿ƒçº¿ç¨‹æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> maximumPoolSize,&lt;span style="color:#75715e">// æœ€å¤§çº¿ç¨‹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> keepAliveTime, &lt;span style="color:#75715e">// æœ€å¤§ç©ºé—²æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TimeUnit unit, &lt;span style="color:#75715e">// æ—¶é—´å•ä½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BlockingQueue&lt;span style="color:#f92672">&amp;lt;&lt;/span>Runnable&lt;span style="color:#f92672">&amp;gt;&lt;/span> workQueue, &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ThreadFactory threadFactory, &lt;span style="color:#75715e">// çº¿ç¨‹å·¥åŽ‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RejectedExecutionHandler handler &lt;span style="color:#75715e">// é¥±å’Œå¤„ç†æœºåˆ¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>corePoolSize - çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œå³ä½¿çº¿ç¨‹æ˜¯ç©ºé—²çš„ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼Œé™¤éžè®¾ç½®äº† allowCoreThreadTimeOut ä¸º trueã€‚&lt;/li>
&lt;li>maximumPoolSize - çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚&lt;/li>
&lt;li>keepAliveTime - éžæ ¸å¿ƒçº¿ç¨‹ç©ºé—²æ—¶çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«é”€æ¯ã€‚&lt;/li>
&lt;li>unit - keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚&lt;/li>
&lt;li>workQueue - ç”¨äºŽä¿å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡žé˜Ÿåˆ—ã€‚
&lt;ol>
&lt;li>&lt;strong>SynchronousQueue:&lt;/strong> ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡žé˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„å¯¹åº”ç§»é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚é€‚åˆäºŽä¼ é€’æ€§çš„è¯·æ±‚ã€‚&lt;/li>
&lt;li>&lt;strong>LinkedBlockingQueue:&lt;/strong> ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œä½¿ç”¨é“¾è¡¨å®žçŽ°ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šå®¹é‡ï¼Œé»˜è®¤å°†æ˜¯ Integer.MAX_VALUEã€‚å½“ä»»åŠ¡æ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ—¶ï¼Œå¤šä½™çš„ä»»åŠ¡å°†è¢«æ”¾ç½®åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚&lt;/li>
&lt;li>&lt;strong>ArrayBlockingQueue:&lt;/strong> ä¸€ä¸ªæœ‰ç•Œçš„é˜»å¡žé˜Ÿåˆ—ï¼Œä½¿ç”¨æ•°ç»„å®žçŽ°ã€‚åœ¨åˆ›å»ºæ—¶éœ€è¦æŒ‡å®šå®¹é‡å¤§å°ã€‚é€‚åˆäºŽæœ‰ç•Œä»»åŠ¡é˜Ÿåˆ—çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“è¿žæŽ¥æ± å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>threadFactory - ç”¨äºŽåˆ›å»ºæ–°çº¿ç¨‹çš„å·¥åŽ‚ã€‚&lt;/li>
&lt;li>handler - å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼ä¸”é˜»å¡žé˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œç”¨æ¥å¤„ç†æ–°æäº¤çš„ä»»åŠ¡çš„é¥±å’Œç­–ç•¥ã€‚
&lt;ol>
&lt;li>&lt;code>AbortPolicy&lt;/code>: é»˜è®¤çš„ç­–ç•¥ï¼Œå°†æŠ›å‡º&lt;code>RejectedExecutionException&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>CallerRunsPolicy&lt;/code>: å½“ä»»åŠ¡è¢«æ‹’ç»æ·»åŠ æ—¶ï¼Œä¼šä½¿ç”¨å½“å‰çº¿ç¨‹æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ã€‚&lt;/li>
&lt;li>&lt;code>DiscardPolicy&lt;/code>: ç›´æŽ¥ä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¸æä¾›ä»»ä½•åé¦ˆã€‚&lt;/li>
&lt;li>&lt;code>DiscardOldestPolicy&lt;/code>: ä¸¢å¼ƒç­‰å¾…æ—¶é—´æœ€é•¿çš„ä»»åŠ¡ï¼Œç„¶åŽå°è¯•æäº¤æ–°çš„ä»»åŠ¡ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>ExecutorServiceæŽ¥å£çš„å¸¸ç”¨æ–¹æ³•:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æŽ¥å£å&lt;/th>
&lt;th>ä½œç”¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>void shutdown()&lt;/td>
&lt;td>å¯åŠ¨ä¸€æ¬¡é¡ºåºå…³é—­ï¼Œæ‰§è¡Œä»¥å‰æäº¤çš„ä»»åŠ¡ï¼Œä½†ä¸æŽ¥å—æ–°ä»»åŠ¡ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>List&lt;Runnable> shutdownNow()&lt;/td>
&lt;td>åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæš‚åœå¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›žç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;T> Future&lt;T> submit(Callable&lt;T> task)&lt;/td>
&lt;td>æ‰§è¡Œå¸¦è¿”å›žå€¼çš„ä»»åŠ¡ï¼Œè¿”å›žä¸€ä¸ªFutureå¯¹è±¡ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Future&lt;?> submit(Runnable task)&lt;/td>
&lt;td>æ‰§è¡Œ Runnable ä»»åŠ¡ï¼Œå¹¶è¿”å›žä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;T> Future&lt;T> submit(Runnable task, T result)&lt;/td>
&lt;td>æ‰§è¡Œ Runnable ä»»åŠ¡ï¼Œå¹¶è¿”å›žä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="executorserviceæŽ¥å£çš„çš„å®žçŽ°ç±»">ExecutorServiceæŽ¥å£çš„çš„å®žçŽ°ç±»&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>static ExecutorService newCachedThreadPool() &lt;br />åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹æ± å¯¹è±¡,é‡Œé¢çš„çº¿ç¨‹å¯é‡ç”¨,ä¸”åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»º&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) &lt;br />çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨ThreadFactoryæ¥åˆ›å»º,è¿™æ ·çš„çº¿ç¨‹æ— éœ€æ‰‹åŠ¨å¯åŠ¨,è‡ªåŠ¨æ‰§è¡Œ;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ExecutorService newFixedThreadPool(int nThreads) &lt;br />åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) &lt;br />åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ä¸”çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨ThreadFactoryæ¥åˆ›å»ºã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ExecutorService newSingleThreadExecutor() &lt;br />åˆ›å»ºä¸€ä¸ªä½¿ç”¨å•ä¸ª worker çº¿ç¨‹çš„ Executorï¼Œä»¥æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¯¥çº¿ç¨‹ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) &lt;br />åˆ›å»ºä¸€ä¸ªä½¿ç”¨å•ä¸ª worker çº¿ç¨‹çš„ Executorï¼Œä¸”çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨ThreadFactoryæ¥åˆ›å»ºã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="scheduledexecutorserviceä»»åŠ¡è°ƒåº¦">ScheduledExecutorServiceä»»åŠ¡è°ƒåº¦&lt;/h4>
&lt;p>ScheduledExecutorServiceæ˜¯ExecutorServiceçš„å­æŽ¥å£,å…·å¤‡äº†å»¶è¿Ÿè¿è¡Œæˆ–å®šæœŸæ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•()&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>static ScheduledExecutorService newScheduledThreadPool(int corePoolSize)&lt;br />åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ä¸”å…è®¸å»¶è¿Ÿè¿è¡Œæˆ–å®šæœŸæ‰§è¡Œä»»åŠ¡;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ScheduledExecutorService newScheduledThreadPool(int corePoolSize, ThreadFactory threadFactory)&lt;br />åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ä¸”çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨ThreadFactoryæ¥åˆ›å»º,ä¸”å…è®¸å»¶è¿Ÿè¿è¡Œæˆ–å®šæœŸæ‰§è¡Œä»»åŠ¡;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ScheduledExecutorService newSingleThreadScheduledExecutor() &lt;br />åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œç¨‹åºï¼Œå®ƒå…è®¸åœ¨ç»™å®šå»¶è¿ŸåŽè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>static ScheduledExecutorService newSingleThreadScheduledExecutor(ThreadFactory threadFactory) &lt;br />åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œç¨‹åºï¼Œå®ƒå¯å®‰æŽ’åœ¨ç»™å®šå»¶è¿ŸåŽè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ScheduledExecutorServiceå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;V> ScheduledFuture&lt;V> schedule(Callable&lt;V> callable, long delay, TimeUnit unit) &lt;br />å»¶è¿Ÿæ—¶é—´å•ä½æ˜¯unit,æ•°é‡æ˜¯delayçš„æ—¶é—´åŽæ‰§è¡Œcallableã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ScheduledFuture&lt;?> schedule(Runnable command, long delay, TimeUnit unit) &lt;br />å»¶è¿Ÿæ—¶é—´å•ä½æ˜¯unit,æ•°é‡æ˜¯delayçš„æ—¶é—´åŽæ‰§è¡Œcommandã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ScheduledFuture&lt;?> scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit) &lt;br />å»¶è¿Ÿæ—¶é—´å•ä½æ˜¯unit,æ•°é‡æ˜¯initialDelayçš„æ—¶é—´åŽ,æ¯é—´éš”periodæ—¶é—´é‡å¤æ‰§è¡Œä¸€æ¬¡commandã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ScheduledFuture&lt;?> scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit) &lt;br />åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿ŸåŽé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼ŒéšåŽï¼Œåœ¨æ¯ä¸€æ¬¡æ‰§è¡Œç»ˆæ­¢å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´éƒ½å­˜åœ¨ç»™å®šçš„å»¶è¿Ÿã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="futureå¼‚æ­¥è®¡ç®—ç»“æžœ">Futureå¼‚æ­¥è®¡ç®—ç»“æžœ&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>boolean cancel(boolean mayInterruptIfRunning) &lt;br />è¯•å›¾å–æ¶ˆå¯¹æ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>V get()&lt;br />å¦‚æœ‰å¿…è¦ï¼Œç­‰å¾…è®¡ç®—å®Œæˆï¼Œç„¶åŽèŽ·å–å…¶ç»“æžœã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>V get(long timeout, TimeUnit unit) &lt;br />å¦‚æœ‰å¿…è¦ï¼Œæœ€å¤šç­‰å¾…ä¸ºä½¿è®¡ç®—å®Œæˆæ‰€ç»™å®šçš„æ—¶é—´ä¹‹åŽï¼ŒèŽ·å–å…¶ç»“æžœï¼ˆå¦‚æžœç»“æžœå¯ç”¨ï¼‰ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>boolean isCancelled() &lt;br />å¦‚æžœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰å°†å…¶å–æ¶ˆï¼Œåˆ™è¿”å›ž trueã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>boolean isDone() &lt;br />å¦‚æžœä»»åŠ¡å·²å®Œæˆï¼Œåˆ™è¿”å›ž trueã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="ä»£ç æ¼”ç¤ºexecutorservice">ä»£ç æ¼”ç¤ºExecutorService&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¼”ç¤º newCachedThreadPool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test1();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test2();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newCachedThreadPool&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newCachedThreadPool&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(r, &lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹åå­—:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¼”ç¤ºnewFixedThreadPool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test1();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> test2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newFixedThreadPool&lt;/span>(3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable2(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newFixedThreadPool&lt;/span>(3,&lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(r, &lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹åå­—:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable2(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable2&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable2&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¼”ç¤ºnewSingleThreadExecutor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test1();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> test2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newSingleThreadExecutor&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable3(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newSingleThreadExecutor&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(r, &lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹åå­—:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable3(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable3&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable3&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ExecutorServiceæŽ¥å£çš„shutdown(),shutdownNow(),submit()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo4&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test1();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> test2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newSingleThreadExecutor&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(r, &lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹åå­—:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable4(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç«‹åˆ»å…³é—­çº¿ç¨‹æ± ,å¦‚æžœçº¿ç¨‹æ± ä¸­çš„è¿˜æœ‰ç¼“å­˜ä»»åŠ¡,æ²¡æœ‰æ‰§è¡Œ,åˆ™å–æ¶ˆæ‰§è¡Œ,å¹¶è¿”å›žè¿™äº›ä»»åŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Runnable&lt;span style="color:#f92672">&amp;gt;&lt;/span> runnables &lt;span style="color:#f92672">=&lt;/span> executorService.&lt;span style="color:#a6e22e">shutdownNow&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(runnables);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸èƒ½å†æŽ¥æ”¶æ–°çš„æ–¹æ³•äº†,ä¼šæŠ¥é”™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable4(888));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newSingleThreadExecutor&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable4(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é—­çº¿ç¨‹æ± ,ä»…ä»…æ˜¯ä¸å†æŽ¥æ”¶æ–°çš„ä»»åŠ¡,ä»¥å‰çš„ä»»åŠ¡è¿˜ä¼šè®°å½•æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">shutdown&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸èƒ½å†æŽ¥æ”¶æ–°çš„æ–¹æ³•äº†,ä¼šæŠ¥é”™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable4(888));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable4&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable4&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">toString&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#34;MyRunable4{&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;i=&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;}&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä»£ç æ¼”ç¤ºscheduledexecutorservice">ä»£ç æ¼”ç¤ºScheduledExecutorService&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ¼”ç¤ºnewScheduledThreadPool,æµ‹è¯•å»¶è¿Ÿæ‰§è¡Œå’Œé‡å¤æ‰§è¡Œçš„åŠŸèƒ½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å…·å¤‡å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ScheduledExecutorService es &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newScheduledThreadPool&lt;/span>(3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºå¤šä¸ªä»»åŠ¡,å¹¶ä¸”æäº¤ä»»åŠ¡,æ¯ä¸ªä»»åŠ¡å»¶è¿Ÿ2sæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> es.&lt;span style="color:#a6e22e">schedule&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable(i), 2, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç»“æŸ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¼”ç¤ºnewScheduledThreadPool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å…·å¤‡å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ScheduledExecutorService es &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newScheduledThreadPool&lt;/span>(3, &lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(&lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> n&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºå¤šä¸ªä»»åŠ¡,å¹¶ä¸”æäº¤ä»»åŠ¡,æ¯ä¸ªä»»åŠ¡å»¶è¿Ÿ2sæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> es.&lt;span style="color:#a6e22e">scheduleAtFixedRate&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable2(1), 1,2, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç»“æŸ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable2&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable2&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(1500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¼”ç¤ºnewSingleThreadScheduledExecutor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å…·å¤‡å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ScheduledExecutorService es &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newSingleThreadScheduledExecutor&lt;/span>( &lt;span style="color:#66d9ef">new&lt;/span> ThreadFactory() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Thread &lt;span style="color:#a6e22e">newThread&lt;/span>(Runnable r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(&lt;span style="color:#e6db74">&amp;#34;è‡ªå®šä¹‰çº¿ç¨‹:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> n&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºå¤šä¸ªä»»åŠ¡,å¹¶ä¸”æäº¤ä»»åŠ¡,æ¯ä¸ªä»»åŠ¡å»¶è¿Ÿ2sæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> es.&lt;span style="color:#a6e22e">scheduleWithFixedDelay&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyRunable2(1), 1,2, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç»“æŸ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyRunable3&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyRunable3&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(2000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œäº†ä»»åŠ¡:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä»£ç æ¼”ç¤ºfuture">ä»£ç æ¼”ç¤ºFuture&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo5&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> ExecutionException, InterruptedException, TimeoutException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executorService &lt;span style="color:#f92672">=&lt;/span> Executors.&lt;span style="color:#a6e22e">newCachedThreadPool&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> submit &lt;span style="color:#f92672">=&lt;/span> executorService.&lt;span style="color:#a6e22e">submit&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> MyCall(1, 2));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test1(submit);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// test2(submit);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>(Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> submit) &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException, ExecutionException, TimeoutException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å–æ¶ˆä»»åŠ¡æ‰§è¡Œçš„ç»“æžœ&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> submit.&lt;span style="color:#a6e22e">cancel&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸»çº¿ç¨‹ç­‰å¾…è¶…æ—¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer i &lt;span style="color:#f92672">=&lt;/span> submit.&lt;span style="color:#a6e22e">get&lt;/span>(1, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä»»åŠ¡æ‰§è¡Œçš„ç»“æžœ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test1&lt;/span>(Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> submit) &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException, ExecutionException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> done &lt;span style="color:#f92672">=&lt;/span> submit.&lt;span style="color:#a6e22e">isDone&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç¬¬ä¸€æ¬¡åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> done);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> cancelled &lt;span style="color:#f92672">=&lt;/span> submit.&lt;span style="color:#a6e22e">isCancelled&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç¬¬ä¸€æ¬¡åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> cancelled);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ— é™æœŸç­‰å¾…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer i &lt;span style="color:#f92672">=&lt;/span> submit.&lt;span style="color:#a6e22e">get&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä»»åŠ¡æ‰§è¡Œçš„ç»“æžœ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç¬¬äºŒ æ¬¡åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> submit.&lt;span style="color:#a6e22e">isDone&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç¬¬ä¸€æ¬¡åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆ:&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> submit.&lt;span style="color:#a6e22e">isCancelled&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyCall&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Callable&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">MyCall&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Integer &lt;span style="color:#a6e22e">call&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name &lt;span style="color:#f92672">=&lt;/span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;å‡†å¤‡å¼€å§‹è®¡ç®—:&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(2000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;çº¿ç¨‹:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>name &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;è®¡ç®—å®Œæˆ:&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a&lt;span style="color:#f92672">+&lt;/span>b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="jvm">JVM&lt;/h1>
&lt;h2 id="jvmå†…å­˜ç»“æž„">JVMå†…å­˜ç»“æž„&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051502261.png" alt="image-20230825200326130">&lt;/p>
&lt;h3 id="ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨&lt;/h3>
&lt;p>è™šæ‹ŸæœºæŒ‡ä»¤çš„æ‰§è¡Œæµç¨‹:CPUä¸æ˜¯ä¸æ˜¯ç›´æŽ¥è¯»äºŒè¿›åˆ¶å­—èŠ‚ç  , &lt;code>è§£é‡Šå™¨&lt;/code>è¯»äºŒè¿›åˆ¶å­—èŠ‚ç  è½¬æ¢æˆ &lt;code>æœºå™¨ç &lt;/code>,äº¤ç»™CPUæ‰§è¡Œ&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051502586.png" alt="image-20230819130100665">&lt;/p>
&lt;p>ç¨‹åºè®¡æ•°å™¨çš„åœ¨ä½œç”¨:è®°ä½ä¸‹ä¸€è·³JVMæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051503947.png" alt="image-20230819130536093">&lt;/p>
&lt;p>ç‰¹ç‚¹:&lt;/p>
&lt;p>çº¿ç¨‹ç§æœ‰çš„,&lt;/p>
&lt;p>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051502060.png" alt="image-20230819130807803">&lt;/p>
&lt;h3 id="è™šæ‹Ÿæœºæ ˆ">è™šæ‹Ÿæœºæ ˆ&lt;/h3>
&lt;p>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆæ¡¢ç»„æˆ,å¯¹åº”è¿™æ¯æ¬¡æ–¹æ³•è°ƒç”¨çš„æ—¶æ‰€å ç”¨çš„å†…å­˜&lt;/p>
&lt;p>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆæ¡¢,å¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•&lt;/p>
&lt;p>æ•°æ®ç»“æž„,åƒå­å¼¹å¤¹,å…ˆè¿›åŽå‡º,æ‰€ä»¥ä¸éœ€è¦GC&lt;/p>
&lt;p>-Xss è®¾ç½®æ¯ä¸ª&lt;code>çº¿ç¨‹&lt;/code>æ ˆå†…å­˜å¤§å°,é»˜è®¤1M,å†…å­˜è¶Šå¤§,èƒ½ä½¿ç”¨çš„çº¿ç¨‹è¶Šå°‘&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051502039.png" alt="image-20230819131121768">&lt;/p>
&lt;p>æ¼”ç¤ºæ ˆæ¡¢&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051502380.png" alt="image-20230819134620208">&lt;/p>
&lt;h4 id="æ¼”ç¤ºçº¿ç¨‹å®‰å…¨">æ¼”ç¤ºçº¿ç¨‹å®‰å…¨&lt;/h4>
&lt;p>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡çº¿ç¨‹æ˜¯å®‰å…¨çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸ªçº¿ç¨‹,æœ‰å„è‡ªçš„x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 1000; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051502378.png" alt="image-20230819135303041">&lt;/p>
&lt;h4 id="æ¼”ç¤ºçº¿ç¨‹ä¸å®‰å…¨">æ¼”ç¤ºçº¿ç¨‹ä¸å®‰å…¨&lt;/h4>
&lt;p>å¦‚æžœæ˜¯é™æ€å˜é‡,å°±ä¸æ˜¯å®‰å…¨çš„äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤šçº¿ç¨‹è¿è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">demo&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 1000; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051503889.png" alt="image-20230819135343587">&lt;/p>
&lt;h4 id="æ¼”ç¤ºæ ˆå†…å­˜æº¢å‡º">æ¼”ç¤ºæ ˆå†…å­˜æº¢å‡º&lt;/h4>
&lt;p>æ ˆæ¡¢è¿‡å¤§æˆ–è€…è¿‡å¤šä¼šæº¢å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> count &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> method();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Throwable e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.&lt;span style="color:#a6e22e">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 19994&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(count);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">method&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> count&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> method();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// java.lang.StackOverflowError&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// at æ ˆ.Demo2.method(Demo2.java:22)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// at æ ˆ.Demo2.method(Demo2.java:22)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="çº¿ç¨‹è¯Šæ–­">çº¿ç¨‹è¯Šæ–­&lt;/h4>
&lt;p>&lt;strong>1.çº¿ç¨‹CPUå ç”¨é«˜&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä½¿ç”¨topå‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>çœ‹å“ªä¸ªè¿›ç¨‹å ç”¨CPUè¿‡é«˜,åªèƒ½çœ‹åˆ°è¿›ç¨‹,ä¸èƒ½çœ‹åˆ°çº¿ç¨‹
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹å“ªä¸ªçº¿ç¨‹å ç”¨è¿‡é«˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># jstack çº¿ç¨‹id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åœ¨å…·ä½“æŸ¥æ‰¾çš„æ—¶å€™,åè¿›åˆ¶çš„çº¿ç¨‹IDè½¬æˆ16è¿›åˆ¶
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>2.è¿è¡Œå¾ˆé•¿æ—¶é—´,å¾—ä¸åˆ°ç»“æžœ&lt;/strong>&lt;/p>
&lt;p>æœ‰å¯èƒ½å‘ç”Ÿæ­»é”äº†&lt;/p>
&lt;h3 id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ&lt;/h3>
&lt;p>native æ–¹æ³•,æ¯”å¦‚objecté‡Œçš„cloneæ–¹æ³•&lt;/p>
&lt;h3 id="å †">å †&lt;/h3>
&lt;p>ä½¿ç”¨-Xmx è®¾ç½®å †å†…å­˜ç©ºé—´å¤§å°&lt;/p>
&lt;p>ç‰¹ç‚¹:&lt;/p>
&lt;p>çº¿ç¨‹å…±äº«çš„,å †ä¸­å¯¹è±¡éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜&lt;/p>
&lt;p>æœ‰åžƒåœ¾å›žæ”¶æœºåˆ¶&lt;/p>
&lt;h4 id="æ¼”ç¤ºå †å†…å­˜æº¢å‡º">æ¼”ç¤ºå †å†…å­˜æº¢å‡º&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> List &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;hello&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#66d9ef">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List.&lt;span style="color:#a6e22e">add&lt;/span>(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">=&lt;/span> a &lt;span style="color:#f92672">+&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.&lt;span style="color:#a6e22e">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ¼”ç¤ºjmap">æ¼”ç¤ºjmap&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨ç©ºé—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 16279æ˜¯pid&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>jmap -heap &lt;span style="color:#ae81ff">16279&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Error: -heap option used
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Cannot connect to core dump or remote debug server. Use jhsdb jmap instead
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯¹äºŽjdk8ä¹‹åŽçš„ç‰ˆæœ¬ï¼Œä¸èƒ½å†ä½¿ç”¨jmap -heap pidçš„å‘½ä»¤äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>jhsdb jmap --heap --pid &lt;span style="color:#ae81ff">16279&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ¼”ç¤ºjconsole">æ¼”ç¤ºjconsole&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;1.....&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(30000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> bytes &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[&lt;/span>1028 &lt;span style="color:#f92672">*&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 10&lt;span style="color:#f92672">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2.....&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(30000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bytes &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">gc&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;3.....&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(1000000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å°1çš„æ—¶å€™,æ˜¯åˆšå¼€å§‹è¿è¡Œ,é»˜è®¤çš„å†…å­˜å ç”¨&lt;/p>
&lt;p>æ‰“å°2çš„æ—¶å€™,ä»£ç åˆ›å»ºäº†ä¸€ä¸ª10MBæ•°ç»„&lt;/p>
&lt;p>æ‰“å°3çš„æ—¶å€™,æ•°æ®è¢«åžƒåœ¾å›žæ”¶äº†,è¿˜å›žæ”¶äº†ä¸€äº›é»˜è®¤çš„åˆ›å»ºçš„ç©ºé—´,æ‰€ä»¥å†…å­˜å ç”¨å°±é™ä¸‹æ¥äº†&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051503025.png" alt="image-20230821154126018">&lt;/p>
&lt;h4 id="æ¼”ç¤ºjvisualvm">æ¼”ç¤ºjvisualvm&lt;/h4>
&lt;p>ç‚¹å‡»gcä¹‹åŽ,å†…å­˜å ç”¨ä¸ä¸‹é™çš„æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ¼”ç¤ºjvisualvm
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ArrayList&lt;span style="color:#f92672">&amp;lt;&lt;/span>Persion&lt;span style="color:#f92672">&amp;gt;&lt;/span> persions &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 200; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> persions.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> Persion());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">sleep&lt;/span>(99999999999999999L);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Persion&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> big &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[&lt;/span>1024 &lt;span style="color:#f92672">*&lt;/span> 1024&lt;span style="color:#f92672">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç‚¹å‡»&lt;code>Heap Dump&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051505544.png" alt="image-20230821155229892">&lt;/p>
&lt;p>ä»”ç»†æ‰¾æ‰¾,å°±èƒ½çœ‹åˆ°é‚£äº›æ•°æ®å ç”¨çš„å†…å­˜æ¯”è¾ƒå¤š&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051506269.png" alt="image-20230821155411806">&lt;/p>
&lt;h3 id="æ–¹æ³•åŒº">æ–¹æ³•åŒº&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051506319.png" alt="image">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>æ¼”ç¤ºæ°¸ä¹…ä»£å†…å­˜æº¢å‡º:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 1.8ä»¥å‰ä¼šå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>java.lang.OutOfMemoreryError: PermGen space
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-XX:MaxPermSize&lt;span style="color:#f92672">=&lt;/span>8m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 1.8ä»¥å‰ä¼šå¯¼è‡´å…ƒç©ºé—´å†…å­˜æº¢å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>java.lang.OutOfMemoreryError: Metaspace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-XX:MaxMetaspaceSize&lt;span style="color:#f92672">=&lt;/span>8m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ²¡æœ‰æ¼”ç¤ºå‡ºæ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jdk.internal.org.objectweb.asm.ClassWriter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jdk.internal.org.objectweb.asm.Opcodes;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ¼”ç¤ºå…ƒç©ºé—´å†…å­˜æº¢å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ–¹æ³•åŒºå†…å­˜æº¢å‡º,1.8æ‰æœ‰è¿™ä¸ªç‰ˆæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * -XX:MaxMetaspaceSize=8m
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ClassLoader:ç±»åŠ è½½å™¨,å¯ä»¥ç”¨æ¥åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> ClassLoader{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Demo test &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Demo();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 10000; i&lt;span style="color:#f92672">++&lt;/span>, j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”Ÿæˆç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ClassWriter cw &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ClassWriter(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç‰ˆæœ¬å·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¿é—®ä¿®é¥°ç¬¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç±»å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŒ…å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// çˆ¶ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŽ¥å£åç§°,è¿™é‡Œæ²¡æœ‰å®žçŽ°æŽ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cw.&lt;span style="color:#a6e22e">visit&lt;/span>(Opcodes.&lt;span style="color:#a6e22e">V1_8&lt;/span>, Opcodes.&lt;span style="color:#a6e22e">ACC_PUBLIC&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Class&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i, &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;java/lang/Object&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›žbyteæ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> code &lt;span style="color:#f92672">=&lt;/span> cw.&lt;span style="color:#a6e22e">toByteArray&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŠ è½½ç±»,ç”ŸæˆClasså¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> test.&lt;span style="color:#a6e22e">defineClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Class&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i, code, 0, code.&lt;span style="color:#a6e22e">length&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿ç”¨çš„åœºæ™¯:&lt;/p>
&lt;p>Springå’ŒMybatiséƒ½ä½¿ç”¨åˆ°äº†CGLIBæŠ€æœ¯,CGLIBä¹Ÿä¼šåƒä¸Šé¢æ¼”ç¤ºçš„ä½¿ç”¨&lt;code>ClassWriter&lt;/code>åˆ›å»ºå¯¹è±¡,åˆ›å»ºçš„å¯¹è±¡å¤šäº†,å°±ä¼šå¯¼è‡´æ–¹æ³•åŒºå¼‚å¸¸,æ‰€ä»¥å°±ç§»åŠ¨åˆ°ç›´æŽ¥å†…å­˜,è™½ç„¶æ²¡å•¥æœ¬è´¨ä¸Šçš„ä½œç”¨,åªæ˜¯ä¼šå½±å“&lt;code>OOM&lt;/code>çš„æ—¶é—´&lt;/p>
&lt;h5 id="å¸¸é‡æ± ">å¸¸é‡æ± &lt;/h5>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å¸¸é‡æ± 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * äºŒè¿›åˆ¶å­—èŠ‚ç (ç±»åŸºæœ¬ä¿¡æ¯,å¸¸é‡æ± ,ç±»æ–¹æ³•å®šä¹‰,åŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Hello world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨å‘½ä»¤ç¼–è¯‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>javap &lt;span style="color:#f92672">-&lt;/span>v Demo3.&lt;span style="color:#a6e22e">class&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘çš„ç»“æžœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»¥ä¸‹æ˜¯ç±»çš„åŸºæœ¬ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Classfile &lt;span style="color:#f92672">/&lt;/span>Users&lt;span style="color:#f92672">/&lt;/span>anthony&lt;span style="color:#f92672">/&lt;/span>Documents&lt;span style="color:#f92672">/&lt;/span>GitHub&lt;span style="color:#f92672">/&lt;/span>study&lt;span style="color:#f92672">-&lt;/span>java&lt;span style="color:#f92672">/&lt;/span>java&lt;span style="color:#f92672">-&lt;/span>base&lt;span style="color:#f92672">/&lt;/span>target&lt;span style="color:#f92672">/&lt;/span>classes&lt;span style="color:#f92672">/&lt;/span>æ–¹æ³•åŒº&lt;span style="color:#f92672">/&lt;/span>Demo3.&lt;span style="color:#a6e22e">class&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Last modified 2023å¹´8æœˆ23æ—¥; size 538 bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MD5 checksum 1aca08c8871c6946b2737975bbf15625
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiled from &lt;span style="color:#e6db74">&amp;#34;Demo3.java&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">æ–¹æ³•åŒº&lt;/span>.&lt;span style="color:#a6e22e">Demo3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> minor version: 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> major version: 55
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flags: (0x0021) ACC_PUBLIC, ACC_SUPER
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> this_class: &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>5 &lt;span style="color:#75715e">// æ–¹æ³•åŒº/Demo3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> super_class: &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>6 &lt;span style="color:#75715e">// java/lang/Object&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interfaces: 0, fields: 0, methods: 2, attributes: 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¸¸é‡æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Constant pool:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>1 &lt;span style="color:#f92672">=&lt;/span> Methodref &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>6.&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>20 &lt;span style="color:#75715e">// java/lang/Object.&amp;#34;&amp;lt;init&amp;gt;&amp;#34;:()V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>2 &lt;span style="color:#f92672">=&lt;/span> Fieldref &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>21.&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>22 &lt;span style="color:#75715e">// java/lang/System.out:Ljava/io/PrintStream;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>3 &lt;span style="color:#f92672">=&lt;/span> String &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>23 &lt;span style="color:#75715e">// Hello world&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>4 &lt;span style="color:#f92672">=&lt;/span> Methodref &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>24.&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>25 &lt;span style="color:#75715e">// java/io/PrintStream.println:(Ljava/lang/String;)V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>5 &lt;span style="color:#f92672">=&lt;/span> Class &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>26 &lt;span style="color:#75715e">// æ–¹æ³•åŒº/Demo3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>6 &lt;span style="color:#f92672">=&lt;/span> Class &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>27 &lt;span style="color:#75715e">// java/lang/Object&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>7 &lt;span style="color:#f92672">=&lt;/span> Utf8 &lt;span style="color:#f92672">&amp;lt;&lt;/span>init&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>8 &lt;span style="color:#f92672">=&lt;/span> Utf8 ()V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>9 &lt;span style="color:#f92672">=&lt;/span> Utf8 Code
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>10 &lt;span style="color:#f92672">=&lt;/span> Utf8 LineNumberTable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>11 &lt;span style="color:#f92672">=&lt;/span> Utf8 LocalVariableTable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>12 &lt;span style="color:#f92672">=&lt;/span> Utf8 &lt;span style="color:#66d9ef">this&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>13 &lt;span style="color:#f92672">=&lt;/span> Utf8 Læ–¹æ³•åŒº&lt;span style="color:#f92672">/&lt;/span>Demo3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>14 &lt;span style="color:#f92672">=&lt;/span> Utf8 main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>15 &lt;span style="color:#f92672">=&lt;/span> Utf8 (&lt;span style="color:#f92672">[&lt;/span>Ljava&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>String;)V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>16 &lt;span style="color:#f92672">=&lt;/span> Utf8 args
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>17 &lt;span style="color:#f92672">=&lt;/span> Utf8 &lt;span style="color:#f92672">[&lt;/span>Ljava&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>String;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>18 &lt;span style="color:#f92672">=&lt;/span> Utf8 SourceFile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>19 &lt;span style="color:#f92672">=&lt;/span> Utf8 Demo3.&lt;span style="color:#a6e22e">java&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>20 &lt;span style="color:#f92672">=&lt;/span> NameAndType &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>7:&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>8 &lt;span style="color:#75715e">// &amp;#34;&amp;lt;init&amp;gt;&amp;#34;:()V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>21 &lt;span style="color:#f92672">=&lt;/span> Class &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>28 &lt;span style="color:#75715e">// java/lang/System&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>22 &lt;span style="color:#f92672">=&lt;/span> NameAndType &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>29:&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>30 &lt;span style="color:#75715e">// out:Ljava/io/PrintStream;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>23 &lt;span style="color:#f92672">=&lt;/span> Utf8 Hello world
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>24 &lt;span style="color:#f92672">=&lt;/span> Class &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>31 &lt;span style="color:#75715e">// java/io/PrintStream&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>25 &lt;span style="color:#f92672">=&lt;/span> NameAndType &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>32:&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>33 &lt;span style="color:#75715e">// println:(Ljava/lang/String;)V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>26 &lt;span style="color:#f92672">=&lt;/span> Utf8 æ–¹æ³•åŒº&lt;span style="color:#f92672">/&lt;/span>Demo3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>27 &lt;span style="color:#f92672">=&lt;/span> Utf8 java&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>Object
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>28 &lt;span style="color:#f92672">=&lt;/span> Utf8 java&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>System
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>29 &lt;span style="color:#f92672">=&lt;/span> Utf8 out
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>30 &lt;span style="color:#f92672">=&lt;/span> Utf8 Ljava&lt;span style="color:#f92672">/&lt;/span>io&lt;span style="color:#f92672">/&lt;/span>PrintStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>31 &lt;span style="color:#f92672">=&lt;/span> Utf8 java&lt;span style="color:#f92672">/&lt;/span>io&lt;span style="color:#f92672">/&lt;/span>PrintStream
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>32 &lt;span style="color:#f92672">=&lt;/span> Utf8 println
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>33 &lt;span style="color:#f92672">=&lt;/span> Utf8 (Ljava&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>String;)V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç±»çš„æ–¹æ³•å®šä¹‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> æ–¹æ³•åŒº.&lt;span style="color:#a6e22e">Demo3&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> descriptor: ()V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flags: (0x0001) ACC_PUBLIC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Code:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stack&lt;span style="color:#f92672">=&lt;/span>1, locals&lt;span style="color:#f92672">=&lt;/span>1, args_size&lt;span style="color:#f92672">=&lt;/span>1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0: aload_0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1: invokespecial &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>1 &lt;span style="color:#75715e">// Method java/lang/Object.&amp;#34;&amp;lt;init&amp;gt;&amp;#34;:()V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 4: &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LineNumberTable:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> line 6: 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LocalVariableTable:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Start Length Slot Name Signature
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0 5 0 &lt;span style="color:#66d9ef">this&lt;/span> Læ–¹æ³•åŒº&lt;span style="color:#f92672">/&lt;/span>Demo3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(java.&lt;span style="color:#a6e22e">lang&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> descriptor: (&lt;span style="color:#f92672">[&lt;/span>Ljava&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>String;)V
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flags: (0x0009) ACC_PUBLIC, ACC_STATIC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Code:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stack&lt;span style="color:#f92672">=&lt;/span>2, locals&lt;span style="color:#f92672">=&lt;/span>1, args_size&lt;span style="color:#f92672">=&lt;/span>1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è™šæ‹ŸæœºæŒ‡ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0: getstatic &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>2 &lt;span style="color:#75715e">// Field java/lang/System.out:Ljava/io/PrintStream;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3: ldc &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>3 &lt;span style="color:#75715e">// String Hello world&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 5: invokevirtual &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>4 &lt;span style="color:#75715e">// Method java/io/PrintStream.println:(Ljava/lang/String;)V&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 8: &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LineNumberTable:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> line 8: 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> line 9: 8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LocalVariableTable:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Start Length Slot Name Signature
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0 9 0 args &lt;span style="color:#f92672">[&lt;/span>Ljava&lt;span style="color:#f92672">/&lt;/span>lang&lt;span style="color:#f92672">/&lt;/span>String;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SourceFile: &lt;span style="color:#e6db74">&amp;#34;Demo3.java&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ä¸²æ± stringtableçš„ç‰¹æ€§">ä¸²æ± (StringTable)çš„ç‰¹æ€§&lt;/h5>
&lt;p>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·,ç¬¬ä¸€æ¬¡ç”¨åˆ°çš„æ—¶å€™æ‰å›žå˜æˆå¯¹è±¡&lt;/p>
&lt;p>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶,æ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&lt;/p>
&lt;p>å­—ç¬¦ä¸²å˜é‡æ‹¼æŽ¥çš„åŽŸç†æ˜¯&lt;code>StringBuilder&lt;/code>(1.8)&lt;/p>
&lt;p>å­—ç¬¦ä¸²å¸¸é‡æ‹¼æŽ¥çš„åŽŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–&lt;/p>
&lt;p>å¯ä»¥ä½¿ç”¨&lt;code>intern&lt;/code>æ–¹æ³•,ä¸»åŠ¨å°†ä¸²æ± ä¸­çš„è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> String(&lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> String(&lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿™æ˜¯1.8çš„ è®²å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­,å¦‚æžœæœ‰ä¸ä¼šæ”¾å…¥,å¦‚æžœæ²¡æœ‰åˆ™ä¼šæ”¾å…¥ä¸²æ± ,ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›ž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1.8å’Œ1.6 ä¸ä¸€æ ·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String intern &lt;span style="color:#f92672">=&lt;/span> s.&lt;span style="color:#a6e22e">intern&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(intern&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ab&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(s&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ab&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¸¸é‡æ± å’Œä¸²æ± çš„åŒºåˆ«">å¸¸é‡æ± å’Œä¸²æ± çš„åŒºåˆ«&lt;/h5>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// StringTable[&amp;#34;a&amp;#34;,&amp;#34;b&amp;#34;,&amp;#34;ab&amp;#34;]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åç¼–è¯‘ä¹‹åŽ,å¸¸é‡æ± ä¸­çš„ä¿¡æ¯,éƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­,è¿™æ—¶éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·,è¿˜æ²¡æœ‰å˜æˆJavaå­—ç¬¦ä¸²å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿è¡Œåˆ°s1è¿™è¡Œä»£ç çš„æ—¶å€™,å°±ä¼šæŠŠaç¬¦å·å˜æˆaå­—ç¬¦ä¸²å¯¹è±¡,å­˜å…¥åˆ°stringtable[]ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”¨åˆ°æ‰ä¼šåˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ”¾åˆ°ä¸²æ± ä¸­,ä¹Ÿå°±æ˜¯æ‡’åŠ è½½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>; &lt;span style="color:#75715e">// æ‡’åŠ è½½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s3 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ab&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å­—ç¬¦ä¸²ç›¸åŠ çš„åŽŸç†:new StringBuilder().append(s1).append(s2).toString()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸Šé¢s3çš„ä½ç½®æ˜¯åœ¨ä¸²æ± ä¸­,s4 æ˜¯åœ¨å †å†…å­˜ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s4 &lt;span style="color:#f92672">=&lt;/span> s1 &lt;span style="color:#f92672">+&lt;/span> s2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(s3 &lt;span style="color:#f92672">==&lt;/span> s4);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// javacåœ¨ç¼–è¯‘æœŸé—´å°±ç¡®å®šä¸ºabäº†,è¿è¡Œçš„æ—¶å€™ç›´æŽ¥åŽ»ä¸²æ± ä¸­æŸ¥æ‰¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String s5 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(s3 &lt;span style="color:#f92672">==&lt;/span> s5);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯æ˜Žå­—ç¬¦ä¸²åŠ è½½çš„å»¶è¿Ÿç‰¹æ€§&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051506157.png" alt="image-20230823214436317">&lt;/p>
&lt;h5 id="stringtableçš„ä½ç½®">StringTableçš„ä½ç½®&lt;/h5>
&lt;p>ä½ç½®çš„ç§»åŠ¨,åœ¨1.6çš„æ—¶å€™è¦ä½¿ç”¨full gcæ‰èƒ½è¢«å›žæ”¶,1.8ç§»åŠ¨åˆ°å †å†…å­˜äº†,minco gc å°±å¯ä»¥å›žæ”¶&lt;/p>
&lt;h5 id="stringtableçš„è°ƒä¼˜">StringTableçš„è°ƒä¼˜&lt;/h5>
&lt;p>1.è°ƒæ•´-XX:StringTableSize=æ¡¶çš„ä¸ªæ•°&lt;/p>
&lt;p>2.è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± &lt;/p>
&lt;p>æ¯”å¦‚æœ‰å¾ˆå¤šäººçš„åœ°å€,éƒ½åŒ…å«åŒ—äº¬å¸‚è¿™æ ·çš„å­—ç¬¦ä¸²,å°±åº”è¯¥è€ƒè™‘å…¥æ± &lt;/p>
&lt;h2 id="ç›´æŽ¥å†…å­˜direct-memory">ç›´æŽ¥å†…å­˜(Direct Memory)&lt;/h2>
&lt;p>å¸¸è§äºŽNIO(&lt;code>ByteBuffer&lt;/code>)æ“ä½œæ—¶,ç”¨æˆ·æ•°æ®ç¼“å†²åŒº&lt;/p>
&lt;p>åˆ†é…å›žæ”¶æˆæœ¬è¾ƒé«˜,è¯»å†™æ€§èƒ½é«˜&lt;/p>
&lt;p>ä¸å—JVMå†…å­˜å›žæ”¶ç®¡ç†&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051508986.png" alt="image-20230831150048574">&lt;/p>
&lt;h3 id="æ¼”ç¤ºç›´æŽ¥å†…å­˜æº¢å‡º">æ¼”ç¤ºç›´æŽ¥å†…å­˜æº¢å‡º&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> _100MB &lt;span style="color:#f92672">=&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 100;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>ByteBuffer&lt;span style="color:#f92672">&amp;gt;&lt;/span> objects &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#66d9ef">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByteBuffer allocate &lt;span style="color:#f92672">=&lt;/span> ByteBuffer.&lt;span style="color:#a6e22e">allocateDirect&lt;/span>(_100MB);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> objects.&lt;span style="color:#a6e22e">add&lt;/span>(allocate);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Exception in thread &lt;span style="color:#e6db74">&amp;#34;main&amp;#34;&lt;/span> java.&lt;span style="color:#a6e22e">lang&lt;/span>.&lt;span style="color:#a6e22e">OutOfMemoryError&lt;/span>: Direct buffer memory
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at java.&lt;span style="color:#a6e22e">base&lt;/span>&lt;span style="color:#f92672">/&lt;/span>java.&lt;span style="color:#a6e22e">nio&lt;/span>.&lt;span style="color:#a6e22e">Bits&lt;/span>.&lt;span style="color:#a6e22e">reserveMemory&lt;/span>(Bits.&lt;span style="color:#a6e22e">java&lt;/span>:175)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at java.&lt;span style="color:#a6e22e">base&lt;/span>&lt;span style="color:#f92672">/&lt;/span>java.&lt;span style="color:#a6e22e">nio&lt;/span>.&lt;span style="color:#a6e22e">DirectByteBuffer&lt;/span>.&lt;span style="color:#f92672">&amp;lt;&lt;/span>init&lt;span style="color:#f92672">&amp;gt;&lt;/span>(DirectByteBuffer.&lt;span style="color:#a6e22e">java&lt;/span>:118)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at java.&lt;span style="color:#a6e22e">base&lt;/span>&lt;span style="color:#f92672">/&lt;/span>java.&lt;span style="color:#a6e22e">nio&lt;/span>.&lt;span style="color:#a6e22e">ByteBuffer&lt;/span>.&lt;span style="color:#a6e22e">allocateDirect&lt;/span>(ByteBuffer.&lt;span style="color:#a6e22e">java&lt;/span>:317)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> at ç›´æŽ¥å†…å­˜.&lt;span style="color:#a6e22e">Demo&lt;/span>.&lt;span style="color:#a6e22e">main&lt;/span>(Demo.&lt;span style="color:#a6e22e">java&lt;/span>:18)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é‡Šæ”¾åŽŸç†">é‡Šæ”¾åŽŸç†&lt;/h3>
&lt;p>ä½¿ç”¨UnSafeå¯¹è±¡å®Œæˆäº†ç›´æŽ¥å†…å­˜çš„åˆ†é…å›žæ”¶,è€Œä¸”å›žæ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•&lt;/p>
&lt;p>ByteBufferçš„å®žçŽ°ç±»å†…éƒ¨,ä½¿ç”¨äº†Cleaner(è™šå¼•ç”¨)æ¥æ£€æµ‹ByteBufferå¯¹è±¡,ä¸€æ—¦ByteBufferå¯¹è±¡è¢«åžƒåœ¾å›žæ”¶,å°±ä¼šç”±ReferenceHandlerçº¿ç¨‹é€šè¿‡Cleaneræ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾ç›´æŽ¥å†…å­˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> _1GB &lt;span style="color:#f92672">=&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 1024;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByteBuffer byteBuffer &lt;span style="color:#f92672">=&lt;/span> ByteBuffer.&lt;span style="color:#a6e22e">allocateDirect&lt;/span>(_1GB);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;åˆ†é…å®Œæ¯•&amp;#34;&lt;/span>); &lt;span style="color:#75715e">// çœ‹ä»»åŠ¡ç®¡ç†å™¨,å¯ä»¥çœ‹åˆ°è¿™ä¸ªç¨‹åºå ç”¨1G+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¼€å§‹é‡Šæ”¾&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byteBuffer &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">gc&lt;/span>(); &lt;span style="color:#75715e">// å¯ä»¥çœ‹åˆ°è¢«ä¼šå›žæ”¶äº†,ä¸ºä»€ä¹ˆä¼šè¢«å›žæ”¶å‘¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é‡Šæ”¾åŽŸç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> _1GB &lt;span style="color:#f92672">=&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 1024 &lt;span style="color:#f92672">*&lt;/span> 1024;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> IOException, NoSuchFieldException, IllegalAccessException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Unsafe unsafe &lt;span style="color:#f92672">=&lt;/span> getUnsafe();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ†é…å†…å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// base è¡¨ç¤ºå†…å­˜åœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> base &lt;span style="color:#f92672">=&lt;/span> unsafe.&lt;span style="color:#a6e22e">allocateMemory&lt;/span>(_1GB);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> unsafe.&lt;span style="color:#a6e22e">setMemory&lt;/span>(base,_1GB,(&lt;span style="color:#66d9ef">byte&lt;/span>)0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡Šæ”¾å†…å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> unsafe.&lt;span style="color:#a6e22e">freeMemory&lt;/span>(base);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> Unsafe &lt;span style="color:#a6e22e">getUnsafe&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> NoSuchFieldException, IllegalAccessException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Field declaredField &lt;span style="color:#f92672">=&lt;/span> Unsafe.&lt;span style="color:#a6e22e">class&lt;/span>.&lt;span style="color:#a6e22e">getDeclaredField&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;theUnsafe&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> declaredField.&lt;span style="color:#a6e22e">setAccessible&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (Unsafe) declaredField.&lt;span style="color:#a6e22e">get&lt;/span>(&lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æºç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ByteBuffer.&lt;span style="color:#a6e22e">allocateDirect&lt;/span>(_1GB);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> ByteBuffer &lt;span style="color:#a6e22e">allocateDirect&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> capacity) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DirectByteBuffer(capacity);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DirectByteBuffer(&lt;span style="color:#66d9ef">int&lt;/span> cap) { &lt;span style="color:#75715e">// package-private&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>(&lt;span style="color:#f92672">-&lt;/span>1, 0, cap, cap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> pa &lt;span style="color:#f92672">=&lt;/span> VM.&lt;span style="color:#a6e22e">isDirectMemoryPageAligned&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ps &lt;span style="color:#f92672">=&lt;/span> Bits.&lt;span style="color:#a6e22e">pageSize&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> size &lt;span style="color:#f92672">=&lt;/span> Math.&lt;span style="color:#a6e22e">max&lt;/span>(1L, (&lt;span style="color:#66d9ef">long&lt;/span>)cap &lt;span style="color:#f92672">+&lt;/span> (pa &lt;span style="color:#f92672">?&lt;/span> ps : 0));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Bits.&lt;span style="color:#a6e22e">reserveMemory&lt;/span>(size, cap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> base &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ†é…å†…å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> base &lt;span style="color:#f92672">=&lt;/span> UNSAFE.&lt;span style="color:#a6e22e">allocateMemory&lt;/span>(size);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (OutOfMemoryError x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Bits.&lt;span style="color:#a6e22e">unreserveMemory&lt;/span>(size, cap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UNSAFE.&lt;span style="color:#a6e22e">setMemory&lt;/span>(base, size, (&lt;span style="color:#66d9ef">byte&lt;/span>) 0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pa &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (base &lt;span style="color:#f92672">%&lt;/span> ps &lt;span style="color:#f92672">!=&lt;/span> 0)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Round up to page boundary&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> address &lt;span style="color:#f92672">=&lt;/span> base &lt;span style="color:#f92672">+&lt;/span> ps &lt;span style="color:#f92672">-&lt;/span> (base &lt;span style="color:#f92672">&amp;amp;&lt;/span> (ps &lt;span style="color:#f92672">-&lt;/span> 1));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> address &lt;span style="color:#f92672">=&lt;/span> base;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å½“thisè¢«å›žæ”¶æ—¶,å°±ä¼šè°ƒç”¨å›žè°ƒå‡½æ•°Deallocator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°±æ˜¯Javaå¯¹è±¡è¢«å›žæ”¶ï¼Œè§¦å‘ç›´æŽ¥å†…å­˜å›žæ”¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cleaner &lt;span style="color:#f92672">=&lt;/span> Cleaner.&lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> Deallocator(base, size, cap));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> att &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç»§æ‰¿äº†è™šåº”ç”¨å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Cleaner&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> PhantomReference&lt;span style="color:#f92672">&amp;lt;&lt;/span>Object&lt;span style="color:#f92672">&amp;gt;&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">clean&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>remove(&lt;span style="color:#66d9ef">this&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> thunk.&lt;span style="color:#a6e22e">run&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (&lt;span style="color:#66d9ef">final&lt;/span> Throwable x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AccessController.&lt;span style="color:#a6e22e">doPrivileged&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> PrivilegedAction&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Void &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (System.&lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> Error(&lt;span style="color:#e6db74">&amp;#34;Cleaner terminated abnormally&amp;#34;&lt;/span>, x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">exit&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å›žè°ƒå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Deallocator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">implements&lt;/span> Runnable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> address;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> capacity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#a6e22e">Deallocator&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> address, &lt;span style="color:#66d9ef">long&lt;/span> size, &lt;span style="color:#66d9ef">int&lt;/span> capacity) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">assert&lt;/span> (address &lt;span style="color:#f92672">!=&lt;/span> 0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">address&lt;/span> &lt;span style="color:#f92672">=&lt;/span> address;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">size&lt;/span> &lt;span style="color:#f92672">=&lt;/span> size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">capacity&lt;/span> &lt;span style="color:#f92672">=&lt;/span> capacity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (address &lt;span style="color:#f92672">==&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Paranoia&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡Šæ”¾ç›´æŽ¥å†…å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UNSAFE.&lt;span style="color:#a6e22e">freeMemory&lt;/span>(address);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> address &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Bits.&lt;span style="color:#a6e22e">unreserveMemory&lt;/span>(size, capacity);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åžƒåœ¾å›žæ”¶æœºåˆ¶">åžƒåœ¾å›žæ”¶æœºåˆ¶&lt;/h2>
&lt;h3 id="å¯è¾¾æ€§åˆ†æžæ³•">å¯è¾¾æ€§åˆ†æžæ³•&lt;/h3>
&lt;p>å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥å›žæ”¶&lt;/p>
&lt;ol>
&lt;li>å¼•ç”¨è®¡æ•°æ³•&lt;/li>
&lt;li>å¯è¾¾æ€§åˆ†æžæ³•,ä½¿ç”¨&lt;a href="https://projects.eclipse.org/projects/tools.mat">Eclipse Memory Analyzer&lt;/a> ,æ²¿ç€GC RootæŸ¥æ‰¾,æ‰¾åˆ°å°±ä¸èƒ½å›žæ”¶&lt;/li>
&lt;/ol>
&lt;p>Eclipse Memory Analyzerçš„ä½¿ç”¨æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ä½¿ç”¨mat æ¼”ç¤ºGC root
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Demo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ArrayList&lt;span style="color:#f92672">&amp;lt;&lt;/span>Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> list1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list1.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list1.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// jsp èŽ·å–åˆ°è¿›ç¨‹id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// jmap -dump:format=b,live,file=1.bin è¿›ç¨‹id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">in&lt;/span>.&lt;span style="color:#a6e22e">read&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;end....&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>live ä»£è¡¨çš„æ„æ€æ˜¯,æ‰§è¡Œdumpæ–‡ä»¶çš„æ—¶å€™,å…ˆæ‰§è¡Œä¸€æ¬¡GC&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051508558.png" alt="image-20230824141103802">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051508709.png" alt="image-20230824141147149">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051509973.png" alt="image-20230824141218556">&lt;/p>
&lt;p>å¤§æ¦‚æœ‰å››ç±»:&lt;/p>
&lt;p>System Class&lt;/p>
&lt;p>Native Stack,è°ƒç”¨nativeæ–¹æ³•è¦ä½¿ç”¨åˆ°çš„&lt;/p>
&lt;p>Thread,æ´»åŠ¨çº¿ç¨‹,ä½¿ç”¨åˆ°çš„å¯¹è±¡&lt;/p>
&lt;p>Busy Monitor,å„ç§é”&lt;/p>
&lt;h3 id="å››ç§å¼•ç”¨">å››ç§å¼•ç”¨&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051509306.png" alt="image-20230824141552451">&lt;/p>
&lt;p>å¼ºå¼•ç”¨&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å¼ºå¼•ç”¨&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>è½¯å¼•ç”¨&lt;/td>
&lt;td>æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡,åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«åžƒåœ¾å›žæ”¶&lt;/td>
&lt;td>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼•ç”¨è‡ªèº«&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å¼±å¼•ç”¨&lt;/td>
&lt;td>åœ¨GCæ—¶,ä¸ç®¡å†…å­˜æ˜¯å¦å……è¶³éƒ½ä¼šè¢«å›žæ”¶&lt;/td>
&lt;td>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼•ç”¨è‡ªèº«&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>éœ€å¼•ç”¨&lt;/td>
&lt;td>ä¸»è¦åˆ†é…ByteBufferä½¿ç”¨,è¢«å¼•ç”¨å¯¹è±¡å›žæ”¶æ—¶,è¢«å¼•ç”¨å¯¹è±¡å›žæ”¶æ—¶,ä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿ,ç”±Reference Handlerçº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æŽ¥å†…å­˜&lt;/td>
&lt;td>å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ç»ˆç»“å™¨å¼•ç”¨&lt;/td>
&lt;td>æ— éœ€æ‰‹åŠ¨ç¼–ç ,GCæ—¶,ç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿ,å†ç”±Finalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨å¹¶è°ƒç”¨finalizeæ–¹æ³•,ç¬¬äºŒæ¬¡GCæ—¶,æ‰èƒ½è¢«å›žæ”¶&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="åžƒåœ¾å›žæ”¶ç®—æ³•">åžƒåœ¾å›žæ”¶ç®—æ³•&lt;/h3>
&lt;ul>
&lt;li>æ ‡è®°æ¸…é™¤&lt;/li>
&lt;li>æ ‡è®°æ•´ç†&lt;/li>
&lt;li>å¤åˆ¶&lt;/li>
&lt;/ul>
&lt;h4 id="æ ‡è®°æ¸…é™¤">æ ‡è®°æ¸…é™¤&lt;/h4>
&lt;p>åŽŸæœ¬çš„å†…å­˜ä½¿ç”¨æƒ…å†µ&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051509603.png" alt="image-20230824143552505">&lt;/p>
&lt;p>æ ‡è®°&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051512492.png" alt="image-20230824143616710">&lt;/p>
&lt;p>æŠŠè¦æ¸…æ¥šçš„å†…å­˜çš„å¼€å§‹åœ°å€æ”¾åœ¨åˆ—è¡¨ä½ ,ç­‰ä¸‹æ¬¡è¦åˆ†é…å†…å­˜çš„æ—¶å€™,ç›´æŽ¥åœ¨åˆ—è¡¨é‡Œæ‰¾&lt;/p>
&lt;p>ä¼˜ç‚¹:å°±æ˜¯é€Ÿåº¦å¿«&lt;/p>
&lt;p>ç¼ºç‚¹:äº§ç”Ÿå†…å­˜ç¢Žç‰‡&lt;/p>
&lt;h4 id="æ ‡è®°æ•´ç†">æ ‡è®°æ•´ç†&lt;/h4>
&lt;p>æ ‡è®°&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051512395.png" alt="image-20230824143845073">&lt;/p>
&lt;p>æ•´ç†&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051512099.png" alt="image-20230824143905620">&lt;/p>
&lt;p>ä¼˜ç‚¹:ä¸ä¼šäº§ç”Ÿç¢Žç‰‡&lt;/p>
&lt;p>ç¼ºç‚¹:é€Ÿåº¦æ…¢&lt;/p>
&lt;h4 id="å¤åˆ¶ç®—æ³•">å¤åˆ¶ç®—æ³•&lt;/h4>
&lt;p>åŽŸæ¥çš„å†…å­˜ä½¿ç”¨&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051514508.png" alt="image-20230824144146317">&lt;/p>
&lt;p>æ ‡è®°&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051514387.png" alt="image-20230824144219705">&lt;/p>
&lt;p>å¤åˆ¶&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051514593.png" alt="image-20230824144234895">&lt;/p>
&lt;p>æ¸…ç†&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515251.png" alt="image-20230824144247178">&lt;/p>
&lt;p>äº¤æ¢from å’Œ toçš„ä½ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515286.png" alt="image-20230824144305405">&lt;/p>
&lt;h3 id="åˆ†ä»£å›žæ”¶">åˆ†ä»£å›žæ”¶&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>æ–°ç”Ÿä»£: Minor GC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ä¼Šç”¸å›­
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> å¹¸å­˜åŒº from
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> å¹¸å­˜åŒº to
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>è€å¹´ä»£: Full GC ä¹Ÿä¼šæ¸…ç†æ–°ç”Ÿä»£
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨ä¼Šç”¸å›­åŒºåŸŸ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï»¿æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ minor geï¼Œä¼Šç”¸å›­å’Œtrom å­˜æ´»çš„å¯¹è±¡ä½¿ç”¨copy å¤åˆ¶åˆ°10ä¸­ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„åŠ 1å¹¶ä¸”äº¤æ¢ from to&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï»¿ï»¿minor se ä¼šå¼•1å‘ stop the wvoridï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åžƒåœ¾å›žæ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï»¿å½“å¯¹è±¡å¯¿å‘½è¶…è¿‡åœ‹å€¼æ—¶ï¼Œä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼Œæœ€å¤§å¯¿å‘½æ˜¯15 (4bit)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï»¿å½“è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œä¼šå…ˆå°è¯•è§¦å‘ mninor geï¼Œå¦‚æžœä¹‹åŽç©ºé—´ä»ä¸è¶³ï¼Œé‚£ä¹ˆè§¦å‘ foll ge, sTwçš„æ—¶é—´æ›´é•¿&lt;/p>
&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å«ä¹‰&lt;/th>
&lt;th>å‚æ•°&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å †åˆå§‹å¤§å°&lt;/td>
&lt;td>Xms&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å †æœ€å¤§å¤§å°&lt;/td>
&lt;td>xmx æˆ– -Xx:MaxFeapSize=size&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ–°ç”Ÿä»£å¤§å°&lt;/td>
&lt;td>Xmn æˆ– ï¼ˆ-XX:NewSize=size + -XX:MaxNewSize=size)&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰&lt;/td>
&lt;td>Xx:InitialSurvivorRatio=ratio å’Œ-XX:+UseAdaptiveSizePolicy&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å¹¸å­˜åŒºæ¯”ä¾‹&lt;/td>
&lt;td>XX:SurvivorRatio=ratio&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ™‹å‡é˜ˆå€¼&lt;/td>
&lt;td>XX:MaxTenuringThreshold=threshold (thresholdå’Œå…·ä½“çš„å›žæ”¶å™¨æœ‰å…³)&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ™‹å‡è¯¦æƒ…&lt;/td>
&lt;td>XX: +PrintTenuringDistribution&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>GCè¯¦æƒ…&lt;/td>
&lt;td>XX:+PrintGCDetails - verbose:go&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FullGC å‰ MinorGC&lt;/td>
&lt;td>XX:+ScavengeBeforeFullGC&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="servlet">Servlet&lt;/h1>
&lt;h2 id="æ­å»ºçŽ¯å¢ƒxmlç‰ˆæœ¬">æ­å»ºçŽ¯å¢ƒ(XMLç‰ˆæœ¬)&lt;/h2>
&lt;p>ä¸‹è½½,è§£åŽ‹tomcat,è¿è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¿›å…¥ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd apache-tomcat-10.0.27/bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¿è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh startup.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŠ¥é”™ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The file is absent or does not have execute permission
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>This file is needed to run this program
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŽˆæƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">777&lt;/span> apache-tomcat-10.0.27
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å†æ¬¡è¿è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh startup.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰“å°ç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using CATALINA_BASE: /Users/anthony/Downloads/apache-tomcat-10.0.27
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using CATALINA_HOME: /Users/anthony/Downloads/apache-tomcat-10.0.27
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using CATALINA_TMPDIR: /Users/anthony/Downloads/apache-tomcat-10.0.27/temp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using JRE_HOME: /Library/Java/JavaVirtualMachines/jdk-18.0.1.jdk/Contents/Home
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using CLASSPATH: /Users/anthony/Downloads/apache-tomcat-10.0.27/bin/bootstrap.jar:/Users/anthony/Downloads/apache-tomcat-10.0.27/bin/tomcat-juli.jar
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using CATALINA_OPTS:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Tomcat started.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®¿é—®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://localhost:8080
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–‡ä»¶ç›®å½•ç»“æž„
&lt;img src="https://image.runtimes.cc/202404051515409.png" alt="">&lt;/p>
&lt;p>å¯¼åŒ…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;project&lt;/span> &lt;span style="color:#a6e22e">xmlns=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">xmlns:xsi=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">xsi:schemaLocation=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;modelVersion&amp;gt;&lt;/span>4.0.0&lt;span style="color:#f92672">&amp;lt;/modelVersion&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>org.example&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>servlet-xml&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æ‰“waråŒ… --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;packaging&amp;gt;&lt;/span>war&lt;span style="color:#f92672">&amp;lt;/packaging&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>1.0-SNAPSHOT&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;name&amp;gt;&lt;/span>servlet-xml Maven Webapp&lt;span style="color:#f92672">&amp;lt;/name&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.tomcat&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>tomcat-servlet-api&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>10.0.4&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;build&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;finalName&amp;gt;&lt;/span>servlet-xml&lt;span style="color:#f92672">&amp;lt;/finalName&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/build&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/project&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸ºæ˜¯ä½¿ç”¨çš„tomcat10,æ‰€æœ‰å¯¼å…¥çš„åŒ…ä¸ä¸€æ ·,å¦‚æžœæ˜¯tomcat10ä¹‹å‰çš„ç‰ˆæœ¬,å¯¼å…¥çš„åŒ…å¥½åƒæ˜¯&lt;code>java-serverlt-api&lt;/code>&lt;/p>
&lt;p>å‚è€ƒ:&lt;a href="https://taurusxin.com/tomcat10-issue/">https://taurusxin.com/tomcat10-issue/&lt;/a>&lt;/p>
&lt;p>ä»£ç &lt;/p>
&lt;p>HelloWorld.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.mmzcg.servlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¼å…¥å¿…éœ€çš„ java åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.PrintWriter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰©å±• HttpServlet ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">HelloWorld&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> HttpServlet {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doGet&lt;/span>(HttpServletRequest request,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletResponse response)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> ServletException, IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®å“åº”å†…å®¹ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;text/html&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®žé™…çš„é€»è¾‘æ˜¯åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PrintWriter out &lt;span style="color:#f92672">=&lt;/span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> out.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;h1&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> message &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;/h1&amp;gt;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">destroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»€ä¹ˆä¹Ÿä¸åš&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘å°±æ²¡è§è¿‡é”€æ¯è¿‡&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Version.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.mmzcg.servlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¼å…¥å¿…éœ€çš„ java åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.PrintWriter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰©å±• HttpServlet ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Version&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> HttpServlet {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doGet&lt;/span>(HttpServletRequest request,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletResponse response)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> ServletException, IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®å“åº”å†…å®¹ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;text/html&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®žé™…çš„é€»è¾‘æ˜¯åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PrintWriter out &lt;span style="color:#f92672">=&lt;/span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> out.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;h1&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;è¿”å›žçš„æ˜¯ç‰ˆæœ¬å·&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;/h1&amp;gt;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">destroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»€ä¹ˆä¹Ÿä¸åš&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘å°±æ²¡è§è¿‡é”€æ¯è¿‡&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>index.jsp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è§£å†³ä¸­æ–‡ä¹±ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;%&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span> page language&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;java&amp;#34;&lt;/span> contentType&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;text/html; charset=UTF-8&amp;#34;&lt;/span> pageEncoding&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#f92672">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>html&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>body&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>h2&lt;span style="color:#f92672">&amp;gt;&lt;/span>è¿™æ˜¯é¦–é¡µ&lt;span style="color:#f92672">&amp;lt;/&lt;/span>h2&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>æœ‰ä¸¤ä¸ªurl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>a href&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>hello&lt;span style="color:#f92672">&amp;lt;/&lt;/span>a&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>a href&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/version&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>version&lt;span style="color:#f92672">&amp;lt;/&lt;/span>a&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/&lt;/span>body&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/&lt;/span>html&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>web.xml&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;!&lt;/span>DOCTYPE web&lt;span style="color:#f92672">-&lt;/span>app PUBLIC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;http://java.sun.com/dtd/web-app_2_3.dtd&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>web&lt;span style="color:#f92672">-&lt;/span>app&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>display&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>Archetype Created Web Application&lt;span style="color:#f92672">&amp;lt;/&lt;/span>display&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>HelloWorld&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">com&lt;/span>.&lt;span style="color:#a6e22e">mmzcg&lt;/span>.&lt;span style="color:#a6e22e">servlet&lt;/span>.&lt;span style="color:#a6e22e">HelloWorld&lt;/span>&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/&lt;/span>&lt;span style="color:#a6e22e">servlet&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>Version&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">com&lt;/span>.&lt;span style="color:#a6e22e">mmzcg&lt;/span>.&lt;span style="color:#a6e22e">servlet&lt;/span>.&lt;span style="color:#a6e22e">Version&lt;/span>&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">&amp;lt;/&lt;/span>&lt;span style="color:#a6e22e">servlet&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>mapping&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>HelloWorld&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>url&lt;span style="color:#f92672">-&lt;/span>pattern&lt;span style="color:#f92672">&amp;gt;/&lt;/span>hello&lt;span style="color:#f92672">&amp;lt;/&lt;/span>url&lt;span style="color:#f92672">-&lt;/span>pattern&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>mapping&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>mapping&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>Version&lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>url&lt;span style="color:#f92672">-&lt;/span>pattern&lt;span style="color:#f92672">&amp;gt;/&lt;/span>version&lt;span style="color:#f92672">&amp;lt;/&lt;/span>url&lt;span style="color:#f92672">-&lt;/span>pattern&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/&lt;/span>servlet&lt;span style="color:#f92672">-&lt;/span>mapping&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/&lt;/span>web&lt;span style="color:#f92672">-&lt;/span>app&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&amp;lt;project xmlns&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34;&lt;/span> xmlns:xsi&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xsi:schemaLocation&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;groupId&amp;gt;org.example&amp;lt;/groupId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;artifactId&amp;gt;servlet-xml&amp;lt;/artifactId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;version&amp;gt;1.0-SNAPSHOT&amp;lt;/version&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;name&amp;gt;servlet-xml Maven Webapp&amp;lt;/name&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;dependencies&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;dependency&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;groupId&amp;gt;org.apache.tomcat&amp;lt;/groupId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;artifactId&amp;gt;tomcat-servlet-api&amp;lt;/artifactId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;version&amp;gt;10.0.4&amp;lt;/version&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;/dependency&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;/dependencies&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;build&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;finalName&amp;gt;servlet-xml&amp;lt;/finalName&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;/build&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/project&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡ŒçŽ¯å¢ƒä¸€:åœ¨IDEAä¸Šè¿è¡Œtomcat&lt;/p>
&lt;p>æ·»åŠ tomcatæ¨¡æ¿&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515728.png" alt="">&lt;/p>
&lt;p>é…ç½®tomcat_home&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515905.png" alt="">&lt;/p>
&lt;p>é…ç½®åŒ…å’Œè·¯å¾„&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515430.png" alt="">&lt;/p>
&lt;p>è¿è¡ŒçŽ¯å¢ƒä¸€:åœ¨å‘½ä»¤è¡Œè¿è¡Œtomcat&lt;/p>
&lt;p>å…ˆåœæŽ‰tomcat,å¤åˆ¶waråŒ…åˆ°webappsç›®å½•é‡Œ&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515813.png" alt="">&lt;/p>
&lt;p>å†å¯åŠ¨tomcat,é»˜è®¤çš„è®¿é—®åœ°å€å°±æ˜¯:&lt;code>http://localhost:8080/servlet-xml/&lt;/code>&lt;/p>
&lt;h2 id="æ­å»ºçŽ¯å¢ƒæ³¨è§£ç‰ˆæœ¬">æ­å»ºçŽ¯å¢ƒ(æ³¨è§£ç‰ˆæœ¬)&lt;/h2>
&lt;p>å‰é¢çš„éƒ½ä¸å˜,åªæ˜¯æ”¹ä¸‹ä»£ç &lt;/p>
&lt;p>web.xml&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!DOCTYPE web-app PUBLIC
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> &amp;#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> &amp;#34;http://java.sun.com/dtd/web-app_2_3.dtd&amp;#34; &amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;web-app&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;display-name&amp;gt;&lt;/span>Archetype Created Web Application&lt;span style="color:#f92672">&amp;lt;/display-name&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/web-app&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>index.jsp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">html&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">body&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#f92672">h2&lt;/span>&amp;gt;Hello World!&amp;lt;/&lt;span style="color:#f92672">h2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">body&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/&lt;span style="color:#f92672">html&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡ŒçŽ¯å¢ƒä¸€:åœ¨å‘½ä»¤è¡Œè¿è¡Œtomcat&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515268.png" alt="">&lt;/p>
&lt;p>HelloWorld.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.mmzcg.annotation;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¼å…¥å¿…éœ€çš„ java åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.annotation.WebServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.PrintWriter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰©å±• HttpServlet ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@WebServlet&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/hello&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">HelloWorld&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> HttpServlet {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ³¨è§£æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doGet&lt;/span>(HttpServletRequest request,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletResponse response)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> ServletException, IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®å“åº”å†…å®¹ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;text/html&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®žé™…çš„é€»è¾‘æ˜¯åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PrintWriter out &lt;span style="color:#f92672">=&lt;/span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> out.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;h1&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> message &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;/h1&amp;gt;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">destroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»€ä¹ˆä¹Ÿä¸åš&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ³¨è§£æˆ‘å°±æ²¡è§è¿‡é”€æ¯è¿‡&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Version.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.mmzcg.annotation;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¼å…¥å¿…éœ€çš„ java åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.annotation.WebServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServlet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> jakarta.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.PrintWriter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰©å±• HttpServlet ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@WebServlet&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/version&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Version&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> HttpServlet {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ‰§è¡Œå¿…éœ€çš„åˆå§‹åŒ–&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doGet&lt;/span>(HttpServletRequest request,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HttpServletResponse response)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> ServletException, IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®å“åº”å†…å®¹ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;text/html&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®žé™…çš„é€»è¾‘æ˜¯åœ¨è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PrintWriter out &lt;span style="color:#f92672">=&lt;/span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> out.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;h1&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ³¨è§£è¿”å›žçš„æ˜¯ç‰ˆæœ¬å·&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;/h1&amp;gt;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">destroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»€ä¹ˆä¹Ÿä¸åš&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘å°±æ²¡è§è¿‡é”€æ¯è¿‡&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä¸­æ–‡ä¹±ç ">ä¸­æ–‡ä¹±ç &lt;/h2>
&lt;h3 id="tomcaté…ç½®æ–‡ä»¶">Tomcaté…ç½®æ–‡ä»¶&lt;/h3>
&lt;p>apache-tomcat-8.5.69\conf\server.xml æ·»åŠ URIEncoding=&amp;ldquo;UTF-8&amp;rdquo; å±žæ€§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Connector port&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;8080&amp;#34;&lt;/span> protocol&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;HTTP/1.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> connectionTimeout&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;20000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redirectPort&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;8443&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> URIEncoding&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ideaæŒ‡å®šç¼–ç ">IdeaæŒ‡å®šç¼–ç &lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051515788.png" alt="">&lt;/p>
&lt;h3 id="jspæŒ‡å®šç¼–ç ">JspæŒ‡å®šç¼–ç &lt;/h3>
&lt;p>åœ¨jspçš„htmlæœ€å…ˆæ·»åŠ &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;%&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span> &lt;span style="color:#f92672">**&lt;/span>page&lt;span style="color:#f92672">**&lt;/span> language&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;java&amp;#34;&lt;/span> contentType&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;text/html; charset=UTF-8&amp;#34;&lt;/span> pageEncoding&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#f92672">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="httpresponseæŒ‡å®šç¼–ç ">httpResponseæŒ‡å®šç¼–ç &lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¤‡æ³¨ï¼šè¯¥æ–¹æ³•åªå¯¹POSTæ–¹å¼æäº¤çš„æ•°æ®æœ‰æ•ˆï¼Œå¯¹GETæ–¹å¼æäº¤çš„æ•°æ®æ— æ•ˆ!&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>request.&lt;span style="color:#a6e22e">setCharacterEncoding&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;UTF-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//åœ¨å“åº”ä¸­ä¸»åŠ¨å‘Šè¯‰æµè§ˆå™¨ä½¿ç”¨UTF-8ç¼–ç æ ¼å¼æ¥æŽ¥æ”¶æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>response.&lt;span style="color:#a6e22e">setHeader&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Content-Type&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text/html;charset=UTF-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//å¯ä»¥ä½¿ç”¨å°è£…ç±»ç®€å†™Content-Typeï¼Œä½¿ç”¨è¯¥æ–¹æ³•åˆ™æ— éœ€ä½¿ç”¨setCharacterEncoding&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;text/html;charset=UTF-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>Jenkins</title><link>https://connorzhangyu.com/posts/jenkins/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/jenkins/</guid><description>&lt;h1 id="rootç”¨æˆ·æƒé™å¯åŠ¨jenkins">Rootç”¨æˆ·æƒé™å¯åŠ¨Jenkins&lt;/h1>
&lt;p>é€‚ç”¨äºŽUbuntuçŽ¯å¢ƒä¸‹é€šè¿‡&lt;code>apt-get install -y jenkins&lt;/code>å‘½ä»¤åœ¨çº¿å®‰è£…çš„Jenkins&lt;/p>
&lt;p>1.ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/default/jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å°†ä¸‹é¢ä¸¤ä¸ªå‚æ•°ä¿®æ”¹ä¸ºroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹å‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_USER&lt;span style="color:#f92672">=&lt;/span>$NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_GROUP&lt;span style="color:#f92672">=&lt;/span>$NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹åŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_USER&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_GROUP&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>2.æ›´æ”¹ç›®å½•æƒé™&lt;/p>
&lt;p>ä¸çŸ¥é“è¿™æ­¥æœ‰æ²¡æœ‰èµ·ä½œç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /var/lib/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown -R root:root ./jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡å¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl restart jenkins.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="jenkinsä½¿ç”¨æ•™ç¨‹">Jenkinsä½¿ç”¨æ•™ç¨‹&lt;/h1>
&lt;h2 id="é…ç½®jdk">é…ç½®JDK&lt;/h2>
&lt;p>Manage Jenkins &amp;ndash;&amp;gt; Global Tool Configuration&lt;/p>
&lt;ol>
&lt;li>è‡ªåŠ¨å®‰è£…&lt;/li>
&lt;li>æ‰‹åŠ¨å®‰è£…è¦æ³¨æ„,J&lt;code>AVA_HOME&lt;/code>çš„è¾“å…¥æ¡†ä¸‹é¢ï¼Œä¸è¦æœ‰è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™å°±æ˜¯è·¯å¾„ä¸æ­£ç¡®,å–æ¶ˆå‹¾é€‰è‡ªåŠ¨å®‰è£…&lt;/li>
&lt;/ol>
&lt;h2 id="é…ç½®maven">é…ç½®Maven&lt;/h2>
&lt;ol>
&lt;li>å®‰è£…Maven Integration æ’ä»¶&lt;/li>
&lt;li>é€šå¸¸è‡ªåŠ¨å®‰è£…mavenå°±è¡Œäº†,å¦‚æžœæ‰‹åŠ¨å®‰è£…,&lt;code>MAVEN_HOME&lt;/code> è¾“å…¥æ¡†ä¸‹é¢ï¼Œä¸è¦æœ‰è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™å°±æ˜¯è·¯å¾„ä¸æ­£ç¡®&lt;/li>
&lt;/ol>
&lt;h2 id="èŽ·å–å½“å‰é¡¹ç›®åç§°">èŽ·å–å½“å‰é¡¹ç›®åç§°&lt;/h2>
&lt;p>åœ¨è„šæœ¬ä¸­è¾“å…¥ &lt;code>$JOB_NAME&lt;/code>å°±èƒ½èŽ·å–åˆ°äº†&lt;/p>
&lt;h2 id="å¸è½½jenkins">å¸è½½jenkins&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>//æœåŠ¡
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get remove jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>//å®‰è£…åŒ…ï¼Œæ³¨æ„è¿™é‡Œå¦‚æžœä¸æ˜¯ubuntué‚£å°±yum
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get remove --auto-remove jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>//é…ç½®å’Œæ•°æ®
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get purge jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get purge --auto-remove jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‡çº§jenkins">å‡çº§jenkins&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é€‚ç”¨äºŽubuntuå®‰è£…çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get upgrade jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åŒæ—¶æž„å»ºä»»åŠ¡çš„ä¸ªæ•°">åŒæ—¶æž„å»ºä»»åŠ¡çš„ä¸ªæ•°&lt;/h2>
&lt;p>ç³»ç»Ÿç®¡ç†&amp;ndash;&amp;gt;ç³»ç»Ÿè®¾ç½®&amp;ndash;&amp;gt;æ‰§è¡Œè€…æ•°é‡&lt;/p></description><content>&lt;h1 id="rootç”¨æˆ·æƒé™å¯åŠ¨jenkins">Rootç”¨æˆ·æƒé™å¯åŠ¨Jenkins&lt;/h1>
&lt;p>é€‚ç”¨äºŽUbuntuçŽ¯å¢ƒä¸‹é€šè¿‡&lt;code>apt-get install -y jenkins&lt;/code>å‘½ä»¤åœ¨çº¿å®‰è£…çš„Jenkins&lt;/p>
&lt;p>1.ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/default/jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å°†ä¸‹é¢ä¸¤ä¸ªå‚æ•°ä¿®æ”¹ä¸ºroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹å‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_USER&lt;span style="color:#f92672">=&lt;/span>$NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_GROUP&lt;span style="color:#f92672">=&lt;/span>$NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹åŽ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_USER&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>JENKINS_GROUP&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>2.æ›´æ”¹ç›®å½•æƒé™&lt;/p>
&lt;p>ä¸çŸ¥é“è¿™æ­¥æœ‰æ²¡æœ‰èµ·ä½œç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /var/lib/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown -R root:root ./jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡å¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl restart jenkins.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="jenkinsä½¿ç”¨æ•™ç¨‹">Jenkinsä½¿ç”¨æ•™ç¨‹&lt;/h1>
&lt;h2 id="é…ç½®jdk">é…ç½®JDK&lt;/h2>
&lt;p>Manage Jenkins &amp;ndash;&amp;gt; Global Tool Configuration&lt;/p>
&lt;ol>
&lt;li>è‡ªåŠ¨å®‰è£…&lt;/li>
&lt;li>æ‰‹åŠ¨å®‰è£…è¦æ³¨æ„,J&lt;code>AVA_HOME&lt;/code>çš„è¾“å…¥æ¡†ä¸‹é¢ï¼Œä¸è¦æœ‰è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™å°±æ˜¯è·¯å¾„ä¸æ­£ç¡®,å–æ¶ˆå‹¾é€‰è‡ªåŠ¨å®‰è£…&lt;/li>
&lt;/ol>
&lt;h2 id="é…ç½®maven">é…ç½®Maven&lt;/h2>
&lt;ol>
&lt;li>å®‰è£…Maven Integration æ’ä»¶&lt;/li>
&lt;li>é€šå¸¸è‡ªåŠ¨å®‰è£…mavenå°±è¡Œäº†,å¦‚æžœæ‰‹åŠ¨å®‰è£…,&lt;code>MAVEN_HOME&lt;/code> è¾“å…¥æ¡†ä¸‹é¢ï¼Œä¸è¦æœ‰è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™å°±æ˜¯è·¯å¾„ä¸æ­£ç¡®&lt;/li>
&lt;/ol>
&lt;h2 id="èŽ·å–å½“å‰é¡¹ç›®åç§°">èŽ·å–å½“å‰é¡¹ç›®åç§°&lt;/h2>
&lt;p>åœ¨è„šæœ¬ä¸­è¾“å…¥ &lt;code>$JOB_NAME&lt;/code>å°±èƒ½èŽ·å–åˆ°äº†&lt;/p>
&lt;h2 id="å¸è½½jenkins">å¸è½½jenkins&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>//æœåŠ¡
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get remove jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>//å®‰è£…åŒ…ï¼Œæ³¨æ„è¿™é‡Œå¦‚æžœä¸æ˜¯ubuntué‚£å°±yum
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get remove --auto-remove jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>//é…ç½®å’Œæ•°æ®
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get purge jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get purge --auto-remove jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‡çº§jenkins">å‡çº§jenkins&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é€‚ç”¨äºŽubuntuå®‰è£…çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get upgrade jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åŒæ—¶æž„å»ºä»»åŠ¡çš„ä¸ªæ•°">åŒæ—¶æž„å»ºä»»åŠ¡çš„ä¸ªæ•°&lt;/h2>
&lt;p>ç³»ç»Ÿç®¡ç†&amp;ndash;&amp;gt;ç³»ç»Ÿè®¾ç½®&amp;ndash;&amp;gt;æ‰§è¡Œè€…æ•°é‡&lt;/p>
&lt;h2 id="æž„å»ºæˆåŠŸæ‰ç»§ç»­å‘åŒ…">æž„å»ºæˆåŠŸæ‰ç»§ç»­å‘åŒ…&lt;/h2>
&lt;p>åªæ˜¯ä¸ªä¸å¤§ä¸å°çš„åŠŸèƒ½,å¾ˆå®¹æ˜“å¿½ç•¥äº†,åœ¨ ä»»åŠ¡çš„é…ç½®&amp;ndash;&amp;gt;Post Steps &amp;ndash;&amp;gt; Run only if build succeeds&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202405280938281.png" alt="image-20240528093819570">&lt;/p>
&lt;h2 id="ä¿®æ”¹æ—¶åŒº">ä¿®æ”¹æ—¶åŒº&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091744504.png" alt="image-20240809174451156">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091746778.png" alt="image-20240809174606994">&lt;/p>
&lt;h2 id="webhook">WebHook&lt;/h2>
&lt;p>ä½¿ç”¨çš„åœºæ™¯,Github Pushä»£ç ä¹‹åŽ,è‡ªåŠ¨æž„å»º&lt;/p>
&lt;p>ç¬¬ä¸€æ­¥.jenkinsçš„é…ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091740783.png" alt="image-20240809174000506">&lt;/p>
&lt;p>ç¬¬äºŒæ­¥.Githubçš„é…ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091741395.png" alt="image-20240809174111087">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091742218.png" alt="image-20240809174235801">&lt;/p>
&lt;p>ç¬¬ä¸‰æ­¥.è¿”å›žjenkinsè®¾ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408091743820.png" alt="image-20240809174324197">&lt;/p>
&lt;p>ç¬¬å››æ­¥.pushä»£ç ,æŸ¥çœ‹æœ‰æ²¡æœ‰æ­£å¸¸æž„å»º&lt;/p>
&lt;h1 id="jenkinsdockeréƒ¨ç½²mavenèšåˆå·¥ç¨‹">Jenkins+Dockeréƒ¨ç½²Mavenèšåˆå·¥ç¨‹&lt;/h1>
&lt;p>å®‰è£…Jenkins&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /var/run/docker.sock:/var/run/docker.sock &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#66d9ef">$(&lt;/span>which docker&lt;span style="color:#66d9ef">)&lt;/span>:/usr/bin/docker &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /root/jenkins:/var/jenkins_home &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name jenkins &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --user&lt;span style="color:#f92672">=&lt;/span>root &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8080:8080 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 50000:50000 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -u &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> jenkins/jenkins:jdk11
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ç¬¬2è¡Œæ˜¯å°†å®¿ä¸»æœºçš„/var/run/docker.sockæ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·åœ¨å®¹å™¨ä¸­è¿è¡Œçš„dockerå‘½ä»¤ï¼Œå°±ä¼šåœ¨å®¿ä¸»æœºä¸Šæ¥æ‰§è¡Œã€‚&lt;/li>
&lt;li>ç¬¬3è¡Œæ˜¯å°†å®¿ä¸»æœºçš„dockerç¨‹åºæ˜ å°„è¿›å®¹å™¨ä¸­ï¼Œè¿™æ ·æœ¬èº«æ²¡æœ‰å®‰è£…dockerçš„jenkinså®¹å™¨å°±å¯ä»¥æ‰§è¡Œdockerå‘½ä»¤äº†ï¼ˆäº‹å®žä¸Šå®¹å™¨é‡Œæ˜¯æ²¡æœ‰è¿è¡Œdockerçš„æœåŠ¡çš„ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨è¿™ä¸ªæ˜ å°„è¿›å®¹å™¨çš„dockeræ¥ä½œä¸ºå®¢æˆ·ç«¯å‘é€dockerçš„æŒ‡ä»¤åˆ°/var/run/docker.sockè€Œå·²ï¼Œè€Œ/var/run/docker.sockå·²ç»è¢«é“¾æŽ¥åˆ°å®¿ä¸»æœºäº†)&lt;/li>
&lt;/ul>
&lt;p>Dockerfile&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> openjdk:8-jdk-alpine&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">VOLUME&lt;/span>&lt;span style="color:#e6db74"> /tmp&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">ADD&lt;/span> admin-server-0.0.1-SNAPSHOT.jar app.jar&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">ENTRYPOINT&lt;/span> [&lt;span style="color:#e6db74">&amp;#34;java&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;-Djava.security.egd=file:/dev/./urandom&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;-jar&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;/app.jar&amp;#34;&lt;/span>]&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Mavençš„pom.xmlé…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;plugin&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;groupId&amp;gt;&lt;/span>com.spotify&lt;span style="color:#f92672">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;artifactId&amp;gt;&lt;/span>docker-maven-plugin&lt;span style="color:#f92672">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;version&amp;gt;&lt;/span>0.4.13&lt;span style="color:#f92672">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;imageName&amp;gt;&lt;/span>springboot/${project.artifactId}&lt;span style="color:#f92672">&amp;lt;/imageName&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;dockerDirectory&amp;gt;&lt;/span>src/main/docker&lt;span style="color:#f92672">&amp;lt;/dockerDirectory&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;resource&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;targetPath&amp;gt;&lt;/span>/&lt;span style="color:#f92672">&amp;lt;/targetPath&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;directory&amp;gt;&lt;/span>${project.build.directory}&lt;span style="color:#f92672">&amp;lt;/directory&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;include&amp;gt;&lt;/span>${project.build.finalName}.jar&lt;span style="color:#f92672">&amp;lt;/include&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/resource&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/plugin&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>imageName&lt;/code>æ‰“çš„é•œåƒåç§°,è¿™é‡Œçš„é•œåƒåç§°æ˜¯:springboot/admin-server&lt;/li>
&lt;li>&lt;code>dockerDirectory&lt;/code>æŒ‡å®šdockeræ–‡ä»¶å¤¹çš„ä½ç½®&lt;/li>
&lt;/ul>
&lt;p>Jobé…ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051423837.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424832.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424206.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424089.png" alt="">&lt;/p>
&lt;p>â€¢ &lt;code>-e â€œSPRING_PROFILES_ACTIVE=prereleaseâ€&lt;/code> ,å¯ä»¥çœ‹æˆæ˜¯å¯åŠ¨jarçš„æ—¶å€™çš„,java -jar admin-server.jar â€“spring.profiles.active=prerelease ,æŒ‡å®šè¿è¡ŒçŽ¯å¢ƒ&lt;/p>
&lt;h1 id="è„šæœ¬">è„šæœ¬&lt;/h1>
&lt;h2 id="æ£€æµ‹å®¹å™¨çš„è¿è¡Œ">æ£€æµ‹å®¹å™¨çš„è¿è¡Œ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#34;=&amp;#34; ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>count&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>docker ps -a | grep sabong-admin-controlfront |awk &lt;span style="color:#e6db74">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -n &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$count&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> docker stop $count
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> docker rm $count
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;åœæ­¢å¹¶åˆ é™¤å®¹å™¨&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -itd &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 9011:9011 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -e â€œSPRING_PROFILES_ACTIVE&lt;span style="color:#f92672">=&lt;/span>prereleaseâ€ &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name admin-server &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> springboot/admin-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æŽ¨é€é•œåƒåˆ°harbor">æŽ¨é€é•œåƒåˆ°harbor&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰“æ ‡ç­¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># sabong/sabong-controller-manager:latest å·²ç»buildæˆåŠŸäº†çš„é•œåƒåå­—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 10.0.0.7/library/sabong/sabong-controller-manager:latest æ–°çš„é•œåƒåå­—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker tag sabong/sabong-controller-manager:latest 10.0.0.7/library/sabong/sabong-controller-manager:latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç™»å½•ç§æœ‰ä»“åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker login -u admin -p &lt;span style="color:#ae81ff">123456&lt;/span> 10.0.0.7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŽ¨é€é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker push 10.0.0.7/library/sabong/sabong-controller-manager:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="vueæ‰“åŒ…æˆé•œåƒ">Vueæ‰“åŒ…æˆé•œåƒ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>npm install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npm run build:prod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># build&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># sabong/sabong-admin-controlfront éšä¾¿èµ·çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker build -t sabong/sabong-admin-controlfront --no-cache .
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰“æ ‡ç­¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker tag sabong/sabong-admin-controlfront:latest 10.0.0.7/library/sabong/sabong-admin-controlfront:latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç™»å½•ç§æœ‰ä»“åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker login -u admin -p &lt;span style="color:#ae81ff">123456&lt;/span> 10.0.0.7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŽ¨é€é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker push 10.0.0.7/library/sabong/sabong-admin-controlfront:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Dockerfile&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-docker" data-lang="docker">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">From&lt;/span>&lt;span style="color:#e6db74"> nginx&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> dist/ /usr/share/nginx/html/&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â›” è¿™é‡Œç”¨çš„æ˜¯nginxå®¹å™¨é‡Œé»˜è®¤çš„nginxé…ç½®æ–‡ä»¶,æ‰€ä»¥è¿™é‡Œæ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰çš„nginxé…ç½®&lt;/p>
&lt;h2 id="springbooté¡¹ç›®è„šæœ¬">SpringBooté¡¹ç›®è„šæœ¬&lt;/h2>
&lt;p>é€‚ç”¨äºŽsshä¼ è¾“æ–‡ä»¶,å¯åŠ¨è„šæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å…·ä½“ä¸çŸ¥é“æ˜¯å¹²å•¥çš„,åŠ ä¸Šè¿™ä¸ª,è¿™ä¸ªçœ‹æƒ…å†µåŠ &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># BUILD_ID=DONTKILLME&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>APP_NAME&lt;span style="color:#f92672">=&lt;/span>xxx.jar
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ€è¿›ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pid&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>ps -ef|grep $APP_NAME|grep -v grep|awk &lt;span style="color:#e6db74">&amp;#39;{print $2}&amp;#39;&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -n &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>pid&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> kill -9 $pid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;å‡†å¤‡å¯åŠ¨jaråŒ…&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nohup java -jar /root/$APP_NAME --spring.profiles.active&lt;span style="color:#f92672">=&lt;/span>prod &amp;amp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sleep &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;å¯åŠ¨æˆåŠŸ&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="mavenå¤šæ¨¡å—æ‰“åŒ…">Mavenå¤šæ¨¡å—æ‰“åŒ…&lt;/h1>
&lt;p>æŒ‡å®šæ‰“åŒ…é¡¹ç›®å&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>clean package -pl æ¨¡å—å -am
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é…ç½®SSH server&lt;/p>
&lt;p>åœ¨ç³»ç»Ÿç®¡ç†&amp;ndash;&amp;gt;System&amp;mdash;&amp;gt;SSH Serveré…ç½®&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424215.png" alt="image-20240319175903145">&lt;/p>
&lt;p>é…ç½®SSH Over FTP publish&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424247.png" alt="image-20240319184601103">&lt;/p>
&lt;p>è¿™é‡Œ&lt;code>Verbose output in console&lt;/code>çš„ä½œç”¨æ˜¯æŠŠè¿œç¨‹çš„æ­¥éª¤,å’Œè¿œç¨‹çš„shellæ‰§è¡Œçš„ç»“æžœä¹Ÿæ‰“å°å‡ºæ¥&lt;/p>
&lt;p>è¿™é‡Œ&lt;code>Exec in pty&lt;/code> è¦å‹¾é€‰,ä¸ç„¶é¡¹ç›®å¯åŠ¨å®Œæˆäº†,ä¹Ÿä¸ä¼šåœæ­¢SSHé“¾æŽ¥&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424187.png" alt="image-20240319175519104">&lt;/p>
&lt;h1 id="å‰ç«¯æ‰“åŒ…">å‰ç«¯æ‰“åŒ…&lt;/h1>
&lt;p>é€‰æ‹©å·²ç»é…ç½®çš„nodeç‰ˆæœ¬&lt;/p>
&lt;p>&lt;strong>æž„å»ºçŽ¯å¢ƒ&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051424037.png" alt="image-20240319183930032">&lt;/p>
&lt;p>&lt;strong>Build Steps&lt;/strong>&lt;/p>
&lt;p>é€‰æ‹©æ‰§è¡Œshell&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>npm install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npm run build:prod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pwd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ é™¤ä¸Šä¸€æ¬¡æž„å»ºæ‰“çš„åŒ…,ç„¶åŽdistæ–‡ä»¶å¤¹æ‰“åŒ…æˆdist.zipæ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm -f dist.zip &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> zip -r dist.zip dist
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051424098.png" alt="image-20240319184412134">&lt;/p>
&lt;h1 id="å„ç§é—®é¢˜æŠ¥é”™">å„ç§é—®é¢˜æŠ¥é”™&lt;/h1>
&lt;p>1.HTTP ERROR 403 No valid crumb was included in the request&lt;/p>
&lt;p>è§£å†³åŠžæ³•:ç½‘ä¸Šéƒ½æ˜¯è¦åŽ»å…³é—­CSRFï¼Œå¾ˆæ˜Žç¡®çš„æ˜¯æˆ‘è¿™é‡Œçš„å…¨å±€å®‰å…¨é…ç½®é‡Œé¢æ ¹æœ¬å°±æ²¡æœ‰é€‰é¡¹ï¼Œæˆ‘çš„ç‰ˆæœ¬æ˜¯&lt;code>jenkins 2.293&lt;/code>ã€‚æ‰€ä»¥ç™¾åº¦å‡ºæ¥çš„éƒ½æ˜¯ä¸€å †åžƒåœ¾ï¼Œæ— å¥ˆè‡ªå·±è§£å†³ï¼Œå°è¯•ä¸€ç•ªä¹‹åŽï¼Œæ‰¾åˆ°äº†æ–¹æ³•ï¼Œå¦‚&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051425841.png" alt="image-20231201155420918">&lt;/p>
&lt;p>ä¸‹å›¾æ‰€ç¤ºï¼šè¿˜æ˜¯åœ¨å…¨å±€å®‰å…¨é…ç½®é‡Œé¢ï¼Œå‹¾é€‰ä¸Šè¿™ä¸ªå‚æ•°å³å¯ã€‚&lt;/p>
&lt;hr>
&lt;p>2.Jenkinsé…ç½®ä¸­å®‰è£…æ’ä»¶æ—¶æç¤º&lt;code>No such plugin: cloudbees-folder&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo systemctl start jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;p>2.Jenkinså’ŒGithub personal access token&lt;/p>
&lt;ul>
&lt;li>ç™»å½•åˆ°æ‚¨çš„ Jenkins æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>é€‰æ‹©â€œJenkinsâ€&amp;gt;â€œManage Jenkinsâ€&amp;gt;â€œConfigure Systemâ€ã€‚&lt;/li>
&lt;li>æ»šåŠ¨åˆ°â€œGitHubâ€éƒ¨åˆ†ã€‚&lt;/li>
&lt;li>ç‚¹å‡»â€œAdd GitHub Serverâ€æŒ‰é’®ã€‚&lt;/li>
&lt;li>åœ¨â€œAPI URLâ€å­—æ®µä¸­è¾“å…¥æ‚¨çš„ Github API URLï¼ˆä¾‹å¦‚ &lt;a href="https://link.juejin.cn/?target=https%3A%2F%2Fapi.github.com%EF%BC%89%E3%80%82">api.github.comï¼‰ã€‚&lt;/a>&lt;/li>
&lt;li>åœ¨â€œCredentialsâ€å­—æ®µä¸­é€‰æ‹©â€œAddâ€ã€‚&lt;/li>
&lt;li>é€‰æ‹©â€œKindâ€ä¸ºâ€œUsername with passwordâ€ã€‚&lt;/li>
&lt;li>åœ¨â€œUsernameâ€å­—æ®µä¸­è¾“å…¥æ‚¨çš„ Github ç”¨æˆ·åã€‚&lt;/li>
&lt;li>åœ¨â€œPasswordâ€å­—æ®µä¸­è¾“å…¥æ‚¨çš„ Github ä¸ªäººè®¿é—®ä»¤ç‰Œã€‚&lt;/li>
&lt;li>ç‚¹å‡»â€œVerify credentialsâ€æŒ‰é’®ä»¥éªŒè¯å‡­æ®æ˜¯å¦æœ‰æ•ˆã€‚&lt;/li>
&lt;li>å¦‚æžœéªŒè¯æˆåŠŸï¼Œè¯·ç‚¹å‡»â€œSaveâ€æŒ‰é’®ä¿å­˜æ›´æ”¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>3.jenkinsæ˜ å°„docker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æžœdocker run jenkins æ²¡æœ‰æŒ‡å®š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¿™é‡Œå°±ä¸èƒ½æ‰“åŒ…,å°±æ˜¯å› ä¸ºåœ¨jenkinsé‡Œçš„å®¹å™¨ä¸­,æ²¡æœ‰å®‰è£…å¯¹è±¡,ä½¿ç”¨äº†-v &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å°±æ˜¯æŠŠjenkinsé‡Œæ‰€éœ€è¦çš„dockeræ˜ å°„åˆ°å®¿ä¸»dockerä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-v /var/run/docker.sock:/var/run/docker.sock &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span>-v &lt;span style="color:#66d9ef">$(&lt;/span>which docker&lt;span style="color:#66d9ef">)&lt;/span>:/usr/bin/docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>4.å®‰è£…æ’ä»¶æ²¡æœ‰æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051425983.png" alt="">
éœ€è¦åˆ°æ’ä»¶ä¸­å¿ƒ,åœ¨å¯æ›´æ–°å’Œå¯é€‰æ’ä»¶é‡Œ,ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨åŽ»æœç´¢å®‰è£…,å¦‚æžœè¿˜æœ‰é—®é¢˜,å°±éœ€è¦æ›´æ–°jenkins&lt;/p>
&lt;p>5.&lt;code>npm install&lt;/code>éœ€è¦æƒé™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>Unable to save binary /var/lib/jenkins/workspace/mymanager-/node_modules/node-sass/vendor/linux-x64-83 : Error: EACCES: permission denied, mkdir &lt;span style="color:#e6db74">&amp;#39;/var/lib/jenkins/workspace/lottery-web-24kai-ausk3/node_modules/node-sass/vendor&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ä¿®æ”¹ç«¯å£">ä¿®æ”¹ç«¯å£&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬ä¸€æ­¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo vim /etc/init.d/jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 8088æ”¹æˆæƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>check_tcp_port &lt;span style="color:#e6db74">&amp;#34;http&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$HTTP_PORT&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;8088&amp;#34;&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬äºŒæ­¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo vim /etc/default/jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 8088æ”¹æˆæƒ³è¦çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HTTP_PORT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8088&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¬¬ä¸‰æ­¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /lib/systemd/system/jenkins.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Environment&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;JENKINS_PORT=80&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl start jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl status jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¿™ä¸ªæ—¶å€™å°±å¯åŠ¨æŠ¥é”™,ç„¶åŽæŽ¥ç€ä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /lib/systemd/system/jenkins.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æœ¬æ¥æ˜¯jenkinsçš„,æ”¹æˆroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>User&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Group&lt;span style="color:#f92672">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰§è¡Œ,å°±å¯ä»¥äº†,ä¸çŸ¥é“ä¸ºå•¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl start jenkins
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl status jenkins
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="jenkinsä½¿ç”¨rootè´¦å·ç™»å½•">jenkinsä½¿ç”¨rootè´¦å·ç™»å½•&lt;/h1>
&lt;p>&lt;a href="https://www.baimeidashu.com/13094.html">è®¾ç½®1&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.cnblogs.com/fieldtianye/p/17852160.html">è®¾ç½®2&lt;/a>&lt;/p>
&lt;h1 id="æƒé™ç®¡ç†">æƒé™ç®¡ç†&lt;/h1>
&lt;p>1.å®‰è£…æ’ä»¶,&lt;code>Role-based Authorization Strategy&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408081650831.png" alt="image-20240808165032732">&lt;/p>
&lt;p>2.ç‚¹å‡» ç®¡ç†ç³»ç»Ÿ&amp;ndash;&amp;gt;å®‰å…¨æ®µè½ä¸‹çš„&amp;ndash;&amp;gt;å…¨å±€å®‰å…¨é…ç½®,é€‰ä¸­&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408081652851.png" alt="image-20240808165220186">&lt;/p>
&lt;p>3.ç®¡ç†ç³»ç»Ÿ&amp;ndash;&amp;gt;å®‰å…¨æ®µè½ä¸‹çš„ å°±ä¼šå¤šä¸€ä¸ªåŠŸèƒ½&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202408081653465.png" alt="image-20240808165321957">&lt;/p></content></item><item><title>Mybatis</title><link>https://connorzhangyu.com/posts/mybatis/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/mybatis/</guid><description>&lt;h1 id="æ•™ç¨‹">æ•™ç¨‹&lt;/h1>
&lt;blockquote>
&lt;p>å‚è€ƒ:&lt;/p>
&lt;p>&lt;a href="https://mybatis.org/mybatis-3/">å®˜æ–¹æ–‡æ¡£&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/mybatis">æºç &lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="providerçš„ä½¿ç”¨">Providerçš„ä½¿ç”¨&lt;/h2>
&lt;p>1.ä¸€å®šè¦æ³¨æ„typeçš„ç±»å.class å’Œ methodæ–¹æ³•å,è¿˜è¦æ³¨æ„å½¢å‚ä¹Ÿå¾—æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;p>2.Providerçš„æ–¹æ³•,å¤§æ¦‚å°±ä¸‰ä¸ªæ–¹æ³•sql.SELECT,sql.WHERE,sql.FROM&lt;/p>
&lt;p>3.SQL å¯¹è±¡é‡Œçš„æ–¹æ³•åè·Ÿåˆ«çš„ä¸ä¸€æ ·,å°å†™çš„ä¸è¡Œ,ideaä¹Ÿè¯†åˆ«ä¸åˆ°,è¦ç”¨å¤§å†™,æ¯”å¦‚SLELECT&lt;/p>
&lt;p>4.Provideré‡Œè¿”å›žçš„æ˜¯String&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427670.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427490.png" alt="">&lt;/p>
&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢å¤šä¸ªå‚æ•°">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(å¤šä¸ªå‚æ•°)&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427839.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051428785.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051429441.png" alt="">&lt;/p>
&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢å¤šä¸ªå‚æ•°-1">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(å¤šä¸ªå‚æ•°)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@SelectProvider&lt;/span>(method&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;queryPageFloors&amp;#34;&lt;/span>,type&lt;span style="color:#f92672">=&lt;/span>BarterGroupProvider.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Results&lt;/span>({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;userId&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;user_id&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;floorNum&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;floor_num&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;floorSecond&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;say&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;note&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;joinOrPublish&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;join_or_publish&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;categorys&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.queryCategory&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;productIds&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.queryProducts&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;beforeResult&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupEvaluationMapper.queryAll&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;barterGroupUser&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> BarterGroupUser.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;{user_id=user_id,id = barter_group_id }&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.isHead&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;futureResultNum&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.futureResultNum&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>QueryFloors&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryFloors3&lt;/span>(Page&lt;span style="color:#f92672">&amp;lt;&lt;/span>QueryFloors&lt;span style="color:#f92672">&amp;gt;&lt;/span> page);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * åˆ†ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT * FROM ecloud_marketing.barter_group_category WHERE barter_group_details_id = #{id} limit 0,7 &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupCategory&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryCategory&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * äº§å“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT product_id from ecloud_marketing.barter_group_product_category WHERE barter_group_details_id = #{id} limit 0,3 &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Long&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryProducts&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å›¢å‘˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param userId
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT * FROM ecloud_marketing.barter_group_user WHERE user_id =#{user_id} and barter_group_id = #{id} and status = 1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BarterGroupUser &lt;span style="color:#a6e22e">isHead&lt;/span>(Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String,Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> map);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT count(*) from ecloud_marketing.barter_group_evaluation WHERE barter_group_details_id = #{id}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Integer &lt;span style="color:#a6e22e">futureResultNum&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">QueryFloors&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Serializable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘æœ‰çš„äº§å“çš„id&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>ProductBarter&lt;span style="color:#f92672">&amp;gt;&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…å‰çš„è¯„è®ºæ•°æ®&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluation&lt;span style="color:#f92672">&amp;gt;&lt;/span> beforeResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…åŽçš„è¯„è®ºæ•°æ®æœ‰åˆ†é¡µç»™åŠŸèƒ½&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Page&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluation&lt;span style="color:#f92672">&amp;gt;&lt;/span> beforeResultPage;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…åŽçš„è¯„è®ºæ•°æ®&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluationResult&lt;span style="color:#f92672">&amp;gt;&lt;/span> futureResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å‰©ä½™è¯„è®ºæ¡æ•°&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer futureResultNum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;åˆ†ç±»&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupCategory&lt;span style="color:#f92672">&amp;gt;&lt;/span> categorys;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;æ¥¼å±‚æ•°&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer floorNum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;æ¥¼å±‚id&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Long floorSecond;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;è¦è¯´çš„&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String say;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;åŠ å…¥æˆ–è€…æ˜¯å‘å¸ƒ&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer joinOrPublish;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä¼šå‘˜è¡¨&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> BarterGroupUser barterGroupUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;åŠ å…¥æ—¶é—´&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Long joinData;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢ä¸€ä¸ªå‚æ•°">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(ä¸€ä¸ªå‚æ•°)&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051430732.png" alt="">&lt;/p></description><content>&lt;h1 id="æ•™ç¨‹">æ•™ç¨‹&lt;/h1>
&lt;blockquote>
&lt;p>å‚è€ƒ:&lt;/p>
&lt;p>&lt;a href="https://mybatis.org/mybatis-3/">å®˜æ–¹æ–‡æ¡£&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/mybatis">æºç &lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="providerçš„ä½¿ç”¨">Providerçš„ä½¿ç”¨&lt;/h2>
&lt;p>1.ä¸€å®šè¦æ³¨æ„typeçš„ç±»å.class å’Œ methodæ–¹æ³•å,è¿˜è¦æ³¨æ„å½¢å‚ä¹Ÿå¾—æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;p>2.Providerçš„æ–¹æ³•,å¤§æ¦‚å°±ä¸‰ä¸ªæ–¹æ³•sql.SELECT,sql.WHERE,sql.FROM&lt;/p>
&lt;p>3.SQL å¯¹è±¡é‡Œçš„æ–¹æ³•åè·Ÿåˆ«çš„ä¸ä¸€æ ·,å°å†™çš„ä¸è¡Œ,ideaä¹Ÿè¯†åˆ«ä¸åˆ°,è¦ç”¨å¤§å†™,æ¯”å¦‚SLELECT&lt;/p>
&lt;p>4.Provideré‡Œè¿”å›žçš„æ˜¯String&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427670.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427490.png" alt="">&lt;/p>
&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢å¤šä¸ªå‚æ•°">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(å¤šä¸ªå‚æ•°)&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427839.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051428785.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051429441.png" alt="">&lt;/p>
&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢å¤šä¸ªå‚æ•°-1">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(å¤šä¸ªå‚æ•°)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@SelectProvider&lt;/span>(method&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;queryPageFloors&amp;#34;&lt;/span>,type&lt;span style="color:#f92672">=&lt;/span>BarterGroupProvider.&lt;span style="color:#a6e22e">class&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Results&lt;/span>({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;userId&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;user_id&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;floorNum&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;floor_num&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;floorSecond&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;say&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;note&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;joinOrPublish&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;join_or_publish&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;categorys&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.queryCategory&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;productIds&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.queryProducts&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;beforeResult&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> List.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupEvaluationMapper.queryAll&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;barterGroupUser&amp;#34;&lt;/span>,javaType &lt;span style="color:#f92672">=&lt;/span> BarterGroupUser.&lt;span style="color:#a6e22e">class&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;{user_id=user_id,id = barter_group_id }&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.isHead&amp;#34;&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Result&lt;/span>(property&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;futureResultNum&amp;#34;&lt;/span>,column&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>,many&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">@Many&lt;/span>(select&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.ecloud.hobay.marketing.service.infrastructure.mapper.bartergroup.BarterGroupMapper.futureResultNum&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>QueryFloors&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryFloors3&lt;/span>(Page&lt;span style="color:#f92672">&amp;lt;&lt;/span>QueryFloors&lt;span style="color:#f92672">&amp;gt;&lt;/span> page);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * åˆ†ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT * FROM ecloud_marketing.barter_group_category WHERE barter_group_details_id = #{id} limit 0,7 &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupCategory&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryCategory&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * äº§å“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT product_id from ecloud_marketing.barter_group_product_category WHERE barter_group_details_id = #{id} limit 0,3 &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Long&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryProducts&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å›¢å‘˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param userId
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT * FROM ecloud_marketing.barter_group_user WHERE user_id =#{user_id} and barter_group_id = #{id} and status = 1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BarterGroupUser &lt;span style="color:#a6e22e">isHead&lt;/span>(Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String,Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> map);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Select&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SELECT count(*) from ecloud_marketing.barter_group_evaluation WHERE barter_group_details_id = #{id}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Integer &lt;span style="color:#a6e22e">futureResultNum&lt;/span>(&lt;span style="color:#a6e22e">@Param&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>) Long id);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">QueryFloors&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Serializable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘æœ‰çš„äº§å“çš„id&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>ProductBarter&lt;span style="color:#f92672">&amp;gt;&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…å‰çš„è¯„è®ºæ•°æ®&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluation&lt;span style="color:#f92672">&amp;gt;&lt;/span> beforeResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…åŽçš„è¯„è®ºæ•°æ®æœ‰åˆ†é¡µç»™åŠŸèƒ½&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Page&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluation&lt;span style="color:#f92672">&amp;gt;&lt;/span> beforeResultPage;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å°è£…åŽçš„è¯„è®ºæ•°æ®&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupEvaluationResult&lt;span style="color:#f92672">&amp;gt;&lt;/span> futureResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å‰©ä½™è¯„è®ºæ¡æ•°&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer futureResultNum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;åˆ†ç±»&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>BarterGroupCategory&lt;span style="color:#f92672">&amp;gt;&lt;/span> categorys;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;æ¥¼å±‚æ•°&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer floorNum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;æ¥¼å±‚id&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Long floorSecond;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;è¦è¯´çš„&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> String say;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;åŠ å…¥æˆ–è€…æ˜¯å‘å¸ƒ&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Integer joinOrPublish;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä¼šå‘˜è¡¨&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> BarterGroupUser barterGroupUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@ApiModelProperty&lt;/span>(value&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;åŠ å…¥æ—¶é—´&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Long joinData;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ³¨è§£-ä¸€å¯¹å¤šæŸ¥è¯¢ä¸€ä¸ªå‚æ•°">æ³¨è§£ ä¸€å¯¹å¤šæŸ¥è¯¢(ä¸€ä¸ªå‚æ•°)&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051430732.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051430867.png" alt="">&lt;/p>
&lt;h2 id="æ ‡ç­¾">æ ‡ç­¾&lt;/h2>
&lt;p>mybatisçš„xmlçš„å¸¸ç”¨æ ‡ç­¾:&lt;/p>
&lt;p>&lt;strong>include&lt;/strong>å’Œ&lt;strong>sql&lt;/strong>æ ‡ç­¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;sql&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;query_column&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id,user_no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/sql&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;select&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> select &lt;span style="color:#f92672">&amp;lt;include&lt;/span> &lt;span style="color:#a6e22e">refid=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;query_column&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/include&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from user_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>whereæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;select&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> select * from user_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> where
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;userName != null and userName != &amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_name = #{userName}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;password != null and password != &amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> and password = #{password}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœuserName= nullï¼Œåˆ™sqlè¯­å¥å°±å˜æˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">select&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">from&lt;/span> user_info &lt;span style="color:#66d9ef">where&lt;/span> &lt;span style="color:#66d9ef">and&lt;/span> password &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">{&lt;/span>password&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>where&lt;/code>æ ‡ç­¾å¯ä»¥åŽ»é™¤whereè¯­å¥ä¸­çš„ç¬¬ä¸€ä¸ªand æˆ– orã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;select&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> select * from user_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;where&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;userName != null and userName != &amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> and user_name = #{userName}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;password != null and password != &amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> and password = #{password}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/where&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>setæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;update&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;myupdate&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> update user_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;set&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;userName != null&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_name = #{userName},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;password != null&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> password = #{password,jdbcType=VARCHAR},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/set&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> where id = #{id,jdbcType=INTEGER}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/update&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>trimæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;p>&lt;code>where&lt;/code>æ ‡ç­¾åªèƒ½åŽ»é™¤ç¬¬ä¸€ä¸ªandæˆ–orï¼Œä¸å¤Ÿçµæ´»ï¼Œtrimæ ‡ç­¾åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚
trimæ ‡ç­¾çš„å±žæ€§å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>prefix&lt;/strong> åœ¨trimæ ‡ç­¾å†…å®¹å‰é¢åŠ ä¸Šå‰ç¼€&lt;/li>
&lt;li>&lt;strong>suffix&lt;/strong> åœ¨trimæ ‡ç­¾å†…å®¹åŽé¢åŠ ä¸ŠåŽç¼€&lt;/li>
&lt;li>&lt;strong>prefixOverrides&lt;/strong> ç§»é™¤å‰ç¼€å†…å®¹ã€‚å³ å±žæ€§ä¼šå¿½ç•¥é€šè¿‡ç®¡é“åˆ†éš”çš„æ–‡æœ¬åºåˆ—ï¼Œå¤šä¸ªå¿½ç•¥åºåˆ—ç”¨ â€œ|â€ éš”å¼€ã€‚å®ƒå¸¦æ¥çš„ç»“æžœå°±æ˜¯æ‰€æœ‰åœ¨ prefixOverrides å±žæ€§ä¸­æŒ‡å®šçš„å†…å®¹å°†è¢«ç§»é™¤ã€‚&lt;/li>
&lt;li>&lt;strong>suffixOverrides&lt;/strong> ç§»é™¤å‰ç¼€å†…å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;trim&lt;/span> &lt;span style="color:#a6e22e">prefix=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">prefixOverrides=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;and&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;userId != null&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_id=#{userId}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;pwd != null and pwd !=&amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_id=#{userId}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/trim&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>foreachæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;p>foreachå…ƒç´ çš„å±žæ€§ä¸»è¦æœ‰itemï¼Œindexï¼Œcollectionï¼Œopenï¼Œseparatorï¼Œclose.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>collection&lt;/strong> è¦åšforeachçš„å¯¹è±¡ï¼Œä½œä¸ºå…¥å‚æ—¶ï¼ŒListå¯¹è±¡é»˜è®¤ç”¨&amp;quot;list&amp;quot;ä»£æ›¿ä½œä¸ºé”®ï¼Œæ•°ç»„å¯¹è±¡æœ‰&amp;quot;array&amp;quot;ä»£æ›¿ä½œä¸ºé”®ï¼ŒMapå¯¹è±¡æ²¡æœ‰é»˜è®¤çš„é”®ã€‚å½“ç„¶åœ¨ä½œä¸ºå…¥å‚æ—¶å¯ä»¥ä½¿ç”¨@Param(&amp;ldquo;keyName&amp;rdquo;)æ¥è®¾ç½®é”®ï¼Œè®¾ç½®keyNameåŽï¼Œlist,arrayå°†ä¼šå¤±æ•ˆã€‚ é™¤äº†å…¥å‚è¿™ç§æƒ…å†µå¤–ï¼Œè¿˜æœ‰ä¸€ç§ä½œä¸ºå‚æ•°å¯¹è±¡çš„æŸä¸ªå­—æ®µçš„æ—¶å€™ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æžœUseræœ‰å±žæ€§List idsã€‚å…¥å‚æ˜¯Userå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªcollection = &amp;ldquo;ids&amp;rdquo;.å¦‚æžœUseræœ‰å±žæ€§Ids ids;å…¶ä¸­Idsæ˜¯ä¸ªå¯¹è±¡ï¼ŒIdsæœ‰ä¸ªå±žæ€§List id;å…¥å‚æ˜¯Userå¯¹è±¡ï¼Œé‚£ä¹ˆcollection = &amp;ldquo;&lt;a href="https://links.jianshu.com/go?to=http%3A%2F%2Fids.id">ids.id&lt;/a>&amp;quot;ï¼Œå¿…å¡«&lt;/li>
&lt;li>&lt;strong>item&lt;/strong> åˆä¸­å…ƒç´ è¿­ä»£æ—¶çš„åˆ«åï¼Œå¿…é€‰&lt;/li>
&lt;li>&lt;strong>index&lt;/strong> åœ¨listå’Œæ•°ç»„ä¸­,indexæ˜¯å…ƒç´ çš„åºå·ï¼Œåœ¨mapä¸­ï¼Œindexæ˜¯å…ƒç´ çš„keyï¼Œå¯é€‰&lt;/li>
&lt;li>&lt;strong>open&lt;/strong> foreachä»£ç çš„å¼€å§‹ç¬¦å·ï¼Œä¸€èˆ¬æ˜¯(å’Œclose=&amp;rdquo;)&amp;ldquo;åˆç”¨ã€‚å¸¸ç”¨åœ¨in(),values()æ—¶ã€‚å¯é€‰&lt;/li>
&lt;li>&lt;strong>separator&lt;/strong> å…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚åœ¨in()çš„æ—¶å€™ï¼Œseparator=&amp;rdquo;,&amp;ldquo;ä¼šè‡ªåŠ¨åœ¨å…ƒç´ ä¸­é—´ç”¨â€œ,â€œéš”å¼€ï¼Œé¿å…æ‰‹åŠ¨è¾“å…¥é€—å·å¯¼è‡´sqlé”™è¯¯ï¼Œå¦‚in(1,2,)è¿™æ ·ï¼Œå¯é€‰ã€‚&lt;/li>
&lt;li>&lt;strong>close&lt;/strong> foreachä»£ç çš„å…³é—­ç¬¦å·ï¼Œä¸€èˆ¬æ˜¯)å’Œopen=&amp;rdquo;(&amp;ldquo;åˆç”¨ã€‚å¸¸ç”¨åœ¨in(),values()æ—¶ã€‚å¯é€‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>chooseï¼Œwhenï¼Œotherwiseæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;p>åŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äºŽJavaä¸­çš„ swicth - case - default&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;select&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;getUser&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">resultType=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.cat.pojo.User&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SELECT * FROM user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;where&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;choose&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;when&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;id != null and test.trim() != &amp;#39;&amp;#39; &amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = #{id}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/when&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;when&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;name != null and name.trim() != &amp;#39;&amp;#39; &amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name = #{name}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/when&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;otherwise&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age = 17
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/otherwise&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/choose&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/where&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ifæ ‡ç­¾&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- åˆ¤æ–­å­—ç¬¦ä¸²--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;item != null and item != &amp;#39;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- å¦‚æžœæ˜¯Integerç±»åž‹çš„éœ€è¦æŠŠandåŽé¢åŽ»æŽ‰æˆ–æ˜¯åŠ ä¸Šor--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;item != null&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;if&lt;/span> &lt;span style="color:#a6e22e">test=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;item != null and item != &amp;#39;&amp;#39; or item == 0&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;lt;/if&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å­˜è¿‡å‡½æ•°">å­˜è¿‡/å‡½æ•°&lt;/h2>
&lt;p>å­˜è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;select&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;pNextSupperUsers&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">parameterType=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;map&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">statementType=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;CALLABLE&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">resultType=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;vo.UserAgentVO&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> call p_next_supper_users(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> #{type,mode=IN,jdbcType=INTEGER},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> #{userId,mode=IN,jdbcType=BIGINT}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>UserAgentVO&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">pNextSupperUsers&lt;/span>(Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> param &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>param.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>, 1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>param.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;userId&amp;#34;&lt;/span>, userId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>List&lt;span style="color:#f92672">&amp;lt;&lt;/span>UserAgentVO&lt;span style="color:#f92672">&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> userInfoMapper.&lt;span style="color:#a6e22e">pNextSupperUsers&lt;/span>(param);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">SELECT&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fn_next_user_count ( &lt;span style="color:#ae81ff">1&lt;/span>, u.id ) &lt;span style="color:#66d9ef">AS&lt;/span> teamCount,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>user_info
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æºç ">æºç &lt;/h1>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;blockquote>
&lt;p>&lt;a href="https://www.bilibili.com/video/BV1R14y1W7yS?p=1&amp;amp;vd_source=6f5cde8de02ba80d9974b12cabbbdddb">bç«™åšå­¦è°·&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>æž¶æž„è®¾è®¡&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051430309.png" alt="img">&lt;/p>
&lt;h2 id="å¯åŠ¨æµ‹è¯•æ–¹æ³•">å¯åŠ¨æµ‹è¯•æ–¹æ³•&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> ç¬¬ä¸€ç§è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resource &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;com/analyze/mybatis/mybatis-config.xml&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream inputStream &lt;span style="color:#f92672">=&lt;/span> Resources.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSessionFactory sqlSessionFactory &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SqlSessionFactoryBuilder().&lt;span style="color:#a6e22e">build&lt;/span>(inputStream);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSession sqlSession &lt;span style="color:#f92672">=&lt;/span> sqlSessionFactory.&lt;span style="color:#a6e22e">openSession&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map map &lt;span style="color:#f92672">=&lt;/span> sqlSession.&lt;span style="color:#a6e22e">selectOne&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;com.analyze.mybatis.mapper.UserMapper.getUA&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sqlSession.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> ç¬¬äºŒç§è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test2&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resource &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;com/analyze/mybatis/mybatis-config.xml&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream inputStream &lt;span style="color:#f92672">=&lt;/span> Resources.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSessionFactory sqlSessionFactory &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SqlSessionFactoryBuilder().&lt;span style="color:#a6e22e">build&lt;/span>(inputStream);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSession sqlSession &lt;span style="color:#f92672">=&lt;/span> sqlSessionFactory.&lt;span style="color:#a6e22e">openSession&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UserMapper userMapper &lt;span style="color:#f92672">=&lt;/span> sqlSession.&lt;span style="color:#a6e22e">getMapper&lt;/span>(UserMapper.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map map &lt;span style="color:#f92672">=&lt;/span> userMapper.&lt;span style="color:#a6e22e">getUA&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sqlSession.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢çš„ä»£ç ,å¤§æ¦‚æ„æ€å°±æ˜¯èƒ½åŠ è½½çš„é…ç½®æ–‡ä»¶çš„ä¿¡æ¯,è§£é‡Š&lt;/p>
&lt;p>&lt;code>InputStream inputStream = Resources.getResourceAsStream(resource);&lt;/code>è¿™è¡Œä»£ç çš„ä½œç”¨&lt;/p>
&lt;h2 id="è¯»å–mybatisçš„é…ç½®æ–‡ä»¶">è¯»å–mybatisçš„é…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.io.Resources#getResourceAsStream(java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> InputStream &lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(String resource) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> getResourceAsStream(&lt;span style="color:#66d9ef">null&lt;/span>, resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.io.Resources#getResourceAsStream(java.lang.ClassLoader, java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> InputStream &lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(ClassLoader loader, String resource) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream in &lt;span style="color:#f92672">=&lt;/span> classLoaderWrapper.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(resource, loader);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (in &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IOException(&lt;span style="color:#e6db74">&amp;#34;Could not find resource &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> in;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.io.ClassLoaderWrapper#getResourceAsStream(java.lang.String, java.lang.ClassLoader)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> InputStream &lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(String resource, ClassLoader classLoader) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> getResourceAsStream(resource, getClassLoaders(classLoader));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.io.ClassLoaderWrapper#getClassLoaders&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ClassLoader&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#a6e22e">getClassLoaders&lt;/span>(ClassLoader classLoader) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ClassLoader&lt;span style="color:#f92672">[]&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> classLoader,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaultClassLoader,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getContextClassLoader&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> getClass().&lt;span style="color:#a6e22e">getClassLoader&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> systemClassLoader};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.io.ClassLoaderWrapper#getResourceAsStream(java.lang.String, java.lang.ClassLoader[])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ç”¨çš„Classloader&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>InputStream &lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(String resource, ClassLoader&lt;span style="color:#f92672">[]&lt;/span> classLoader) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (ClassLoader cl : classLoader) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> cl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// try to find the resource as passed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream returnValue &lt;span style="color:#f92672">=&lt;/span> cl.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">==&lt;/span> returnValue) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> returnValue &lt;span style="color:#f92672">=&lt;/span> cl.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> returnValue) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> returnValue;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢çš„ä»£ç ,è§£é‡Š&lt;code>SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);&lt;/code>,ç”¨æ¥è§£æžå…¨å±€é…ç½®æ–‡ä»¶å’Œè§£æžmapperæ–‡ä»¶&lt;/p>
&lt;p>ä¸‹é¢æ˜¯è§£æžå…¨å±€é…ç½®æ–‡ä»¶&lt;/p>
&lt;h2 id="è§£æžå…¨å±€é…ç½®æ–‡ä»¶">è§£æžå…¨å±€é…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.SqlSessionFactoryBuilder#build(java.io.InputStream)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSessionFactory &lt;span style="color:#a6e22e">build&lt;/span>(InputStream inputStream) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> build(inputStream, &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.SqlSessionFactoryBuilder#build(java.io.InputStream, java.lang.String, java.util.Properties)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSessionFactory &lt;span style="color:#a6e22e">build&lt;/span>(InputStream inputStream, String environment, Properties properties) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1.åˆ›å»ºXpathParseè§£æžå™¨å¯¹è±¡,æ ¹æ®inputStreamè§£æžæˆDocumentå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2.åˆ›å»ºå…¨å±€é…ç½®Configurationå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨æž„å»ºè€…æ¨¡å¼,å¥½å¤„é™ä½Žå¶å°”,åˆ†ç¦»å¤æ‚å¯¹è±¡çš„åˆ›å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æž„å»ºXMLConfig&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> XMLConfigBuilder parser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLConfigBuilder(inputStream, environment, properties);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®Xpathè§£æžxmlé…ç½®æ–‡ä»¶,å°†é…ç½®æ–‡ä»¶å°è£…åˆ°Configurationå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›žDefaultSqlSessionFactoryå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// parse() å°±æ˜¯é…ç½®æ–‡ä»¶è§£æžå®Œæˆäº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> build(parser.&lt;span style="color:#a6e22e">parse&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> ExceptionFactory.&lt;span style="color:#a6e22e">wrapException&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error building SqlSession.&amp;#34;&lt;/span>, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">reset&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inputStream.&lt;span style="color:#a6e22e">close&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (IOException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Intentionally ignore. Prefer previous error.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.SqlSessionFactoryBuilder#build(org.apache.ibatis.session.Configuration)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æœ€ç»ˆè¿”å›ž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSessionFactory &lt;span style="color:#a6e22e">build&lt;/span>(Configuration config) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultSqlSessionFactory(config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(java.io.InputStream, java.lang.String, java.util.Properties)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">XMLConfigBuilder&lt;/span>(InputStream inputStream, String environment, Properties props) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç‚¹this,æŸ¥çœ‹ä»£ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> XPathParser(inputStream, &lt;span style="color:#66d9ef">true&lt;/span>, props, &lt;span style="color:#66d9ef">new&lt;/span> XMLMapperEntityResolver()), environment, props);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(org.apache.ibatis.parsing.XPathParser, java.lang.String, java.util.Properties)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#a6e22e">XMLConfigBuilder&lt;/span>(XPathParser parser, String environment, Properties props) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºConfigurationå¯¹è±¡ï¼Œå¹¶é€šè¿‡TypeAliasRegistryæ³¨å†Œä¸€äº›Mybatiså†…éƒ¨ç›¸å…³ç±»çš„åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> Configuration());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">resource&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SQL Mapper Configuration&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">configuration&lt;/span>.&lt;span style="color:#a6e22e">setVariables&lt;/span>(props);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">parsed&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">environment&lt;/span> &lt;span style="color:#f92672">=&lt;/span> environment;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">parser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> parser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.parsing.XPathParser#XPathParser(java.io.InputStream, boolean, java.util.Properties, org.xml.sax.EntityResolver)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">XPathParser&lt;/span>(InputStream inputStream, &lt;span style="color:#66d9ef">boolean&lt;/span> validation, Properties variables, EntityResolver entityResolver) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> commonConstructor(validation, variables, entityResolver);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºè§£æžå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">document&lt;/span> &lt;span style="color:#f92672">=&lt;/span> createDocument(&lt;span style="color:#66d9ef">new&lt;/span> InputSource(inputStream));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.parsing.XPathParser#createDocument&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸ç”¨å¤ªå…³ç³»,åªæ˜¯åˆ›å»ºä¸€ä¸ªè§£æžå™¨çš„å¯¹è±¡,é¡ºä¾¿æ£€æŸ¥xmlæ–‡æ¡£æœ‰æ²¡æœ‰å†™é”™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> Document &lt;span style="color:#a6e22e">createDocument&lt;/span>(InputSource inputSource) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// important: this must only be called AFTER common constructor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DocumentBuilderFactory factory &lt;span style="color:#f92672">=&lt;/span> DocumentBuilderFactory.&lt;span style="color:#a6e22e">newInstance&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setValidating&lt;/span>(validation);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setNamespaceAware&lt;/span>(&lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setIgnoringComments&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setIgnoringElementContentWhitespace&lt;/span>(&lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setCoalescing&lt;/span>(&lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory.&lt;span style="color:#a6e22e">setExpandEntityReferences&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DocumentBuilder builder &lt;span style="color:#f92672">=&lt;/span> factory.&lt;span style="color:#a6e22e">newDocumentBuilder&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.&lt;span style="color:#a6e22e">setEntityResolver&lt;/span>(entityResolver);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.&lt;span style="color:#a6e22e">setErrorHandler&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> ErrorHandler() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">error&lt;/span>(SAXParseException exception) &lt;span style="color:#66d9ef">throws&lt;/span> SAXException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> exception;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">fatalError&lt;/span>(SAXParseException exception) &lt;span style="color:#66d9ef">throws&lt;/span> SAXException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> exception;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">warning&lt;/span>(SAXParseException exception) &lt;span style="color:#66d9ef">throws&lt;/span> SAXException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è§£æžå™¨çš„æºç äº†,è·Ÿmybatisæ²¡æœ‰å…³ç³»äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> builder.&lt;span style="color:#a6e22e">parse&lt;/span>(inputSource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Error creating document instance. Cause: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLConfigBuilder#parse&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> Configuration &lt;span style="color:#a6e22e">parse&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (parsed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸€ä¸ªé…ç½®æ–‡ä»¶,åªèƒ½è§£æžä¸€æ¬¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Each XMLConfigBuilder can only be used once.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parsed &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹è§£æž,æœ€ç»ˆå°è£…åˆ°Configurationå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parseConfiguration(parser.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/configuration&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> configuration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.parsing.XPathParser#evalNode(java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> XNode &lt;span style="color:#a6e22e">evalNode&lt;/span>(String expression) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> evalNode(document, expression);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.parsing.XPathParser#evalNode(java.lang.Object, java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> XNode &lt;span style="color:#a6e22e">evalNode&lt;/span>(Object root, String expression) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Node node &lt;span style="color:#f92672">=&lt;/span> (Node) evaluate(expression, root, XPathConstants.&lt;span style="color:#a6e22e">NODE&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (node &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XNode(&lt;span style="color:#66d9ef">this&lt;/span>, node, variables);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLConfigBuilder#parseConfiguration&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯ä»¥é…ç½®è¿™äº›ä¿¡æ¯:https://mybatis.org/mybatis-3/zh/configuration.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">parseConfiguration&lt;/span>(XNode root) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//issue #117 read properties first&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> propertiesElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;properties&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Properties settings &lt;span style="color:#f92672">=&lt;/span> settingsAsProperties(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;settings&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> loadCustomVfs(settings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> loadCustomLogImpl(settings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> typeAliasesElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;typeAliases&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ’ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pluginElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;plugins&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> objectFactoryElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;objectFactory&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> objectWrapperFactoryElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;objectWrapperFactory&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reflectorFactoryElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;reflectorFactory&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> settingsElement(settings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// read it after objectFactory and objectWrapperFactory issue #631&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> environmentsElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;environments&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> databaseIdProviderElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;databaseIdProvider&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> typeHandlerElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;typeHandlers&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mapperElement(root.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;mappers&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Error parsing SQL Mapper Configuration. Cause: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLConfigBuilder#mapperElement&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">mapperElement&lt;/span>(XNode parent) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (parent &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (XNode child : parent.&lt;span style="color:#a6e22e">getChildren&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#e6db74">&amp;#34;package&amp;#34;&lt;/span>.&lt;span style="color:#a6e22e">equals&lt;/span>(child.&lt;span style="color:#a6e22e">getName&lt;/span>())) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String mapperPackage &lt;span style="color:#f92672">=&lt;/span> child.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">addMappers&lt;/span>(mapperPackage);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resource &lt;span style="color:#f92672">=&lt;/span> child.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resource&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String url &lt;span style="color:#f92672">=&lt;/span> child.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;url&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String mapperClass &lt;span style="color:#f92672">=&lt;/span> child.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;class&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸‰ä¸ªå€¼æ˜¯äº’æ–¥çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (resource &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> url &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> mapperClass &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">resource&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream inputStream &lt;span style="color:#f92672">=&lt;/span> Resources.&lt;span style="color:#a6e22e">getResourceAsStream&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> XMLMapperBuilder mapperParser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLMapperBuilder(inputStream, configuration, resource, configuration.&lt;span style="color:#a6e22e">getSqlFragments&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mapperParser.&lt;span style="color:#a6e22e">parse&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (resource &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> url &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> mapperClass &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">resource&lt;/span>(url);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸“é—¨ç”¨æ¥è§£æžmapperæ˜ å°„æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InputStream inputStream &lt;span style="color:#f92672">=&lt;/span> Resources.&lt;span style="color:#a6e22e">getUrlAsStream&lt;/span>(url);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> XMLMapperBuilder mapperParser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLMapperBuilder(inputStream, configuration, url, configuration.&lt;span style="color:#a6e22e">getSqlFragments&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mapperParser.&lt;span style="color:#a6e22e">parse&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (resource &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> url &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> mapperClass &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> mapperInterface &lt;span style="color:#f92672">=&lt;/span> Resources.&lt;span style="color:#a6e22e">classForName&lt;/span>(mapperClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">addMapper&lt;/span>(mapperInterface);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;A mapper element may only specify a url, resource or class, but not more than one.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§£é‡Šä¸‹environmentä½œç”¨,å°±æ˜¯&lt;code>&amp;lt;environment id=&amp;quot;development&amp;quot;&amp;gt;&lt;/code>è¿™é‡Œçš„,ä¸åŒçš„çŽ¯å¢ƒä¸åŒçš„é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;environments&lt;/span> &lt;span style="color:#a6e22e">default=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;development&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;environment&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;development&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;transactionManager&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;JDBC&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;dataSource&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;POOLED&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;driver&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.mysql.cj.jdbc.Driver&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;url&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;jdbc:mysql://192.168.3.12:3306/orangedb&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;abcd2022&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dataSource&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/environment&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;environment&lt;/span> &lt;span style="color:#a6e22e">id=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;transactionManager&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;JDBC&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;dataSource&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;POOLED&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;driver&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.mysql.cj.jdbc.Driver&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;url&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;jdbc:mysql://192.168.3.12:3306/orangedb&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;property&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#a6e22e">value=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;abcd2022&amp;#34;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/dataSource&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/environment&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/environments&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨æ³•:å¦‚ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>SqlSessionFactory sqlSessionFactory &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SqlSessionFactoryBuilder().&lt;span style="color:#a6e22e">build&lt;/span>(inputStream,&lt;span style="color:#e6db74">&amp;#34;development&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢æ˜¯è§£æžmapperæ–‡ä»¶,é…ç½®çš„å±žæ€§,å‚è€ƒ:&lt;code>https://mybatis.org/mybatis-3/zh/sqlmap-xml.html&lt;/code>&lt;/p>
&lt;h2 id="è§£æžmapperé…ç½®æ–‡ä»¶">è§£æžmapperé…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLMapperBuilder#XMLMapperBuilder(java.io.InputStream, org.apache.ibatis.session.Configuration, java.lang.String, java.util.Map&amp;lt;java.lang.String,org.apache.ibatis.parsing.XNode&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿™ä¸ªæ–¹æ³•,å‰é¢å·²ç»ç”¨è¿‡äº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">XMLMapperBuilder&lt;/span>(InputStream inputStream, Configuration configuration, String resource, Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, XNode&lt;span style="color:#f92672">&amp;gt;&lt;/span> sqlFragments) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> XPathParser(inputStream, &lt;span style="color:#66d9ef">true&lt;/span>, configuration.&lt;span style="color:#a6e22e">getVariables&lt;/span>(), &lt;span style="color:#66d9ef">new&lt;/span> XMLMapperEntityResolver()),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration, resource, sqlFragments);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLMapperBuilder#parse&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// mapperæ˜ å°„æ–‡ä»¶æ˜¯å¦å·²ç»åŠ è½½è¿‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>configuration.&lt;span style="color:#a6e22e">isResourceLoaded&lt;/span>(resource)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žæ ¹èŠ‚ç‚¹è§£æž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configurationElement(parser.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/mapper&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ‡è®°å·²ç»è§£æž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">addLoadedResource&lt;/span>(resource);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸ºå‘½åç©ºé—´ç»‘å®šæ˜ å°„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bindMapperForNamespace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parsePendingResultMaps();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parsePendingCacheRefs();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parsePendingStatements();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLMapperBuilder#configurationElement&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">configurationElement&lt;/span>(XNode context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å‘½åç©ºé—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String namespace &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;namespace&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘½åç©ºé—´ä¸èƒ½ä¸ºç©º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (namespace &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">||&lt;/span> namespace.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Mapper&amp;#39;s namespace cannot be empty&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®å½“å‰çš„å‘½åç©ºé—´çš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æž„å»ºmappedStatementå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builderAssistant.&lt;span style="color:#a6e22e">setCurrentNamespace&lt;/span>(namespace);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheRefElement(context.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;cache-ref&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheElement(context.&lt;span style="color:#a6e22e">evalNode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;cache&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> parameterMapElement(context.&lt;span style="color:#a6e22e">evalNodes&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/mapper/parameterMap&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resultMapElements(context.&lt;span style="color:#a6e22e">evalNodes&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/mapper/resultMap&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sqlElement(context.&lt;span style="color:#a6e22e">evalNodes&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/mapper/sql&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buildStatementFromContext(context.&lt;span style="color:#a6e22e">evalNodes&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;select|insert|update|delete&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Error parsing Mapper XML. The XML location is &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> resource &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;. Cause: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLMapperBuilder#buildStatementFromContext(java.util.List&amp;lt;org.apache.ibatis.parsing.XNode&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">buildStatementFromContext&lt;/span>(List&lt;span style="color:#f92672">&amp;lt;&lt;/span>XNode&lt;span style="color:#f92672">&amp;gt;&lt;/span> list) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (configuration.&lt;span style="color:#a6e22e">getDatabaseId&lt;/span>() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buildStatementFromContext(list, configuration.&lt;span style="color:#a6e22e">getDatabaseId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰é…ç½®è¿‡getDatabaseId,æ‰€ä»¥èµ°è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buildStatementFromContext(list, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLMapperBuilder#buildStatementFromContext(java.util.List&amp;lt;org.apache.ibatis.parsing.XNode&amp;gt;, java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">buildStatementFromContext&lt;/span>(List&lt;span style="color:#f92672">&amp;lt;&lt;/span>XNode&lt;span style="color:#f92672">&amp;gt;&lt;/span> list, String requiredDatabaseId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (XNode context : list) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> XMLStatementBuilder statementParser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLStatementBuilder(configuration, builderAssistant, context, requiredDatabaseId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> statementParser.&lt;span style="color:#a6e22e">parseStatementNode&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (IncompleteElementException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">addIncompleteStatement&lt;/span>(statementParser);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLStatementBuilder#parseStatementNode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">parseStatementNode&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String id &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;id&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String databaseId &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;databaseId&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰è®¾ç½®è¿‡databaseId&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>databaseIdMatchesCurrent(id, databaseId, &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">requiredDatabaseId&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String nodeName &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getNode&lt;/span>().&lt;span style="color:#a6e22e">getNodeName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è§£æžSqlå‘½ä»¤ç±»åž‹æ˜¯ä»€ä¹ˆ,ç¡®å®žæ˜¯ Select,update,insert,delete ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlCommandType sqlCommandType &lt;span style="color:#f92672">=&lt;/span> SqlCommandType.&lt;span style="color:#a6e22e">valueOf&lt;/span>(nodeName.&lt;span style="color:#a6e22e">toUpperCase&lt;/span>(Locale.&lt;span style="color:#a6e22e">ENGLISH&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isSelect &lt;span style="color:#f92672">=&lt;/span> sqlCommandType &lt;span style="color:#f92672">==&lt;/span> SqlCommandType.&lt;span style="color:#a6e22e">SELECT&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> flushCache &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getBooleanAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;flushCache&amp;#34;&lt;/span>, &lt;span style="color:#f92672">!&lt;/span>isSelect);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> useCache &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getBooleanAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;useCache&amp;#34;&lt;/span>, isSelect);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> resultOrdered &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getBooleanAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resultOrdered&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Include Fragments before parsing&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> XMLIncludeTransformer includeParser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLIncludeTransformer(configuration, builderAssistant);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> includeParser.&lt;span style="color:#a6e22e">applyIncludes&lt;/span>(context.&lt;span style="color:#a6e22e">getNode&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String parameterType &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;parameterType&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> parameterTypeClass &lt;span style="color:#f92672">=&lt;/span> resolveClass(parameterType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é…ç½®è¯­è¨€é©±åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String lang &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;lang&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LanguageDriver langDriver &lt;span style="color:#f92672">=&lt;/span> getLanguageDriver(lang);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Parse selectKey after includes and remove them.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processSelectKeyNodes(id, parameterTypeClass, langDriver);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Parse the SQL (pre: &amp;lt;selectKey&amp;gt; and &amp;lt;include&amp;gt; were parsed and removed)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> KeyGenerator keyGenerator;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String keyStatementId &lt;span style="color:#f92672">=&lt;/span> id &lt;span style="color:#f92672">+&lt;/span> SelectKeyGenerator.&lt;span style="color:#a6e22e">SELECT_KEY_SUFFIX&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> keyStatementId &lt;span style="color:#f92672">=&lt;/span> builderAssistant.&lt;span style="color:#a6e22e">applyCurrentNamespace&lt;/span>(keyStatementId, &lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (configuration.&lt;span style="color:#a6e22e">hasKeyGenerator&lt;/span>(keyStatementId)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> keyGenerator &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">getKeyGenerator&lt;/span>(keyStatementId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> keyGenerator &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getBooleanAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;useGeneratedKeys&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">isUseGeneratedKeys&lt;/span>() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> SqlCommandType.&lt;span style="color:#a6e22e">INSERT&lt;/span>.&lt;span style="color:#a6e22e">equals&lt;/span>(sqlCommandType))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">?&lt;/span> Jdbc3KeyGenerator.&lt;span style="color:#a6e22e">INSTANCE&lt;/span> : NoKeyGenerator.&lt;span style="color:#a6e22e">INSTANCE&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ›¿æ¢å ä½ç¬¦?,ä¿å­˜#{}é‡Œé¢çš„å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSource sqlSource &lt;span style="color:#f92672">=&lt;/span> langDriver.&lt;span style="color:#a6e22e">createSqlSource&lt;/span>(configuration, context, parameterTypeClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StatementType statementType &lt;span style="color:#f92672">=&lt;/span> StatementType.&lt;span style="color:#a6e22e">valueOf&lt;/span>(context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;statementType&amp;#34;&lt;/span>, StatementType.&lt;span style="color:#a6e22e">PREPARED&lt;/span>.&lt;span style="color:#a6e22e">toString&lt;/span>()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer fetchSize &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getIntAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;fetchSize&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer timeout &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getIntAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;timeout&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String parameterMap &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;parameterMap&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultType &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resultType&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> resultTypeClass &lt;span style="color:#f92672">=&lt;/span> resolveClass(resultType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultMap &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resultMap&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultSetType &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resultSetType&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultSetType resultSetTypeEnum &lt;span style="color:#f92672">=&lt;/span> resolveResultSetType(resultSetType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (resultSetTypeEnum &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resultSetTypeEnum &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">getDefaultResultSetType&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String keyProperty &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;keyProperty&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String keyColumn &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;keyColumn&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultSets &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resultSets&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡æž„å»ºè€…åŠ©æ‰‹,åˆ›å»ºmappedstatementå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builderAssistant.&lt;span style="color:#a6e22e">addMappedStatement&lt;/span>(id, sqlSource, statementType, sqlCommandType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resultSetTypeEnum, flushCache, useCache, resultOrdered,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.MapperBuilderAssistant#addMappedStatement(java.lang.String, org.apache.ibatis.mapping.SqlSource, org.apache.ibatis.mapping.StatementType, org.apache.ibatis.mapping.SqlCommandType, java.lang.Integer, java.lang.Integer, java.lang.String, java.lang.Class&amp;lt;?&amp;gt;, java.lang.String, java.lang.Class&amp;lt;?&amp;gt;, org.apache.ibatis.mapping.ResultSetType, boolean, boolean, boolean, org.apache.ibatis.executor.keygen.KeyGenerator, java.lang.String, java.lang.String, java.lang.String, org.apache.ibatis.scripting.LanguageDriver, java.lang.String)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> MappedStatement &lt;span style="color:#a6e22e">addMappedStatement&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String id,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSource sqlSource,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StatementType statementType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlCommandType sqlCommandType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer fetchSize,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Integer timeout,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String parameterMap,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> parameterType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultMap,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> resultType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultSetType resultSetType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> flushCache,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> useCache,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> resultOrdered,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> KeyGenerator keyGenerator,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String keyProperty,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String keyColumn,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String databaseId,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LanguageDriver lang,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String resultSets) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (unresolvedCacheRef) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> IncompleteElementException(&lt;span style="color:#e6db74">&amp;#34;Cache-ref not yet resolved&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id &lt;span style="color:#f92672">=&lt;/span> applyCurrentNamespace(id, &lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> isSelect &lt;span style="color:#f92672">=&lt;/span> sqlCommandType &lt;span style="color:#f92672">==&lt;/span> SqlCommandType.&lt;span style="color:#a6e22e">SELECT&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºMappedStatementå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MappedStatement.&lt;span style="color:#a6e22e">Builder&lt;/span> statementBuilder &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> MappedStatement.&lt;span style="color:#a6e22e">Builder&lt;/span>(configuration, id, sqlSource, sqlCommandType)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">resource&lt;/span>(resource)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">fetchSize&lt;/span>(fetchSize)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">timeout&lt;/span>(timeout)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">statementType&lt;/span>(statementType)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">keyGenerator&lt;/span>(keyGenerator)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">keyProperty&lt;/span>(keyProperty)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">keyColumn&lt;/span>(keyColumn)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">databaseId&lt;/span>(databaseId)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">lang&lt;/span>(lang)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">resultOrdered&lt;/span>(resultOrdered)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">resultSets&lt;/span>(resultSets)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">resultMaps&lt;/span>(getStatementResultMaps(resultMap, resultType, id))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">resultSetType&lt;/span>(resultSetType)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">flushCacheRequired&lt;/span>(valueOrDefault(flushCache, &lt;span style="color:#f92672">!&lt;/span>isSelect))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">useCache&lt;/span>(valueOrDefault(useCache, isSelect))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">cache&lt;/span>(currentCache);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ParameterMap statementParameterMap &lt;span style="color:#f92672">=&lt;/span> getStatementParameterMap(parameterMap, parameterType, id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (statementParameterMap &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> statementBuilder.&lt;span style="color:#a6e22e">parameterMap&lt;/span>(statementParameterMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°è£…å¥½MappedStatement,å¹¶è¿”å›ž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MappedStatement statement &lt;span style="color:#f92672">=&lt;/span> statementBuilder.&lt;span style="color:#a6e22e">build&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configuration.&lt;span style="color:#a6e22e">addMappedStatement&lt;/span>(statement);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> statement;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.MapperBuilderAssistant#applyCurrentNamespace&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">applyCurrentNamespace&lt;/span>(String base, &lt;span style="color:#66d9ef">boolean&lt;/span> isReference) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (base &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isReference) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// is it qualified with any namespace yet?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (base.&lt;span style="color:#a6e22e">contains&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> base;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// is it qualified with this namespace yet?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (base.&lt;span style="color:#a6e22e">startsWith&lt;/span>(currentNamespace &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> base;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (base.&lt;span style="color:#a6e22e">contains&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BuilderException(&lt;span style="color:#e6db74">&amp;#34;Dots are not allowed in element names, please remove it from &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> base);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// namespacename+ç‚¹+æ–¹æ³•å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> currentNamespace &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> base;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™é‡Œ,é…ç½®æ–‡ä»¶å°±è§£æžå®Œæˆäº†,ä¸‹é¢æ˜¯åˆ›å»ºSqlSessionFactoryå¯¹è±¡&lt;/p>
&lt;h2 id="sqlsession">SqlSession&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// org.apache.ibatis.session.SqlSessionFactoryBuilder#build(org.apache.ibatis.session.Configuration)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSessionFactory &lt;span style="color:#a6e22e">build&lt;/span>(Configuration config) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultSqlSessionFactory(config);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢æ˜¯mybatisåˆ›å»ºsqlçš„æµç¨‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// /Users/anthony/.m2/repository/org/mybatis/mybatis/3.5.2/mybatis-3.5.2-sources.jar!/org/apache/ibatis/builder/xml/XMLStatementBuilder.java:96&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å ä½ç¬¦æ˜¯å¦‚æžœè¿›è¡Œæ›¿æ¢çš„?åŠ¨æ€sqlå¦‚æžœè¿›è¡Œçš„è§£æž&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>String lang &lt;span style="color:#f92672">=&lt;/span> context.&lt;span style="color:#a6e22e">getStringAttribute&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;lang&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LanguageDriver langDriver &lt;span style="color:#f92672">=&lt;/span> getLanguageDriver(lang);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SqlSource sqlSource &lt;span style="color:#f92672">=&lt;/span> langDriver.&lt;span style="color:#a6e22e">createSqlSource&lt;/span>(configuration, context, parameterTypeClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.builder.xml.XMLStatementBuilder#getLanguageDriver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> LanguageDriver &lt;span style="color:#a6e22e">getLanguageDriver&lt;/span>(String lang) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Class&lt;span style="color:#f92672">&amp;lt;?&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> LanguageDriver&lt;span style="color:#f92672">&amp;gt;&lt;/span> langClass &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (lang &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> langClass &lt;span style="color:#f92672">=&lt;/span> resolveClass(lang);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> configuration.&lt;span style="color:#a6e22e">getLanguageDriver&lt;/span>(langClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.Configuration#getLanguageDriver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> LanguageDriver &lt;span style="color:#a6e22e">getLanguageDriver&lt;/span>(Class&lt;span style="color:#f92672">&amp;lt;?&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> LanguageDriver&lt;span style="color:#f92672">&amp;gt;&lt;/span> langClass) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (langClass &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> languageRegistry.&lt;span style="color:#a6e22e">getDefaultDriver&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> languageRegistry.&lt;span style="color:#a6e22e">register&lt;/span>(langClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> languageRegistry.&lt;span style="color:#a6e22e">getDriver&lt;/span>(langClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.scripting.LanguageDriverRegistry#getDefaultDriver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ‰“æ–­ç‚¹å¯ä»¥çœ‹åˆ°æ˜¯:XMLLanguageDriver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> LanguageDriver &lt;span style="color:#a6e22e">getDefaultDriver&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> getDriver(getDefaultDriverClass());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> Class&lt;span style="color:#f92672">&amp;lt;?&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> LanguageDriver&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getDefaultDriverClass&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> defaultDriverClass;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.scripting.xmltags.XMLLanguageDriver#createSqlSource(org.apache.ibatis.session.Configuration, org.apache.ibatis.parsing.XNode, java.lang.Class&amp;lt;?&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSource &lt;span style="color:#a6e22e">createSqlSource&lt;/span>(Configuration configuration, XNode script, Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> parameterType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> XMLScriptBuilder builder &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> XMLScriptBuilder(configuration, script, parameterType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> builder.&lt;span style="color:#a6e22e">parseScriptNode&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.scripting.xmltags.XMLScriptBuilder#XMLScriptBuilder(org.apache.ibatis.session.Configuration, org.apache.ibatis.parsing.XNode, java.lang.Class&amp;lt;?&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">XMLScriptBuilder&lt;/span>(Configuration configuration, XNode context, Class&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> parameterType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>(configuration);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">context&lt;/span> &lt;span style="color:#f92672">=&lt;/span> context;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">parameterType&lt;/span> &lt;span style="color:#f92672">=&lt;/span> parameterType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–åŠ¨æ€sqlçš„èŠ‚ç‚¹å¤„ç†å™¨ç»“åˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> initNodeHandlerMap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.scripting.xmltags.XMLScriptBuilder#initNodeHandlerMap&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">initNodeHandlerMap&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;trim&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> TrimHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;where&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> WhereHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;set&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> SetHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;foreach&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> ForEachHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;if&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> IfHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;choose&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> ChooseHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;when&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> IfHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;otherwise&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> OtherwiseHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeHandlerMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;bind&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> BindHandler());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.scripting.xmltags.XMLScriptBuilder#parseScriptNode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è§£æžsql,è¿˜æœ‰å‚æ•°ç±»åž‹å’Œç»“æžœé›†ç±»åž‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSource &lt;span style="color:#a6e22e">parseScriptNode&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MixedSqlNode rootSqlNode &lt;span style="color:#f92672">=&lt;/span> parseDynamicTags(context);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SqlSource sqlSource;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isDynamic) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sqlSource &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DynamicSqlSource(configuration, rootSqlNode);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sqlSource &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RawSqlSource(configuration, rootSqlNode, parameterType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sqlSource;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¨éƒ¨å°±è§£æžå®Œæˆäº†,æŽ¥ä¸‹æ¥&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051430408.png" alt="image-20230813213519036">&lt;/p>
&lt;p>çœ‹çœ‹&lt;code>session = sqlSessionFactory.openSession();&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ›å»ºäº‹åŠ¡å¯¹è±¡&lt;/li>
&lt;li>åˆ›å»ºäº†æ‰§è¡Œå™¨å¯¹è±¡CasheingExecutor&lt;/li>
&lt;li>åˆ›å»ºDefaultSqlSessionå¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.defaults.DefaultSqlSessionFactory#openSession()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> SqlSession &lt;span style="color:#a6e22e">openSession&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> openSessionFromDataSource(configuration.&lt;span style="color:#a6e22e">getDefaultExecutorType&lt;/span>(), &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.Configuration#getDefaultExecutorType&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// protected ExecutorType defaultExecutorType = ExecutorType.SIMPLE;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> ExecutorType &lt;span style="color:#a6e22e">getDefaultExecutorType&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> defaultExecutorType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.defaults.DefaultSqlSessionFactory#openSessionFromDataSource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‚æ•°ä¸€:æ‰§è¡Œå™¨,å‚æ•°äºŒ:éš”ç¦»çº§åˆ«&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> SqlSession &lt;span style="color:#a6e22e">openSessionFromDataSource&lt;/span>(ExecutorType execType, TransactionIsolationLevel level, &lt;span style="color:#66d9ef">boolean&lt;/span> autoCommit) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Transaction tx &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–æ•°æ®æºçŽ¯å¢ƒä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> Environment environment &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">getEnvironment&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–äº‹åŠ¡å·¥åŽ‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> TransactionFactory transactionFactory &lt;span style="color:#f92672">=&lt;/span> getTransactionFactoryFromEnvironment(environment);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–JdbcTransactionæˆ–è€…ManagedTransaction&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ManagedTransaction å°±ç›¸å½“äºŽæ²¡æœ‰äº‹åŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tx &lt;span style="color:#f92672">=&lt;/span> transactionFactory.&lt;span style="color:#a6e22e">newTransaction&lt;/span>(environment.&lt;span style="color:#a6e22e">getDataSource&lt;/span>(), level, autoCommit);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºExecutoræ‰§è¡Œå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> Executor executor &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">newExecutor&lt;/span>(tx, execType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºDefaultSqlSession&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> DefaultSqlSession(configuration, executor, autoCommit);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> closeTransaction(tx); &lt;span style="color:#75715e">// may have fetched a connection so lets call close()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> ExceptionFactory.&lt;span style="color:#a6e22e">wrapException&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error opening session. Cause: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">reset&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.transaction.jdbc.JdbcTransactionFactory#newTransaction(java.sql.Connection)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> Transaction &lt;span style="color:#a6e22e">newTransaction&lt;/span>(DataSource ds, TransactionIsolationLevel level, &lt;span style="color:#66d9ef">boolean&lt;/span> autoCommit) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> JdbcTransaction(ds, level, autoCommit);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.Configuration#newExecutor(org.apache.ibatis.transaction.Transaction, org.apache.ibatis.session.ExecutorType)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Executor &lt;span style="color:#a6e22e">newExecutor&lt;/span>(Transaction transaction, ExecutorType executorType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorType &lt;span style="color:#f92672">=&lt;/span> executorType &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> defaultExecutorType : executorType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executorType &lt;span style="color:#f92672">=&lt;/span> executorType &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> ExecutorType.&lt;span style="color:#a6e22e">SIMPLE&lt;/span> : executorType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Executor executor;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ExecutorType.&lt;span style="color:#a6e22e">BATCH&lt;/span> &lt;span style="color:#f92672">==&lt;/span> executorType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BatchExecutor(&lt;span style="color:#66d9ef">this&lt;/span>, transaction);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (ExecutorType.&lt;span style="color:#a6e22e">REUSE&lt;/span> &lt;span style="color:#f92672">==&lt;/span> executorType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ReuseExecutor(&lt;span style="color:#66d9ef">this&lt;/span>, transaction);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SimpleExecutor(&lt;span style="color:#66d9ef">this&lt;/span>, transaction);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœå…è®¸ç¼“å­˜,ä¼šé€šè¿‡CachingExecutoråŽ»ä»£ç†ä¸€å±‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cacheEnabled) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executor &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> CachingExecutor(executor);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‹¦æˆªå™¨æ’ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> executor &lt;span style="color:#f92672">=&lt;/span> (Executor) interceptorChain.&lt;span style="color:#a6e22e">pluginAll&lt;/span>(executor);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> executor;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.CachingExecutor#CachingExecutor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">CachingExecutor&lt;/span>(Executor delegate) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">delegate&lt;/span> &lt;span style="color:#f92672">=&lt;/span> delegate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delegate.&lt;span style="color:#a6e22e">setExecutorWrapper&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è°ƒç”¨å…·ä½“çš„apiè¿›è¡ŒæŸ¥è¯¢">è°ƒç”¨å…·ä½“çš„APIè¿›è¡ŒæŸ¥è¯¢&lt;/h2>
&lt;p>ç”¨&lt;code>å¯åŠ¨ç±»&lt;/code>ä¸­çš„æ–¹æ³•,å¯¹æ¯”å¯ä»¥å‘çŽ°ä¸¤æ®µä»£ç ä¸åŒä¹‹å¤„ä¸º:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>Map map &lt;span style="color:#f92672">=&lt;/span> sqlSession.&lt;span style="color:#a6e22e">selectOne&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;com.analyze.mybatis.mapper.UserMapper.getUA&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>UserMapper userMapper &lt;span style="color:#f92672">=&lt;/span> sqlSession.&lt;span style="color:#a6e22e">getMapper&lt;/span>(UserMapper.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Map map &lt;span style="color:#f92672">=&lt;/span> userMapper.&lt;span style="color:#a6e22e">getUA&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æŸ¥çœ‹&lt;code>DefaultSqlSession&lt;/code>ä¸­çš„&lt;code>selectOne&lt;/code>æ–¹æ³•,ä¼šæ‰§è¡Œä»¥ä¸‹çš„è°ƒç”¨é“¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.defaults.DefaultSqlSession#selectOne(java.lang.String, java.lang.Object)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> T &lt;span style="color:#a6e22e">selectOne&lt;/span>(String statement, Object parameter) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Popular vote was to return null on 0 results and throw exception on too many.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">selectList&lt;/span>(statement, parameter);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (list.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> list.&lt;span style="color:#a6e22e">get&lt;/span>(0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (list.&lt;span style="color:#a6e22e">size&lt;/span>() &lt;span style="color:#f92672">&amp;gt;&lt;/span> 1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> TooManyResultsException(&lt;span style="color:#e6db74">&amp;#34;Expected one result (or null) to be returned by selectOne(), but found: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> list.&lt;span style="color:#a6e22e">size&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.defaults.DefaultSqlSession#selectList(java.lang.String, java.lang.Object)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// RowBounds åˆ†é¡µå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">selectList&lt;/span>(String statement, Object parameter) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">selectList&lt;/span>(statement, parameter, RowBounds.&lt;span style="color:#a6e22e">DEFAULT&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.defaults.DefaultSqlSession#selectList(java.lang.String, java.lang.Object, org.apache.ibatis.session.RowBounds)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">selectList&lt;/span>(String statement, Object parameter, RowBounds rowBounds) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®ä¼ å…¥çš„statementId,èŽ·å–mapperStatementå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MappedStatement ms &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">getMappedStatement&lt;/span>(statement);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è°ƒç”¨æ‰§è¡Œå™¨çš„æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> executor.&lt;span style="color:#a6e22e">query&lt;/span>(ms, wrapCollection(parameter), rowBounds, Executor.&lt;span style="color:#a6e22e">NO_RESULT_HANDLER&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> ExceptionFactory.&lt;span style="color:#a6e22e">wrapException&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error querying database. Cause: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> e, e);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">reset&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.CachingExecutor#query(org.apache.ibatis.mapping.MappedStatement, java.lang.Object, org.apache.ibatis.session.RowBounds, org.apache.ibatis.session.ResultHandler)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ³¨æ„è¿™é‡Œæ˜¯CachingExecutor,é»˜è®¤çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å¸¦é—®å·çš„sqlè¯­å¥,æ¯”å¦‚ select * from user_info where id = ?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BoundSql boundSql &lt;span style="color:#f92672">=&lt;/span> ms.&lt;span style="color:#a6e22e">getBoundSql&lt;/span>(parameterObject);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”Ÿæˆç¼“å­˜key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CacheKey key &lt;span style="color:#f92672">=&lt;/span> createCacheKey(ms, parameterObject, rowBounds, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.CachingExecutor#query(org.apache.ibatis.mapping.MappedStatement, java.lang.Object, org.apache.ibatis.session.RowBounds, org.apache.ibatis.session.ResultHandler, org.apache.ibatis.cache.CacheKey, org.apache.ibatis.mapping.BoundSql)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// äºŒçº§ç¼“å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// usermapperçš„æ ‡ç­¾é‡Œå¯ä»¥è®¾ç½®&amp;lt;Cache&amp;gt;ç¼“å­˜æ ‡ç­¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Cache cache &lt;span style="color:#f92672">=&lt;/span> ms.&lt;span style="color:#a6e22e">getCache&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cache &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ·æ–°äºŒçº§ç¼“å­˜,åœ¨&amp;lt;select&amp;gt; æ ‡ç­¾é‡Œå¯ä»¥é…ç½®flushcache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flushCacheIfRequired(ms);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åœ¨&amp;lt;select&amp;gt; æ ‡ç­¾é‡Œå¯ä»¥é…ç½®usecache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ms.&lt;span style="color:#a6e22e">isUseCache&lt;/span>() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> resultHandler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­æ˜¯ä¸æ˜¯å­˜è¿‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ensureNoOutParams(ms, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@SuppressWarnings&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;unchecked&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»ŽäºŒçº§ç¼“å­˜ä¸­æŸ¥è¯¢æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> list &lt;span style="color:#f92672">=&lt;/span> (List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span>) tcm.&lt;span style="color:#a6e22e">getObject&lt;/span>(cache, key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœä»ŽäºŒçº§ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (list &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å§”æ‰˜ç»™BaseExecutoræ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list &lt;span style="color:#f92672">=&lt;/span> delegate.&lt;span style="color:#a6e22e">query&lt;/span>(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†æŸ¥è¯¢ç»“æžœä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­,è¿™é‡Œåªæ˜¯å­˜åˆ°mapé›†åˆä¸­,æ²¡æœ‰çœŸæ­£å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tcm.&lt;span style="color:#a6e22e">putObject&lt;/span>(cache, key, list); &lt;span style="color:#75715e">// issue #578 and #116&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> delegate.&lt;span style="color:#a6e22e">query&lt;/span>(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.BaseExecutor#query(org.apache.ibatis.mapping.MappedStatement, java.lang.Object, org.apache.ibatis.session.RowBounds, org.apache.ibatis.session.ResultHandler, org.apache.ibatis.cache.CacheKey, org.apache.ibatis.mapping.BoundSql)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">resource&lt;/span>(ms.&lt;span style="color:#a6e22e">getResource&lt;/span>()).&lt;span style="color:#a6e22e">activity&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;executing a query&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">object&lt;/span>(ms.&lt;span style="color:#a6e22e">getId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (closed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ExecutorException(&lt;span style="color:#e6db74">&amp;#34;Executor was closed.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœé…ç½®äº†FlushCacheRequiredä¸ºtrue,åˆ™ä¼šåœ¨æ‰§è¡Œå™¨æ‰§è¡Œä¹‹å‰å°±æ¸…ç©ºæœ¬åœ°ä¸€çº§ç¼“å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (queryStack &lt;span style="color:#f92672">==&lt;/span> 0 &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ms.&lt;span style="color:#a6e22e">isFlushCacheRequired&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¸…ç©ºç¼“å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> clearLocalCache();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> queryStack&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žä¸€çº§ç¼“å­˜ä¸­èŽ·å–æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list &lt;span style="color:#f92672">=&lt;/span> resultHandler &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> (List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span>) localCache.&lt;span style="color:#a6e22e">getObject&lt;/span>(key) : &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (list &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœæœ‰æ•°æ®,åˆ™å¤„ç†æœ¬åœ°ç¼“å­˜ç»“æžœç»™è¾“å‡ºå‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿˜æ˜¯å¤„ç†å­˜è¿‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰ç¼“å­˜ç»“æžœ,åˆ™ä»Žæ•°æ®åº“æŸ¥è¯¢ç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list &lt;span style="color:#f92672">=&lt;/span> queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> queryStack&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (queryStack &lt;span style="color:#f92672">==&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (DeferredLoad deferredLoad : deferredLoads) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deferredLoad.&lt;span style="color:#a6e22e">load&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// issue #601&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deferredLoads.&lt;span style="color:#a6e22e">clear&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (configuration.&lt;span style="color:#a6e22e">getLocalCacheScope&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> LocalCacheScope.&lt;span style="color:#a6e22e">STATEMENT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// issue #482&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> clearLocalCache();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.BaseExecutor#queryFromDatabase&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">queryFromDatabase&lt;/span>(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘æœ¬åœ°ç¼“å­˜ä¸­å­˜å…¥ä¸€ä¸ªExecutionPlaceholderçš„æžšä¸¾ç±»å ä½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> localCache.&lt;span style="color:#a6e22e">putObject&lt;/span>(key, EXECUTION_PLACEHOLDER);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡ŒæŸ¥è¯¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list &lt;span style="color:#f92672">=&lt;/span> doQuery(ms, parameter, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡ŒçŽ©ç§»é™¤è¿™ä¸ªkey&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> localCache.&lt;span style="color:#a6e22e">removeObject&lt;/span>(key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> localCache.&lt;span style="color:#a6e22e">putObject&lt;/span>(key, list);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ms.&lt;span style="color:#a6e22e">getStatementType&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> StatementType.&lt;span style="color:#a6e22e">CALLABLE&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> localOutputParameterCache.&lt;span style="color:#a6e22e">putObject&lt;/span>(key, parameter);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.SimpleExecutor#doQuery&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">doQuery&lt;/span>(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Statement stmt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–å…¨å±€é…ç½®æ–‡ä»¶å®žä¾‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Configuration configuration &lt;span style="color:#f92672">=&lt;/span> ms.&lt;span style="color:#a6e22e">getConfiguration&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// newä¸€ä¸ªstatementHandlerå®žä¾‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StatementHandler handler &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">newStatementHandler&lt;/span>(wrapper, ms, parameter, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‡†å¤‡å¤„ç†å™¨,ä¸»è¦åŒ…æ‹¬åˆ›å»ºstatementä»¥åŠåŠ¨æ€å‚æ•°çš„è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stmt &lt;span style="color:#f92672">=&lt;/span> prepareStatement(handler, ms.&lt;span style="color:#a6e22e">getStatementLog&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡ŒçœŸæ­£çš„æ•°æ®åº“æ“ä½œè°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handler.&lt;span style="color:#a6e22e">query&lt;/span>(stmt, resultHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> closeStatement(stmt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.session.Configuration#newStatementHandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> StatementHandler &lt;span style="color:#a6e22e">newStatementHandler&lt;/span>(Executor executor, MappedStatement mappedStatement, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºè·¯ç”±åŠŸèƒ½çš„StatementHanlder,æ ¹æ®MappedStatementä¸­çš„StetementType&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StatementHandler statementHandler &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RoutingStatementHandler(executor, mappedStatement, parameterObject, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ’ä»¶æœºåˆ¶:å¯¹æ ¸å¿ƒå¯¹è±¡è¿›è¡Œæ‹¦æˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> statementHandler &lt;span style="color:#f92672">=&lt;/span> (StatementHandler) interceptorChain.&lt;span style="color:#a6e22e">pluginAll&lt;/span>(statementHandler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> statementHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.statement.RoutingStatementHandler#RoutingStatementHandler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">RoutingStatementHandler&lt;/span>(Executor executor, MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (ms.&lt;span style="color:#a6e22e">getStatementType&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> STATEMENT:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delegate &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SimpleStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> PREPARED:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delegate &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> PreparedStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> CALLABLE:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delegate &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> CallableStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ExecutorException(&lt;span style="color:#e6db74">&amp;#34;Unknown statement type: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> ms.&lt;span style="color:#a6e22e">getStatementType&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.SimpleExecutor#prepareStatement&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> Statement &lt;span style="color:#a6e22e">prepareStatement&lt;/span>(StatementHandler handler, Log statementLog){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Statement stmt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// èŽ·å–ä»£ç†åŽ,å¢žåŠ æ—¥å¿—åŠŸèƒ½çš„Connectionå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Connection connection &lt;span style="color:#f92672">=&lt;/span> getConnection(statementLog);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºStatementå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stmt &lt;span style="color:#f92672">=&lt;/span> handler.&lt;span style="color:#a6e22e">prepare&lt;/span>(connection, transaction.&lt;span style="color:#a6e22e">getTimeout&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‚æ•°åŒ–å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler.&lt;span style="color:#a6e22e">parameterize&lt;/span>(stmt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> stmt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.statement.PreparedStatementHandler#query&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(Statement statement, ResultHandler resultHandler) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PreparedStatement ps &lt;span style="color:#f92672">=&lt;/span> (PreparedStatement) statement;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ps.&lt;span style="color:#a6e22e">execute&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> resultSetHandler.&lt;span style="color:#a6e22e">handleResultSets&lt;/span>(ps);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051430956.png" alt="image-20230816183741743">&lt;/p>
&lt;h2 id="è§£æžç»“æžœ">è§£æžç»“æžœ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.resultset.DefaultResultSetHandler#handleResultSets&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">handleResultSets&lt;/span>(Statement stmt) &lt;span style="color:#66d9ef">throws&lt;/span> SQLException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ErrorContext.&lt;span style="color:#a6e22e">instance&lt;/span>().&lt;span style="color:#a6e22e">activity&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;handling results&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">object&lt;/span>(mappedStatement.&lt;span style="color:#a6e22e">getId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> multipleResults &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> resultSetCount &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultSetWrapper rsw &lt;span style="color:#f92672">=&lt;/span> getFirstResultSet(stmt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>ResultMap&lt;span style="color:#f92672">&amp;gt;&lt;/span> resultMaps &lt;span style="color:#f92672">=&lt;/span> mappedStatement.&lt;span style="color:#a6e22e">getResultMaps&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> resultMapCount &lt;span style="color:#f92672">=&lt;/span> resultMaps.&lt;span style="color:#a6e22e">size&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> validateResultMapsCount(rsw, resultMapCount);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (rsw &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> resultMapCount &lt;span style="color:#f92672">&amp;gt;&lt;/span> resultSetCount) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultMap resultMap &lt;span style="color:#f92672">=&lt;/span> resultMaps.&lt;span style="color:#a6e22e">get&lt;/span>(resultSetCount);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handleResultSet(rsw, resultMap, multipleResults, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rsw &lt;span style="color:#f92672">=&lt;/span> getNextResultSet(stmt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cleanUpAfterHandlingResultSet();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resultSetCount&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String&lt;span style="color:#f92672">[]&lt;/span> resultSets &lt;span style="color:#f92672">=&lt;/span> mappedStatement.&lt;span style="color:#a6e22e">getResultSets&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (resultSets &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (rsw &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> resultSetCount &lt;span style="color:#f92672">&amp;lt;&lt;/span> resultSets.&lt;span style="color:#a6e22e">length&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultMapping parentMapping &lt;span style="color:#f92672">=&lt;/span> nextResultMaps.&lt;span style="color:#a6e22e">get&lt;/span>(resultSets&lt;span style="color:#f92672">[&lt;/span>resultSetCount&lt;span style="color:#f92672">]&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (parentMapping &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String nestedResultMapId &lt;span style="color:#f92672">=&lt;/span> parentMapping.&lt;span style="color:#a6e22e">getNestedResultMapId&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResultMap resultMap &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">getResultMap&lt;/span>(nestedResultMapId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handleResultSet(rsw, resultMap, &lt;span style="color:#66d9ef">null&lt;/span>, parentMapping);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rsw &lt;span style="color:#f92672">=&lt;/span> getNextResultSet(stmt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cleanUpAfterHandlingResultSet();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resultSetCount&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> collapseSingleResultList(multipleResults);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç¼“å­˜">ç¼“å­˜&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.CachingExecutor#createCacheKey&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// CacheKeyé‡æ–°äº† hacodeå’Œequalsæ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> CacheKey &lt;span style="color:#a6e22e">createCacheKey&lt;/span>(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// delegate æ˜¯å…·ä½“ç±»åž‹çš„æ‰§è¡Œå™¨çš„åº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é»˜è®¤æ˜¯SimpleExecutor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> delegate.&lt;span style="color:#a6e22e">createCacheKey&lt;/span>(ms, parameterObject, rowBounds, boundSql);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// org.apache.ibatis.executor.BaseExecutor#createCacheKey&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> CacheKey &lt;span style="color:#a6e22e">createCacheKey&lt;/span>(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (closed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ExecutorException(&lt;span style="color:#e6db74">&amp;#34;Executor was closed.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡æž„é€ å™¨åˆ›å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CacheKey cacheKey &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> CacheKey();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(ms.&lt;span style="color:#a6e22e">getId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ†é¡µå‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(rowBounds.&lt;span style="color:#a6e22e">getOffset&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(rowBounds.&lt;span style="color:#a6e22e">getLimit&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// sql&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(boundSql.&lt;span style="color:#a6e22e">getSql&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>ParameterMapping&lt;span style="color:#f92672">&amp;gt;&lt;/span> parameterMappings &lt;span style="color:#f92672">=&lt;/span> boundSql.&lt;span style="color:#a6e22e">getParameterMappings&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TypeHandlerRegistry typeHandlerRegistry &lt;span style="color:#f92672">=&lt;/span> ms.&lt;span style="color:#a6e22e">getConfiguration&lt;/span>().&lt;span style="color:#a6e22e">getTypeHandlerRegistry&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// mimic DefaultParameterHandler logic&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (ParameterMapping parameterMapping : parameterMappings) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (parameterMapping.&lt;span style="color:#a6e22e">getMode&lt;/span>() &lt;span style="color:#f92672">!=&lt;/span> ParameterMode.&lt;span style="color:#a6e22e">OUT&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String propertyName &lt;span style="color:#f92672">=&lt;/span> parameterMapping.&lt;span style="color:#a6e22e">getProperty&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (boundSql.&lt;span style="color:#a6e22e">hasAdditionalParameter&lt;/span>(propertyName)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> boundSql.&lt;span style="color:#a6e22e">getAdditionalParameter&lt;/span>(propertyName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (parameterObject &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (typeHandlerRegistry.&lt;span style="color:#a6e22e">hasTypeHandler&lt;/span>(parameterObject.&lt;span style="color:#a6e22e">getClass&lt;/span>())) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> parameterObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MetaObject metaObject &lt;span style="color:#f92672">=&lt;/span> configuration.&lt;span style="color:#a6e22e">newMetaObject&lt;/span>(parameterObject);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> metaObject.&lt;span style="color:#a6e22e">getValue&lt;/span>(propertyName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‚æ•°çš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (configuration.&lt;span style="color:#a6e22e">getEnvironment&lt;/span>() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// issue #176&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å½“å‰çŽ¯å¢ƒçš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cacheKey.&lt;span style="color:#a6e22e">update&lt;/span>(configuration.&lt;span style="color:#a6e22e">getEnvironment&lt;/span>().&lt;span style="color:#a6e22e">getId&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> cacheKey;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="é¢è¯•é¢˜">é¢è¯•é¢˜&lt;/h1></content></item><item><title>Mycat</title><link>https://connorzhangyu.com/posts/mycat/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/mycat/</guid><description>&lt;h1 id="ä¸»ä»Žå¤åˆ¶">ä¸»ä»Žå¤åˆ¶&lt;/h1>
&lt;h1 id="å¯åŠ¨">å¯åŠ¨&lt;/h1>
&lt;p>1 .ä¸‹è½½jreåŒ…&lt;/p>
&lt;p>2 ä¸‹è½½mycatåŒ…&lt;/p>
&lt;p>3 æ‰“åŒ…é•œåƒ&lt;/p>
&lt;p>Dockerfile&lt;/p>
&lt;pre tabindex="0">&lt;code>FROM centos
# è§£åŽ‹è¿™ä¸ªåŒ…åˆ°homeä¸‹é¢
ADD server-jre-8u251-linux-x64.tar.gz /home/
ADD ./Mycat-server-1.6.7.4-release-20200105164103-linux.tar.gz /home
ENV WORKPATH /home/mycat/
WORKDIR $WORKPATH
ENV JAVA_HOME /home/jdk1.8.0_251
ENV CLASSPATH $JAVA_HOME/dt.jar:$JAVA_HOME/lib/tools.jar
ENV PATH $PATH:$JAVA_HOME/BIN:$CATALINA_HOME/lib:$CATALINA_HOME/bin
# æš´éœ²8066ç«¯å£
EXPOSE 8066
CMD /home/mycat/bin/mycat console
&lt;/code>&lt;/pre>&lt;p>æŠŠmycaté‡Œçš„conf å’Œ logs ä»Žå®¹å™¨ä¸­æ‹·è´å‡ºæ¥&lt;/p>
&lt;p>å†æŒ‚åœ¨ä¸¤ä¸ªç›®å½•,å¹¶å¯åŠ¨&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run -it \
--name mycat \
-p 8066:8066 \
-v /home/anthony/mycat/conf:/home/mycat/conf/ \
-v /home/anthony/mycat/logs:/home/mycat/logs/ \
java1234/mycat:1.0
Running Mycat-server...
Removed stale pid file: /home/mycat/logs/mycat.pid
wrapper | --&amp;gt; Wrapper Started as Console
wrapper | Launching a JVM...
jvm 1 | Wrapper (Version 3.2.3) http://wrapper.tanukisoftware.org
jvm 1 | Copyright 1999-2006 Tanuki Software, Inc. All Rights Reserved.
jvm 1 |
jvm 1 | MyCAT Server startup successfully. see logs in logs/mycat.log
&lt;/code>&lt;/pre>&lt;h1 id="é…ç½®">é…ç½®&lt;/h1>
&lt;ul>
&lt;li>schems.xml å®šä¹‰é€»è¾‘åº“,è¡¨,åˆ†ç‰‡èŠ‚ç‚¹ç­‰å†…å®¹&lt;/li>
&lt;li>rule.xml å®šä¹‰åˆ†ç‰‡è§„åˆ™&lt;/li>
&lt;li>server.xml å®šä¹‰ç”¨æˆ·ä»¥åŠç³»ç»Ÿç›¸å…³å˜é‡&lt;/li>
&lt;/ul>
&lt;h1 id="å®‰è£…mysql57">å®‰è£…mysql5.7&lt;/h1>
&lt;pre tabindex="0">&lt;code># ä»Žå®¹å™¨ä¸­æ‹·è´è¿™äº›æ–‡ä»¶
docker cp xxx:/etc/mysql/mysql.conf.d/ /home/anthony/mysql
docker cp xxx:/var/log/ /home/anthony/mysql
&lt;/code>&lt;/pre>&lt;p>å¯åŠ¨çš„æ—¶å€™æ˜ å°„è¿™äº›&lt;/p></description><content>&lt;h1 id="ä¸»ä»Žå¤åˆ¶">ä¸»ä»Žå¤åˆ¶&lt;/h1>
&lt;h1 id="å¯åŠ¨">å¯åŠ¨&lt;/h1>
&lt;p>1 .ä¸‹è½½jreåŒ…&lt;/p>
&lt;p>2 ä¸‹è½½mycatåŒ…&lt;/p>
&lt;p>3 æ‰“åŒ…é•œåƒ&lt;/p>
&lt;p>Dockerfile&lt;/p>
&lt;pre tabindex="0">&lt;code>FROM centos
# è§£åŽ‹è¿™ä¸ªåŒ…åˆ°homeä¸‹é¢
ADD server-jre-8u251-linux-x64.tar.gz /home/
ADD ./Mycat-server-1.6.7.4-release-20200105164103-linux.tar.gz /home
ENV WORKPATH /home/mycat/
WORKDIR $WORKPATH
ENV JAVA_HOME /home/jdk1.8.0_251
ENV CLASSPATH $JAVA_HOME/dt.jar:$JAVA_HOME/lib/tools.jar
ENV PATH $PATH:$JAVA_HOME/BIN:$CATALINA_HOME/lib:$CATALINA_HOME/bin
# æš´éœ²8066ç«¯å£
EXPOSE 8066
CMD /home/mycat/bin/mycat console
&lt;/code>&lt;/pre>&lt;p>æŠŠmycaté‡Œçš„conf å’Œ logs ä»Žå®¹å™¨ä¸­æ‹·è´å‡ºæ¥&lt;/p>
&lt;p>å†æŒ‚åœ¨ä¸¤ä¸ªç›®å½•,å¹¶å¯åŠ¨&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run -it \
--name mycat \
-p 8066:8066 \
-v /home/anthony/mycat/conf:/home/mycat/conf/ \
-v /home/anthony/mycat/logs:/home/mycat/logs/ \
java1234/mycat:1.0
Running Mycat-server...
Removed stale pid file: /home/mycat/logs/mycat.pid
wrapper | --&amp;gt; Wrapper Started as Console
wrapper | Launching a JVM...
jvm 1 | Wrapper (Version 3.2.3) http://wrapper.tanukisoftware.org
jvm 1 | Copyright 1999-2006 Tanuki Software, Inc. All Rights Reserved.
jvm 1 |
jvm 1 | MyCAT Server startup successfully. see logs in logs/mycat.log
&lt;/code>&lt;/pre>&lt;h1 id="é…ç½®">é…ç½®&lt;/h1>
&lt;ul>
&lt;li>schems.xml å®šä¹‰é€»è¾‘åº“,è¡¨,åˆ†ç‰‡èŠ‚ç‚¹ç­‰å†…å®¹&lt;/li>
&lt;li>rule.xml å®šä¹‰åˆ†ç‰‡è§„åˆ™&lt;/li>
&lt;li>server.xml å®šä¹‰ç”¨æˆ·ä»¥åŠç³»ç»Ÿç›¸å…³å˜é‡&lt;/li>
&lt;/ul>
&lt;h1 id="å®‰è£…mysql57">å®‰è£…mysql5.7&lt;/h1>
&lt;pre tabindex="0">&lt;code># ä»Žå®¹å™¨ä¸­æ‹·è´è¿™äº›æ–‡ä»¶
docker cp xxx:/etc/mysql/mysql.conf.d/ /home/anthony/mysql
docker cp xxx:/var/log/ /home/anthony/mysql
&lt;/code>&lt;/pre>&lt;p>å¯åŠ¨çš„æ—¶å€™æ˜ å°„è¿™äº›&lt;/p>
&lt;h1 id="åˆ›å»ºç½‘ç»œ">åˆ›å»ºç½‘ç»œ&lt;/h1>
&lt;pre tabindex="0">&lt;code># å¯ä»¥æŸ¥çœ‹å®¹å™¨çš„è™šæ‹Ÿip
docker inspect ac7
# æŸ¥çœ‹ç½‘ç»œ
docker network ls
# è‡ªå®šä¹‰ä¸€ä¸ªç½‘ç»œæ¨¡å¼
# extnetwork æ˜¯ç½‘ç»œæ¨¡å¼çš„åå­—
# 172.20.0.1 æ˜¯ç½‘å…³
docker network create --subnet=172.20.0.0/16 extnetwork
&lt;/code>&lt;/pre>&lt;h1 id="mysqlmycatæŒ‡å®šç½‘è·¯é‡å»ºå®¹å™¨">mysql,mycatæŒ‡å®šç½‘è·¯,é‡å»ºå®¹å™¨&lt;/h1>
&lt;pre tabindex="0">&lt;code># æŒ‡å®šç½‘ç»œæ¨¡å¼å’Œipåœ°å€
--net extnetwork --ip 172.20.0.2
docker run -itd \
--name mysql-master \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=123456 \
-v /home/anthony/mysql/mysql.conf.d/:/etc/mysql/conf.d/ \
-v /home/anthony/mysql/log/:/var/log/ \
--net extnetwork --ip 172.20.0.2 \
mysql:5.7
docker run -itd \
--name mysql-slave \
-p 3307:3306 \
-e MYSQL_ROOT_PASSWORD=123456 \
-v /home/anthony/mysql2/mysql.conf.d/:/etc/mysql/conf.d/ \
-v /home/anthony/mysql2/log/:/var/log/ \
--net extnetwork --ip 172.20.0.3 \
mysql:5.7
docker run -it \
--name mycat \
-p 8066:8066 \
-v /home/anthony/mycat/conf:/home/mycat/conf/ \
-v /home/anthony/mycat/logs:/home/mycat/logs/ \
--net extnetwork --ip 172.20.0.4 \
java1234/mycat:1.0
&lt;/code>&lt;/pre>&lt;h1 id="ä¸»ä»Žé…ç½®">ä¸»ä»Žé…ç½®&lt;/h1>
&lt;p>ä¸»,åœ¨[mysqld]&lt;/p>
&lt;pre tabindex="0">&lt;code># ä¸»æœåŠ¡å™¨ID,å¿…é¡»å”¯ä¸€
server-id=2
# å¼€å¯å’Œè®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åç§°
log_bin=mysql-bin
# è¦åŒæ­¥çš„æ•°æ®åº“
binlog-do-db=db_java1234
# ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“
binlog-ignore_db=mysql
binlog-ignore_db=information_schema
binlog-ignore_db=performation_schema
binlog_ignore_db=sys
# è®¾ç½®logbinæ ¼å¼,mysqlé»˜è®¤é‡‡ç”¨statement,å»ºè®®ä½¿ç”¨mixed
binlog_format=MIXED
&lt;/code>&lt;/pre>&lt;p>ä»Ž,åœ¨[mysqld]&lt;/p>
&lt;pre tabindex="0">&lt;code># ä¸»æœåŠ¡å™¨ID,å¿…é¡»å”¯ä¸€
server-id=3
# è¿™è¡Œæ˜¯ä»Žåº“éœ€è¦æ·»åŠ çš„
relay-log=mysql-relay
# å¼€å¯å’Œè®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åç§°
log_bin=mysql-bin
# è¦åŒæ­¥çš„æ•°æ®åº“
binlog-do-db=db_java1234
# ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“
binlog-ignore_db=mysql
binlog-ignore_db=information_schema
binlog-ignore_db=performation_schema
binlog_ignore_db=sys
# è®¾ç½®logbinæ ¼å¼,mysqlé»˜è®¤é‡‡ç”¨statement,å»ºè®®ä½¿ç”¨mixed
binlog_format=MIXED
&lt;/code>&lt;/pre>&lt;h1 id="æµ‹è¯•">æµ‹è¯•&lt;/h1>
&lt;p>ä¸»ä»Žè¿˜æ²¡æœ‰ç”Ÿæ•ˆ&lt;/p>
&lt;pre tabindex="0">&lt;code>mysql&amp;gt; show master status;
+------------------+----------+--------------+--------------------------------------------------+-------------------+
| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+--------------------------------------------------+-------------------+
| mysql-bin.000003 | 357 | db_java1234 | mysql,information_schema,performation_schema,sys | |
+------------------+----------+--------------+--------------------------------------------------+-------------------+
1 row in set (0.01 sec)
mysql&amp;gt; show slave status;
Empty set
&lt;/code>&lt;/pre>&lt;h1 id="è®¾ç½®ç”¨æˆ·å">è®¾ç½®ç”¨æˆ·å&lt;/h1>
&lt;p>åœ¨masteræ‰§è¡Œ&lt;/p>
&lt;pre tabindex="0">&lt;code># åˆ›å»ºç”¨æˆ·åä¸ºslave1
# 172.20.0.3ä»Žåº“ip
# 123456 å¯†ç 
CREATE USER &amp;#39;slave1&amp;#39;@&amp;#39;172.20.0.3&amp;#39; IDENTIFIED BY &amp;#39;123456&amp;#39;;
# è¯­æ³•:GRANT privileges ON databasename.tablename TO &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39;
# 172.20.0.3 ä»Žåº“
# ä¸¤ä¸ªæƒé™:REPLICATIONå’ŒSLAVE
# *.* æ‰€æœ‰çš„åº“å’Œè¡¨
GRANT REPLICATION SLAVE ON *.* TO &amp;#39;slave1&amp;#39;@&amp;#39;172.20.0.3&amp;#39;;
# åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
&lt;/code>&lt;/pre>&lt;p>åœ¨slaveæ‰§è¡Œ&lt;/p>
&lt;pre tabindex="0">&lt;code>CHANGE MASTER TO MASTER_HOST=&amp;#39;172.20.0.2&amp;#39;,MASTER_USER=&amp;#39;slave1&amp;#39;,MASTER_PASSWORD=&amp;#39;123456&amp;#39;,MASTER_LOG_FILE=&amp;#39;mysql-bin.000003&amp;#39;,MASTER_LOG_POS=964;
# å¼€å¯ä¸»ä»Ž
start slave;
&lt;/code>&lt;/pre>&lt;p>åœ¨ä»Žåº“æ‰§è¡Œ&lt;/p>
&lt;pre tabindex="0">&lt;code>show slave status;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://image.runtimes.cc/202404051430859.png" alt="">&lt;/p>
&lt;p>ä¸»è¦çœ‹Slave_io_running =yes&lt;/p>
&lt;p>ä¸»è¦çœ‹Slave_sql_running =yes&lt;/p>
&lt;h1 id="è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»&lt;/h1>
&lt;h1 id="schemlxml">scheml.xml&lt;/h1>
&lt;h3 id="schemaæ ‡ç­¾">schemaæ ‡ç­¾&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;schema name=&amp;#34;TESTDB&amp;#34; checkSQLschema=&amp;#34;true&amp;#34; sqlMaxLimit=&amp;#34;100&amp;#34; randomDataNode=&amp;#34;dn1&amp;#34;&amp;gt;
&amp;lt;!-- auto sharding by id (long) --&amp;gt;
&amp;lt;!--splitTableNames å¯ç”¨&amp;lt;table name å±žæ€§ä½¿ç”¨é€—å·åˆ†å‰²é…ç½®å¤šä¸ªè¡¨,å³å¤šä¸ªè¡¨ä½¿ç”¨è¿™ä¸ªé…ç½®--&amp;gt;
&amp;lt;table name=&amp;#34;travelrecord,address&amp;#34; dataNode=&amp;#34;dn1,dn2,dn3&amp;#34; rule=&amp;#34;auto-sharding-long&amp;#34; splitTableNames =&amp;#34;true&amp;#34;/&amp;gt;
&amp;lt;!-- &amp;lt;table name=&amp;#34;oc_call&amp;#34; primaryKey=&amp;#34;ID&amp;#34; dataNode=&amp;#34;dn1$0-743&amp;#34; rule=&amp;#34;latest-month-calldate&amp;#34;
/&amp;gt; --&amp;gt;
&amp;lt;/schema&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>name: é…ç½®é€»è¾‘åº“çš„åç§°&lt;/li>
&lt;li>checkSQLschema: å½“æ‰§è¡Œ&lt;code>select * from T_Account.user&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸ºtrueæ—¶,mycatä¼šæŠŠsqlè½¬æˆ&lt;code>select * from user&lt;/code>&lt;/p>
&lt;p>false ä¼šæŠ¥é”™&lt;/p>
&lt;ul>
&lt;li>sqlMaxLimit:æœ€å¤§æŸ¥è¯¢æ¯é¡µæ¡æ•°,å¦‚æžœsqlæŒ‡å®šäº†limit,å°±ä»¥sqlä¸ºå‡†,æ²¡æœ‰,å°±ä»¥é…ç½®ä¸ºå‡†&lt;/li>
&lt;li>randomDataNode:è¿™ä¸ªå…ˆä¸ç”¨,å…ˆæ”¹æˆ&lt;code>datanote='dn1'&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="datanoteæ ‡ç­¾">datanoteæ ‡ç­¾&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;dataNode name=&amp;#34;dn1&amp;#34; dataHost=&amp;#34;localhost1&amp;#34; database=&amp;#34;db1&amp;#34; /&amp;gt;
&amp;lt;dataNode name=&amp;#34;dn2&amp;#34; dataHost=&amp;#34;localhost1&amp;#34; database=&amp;#34;db2&amp;#34; /&amp;gt;
&amp;lt;dataNode name=&amp;#34;dn3&amp;#34; dataHost=&amp;#34;localhost1&amp;#34; database=&amp;#34;db3&amp;#34; /&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>name:æ•°æ®åˆ†ç‰‡èŠ‚ç‚¹åç§°&lt;/li>
&lt;li>dataHost:å®šä¹‰è¯¥æ•°æ®åˆ†ç‰‡èŠ‚ç‚¹å±žäºŽå“ªå°æ•°æ®åº“ä¸»æœº&lt;/li>
&lt;li>database:æŒ‡å®šå“ªä¸ªæ•°æ®åº“,db_java1234&lt;/li>
&lt;/ul>
&lt;h3 id="datahostæ ‡ç­¾">datahostæ ‡ç­¾&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;dataHost name=&amp;#34;localhost1&amp;#34; maxCon=&amp;#34;1000&amp;#34; minCon=&amp;#34;10&amp;#34; balance=&amp;#34;3&amp;#34;
writeType=&amp;#34;0&amp;#34; dbType=&amp;#34;mysql&amp;#34; dbDriver=&amp;#34;native&amp;#34; switchType=&amp;#34;1&amp;#34; slaveThreshold=&amp;#34;100&amp;#34;&amp;gt;
&amp;lt;heartbeat&amp;gt;select user()&amp;lt;/heartbeat&amp;gt;
&amp;lt;!-- can have multi write hosts --&amp;gt;
&amp;lt;writeHost host=&amp;#34;hostM1&amp;#34; url=&amp;#34;localhost:3306&amp;#34; user=&amp;#34;root&amp;#34;
password=&amp;#34;123456&amp;#34;&amp;gt;
&amp;lt;/writeHost&amp;gt;
&amp;lt;!-- &amp;lt;writeHost host=&amp;#34;hostM2&amp;#34; url=&amp;#34;localhost:3316&amp;#34; user=&amp;#34;root&amp;#34; password=&amp;#34;123456&amp;#34;/&amp;gt; --&amp;gt;
&amp;lt;/dataHost&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>name:è·Ÿdatanoteæ ‡ç­¾çš„datahostå¯¹åº”&lt;/li>
&lt;li>maxCon æŒ‡å®šæ¯ä¸ªè¯»å†™å®žä¾‹è¿žæŽ¥æ± çš„çš„æœ€å¤§é“¾æŽ¥,writeåˆreadhostæ ‡ç­¾éƒ½ä¼šä½¿ç”¨è¿™ä¸ªå±žæ€§çš„å€¼æ¥å®žä¾‹åŒ–å‡ºè¿žæŽ¥æ± çš„æœ€å¤§è¿žæŽ¥æ•°&lt;/li>
&lt;li>min æœ€å°çš„è¿žæŽ¥&lt;/li>
&lt;li>balance:&lt;/li>
&lt;li>0 ä¸å¼€å¯è¯»å†™åˆ†ç¦»,æ‰€æœ‰è¯»æ“ä½œéƒ½å‘é€åˆ°å½“å‰å¯ç”¨çš„writehostä¸Š&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2 æ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºåœ¨writehoståˆreadehostä¸Šåˆ†å‘&lt;/li>
&lt;li>3 æ‰€æœ‰è¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°writehoståˆreadhos&lt;/li>
&lt;/ul>
&lt;h1 id="åŒç»„åŒä»Ž">åŒç»„åŒä»Ž&lt;/h1>
&lt;h1 id="ç¬¬äºŒå¥—ä¸»ä»Ž">ç¬¬äºŒå¥—ä¸»ä»Ž&lt;/h1>
&lt;p>1.åœ¨mysqlæ·»åŠ ä¸­æ·»åŠ &lt;/p>
&lt;pre tabindex="0">&lt;code>log-slave-update=1
auto-increment-increment=2
auto-increment-offset=1
&lt;/code>&lt;/pre>&lt;p>2.æŠŠmysqlæ–‡ä»¶å¤åˆ¶ä¸€ä»½mysql3&lt;/p>
&lt;p>3.æŠŠmysql3çš„é…ç½®æ–‡ä»¶ä¿®ä¿®æ”¹è¿™äº›é…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code># ä¸»æœåŠ¡å™¨ID,å¿…é¡»å”¯ä¸€
server-id=5
auto-increment-offset=2
&lt;/code>&lt;/pre>&lt;p>4.å†åˆ›å»ºä¸¤ä¸ªå®¹å™¨,m2 å’Œ s2&lt;/p>
&lt;h1 id="master-å’Œ-masteråŒæ­¥">master å’Œ masteråŒæ­¥&lt;/h1>
&lt;p>å°±æ˜¯ç›¸äº’slave&lt;/p>
&lt;h1 id="æµ‹è¯•è¯»å†™åˆ†ç¦»">æµ‹è¯•è¯»å†™åˆ†ç¦»&lt;/h1>
&lt;p>æ’å…¥è¯­å¥&lt;/p>
&lt;pre tabindex="0">&lt;code>insert into test valus(@@hostname)
&lt;/code>&lt;/pre></content></item><item><title>Spring Security</title><link>https://connorzhangyu.com/posts/spring-security/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/spring-security/</guid><description>&lt;h1 id="spring-security">Spring Security&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&amp;lt;dependency&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;artifactId&amp;gt;spring-boot-starter-security&amp;lt;/artifactId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/dependency&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç™»å½•ä¸šåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LoginService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, RedisUser&lt;span style="color:#f92672">&amp;gt;&lt;/span> map &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AuthenticationManager authenticationManager;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">login&lt;/span>(SysUser sysUser) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// AuthenticationManager è¿›è¡Œç”¨æˆ·è®¤è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> UsernamePasswordAuthenticationToken(sysUser.&lt;span style="color:#a6e22e">getUsername&lt;/span>(), sysUser.&lt;span style="color:#a6e22e">getPassword&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Authentication authenticate &lt;span style="color:#f92672">=&lt;/span> authenticationManager.&lt;span style="color:#a6e22e">authenticate&lt;/span>(usernamePasswordAuthenticationToken);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœè®¤è¯ä¸é€šè¿‡,ç»™å‡ºå¯¹åº”çš„æç¤º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (Objects.&lt;span style="color:#a6e22e">isNull&lt;/span>(authenticate)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(&lt;span style="color:#e6db74">&amp;#34;ç™»å½•å¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœè®¤è¯é€šè¿‡,ä½¿ç”¨usernameç»™jwtç”Ÿæˆä¸€ä¸ª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RedisUser principal &lt;span style="color:#f92672">=&lt;/span> (RedisUser) authenticate.&lt;span style="color:#a6e22e">getPrincipal&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> map.&lt;span style="color:#a6e22e">put&lt;/span>(principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>(), principal);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> createJWT(&lt;span style="color:#e6db74">&amp;#34;1234567&amp;#34;&lt;/span>, 9990000, principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">logout&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UsernamePasswordAuthenticationToken authentication &lt;span style="color:#f92672">=&lt;/span> (UsernamePasswordAuthenticationToken) SecurityContextHolder.&lt;span style="color:#a6e22e">getContext&lt;/span>().&lt;span style="color:#a6e22e">getAuthentication&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RedisUser principal &lt;span style="color:#f92672">=&lt;/span> (RedisUser) authentication.&lt;span style="color:#a6e22e">getPrincipal&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String username &lt;span style="color:#f92672">=&lt;/span> principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žredisé‡Œåˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> map.&lt;span style="color:#a6e22e">remove&lt;/span>(username);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RequestMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LoginController&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LoginService loginService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/user/login&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>HashMap&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">login&lt;/span>(&lt;span style="color:#a6e22e">@RequestParam&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;username&amp;#34;&lt;/span>) String username,&lt;span style="color:#a6e22e">@RequestParam&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;password&amp;#34;&lt;/span>) String password){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SysUser sysUser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SysUser();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setUsername&lt;/span>(username);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setPassword&lt;/span>(password);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> stringObjectHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringObjectHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;token&amp;#34;&lt;/span>, loginService.&lt;span style="color:#a6e22e">login&lt;/span>(sysUser));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">status&lt;/span>(200).&lt;span style="color:#a6e22e">body&lt;/span>(stringObjectHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/user/logout&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">logout&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> loginService.&lt;span style="color:#a6e22e">logout&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;success&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éªŒè¯è´¦æˆ·&lt;/p></description><content>&lt;h1 id="spring-security">Spring Security&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&amp;lt;dependency&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;artifactId&amp;gt;spring-boot-starter-security&amp;lt;/artifactId&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/dependency&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç™»å½•ä¸šåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LoginService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> Map&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, RedisUser&lt;span style="color:#f92672">&amp;gt;&lt;/span> map &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AuthenticationManager authenticationManager;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">login&lt;/span>(SysUser sysUser) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// AuthenticationManager è¿›è¡Œç”¨æˆ·è®¤è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> UsernamePasswordAuthenticationToken(sysUser.&lt;span style="color:#a6e22e">getUsername&lt;/span>(), sysUser.&lt;span style="color:#a6e22e">getPassword&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Authentication authenticate &lt;span style="color:#f92672">=&lt;/span> authenticationManager.&lt;span style="color:#a6e22e">authenticate&lt;/span>(usernamePasswordAuthenticationToken);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœè®¤è¯ä¸é€šè¿‡,ç»™å‡ºå¯¹åº”çš„æç¤º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (Objects.&lt;span style="color:#a6e22e">isNull&lt;/span>(authenticate)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(&lt;span style="color:#e6db74">&amp;#34;ç™»å½•å¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æžœè®¤è¯é€šè¿‡,ä½¿ç”¨usernameç»™jwtç”Ÿæˆä¸€ä¸ª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RedisUser principal &lt;span style="color:#f92672">=&lt;/span> (RedisUser) authenticate.&lt;span style="color:#a6e22e">getPrincipal&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> map.&lt;span style="color:#a6e22e">put&lt;/span>(principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>(), principal);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> createJWT(&lt;span style="color:#e6db74">&amp;#34;1234567&amp;#34;&lt;/span>, 9990000, principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">logout&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UsernamePasswordAuthenticationToken authentication &lt;span style="color:#f92672">=&lt;/span> (UsernamePasswordAuthenticationToken) SecurityContextHolder.&lt;span style="color:#a6e22e">getContext&lt;/span>().&lt;span style="color:#a6e22e">getAuthentication&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RedisUser principal &lt;span style="color:#f92672">=&lt;/span> (RedisUser) authentication.&lt;span style="color:#a6e22e">getPrincipal&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String username &lt;span style="color:#f92672">=&lt;/span> principal.&lt;span style="color:#a6e22e">getUsername&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žredisé‡Œåˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> map.&lt;span style="color:#a6e22e">remove&lt;/span>(username);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RequestMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LoginController&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LoginService loginService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/user/login&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>HashMap&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">login&lt;/span>(&lt;span style="color:#a6e22e">@RequestParam&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;username&amp;#34;&lt;/span>) String username,&lt;span style="color:#a6e22e">@RequestParam&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;password&amp;#34;&lt;/span>) String password){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SysUser sysUser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SysUser();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setUsername&lt;/span>(username);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setPassword&lt;/span>(password);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, Object&lt;span style="color:#f92672">&amp;gt;&lt;/span> stringObjectHashMap &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> HashMap&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stringObjectHashMap.&lt;span style="color:#a6e22e">put&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;token&amp;#34;&lt;/span>, loginService.&lt;span style="color:#a6e22e">login&lt;/span>(sysUser));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">status&lt;/span>(200).&lt;span style="color:#a6e22e">body&lt;/span>(stringObjectHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PostMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/user/logout&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">logout&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> loginService.&lt;span style="color:#a6e22e">logout&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;success&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éªŒè¯è´¦æˆ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.example.spirngsecutirylearn.pojo.RedisUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.example.spirngsecutirylearn.pojo.SysUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.userdetails.UserDetails;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.userdetails.UserDetailsService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.userdetails.UsernameNotFoundException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.stereotype.Service;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.util.ArrayList;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestService&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> UserDetailsService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> String user &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> String password &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;$2a$10$yyR9WuT9JY/bpe1VPU0yguqlv0lWpgzTD9NEetf2.n8y7NXIa1rfm&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * DaoAuthenticationProvier ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æŸ¥è¯¢ç”¨æˆ·,å¹¶ä¸”è¿”å›žUserDetailså¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param username
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @throws UsernameNotFoundException
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> UserDetails &lt;span style="color:#a6e22e">loadUserByUsername&lt;/span>(String username) &lt;span style="color:#66d9ef">throws&lt;/span> UsernameNotFoundException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»Žæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SysUser sysUser &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> SysUser();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (username.&lt;span style="color:#a6e22e">equals&lt;/span>(user)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setUsername&lt;/span>(user);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sysUser.&lt;span style="color:#a6e22e">setPassword&lt;/span>(password);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰æŸ¥åˆ°ç”¨æˆ·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RuntimeException(&lt;span style="color:#e6db74">&amp;#34;æ²¡æœ‰æŸ¥åˆ°ç”¨æˆ·ä¿¡æ¯&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ArrayList&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> strings &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ArrayList&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// strings.add(&amp;#34;test&amp;#34;);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> strings.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;admin&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›žå°è£…çš„ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RedisUser(sysUser,strings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼“å­˜çš„ç”¨æˆ·å¯¹è±¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.example.spirngsecutirylearn.pojo;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> lombok.AllArgsConstructor;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> lombok.Data;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.GrantedAuthority;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.authority.SimpleGrantedAuthority;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.userdetails.UserDetails;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.util.Collection;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.util.List;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.util.stream.Collectors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RedisUser&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> UserDetails {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SysUser sysUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">RedisUser&lt;/span>(SysUser sysUser, List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> list) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">sysUser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> sysUser;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">list&lt;/span> &lt;span style="color:#f92672">=&lt;/span> list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Collection&lt;span style="color:#f92672">&amp;lt;?&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> GrantedAuthority&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">getAuthorities&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> list.&lt;span style="color:#a6e22e">stream&lt;/span>().&lt;span style="color:#a6e22e">map&lt;/span>(SimpleGrantedAuthority::&lt;span style="color:#66d9ef">new&lt;/span>).&lt;span style="color:#a6e22e">collect&lt;/span>(Collectors.&lt;span style="color:#a6e22e">toList&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">getPassword&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sysUser.&lt;span style="color:#a6e22e">getPassword&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> String &lt;span style="color:#a6e22e">getUsername&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sysUser.&lt;span style="color:#a6e22e">getUsername&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isAccountNonExpired&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isAccountNonLocked&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isCredentialsNonExpired&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isEnabled&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è®¤è¯å¤±è´¥çš„å›žè°ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.example.spirngsecutirylearn.handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> cn.hutool.json.JSONUtil;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.http.ResponseEntity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.AuthenticationException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.web.AuthenticationEntryPoint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.stereotype.Component;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AuthException&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> AuthenticationEntryPoint {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">commence&lt;/span>(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) &lt;span style="color:#66d9ef">throws&lt;/span> IOException, ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> responseEntity &lt;span style="color:#f92672">=&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>().&lt;span style="color:#a6e22e">body&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;è®¤è¯å¤±è´¥,è¯·é‡æ–°ç™»å½•&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String str &lt;span style="color:#f92672">=&lt;/span> JSONUtil.&lt;span style="color:#a6e22e">toJsonStr&lt;/span>(responseEntity);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/// å¤„ç†å¼‚å¸¸&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extracted(response,str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">extracted&lt;/span>(HttpServletResponse response,String string) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setStatus&lt;/span>(200);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;application/json&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setCharacterEncoding&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;utf-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>().&lt;span style="color:#a6e22e">println&lt;/span>(string);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŽˆæƒå¤±è´¥çš„å›žè°ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.example.spirngsecutirylearn.handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> cn.hutool.json.JSONUtil;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.http.ResponseEntity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.access.AccessDeniedException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.core.AuthenticationException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.web.AuthenticationEntryPoint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.web.access.AccessDeniedHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.stereotype.Component;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.ServletException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.http.HttpServletRequest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.servlet.http.HttpServletResponse;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AccessException&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> AccessDeniedHandler {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">handle&lt;/span>(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) &lt;span style="color:#66d9ef">throws&lt;/span> IOException, ServletException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> responseEntity &lt;span style="color:#f92672">=&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>().&lt;span style="color:#a6e22e">body&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æƒé™ä¸ç§Ÿ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String str &lt;span style="color:#f92672">=&lt;/span> JSONUtil.&lt;span style="color:#a6e22e">toJsonStr&lt;/span>(responseEntity);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/// å¤„ç†å¼‚å¸¸&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extracted(response,str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">extracted&lt;/span>(HttpServletResponse response,String string) &lt;span style="color:#66d9ef">throws&lt;/span> IOException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setStatus&lt;/span>(200);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setContentType&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;application/json&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">setCharacterEncoding&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;utf-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response.&lt;span style="color:#a6e22e">getWriter&lt;/span>().&lt;span style="color:#a6e22e">println&lt;/span>(string);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å¯æ³¨è§£æƒé™æŽ§åˆ¶å’Œè‡ªå®šä¹‰æ³¨è§£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@RequestMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/test&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestController&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@GetMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/hello&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PreAuthorize&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;hasAnyAuthority(&amp;#39;test&amp;#39;)&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">hello&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;hello server&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * è‡ªå®šä¹‰æ ¡éªŒæƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@GetMapping&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/hello2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@PreAuthorize&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;@anthony.hasAnyAuthority(&amp;#39;test&amp;#39;)&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> ResponseEntity&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">hello2&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ResponseEntity.&lt;span style="color:#a6e22e">ok&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;hello server2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> com.example.spirngsecutirylearn.cofig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.example.spirngsecutirylearn.filter.JwtFilter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.example.spirngsecutirylearn.handler.AccessException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> com.example.spirngsecutirylearn.handler.AuthException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.annotation.Bean;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.context.annotation.Configuration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.http.HttpMethod;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.authentication.AuthenticationManager;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.config.annotation.authentication.configuration.EnableGlobalAuthentication;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.config.http.SessionCreationPolicy;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.crypto.password.PasswordEncoder;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> org.springframework.security.web.authentication.logout.LogoutFilter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> javax.annotation.Resource;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@EnableGlobalMethodSecurity&lt;/span>(prePostEnabled &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SecurityConfig&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> WebSecurityConfigurerAdapter {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JwtFilter jwtFilter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AuthException authException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AccessException accessException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> AuthenticationManager &lt;span style="color:#a6e22e">authenticationManagerBean&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">super&lt;/span>.&lt;span style="color:#a6e22e">authenticationManagerBean&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">configure&lt;/span>(HttpSecurity httpSecurity) &lt;span style="color:#66d9ef">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> httpSecurity
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// CSRFç¦ç”¨ï¼Œå› ä¸ºä¸ä½¿ç”¨session&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">csrf&lt;/span>().&lt;span style="color:#a6e22e">disable&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŸºäºŽtokenï¼Œæ‰€ä»¥ä¸éœ€è¦session&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">sessionManagement&lt;/span>().&lt;span style="color:#a6e22e">sessionCreationPolicy&lt;/span>(SessionCreationPolicy.&lt;span style="color:#a6e22e">STATELESS&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">and&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿‡æ»¤è¯·æ±‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">authorizeRequests&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯¹äºŽç™»å½•login æ³¨å†Œregister éªŒè¯ç captchaImage å…è®¸åŒ¿åè®¿é—®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">antMatchers&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/user/login&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">anonymous&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é™æ€èµ„æºï¼ŒpermitAll æœ‰æ²¡æœ‰ç™»å½•éƒ½è®¿é—®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// .antMatchers(HttpMethod.GET, &amp;#34;/&amp;#34;, &amp;#34;/*.html&amp;#34;, &amp;#34;/**/*.html&amp;#34;, &amp;#34;/**/*.css&amp;#34;, &amp;#34;/**/*.js&amp;#34;, &amp;#34;/profile/**&amp;#34;).permitAll()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// .antMatchers(&amp;#34;/swagger-ui.html&amp;#34;, &amp;#34;/swagger-resources/**&amp;#34;, &amp;#34;/webjars/**&amp;#34;, &amp;#34;/*/api-docs&amp;#34;, &amp;#34;/druid/**&amp;#34;).permitAll()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">anyRequest&lt;/span>().&lt;span style="color:#a6e22e">authenticated&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// .and()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// .headers().frameOptions().disable();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ·»åŠ Logout filter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// httpSecurity.logout().logoutUrl(&amp;#34;/logout&amp;#34;).logoutSuccessHandler(logoutSuccessHandler);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// // æ·»åŠ JWT filter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> httpSecurity.&lt;span style="color:#a6e22e">addFilterBefore&lt;/span>(jwtFilter, UsernamePasswordAuthenticationFilter.&lt;span style="color:#a6e22e">class&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// // æ·»åŠ CORS filter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// httpSecurity.addFilterBefore(corsFilter, JwtAuthenticationTokenFilter.class);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// httpSecurity.addFilterBefore(corsFilter, LogoutFilter.class);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ·»åŠ è‡ªå®šä¹‰çš„è®¤è¯å’ŒæŽˆæƒçš„è‡ªå®šä¹‰å¤±è´¥å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> httpSecurity.&lt;span style="color:#a6e22e">exceptionHandling&lt;/span>().&lt;span style="color:#a6e22e">authenticationEntryPoint&lt;/span>(authException).&lt;span style="color:#a6e22e">accessDeniedHandler&lt;/span>(accessException);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> httpSecurity.&lt;span style="color:#a6e22e">cors&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * å¯†ç åŠ å¯†çš„è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> PasswordEncoder &lt;span style="color:#a6e22e">passwordEncoder&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BCryptPasswordEncoder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * BCryptPasswordEncoder çš„æµ‹è¯•æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param args
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BCryptPasswordEncoder bCryptPasswordEncoder &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> BCryptPasswordEncoder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŠ å¯†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String encode &lt;span style="color:#f92672">=&lt;/span> bCryptPasswordEncoder.&lt;span style="color:#a6e22e">encode&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;123456&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(encode);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è§£å¯†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> matches &lt;span style="color:#f92672">=&lt;/span> bCryptPasswordEncoder.&lt;span style="color:#a6e22e">matches&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;123456&amp;#34;&lt;/span>, encode);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(matches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è‡ªå®šä¹‰æ³¨è§£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Component&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestExpress&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">hasAnyAuthority&lt;/span>(String authority){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Authentication authentication &lt;span style="color:#f92672">=&lt;/span> SecurityContextHolder.&lt;span style="color:#a6e22e">getContext&lt;/span>().&lt;span style="color:#a6e22e">getAuthentication&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RedisUser principal &lt;span style="color:#f92672">=&lt;/span> (RedisUser) authentication.&lt;span style="color:#a6e22e">getPrincipal&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// List&amp;lt;String&amp;gt; list = (List&amp;lt;String&amp;gt;)principal.getAuthorities();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>SimpleGrantedAuthority&lt;span style="color:#f92672">&amp;gt;&lt;/span> authorities &lt;span style="color:#f92672">=&lt;/span> (List&lt;span style="color:#f92672">&amp;lt;&lt;/span>SimpleGrantedAuthority&lt;span style="color:#f92672">&amp;gt;&lt;/span>) principal.&lt;span style="color:#a6e22e">getAuthorities&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (SimpleGrantedAuthority simpleGrantedAuthority : authorities) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (simpleGrantedAuthority.&lt;span style="color:#a6e22e">getAuthority&lt;/span>().&lt;span style="color:#a6e22e">equals&lt;/span>(authority)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰¾JavaåŒ…çš„è·¯å¾„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># mac&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/libexec/java_home -V
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>è®¾è®¡æ¨¡å¼</title><link>https://connorzhangyu.com/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</guid><description>&lt;h1 id="åˆ›å»ºåž‹æ¨¡å¼">åˆ›å»ºåž‹æ¨¡å¼&lt;/h1>
&lt;h2 id="ç®€å•å·¥åŽ‚">ç®€å•å·¥åŽ‚&lt;/h2>
&lt;p>Pay.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Pay&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>SimpleFactory.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SimpleFactory&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> Pay &lt;span style="color:#a6e22e">create&lt;/span>(String payType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (payType.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ZFB&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ZFBPay();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (payType.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;WX&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> WXPay();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>WXPay.java&lt;/p>
&lt;p>å¾®ä¿¡æ”¯ä»˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">WXPay&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Pay {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¾®ä¿¡æ”¯ä»˜:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>money&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å…ƒ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ZFBPay.java&lt;/p>
&lt;p>æ”¯ä»˜å®æ”¯ä»˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ZFBPay&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Pay {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ”¯ä»˜å®æ”¯ä»˜:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>money&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å…ƒ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Test.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç®€å•å·¥åŽ‚è®¾è®¡æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Test&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Pay wx &lt;span style="color:#f92672">=&lt;/span> SimpleFactory.&lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;WX&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wx.&lt;span style="color:#a6e22e">pay&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Pay zfb &lt;span style="color:#f92672">=&lt;/span> SimpleFactory.&lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ZFB&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> zfb.&lt;span style="color:#a6e22e">pay&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="è¡Œä¸ºæ¨¡å¼">è¡Œä¸ºæ¨¡å¼&lt;/h1>
&lt;h2 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼&lt;/h2>
&lt;p>&lt;strong>åŸºç¡€&lt;/strong>&lt;/p></description><content>&lt;h1 id="åˆ›å»ºåž‹æ¨¡å¼">åˆ›å»ºåž‹æ¨¡å¼&lt;/h1>
&lt;h2 id="ç®€å•å·¥åŽ‚">ç®€å•å·¥åŽ‚&lt;/h2>
&lt;p>Pay.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Pay&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>SimpleFactory.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SimpleFactory&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> Pay &lt;span style="color:#a6e22e">create&lt;/span>(String payType) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (payType.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ZFB&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ZFBPay();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (payType.&lt;span style="color:#a6e22e">equals&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;WX&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> WXPay();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>WXPay.java&lt;/p>
&lt;p>å¾®ä¿¡æ”¯ä»˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">WXPay&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Pay {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;å¾®ä¿¡æ”¯ä»˜:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>money&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å…ƒ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ZFBPay.java&lt;/p>
&lt;p>æ”¯ä»˜å®æ”¯ä»˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ZFBPay&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Pay {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pay&lt;/span>(Integer money) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ”¯ä»˜å®æ”¯ä»˜:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>money&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å…ƒ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Test.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç®€å•å·¥åŽ‚è®¾è®¡æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Test&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Pay wx &lt;span style="color:#f92672">=&lt;/span> SimpleFactory.&lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;WX&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wx.&lt;span style="color:#a6e22e">pay&lt;/span>(2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Pay zfb &lt;span style="color:#f92672">=&lt;/span> SimpleFactory.&lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ZFB&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> zfb.&lt;span style="color:#a6e22e">pay&lt;/span>(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="è¡Œä¸ºæ¨¡å¼">è¡Œä¸ºæ¨¡å¼&lt;/h1>
&lt;h2 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼&lt;/h2>
&lt;p>&lt;strong>åŸºç¡€&lt;/strong>&lt;/p>
&lt;p>Strategy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Strategy&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç­–ç•¥æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">strategyInterface&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ConcreteStrategyA&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ConcreteStrategyA&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Strategy {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">strategyInterface&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ConcreteStrategyA&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ConcreteStrategyB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ConcreteStrategyB&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Strategy {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">strategyInterface&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ConcreteStrategyB&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ConcreteStrategyC&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ConcreteStrategyC&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Strategy {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">strategyInterface&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ConcreteStrategyC&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Context&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Context&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æŒæœ‰ä¸€ä¸ªå…·ä½“ç­–ç•¥çš„å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> Strategy strategy;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æž„é€ å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå…·ä½“ç­–ç•¥å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">Context&lt;/span>(Strategy strategy){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">strategy&lt;/span> &lt;span style="color:#f92672">=&lt;/span> strategy;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ç­–ç•¥æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">contextInterface&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> strategy.&lt;span style="color:#a6e22e">strategyInterface&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Test.java&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Test&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Context context &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Context(&lt;span style="color:#66d9ef">new&lt;/span> ConcreteStrategyA());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> context.&lt;span style="color:#a6e22e">contextInterface&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åº”ç”¨">åº”ç”¨&lt;/h3>
&lt;p>MemberStrategy.java&lt;/p>
&lt;pre tabindex="0">&lt;code>/**
* ä¼šå‘˜ç­–ç•¥
*/
public interface MemberStrategy {
/**
* è®¡ç®—å›¾ä¹¦çš„ä»·æ ¼,æ ¹ç»ä¼šå‘˜ç­‰çº§
* @param booksPrice å›¾ä¹¦çš„åŽŸä»·
* @return è®¡ç®—å‡ºæ‰“æŠ˜åŽçš„ä»·æ ¼
*/
public double calcPrice(double booksPrice);
}
&lt;/code>&lt;/pre>&lt;p>PrimaryMemberStrategy.java åˆçº§ä¼šå‘˜&lt;/p>
&lt;pre tabindex="0">&lt;code>public class PrimaryMemberStrategy implements MemberStrategy {
@Override
public double calcPrice(double booksPrice) {
System.out.println(&amp;#34;åˆçº§ä¼šå‘˜,æ²¡æœ‰æŠ˜æ‰£&amp;#34;);
return 0;
}
}
&lt;/code>&lt;/pre>&lt;p>IntermediateMemberStrategy.java ä¸­çº§ä¼šå‘˜&lt;/p>
&lt;pre tabindex="0">&lt;code>public class IntermediateMemberStrategy implements MemberStrategy {
@Override
public double calcPrice(double booksPrice) {
System.out.println(&amp;#34;å¯¹äºŽä¸­çº§ä¼šå‘˜çš„æŠ˜æ‰£ä¸º10%&amp;#34;);
return booksPrice * 0.9;
}
}
&lt;/code>&lt;/pre>&lt;p>AdvancedMemberStrategy.java é«˜çº§ä¼šå‘˜&lt;/p>
&lt;pre tabindex="0">&lt;code>public class AdvancedMemberStrategy implements MemberStrategy {
@Override
public double calcPrice(double booksPrice) {
System.out.println(&amp;#34;å¯¹äºŽé«˜çº§ä¼šå‘˜çš„æŠ˜æ‰£ä¸º20%&amp;#34;);
return booksPrice * 0.8;
}
}
&lt;/code>&lt;/pre>&lt;p>Price.java&lt;/p>
&lt;pre tabindex="0">&lt;code>public class Price {
private MemberStrategy strategy;
public Price(MemberStrategy strategy) {
this.strategy = strategy;
}
/**
* è®¡ç®—å›¾ä¹¦çš„ä»·æ ¼
* @param booksPrice å›¾ä¹¦çš„åŽŸä»·
* @return è®¡ç®—å‡ºæ‰“æŠ˜åŽçš„ä»·æ ¼
*/
public double quote(double booksPrice){
return this.strategy.calcPrice(booksPrice);
}
}
&lt;/code>&lt;/pre>&lt;p>Test.java&lt;/p>
&lt;pre tabindex="0">&lt;code>public class Test {
public static void main(String[] args) {
//é€‰æ‹©å¹¶åˆ›å»ºéœ€è¦ä½¿ç”¨çš„ç­–ç•¥å¯¹è±¡
MemberStrategy strategy = new AdvancedMemberStrategy();
//åˆ›å»ºçŽ¯å¢ƒ
Price price = new Price(strategy);
//è®¡ç®—ä»·æ ¼
double quote = price.quote(300);
System.out.println(&amp;#34;å›¾ä¹¦çš„æœ€ç»ˆä»·æ ¼ä¸ºï¼š&amp;#34; + quote);
}
}
&lt;/code>&lt;/pre>&lt;h1 id="ç»“æž„æ¨¡å¼">ç»“æž„æ¨¡å¼&lt;/h1>
&lt;h2 id="è£…é¥°æ¨¡å¼">è£…é¥°æ¨¡å¼&lt;/h2>
&lt;p>mybatisçš„æ‰§è¡ŒæœŸå°±ç”¨çš„æ˜¯è£…é¥°æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠ½è±¡æž„ä»¶è§’è‰²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¯”å¦‚è¿™æ˜¯ä¸€æœŸå¼€å‘çš„æŽ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Shape&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">draw&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å…·ä½“æž„ä»¶è§’è‰²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¯”å¦‚è¿™æ˜¯ä¸€æœŸå¼€å‘å¥½çš„å®žçŽ°ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Rectangle&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Shape {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">draw&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Shape: Rectangle&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ°äºŒæœŸå¼€å‘äº†,å‘çŽ°è¿™ä¸ªRectangleçš„å®žçŽ°ä¸å¤ªå¥½ç”¨äº†,éœ€è¦æ·»åŠ åˆ«çš„åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠ½è±¡è£…é¥°å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">abstract&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ShapeDecorator&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Shape {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> Shape decoratedShape;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">ShapeDecorator&lt;/span>(Shape decoratedShape){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">decoratedShape&lt;/span> &lt;span style="color:#f92672">=&lt;/span> decoratedShape;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">draw&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> decoratedShape.&lt;span style="color:#a6e22e">draw&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å…·ä½“è£…é¥°å™¨è§’è‰²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿™é‡Œå°±æ˜¯å¼€å‘çš„äºŒæœŸçš„åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RedShapeDecorator&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> ShapeDecorator {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#a6e22e">RedShapeDecorator&lt;/span>(Shape decoratedShape) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>(decoratedShape);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">draw&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è°ƒç”¨ä¸€æœŸçš„ä»£ç åŽŸæœ¬çš„åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> decoratedShape.&lt;span style="color:#a6e22e">draw&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è°ƒç”¨äºŒæœŸçš„æ–°ä»£ç çš„åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setRedBorder(decoratedShape);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">setRedBorder&lt;/span>(Shape decoratedShape){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Border Color: Red&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¯”å¦‚ä¸€ä¸ªäººå†·äº†,å¤šå¥—äº†ä¸€ä»¶æ¯›è¡£,å‘çŽ°è¿˜æ˜¯å†·,åˆå¤šç©¿äº†ä¸€ä»¶ç¾½ç»’æœ,ä¸€å±‚ä¸€å±‚çš„,è£…é¥°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">DecoratorPatternDemo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸€æœŸçš„ä»£ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Shape circle &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Circle();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// äºŒæœŸçš„ä»£ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ShapeDecorator redCircle &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> RedShapeDecorator(&lt;span style="color:#66d9ef">new&lt;/span> Circle());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> redCircle.&lt;span style="color:#a6e22e">draw&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æ¨¡æ¿æ¨¡å¼">æ¨¡æ¿æ¨¡å¼&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Lifecycle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">abstract&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AbstractLifecycle&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Lifecycle{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">abstract&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;è¿™é‡Œæ˜¯å…¬å…±æ–¹æ³•&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> run();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;è¿™é‡Œä¹Ÿæ˜¯å…¬å…±æ–¹æ³•&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ServerStandard&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> AbstractLifecycle {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘æ˜¯å®žçŽ°,çˆ¶ç±»å°†è°ƒç”¨æˆ‘&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ServerStandard2&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> AbstractLifecycle {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æˆ‘æ˜¯å®žçŽ°2,çˆ¶ç±»å°†è°ƒç”¨æˆ‘&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Test&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerStandard serverStandard &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerStandard();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serverStandard.&lt;span style="color:#a6e22e">init&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;============================================&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServerStandard2 serverStandard2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ServerStandard2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serverStandard2.&lt;span style="color:#a6e22e">init&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼&lt;/h1>
&lt;pre tabindex="0">&lt;code>public abstract class Handler {
protected String name; // å¤„ç†è€…å§“å
@Setter
protected Handler nextHandler; // ä¸‹ä¸€ä¸ªå¤„ç†è€…
public Handler(String name) {
this.name = name;
}
public abstract boolean process(LeaveRequest leaveRequest); // å¤„ç†è¯·å‡
}
public class Director extends Handler {
public Director(String name) {
super(name);
}
@Override
public boolean process(LeaveRequest leaveRequest) {
// éšæœºæ•°å¤§äºŽ3åˆ™ä¸ºæ‰¹å‡†ï¼Œå¦åˆ™ä¸æ‰¹å‡†
boolean result = (new Random().nextInt(10)) &amp;gt; 3;
String log = &amp;#34;ä¸»ç®¡&amp;lt;%s&amp;gt; å®¡æ‰¹ &amp;lt;%s&amp;gt; çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡å¤©æ•°ï¼š &amp;lt;%d&amp;gt; ï¼Œå®¡æ‰¹ç»“æžœï¼š&amp;lt;%s&amp;gt; &amp;#34;;
System.out.println(String.format(log, this.name, leaveRequest.getName(), leaveRequest.getNumOfDays(), result == true ? &amp;#34;æ‰¹å‡†&amp;#34; : &amp;#34;ä¸æ‰¹å‡†&amp;#34;));
if (!result) { // ä¸æ‰¹å‡†
return false;
} else if (leaveRequest.getNumOfDays() &amp;lt; 3) { // æ‰¹å‡†ä¸”å¤©æ•°å°äºŽ3ï¼Œè¿”å›žtrue
return true;
}
return nextHandler.process(leaveRequest); // æ‰¹å‡†ä¸”å¤©æ•°å¤§äºŽç­‰äºŽ3ï¼Œæäº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…å¤„ç†
}
}
public class Manager extends Handler {
public Manager(String name) {
super(name);
}
@Override
public boolean process(LeaveRequest leaveRequest) {
boolean result = (new Random().nextInt(10)) &amp;gt; 3; // éšæœºæ•°å¤§äºŽ3åˆ™ä¸ºæ‰¹å‡†ï¼Œå¦åˆ™ä¸æ‰¹å‡†
String log = &amp;#34;ç»ç†&amp;lt;%s&amp;gt; å®¡æ‰¹ &amp;lt;%s&amp;gt; çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡å¤©æ•°ï¼š &amp;lt;%d&amp;gt; ï¼Œå®¡æ‰¹ç»“æžœï¼š&amp;lt;%s&amp;gt; &amp;#34;;
System.out.println(String.format(log, this.name, leaveRequest.getName(), leaveRequest.getNumOfDays(), result == true ? &amp;#34;æ‰¹å‡†&amp;#34; : &amp;#34;ä¸æ‰¹å‡†&amp;#34;));
if (!result) { // ä¸æ‰¹å‡†
return false;
} else if (leaveRequest.getNumOfDays() &amp;lt; 7) { // æ‰¹å‡†ä¸”å¤©æ•°å°äºŽ7
return true;
}
return nextHandler.process(leaveRequest); // æ‰¹å‡†ä¸”å¤©æ•°å¤§äºŽç­‰äºŽ7ï¼Œæäº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…å¤„ç†
}
}
public class TopManager extends Handler {
public TopManager(String name) {
super(name);
}
@Override
public boolean process(LeaveRequest leaveRequest) {
boolean result = (new Random().nextInt(10)) &amp;gt; 3; // éšæœºæ•°å¤§äºŽ3åˆ™ä¸ºæ‰¹å‡†ï¼Œå¦åˆ™ä¸æ‰¹å‡†
String log = &amp;#34;æ€»ç»ç†&amp;lt;%s&amp;gt; å®¡æ‰¹ &amp;lt;%s&amp;gt; çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡å¤©æ•°ï¼š &amp;lt;%d&amp;gt; ï¼Œå®¡æ‰¹ç»“æžœï¼š&amp;lt;%s&amp;gt; &amp;#34;;
System.out.println(String.format(log, this.name, leaveRequest.getName(), leaveRequest.getNumOfDays(), result == true ? &amp;#34;æ‰¹å‡†&amp;#34; : &amp;#34;ä¸æ‰¹å‡†&amp;#34;));
if (!result) { // æ€»ç»ç†ä¸æ‰¹å‡†
return false;
}
return true; // æ€»ç»ç†æœ€åŽæ‰¹å‡†
}
}
@Data
@AllArgsConstructor
public class LeaveRequest {
private String name; // è¯·å‡äººå§“å
private int numOfDays; // è¯·å‡å¤©æ•°
}
public class Test {
public static void main(String[] args) {
// åˆ›å»ºå®¡æ‰¹äºº
Handler zhangsan = new Director(&amp;#34;å¼ ä¸‰&amp;#34;);
Handler lisi = new Manager(&amp;#34;æŽå››&amp;#34;);
Handler wangwu = new TopManager(&amp;#34;çŽ‹äº”&amp;#34;);
// åˆ›å»ºè´£ä»»é“¾
zhangsan.setNextHandler(lisi);
lisi.setNextHandler(wangwu);
// å‘èµ·è¯·å‡ç”³è¯·ç¬¬ä¸€æ¬¡
boolean result1 = zhangsan.process(new LeaveRequest(&amp;#34;å°æ—‹é”‹&amp;#34;, 1));
System.out.println(&amp;#34;æœ€ç»ˆç»“æžœï¼š&amp;#34; + result1 + &amp;#34;\n&amp;#34;);
// å‘èµ·è¯·å‡ç”³è¯·ç¬¬äºŒæ¬¡
boolean result2 = zhangsan.process(new LeaveRequest(&amp;#34;å°æ—‹é”‹&amp;#34;, 4));
System.out.println(&amp;#34;æœ€ç»ˆç»“æžœï¼š&amp;#34; + result2 + &amp;#34;\n&amp;#34;);
// å‘èµ·è¯·å‡ç”³è¯·ç¬¬ä¸‰æ¬¡
boolean result3 = zhangsan.process(new LeaveRequest(&amp;#34;å°æ—‹é”‹&amp;#34;, 8));
System.out.println(&amp;#34;æœ€ç»ˆç»“æžœï¼š&amp;#34; + result3 + &amp;#34;\n&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>Tomcatçš„è¿‡æ»¤å™¨ä¹Ÿä½¿ç”¨åˆ°äº†è´£ä»»é“¾&lt;code>ApplicationFilterChain&lt;/code>,å…·ä½“çš„è¿˜æ²¡æœ‰è¯»,å…ˆå†™å®Œè¿™ä¸ªæ¨¡å¼,æ¯”æ¨¡æ¿æ¨¡å¼æ„Ÿè§‰æœ‰ç‚¹å¤æ‚&lt;/p>
&lt;p>å‚è€ƒçš„æ˜¯:&lt;a href="https://juejin.im/post/6844903702260629512#heading-11">https://juejin.im/post/6844903702260629512#heading-11&lt;/a>,&lt;/p>
&lt;p>æ„Ÿè§‰ä¸¾çš„ä¾‹å­çš„ä¸šåŠ¡æ˜¾ç¤ºè¿˜ä¸æ˜¯ç‰¹åˆ«çš„å¥½ç†è§£&lt;/p>
&lt;p>ä¹Ÿå‚è€ƒä¸‹è¿™ä¸ª:&lt;a href="https://www.cnblogs.com/tanshaoshenghao/p/10741160.html">https://www.cnblogs.com/tanshaoshenghao/p/10741160.html&lt;/a>&lt;/p>
&lt;h1 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼&lt;/h1>
&lt;p>&lt;code>SpringMVCçš„DispatchServletçš„ä¾‹å­&lt;/code>&lt;/p>
&lt;h2 id="å…·ä½“å®žçŽ°">å…·ä½“å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Description: æŽ§åˆ¶å™¨æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Controller&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Controller å®žçŽ°ä¹‹1ï¼šHttpController
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">HttpController&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Controller {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doHttpHandler&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;HttpController:httpMethod()&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Controller å®žçŽ°ä¹‹2ï¼šSimpleController
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SimpleController&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Controller {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doSimplerHandler&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SimpleController:simpleMethod()&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Controller å®žçŽ°ä¹‹3ï¼šHttpController
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AnnotationController&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> Controller {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doAnnotationHandler&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;AnnotationController:annotationMethod()&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¤„ç†å™¨">å¤„ç†å™¨&lt;/h2>
&lt;pre tabindex="0">&lt;code>/**
* å®šä¹‰ä¸€ä¸ªAdapteræŽ¥å£
*/
public interface HandlerAdapter {
/**
* æ˜¯å¦æ”¯æŒ
*
* @param handler
* @return
*/
boolean supports(Object handler);
/**
* å¤„ç†
*
* @param handler
*/
void handle(Object handler);
}
/**
* HttpController çš„é€‚é…å™¨
*/
public class HttpHandlerAdapter implements HandlerAdapter {
public boolean supports(Object handler) {
return (handler instanceof HttpController);
}
public void handle(Object handler) {
((HttpController) handler).doHttpHandler();
}
}
/**
* SimpleControllerçš„é€‚é…å™¨
*/
public class SimpleHandlerAdapter implements HandlerAdapter {
public boolean supports(Object handler) {
return (handler instanceof SimpleController);
}
public void handle(Object handler) {
((SimpleController) handler).doSimplerHandler();
}
}
/**
* AnnotationController çš„é€‚é…å™¨
*/
public class AnnotationHandlerAdapter implements HandlerAdapter {
public boolean supports(Object handler) {
return (handler instanceof AnnotationController);
}
public void handle(Object handler) {
((AnnotationController) handler).doAnnotationHandler();
}
}
&lt;/code>&lt;/pre>&lt;h2 id="mainæ–¹æ³•">mainæ–¹æ³•&lt;/h2>
&lt;pre tabindex="0">&lt;code>/**
* æ¨¡æ‹Ÿä¸€ä¸ªDispatcherServletï¼Œé€‚é…å™¨ï¼ˆé€‚é…è€…æ¨¡å¼ï¼‰
* HandlerAdapter(é€‚é…å™¨ç±») ä½œä¸ºé€‚é…å™¨æ¥é€‚é…å„ç§ Handler(é€‚é…è€…ç±»)ï¼ˆå¦‚Controllerï¼‰
*/
public class DispatchServlet {
public static List&amp;lt;HandlerAdapter&amp;gt; handlerAdapters = new ArrayList&amp;lt;HandlerAdapter&amp;gt;();
/**
* æ³¨å†Œæ‰€æœ‰ HandlerAdapter
*/
public DispatchServlet() {
handlerAdapters.add(new AnnotationHandlerAdapter());
handlerAdapters.add(new HttpHandlerAdapter());
handlerAdapters.add(new SimpleHandlerAdapter());
}
/**
* æ¨¡æ‹ŸDispatchServlet ä¸­çš„ doDispatch()æ–¹æ³•
*/
public void doDispatch() {
Controller handler = new AnnotationController();
// é€šè¿‡handleræ¥æ‰¾åˆ°å¯¹åº”é€‚é…å™¨
HandlerAdapter handlerAdapter = getHandler(handler);
// é€šè¿‡æ‰§è¡Œé€‚é…å™¨çš„handleï¼Œæ¥æ‰§è¡Œå¯¹åº”çš„controllerå¯¹åº”æ–¹æ³•
handlerAdapter.handle(handler);
}
/**
* æ‰¾åˆ°ä¸Žhandleré€‚é…çš„é€‚é…å™¨ï¼šé€šè¿‡handler éåŽ† HandlerAdapter é€‚é…å™¨æ¥å®žçŽ°
*/
public HandlerAdapter getHandler(Controller handler) {
for (HandlerAdapter adapter : handlerAdapters) {
if (adapter.supports(handler)) {
return adapter;
}
}
return null;
}
/**
* æ¨¡æ‹Ÿè¿è¡Œ
*/
public static void main(String[] args) {
new DispatchServlet().doDispatch();
}
}
&lt;/code>&lt;/pre>&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;blockquote>
&lt;p>&lt;a href="https://refactoringguru.cn/design-patterns">https://refactoringguru.cn/design-patterns&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6999268990971281439">è£…é¥°å™¨æ¨¡å¼&lt;/a>&lt;/p>&lt;/blockquote></content></item></channel></rss>