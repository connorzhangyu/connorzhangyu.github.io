<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on Hello World</title><link>/categories/linux/</link><description>Recent content in Linux on Hello World</description><generator>Hugo -- gohugo.io</generator><language>zh</language><lastBuildDate>Wed, 25 Oct 2023 09:30:33 +0000</lastBuildDate><atom:link href="/categories/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>JumpServer</title><link>/posts/jumpserver/</link><pubDate>Wed, 25 Oct 2023 09:30:33 +0000</pubDate><guid>/posts/jumpserver/</guid><description>&lt;h1 id="笔记">笔记&lt;/h1>
&lt;h2 id="安装jumpserver">安装JumpServer&lt;/h2>
&lt;p>&lt;a href="https://community.fit2cloud.com/#/products/jumpserver/getstarted">官网一键安装&lt;/a>&lt;/p>
&lt;h2 id="修改配置远程访问的端口">修改配置远程访问的端口&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入到jp的配置文件目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver/config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim config.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置,对外提供服务端口, 如果与现有服务冲突请自行修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HTTP_PORT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8083&lt;/span> &lt;span style="color:#75715e"># 修改这个端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改系统管理员密码">修改系统管理员密码&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入Docker容器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ docker exec -it jms_core /bin/bash
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入根目录,如果不是Docker,进入cd /opt/jumpserver/apps&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cd apps/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ python manage.py changepassword admin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 输入新的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx反向代理">Nginx反向代理&lt;/h2>
&lt;p>&lt;a href="../9355/#%E4%BB%A3%E7%90%86JumpServer">Nginx反向代理&lt;/a>&lt;/p>
&lt;h2 id="配置ssl">配置SSL&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先停止服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 把证书移动到这个目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/opt/jumpserver/config/nginx/cert
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置文件,域名和ssl证书的文职&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/opt/jumpserver/config/config.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置ssh超时时间">配置SSH超时时间&lt;/h2>
&lt;p>默认的时间好像半个小时不操作了,就会自动断开,改成最大值&lt;/p></description><content>&lt;h1 id="笔记">笔记&lt;/h1>
&lt;h2 id="安装jumpserver">安装JumpServer&lt;/h2>
&lt;p>&lt;a href="https://community.fit2cloud.com/#/products/jumpserver/getstarted">官网一键安装&lt;/a>&lt;/p>
&lt;h2 id="修改配置远程访问的端口">修改配置远程访问的端口&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入到jp的配置文件目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver/config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim config.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置,对外提供服务端口, 如果与现有服务冲突请自行修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HTTP_PORT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8083&lt;/span> &lt;span style="color:#75715e"># 修改这个端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改系统管理员密码">修改系统管理员密码&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入Docker容器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ docker exec -it jms_core /bin/bash
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入根目录,如果不是Docker,进入cd /opt/jumpserver/apps&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cd apps/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ python manage.py changepassword admin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 输入新的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx反向代理">Nginx反向代理&lt;/h2>
&lt;p>&lt;a href="../9355/#%E4%BB%A3%E7%90%86JumpServer">Nginx反向代理&lt;/a>&lt;/p>
&lt;h2 id="配置ssl">配置SSL&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先停止服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 把证书移动到这个目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/opt/jumpserver/config/nginx/cert
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置文件,域名和ssl证书的文职&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/opt/jumpserver/config/config.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/jumpserver-installer-v3.6.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./jmsctl.sh start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置ssh超时时间">配置SSH超时时间&lt;/h2>
&lt;p>默认的时间好像半个小时不操作了,就会自动断开,改成最大值&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202406151603157.png" alt="image-20240615160327165">&lt;/p></content></item><item><title>WordPress</title><link>/posts/wordpress/</link><pubDate>Fri, 16 Jun 2023 13:39:21 +0000</pubDate><guid>/posts/wordpress/</guid><description>&lt;h1 id="搭建">搭建&lt;/h1>
&lt;p>使用阿里云,或者腾讯等轻量云服务器,一键搭建&lt;/p>
&lt;h1 id="教程">教程&lt;/h1>
&lt;h2 id="wordpress地址和站点地址的含义和区别">WordPress地址和站点地址的含义和区别&lt;/h2>
&lt;p>WordPress 地址
没有子站点就忽略,和站点地址一样就行
站点地址
就是浏览器地址栏输入的地址&lt;/p>
&lt;p>如果地址填入错误,导致不能进入网站,需要手动修改数据库&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">select&lt;/span> option_name,option_value &lt;span style="color:#66d9ef">from&lt;/span> &lt;span style="color:#66d9ef">options&lt;/span> &lt;span style="color:#66d9ef">where&lt;/span> option_name &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;siteurl&amp;#39;&lt;/span> &lt;span style="color:#66d9ef">or&lt;/span> option_name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;home&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="在云服务器控制面板强制重启导致数据无法启动">在云服务器控制面板强制重启,导致数据无法启动&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>rm -f /www/server/data/ib_*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm -f /www/server/data/mysql-bin*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="常用的插件">常用的插件&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">插件&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">Elementor&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Essential Addons for Elementor&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">SMTP Mailer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Starter Templates&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Yoast SEO&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description><content>&lt;h1 id="搭建">搭建&lt;/h1>
&lt;p>使用阿里云,或者腾讯等轻量云服务器,一键搭建&lt;/p>
&lt;h1 id="教程">教程&lt;/h1>
&lt;h2 id="wordpress地址和站点地址的含义和区别">WordPress地址和站点地址的含义和区别&lt;/h2>
&lt;p>WordPress 地址
没有子站点就忽略,和站点地址一样就行
站点地址
就是浏览器地址栏输入的地址&lt;/p>
&lt;p>如果地址填入错误,导致不能进入网站,需要手动修改数据库&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">select&lt;/span> option_name,option_value &lt;span style="color:#66d9ef">from&lt;/span> &lt;span style="color:#66d9ef">options&lt;/span> &lt;span style="color:#66d9ef">where&lt;/span> option_name &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;siteurl&amp;#39;&lt;/span> &lt;span style="color:#66d9ef">or&lt;/span> option_name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;home&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="在云服务器控制面板强制重启导致数据无法启动">在云服务器控制面板强制重启,导致数据无法启动&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>rm -f /www/server/data/ib_*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm -f /www/server/data/mysql-bin*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="常用的插件">常用的插件&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">插件&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">Elementor&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Essential Addons for Elementor&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">SMTP Mailer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Starter Templates&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Yoast SEO&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></content></item><item><title>Linux</title><link>/posts/linux/</link><pubDate>Tue, 22 Nov 2022 10:53:07 +0000</pubDate><guid>/posts/linux/</guid><description>&lt;h1 id="系统命令">系统命令&lt;/h1>
&lt;h2 id="解压缩">解压缩&lt;/h2>
&lt;p>demo(文件夹)&lt;/p>
&lt;p>|&amp;mdash;&amp;mdash;|1.txt(文件)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -r：递归地压缩目录，意味着 zip 命令会包含 demo 文件夹内的所有文件和子目录。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo.zip：这是输出的压缩文件名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo：这是您要压缩的目录名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zip -r demo.zip demo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -o：强制覆盖现有的文件和文件夹，而不会询问用户。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo.zip：这是您想要解压的 .zip 文件名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unzip -o demo.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看前几行">查看前几行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ifconfig | head -n &lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装中文">安装中文&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apt install language-pack-zh-hans
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/default/locale
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LANG&lt;span style="color:#f92672">=&lt;/span>zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LANGUAGE&lt;span style="color:#f92672">=&lt;/span>zh_CN:zh:en_US:en
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 验证&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@anthony:~# echo $LANG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="update索引失效">Update索引失效&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>正在读取软件包列表... 完成
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E: 无法下载 http://mirror.rise.ph/ubuntu/dists/focal-updates/main/dep11/Components-amd64.yml.xz 文件尺寸不符&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">264288&lt;/span> !&lt;span style="color:#f92672">=&lt;/span> 264484&lt;span style="color:#f92672">)&lt;/span>。您使用的镜像正在同步中？ &lt;span style="color:#f92672">[&lt;/span>IP: 43.226.6.79 80&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Hashes of expected file:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - Filesize:264484 &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - SHA256:ea09acc6bddd6a503a3812ba1d3a025e5515c5469dcad172c86e2bda6f203752
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - SHA1:60863a9cc3181eb87007edcfc2de1ba6a0b81a5f &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - MD5Sum:80baa34a1b24d245341757fa51ebd29e &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Release file created at: Sat, &lt;span style="color:#ae81ff">27&lt;/span> Feb &lt;span style="color:#ae81ff">2021&lt;/span> 08:09:39 +0000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E: 部分索引文件下载失败。如果忽略它们，那将转而使用旧的索引文件。
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 解决办法&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo rm -rf /var/lib/apt/lists/partial/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改时区">修改时区&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查询当前时间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>date -R
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># tzselect&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>选择 4,9,1,1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ubuntu特有的,如果不是ubuntu 跳过这一步&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># java设置时区&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>在/etc/profile或~/.bashrc文件中设置环境变量TZ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export TZ&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;Asia/Shanghai&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source /etc/profile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ubuntu20.04&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo timedatectl set-timezone Asia/Shanghai
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="历史命令">历史命令&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 历史命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>history -3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="sudo免密">sudo免密&lt;/h2>
&lt;p>&lt;code>vim /etc/sudoers&lt;/code>&lt;/p></description><content>&lt;h1 id="系统命令">系统命令&lt;/h1>
&lt;h2 id="解压缩">解压缩&lt;/h2>
&lt;p>demo(文件夹)&lt;/p>
&lt;p>|&amp;mdash;&amp;mdash;|1.txt(文件)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -r：递归地压缩目录，意味着 zip 命令会包含 demo 文件夹内的所有文件和子目录。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo.zip：这是输出的压缩文件名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo：这是您要压缩的目录名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zip -r demo.zip demo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -o：强制覆盖现有的文件和文件夹，而不会询问用户。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># demo.zip：这是您想要解压的 .zip 文件名。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unzip -o demo.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看前几行">查看前几行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ifconfig | head -n &lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装中文">安装中文&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apt install language-pack-zh-hans
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/default/locale
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LANG&lt;span style="color:#f92672">=&lt;/span>zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LANGUAGE&lt;span style="color:#f92672">=&lt;/span>zh_CN:zh:en_US:en
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 验证&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@anthony:~# echo $LANG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="update索引失效">Update索引失效&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>正在读取软件包列表... 完成
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E: 无法下载 http://mirror.rise.ph/ubuntu/dists/focal-updates/main/dep11/Components-amd64.yml.xz 文件尺寸不符&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">264288&lt;/span> !&lt;span style="color:#f92672">=&lt;/span> 264484&lt;span style="color:#f92672">)&lt;/span>。您使用的镜像正在同步中？ &lt;span style="color:#f92672">[&lt;/span>IP: 43.226.6.79 80&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Hashes of expected file:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - Filesize:264484 &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - SHA256:ea09acc6bddd6a503a3812ba1d3a025e5515c5469dcad172c86e2bda6f203752
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - SHA1:60863a9cc3181eb87007edcfc2de1ba6a0b81a5f &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - MD5Sum:80baa34a1b24d245341757fa51ebd29e &lt;span style="color:#f92672">[&lt;/span>weak&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Release file created at: Sat, &lt;span style="color:#ae81ff">27&lt;/span> Feb &lt;span style="color:#ae81ff">2021&lt;/span> 08:09:39 +0000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E: 部分索引文件下载失败。如果忽略它们，那将转而使用旧的索引文件。
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 解决办法&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo rm -rf /var/lib/apt/lists/partial/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改时区">修改时区&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查询当前时间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>date -R
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># tzselect&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>选择 4,9,1,1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ubuntu特有的,如果不是ubuntu 跳过这一步&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># java设置时区&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>在/etc/profile或~/.bashrc文件中设置环境变量TZ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export TZ&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;Asia/Shanghai&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source /etc/profile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ubuntu20.04&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo timedatectl set-timezone Asia/Shanghai
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="历史命令">历史命令&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 历史命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>history -3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="sudo免密">sudo免密&lt;/h2>
&lt;p>&lt;code>vim /etc/sudoers&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Host alias specification&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># User alias specification&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Cmnd alias specification&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># User privilege specification&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root ALL&lt;span style="color:#f92672">=(&lt;/span>ALL:ALL&lt;span style="color:#f92672">)&lt;/span> ALL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加在这里会被覆盖掉&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>anthony ALL&lt;span style="color:#f92672">=(&lt;/span>ALL&lt;span style="color:#f92672">)&lt;/span> NOPASSWD:ALL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Members of the admin group may gain root privileges&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>%admin ALL&lt;span style="color:#f92672">=(&lt;/span>ALL&lt;span style="color:#f92672">)&lt;/span> ALL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 最好是加在最后&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>anthony ALL&lt;span style="color:#f92672">=(&lt;/span>ALL&lt;span style="color:#f92672">)&lt;/span> NOPASSWD:ALL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Allow members of group sudo to execute any command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>%sudo ALL&lt;span style="color:#f92672">=(&lt;/span>ALL:ALL&lt;span style="color:#f92672">)&lt;/span> ALL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>anthony ALL&lt;span style="color:#f92672">=(&lt;/span>ALL&lt;span style="color:#f92672">)&lt;/span> NOPASSWD:ALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="grep管道">grep管道&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat hive-default.xml | grep hive.cli.print
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="系统升级">系统升级&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum -y update&lt;span style="color:#f92672">(&lt;/span>centos&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get update&lt;span style="color:#f92672">(&lt;/span>ubuntu 软件包的列表 &lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get dist-upgrade （进入列新你系统和系统里安装的软件）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ll文件大小按mb显示">ll文件大小按MB显示&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls -lh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ll -lh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看系统版本">查看系统版本&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /etc/os-release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="立即关机和重启">立即关机和重启&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 现在立即关机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>shutdown -h now
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 现在立即重启&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>shutdown -r now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="当前时间">当前时间&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>data / date -R
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="目录占用空间">目录占用空间&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看当前目录下一级子文件和子目录占用的磁盘容量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>du -lh --max-depth&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> /
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看当前目录总共占的容量。而不单独列出各子项占用的容量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>du -sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 使用lsof命令排查,可以查看到状态为deleted的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 可考虑kill掉程序,就会自动释放&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lsof |grep deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>COMMAND PID TID USER FD TYPE DEVICE SIZE/OFF NODE NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dbus-daem &lt;span style="color:#ae81ff">456&lt;/span> dbus txt REG 253,1 &lt;span style="color:#ae81ff">441144&lt;/span> &lt;span style="color:#ae81ff">141672&lt;/span> /usr/bin/dbus-daemon &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node &lt;span style="color:#ae81ff">11595&lt;/span> &lt;span style="color:#ae81ff">11733&lt;/span> root txt REG 253,1 &lt;span style="color:#ae81ff">29851602&lt;/span> &lt;span style="color:#ae81ff">1461079&lt;/span> /home/elk/kibana-5.5.1-linux-x86_64/node/bin/node &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node &lt;span style="color:#ae81ff">11595&lt;/span> &lt;span style="color:#ae81ff">11733&lt;/span> root 1w REG 253,1 &lt;span style="color:#ae81ff">11374904415&lt;/span> &lt;span style="color:#ae81ff">1059873&lt;/span> /home/elk/kibana-5.5.1-linux-x86_64/nohup.out &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node &lt;span style="color:#ae81ff">11595&lt;/span> &lt;span style="color:#ae81ff">11733&lt;/span> root 2w REG 253,1 &lt;span style="color:#ae81ff">11374904415&lt;/span> &lt;span style="color:#ae81ff">1059873&lt;/span> /home/elk/kibana-5.5.1-linux-x86_64/nohup.out &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_17 &lt;span style="color:#ae81ff">24113&lt;/span> &lt;span style="color:#ae81ff">24210&lt;/span> rabbitmq 1w REG 253,1 &lt;span style="color:#ae81ff">8556707104&lt;/span> &lt;span style="color:#ae81ff">659069&lt;/span> /var/log/rabbitmq/startup_log &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_18 &lt;span style="color:#ae81ff">24113&lt;/span> &lt;span style="color:#ae81ff">24211&lt;/span> rabbitmq 1w REG 253,1 &lt;span style="color:#ae81ff">8556707104&lt;/span> &lt;span style="color:#ae81ff">659069&lt;/span> /var/log/rabbitmq/startup_log &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_19 &lt;span style="color:#ae81ff">24113&lt;/span> &lt;span style="color:#ae81ff">24212&lt;/span> rabbitmq 1w REG 253,1 &lt;span style="color:#ae81ff">8556707104&lt;/span> &lt;span style="color:#ae81ff">659069&lt;/span> /var/log/rabbitmq/startup_log &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_20 &lt;span style="color:#ae81ff">24113&lt;/span> &lt;span style="color:#ae81ff">24213&lt;/span> rabbitmq 1w REG 253,1 &lt;span style="color:#ae81ff">8556707104&lt;/span> &lt;span style="color:#ae81ff">659069&lt;/span> /var/log/rabbitmq/startup_log &lt;span style="color:#f92672">(&lt;/span>deleted&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="文件传输">文件传输&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取远程服务器上的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>scp -P &lt;span style="color:#ae81ff">2222&lt;/span> root@www.vpser.net:/root/lnmp0.4.tar.gz /home/lnmp0.4.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取远程服务器上的目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>scp -P &lt;span style="color:#ae81ff">2222&lt;/span> -r root@www.vpser.net:/root/lnmp0.4/ /home/lnmp0.4/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将本地文件上传到服务器上&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>scp -P &lt;span style="color:#ae81ff">2222&lt;/span> /home/lnmp0.4.tar.gz* *root@www.vpser.net:/root/lnmp0.4.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将本地目录上传到服务器上&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>scp -P &lt;span style="color:#ae81ff">2222&lt;/span> -r /home/lnmp0.4/* *root@www.vpser.net:/root/lnmp0.4/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改主机名字">修改主机名字&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第一种方法&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo vim /etc/sysconfig/network
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 编辑&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HOSTNAME&lt;span style="color:#f92672">=&lt;/span>weekend100
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo hostname weenkend110
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第二种方法,需要重启&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/hostname
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ubuntu右上角网络图标消失并且上不了网">Ubuntu右上角网络图标消失并且上不了网&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo nmcli networking off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo nmcli networking on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service network-manager stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo rm /var/lib/NetworkManager/NetworkManager.state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service network-manager start
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo gedit /etc/NetworkManager/NetworkManager.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 把false改成true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service network-manager restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cockpit">Cockpit&lt;/h2>
&lt;pre tabindex="0">&lt;code>Activate the web console with: systemctl enable --now cockpit.socke
&lt;/code>&lt;/pre>&lt;p>Cockpit介绍自己是一个Web端的系统管理工具，只用鼠标点点就能管理系统，事实上也确实如此，我实际使用来说，启动Cockpit服务之后，只需要鼠标点点点就能完成系统很多基础操作，比如查看系统信息，启动/停止服务，新增或者更改账户，系统更新，Web终端及查看网络流量等功能。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl start cockpit.socket &lt;span style="color:#75715e"># 运行Cockpit服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl enable –now cockpit.socket &lt;span style="color:#75715e"># 启动该服务，随系统启动一同启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl status cockpit.socket
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后在另一台电脑上用浏览器登录 &lt;a href="https://ip:9090/">https://IP:9090&lt;/a>&lt;/p>
&lt;h2 id="top">top&lt;/h2>
&lt;pre tabindex="0">&lt;code>top - 21:08:58 up 6:15, 4 users, load average: 0.01, 0.03, 0.05
Tasks: 262 total, 1 running, 261 sleeping, 0 stopped, 0 zombie
%Cpu(s): 0.0 us, 1.4 sy, 0.0 ni, 98.6 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
KiB Mem : 3861300 total, 1922280 free, 1029068 used, 909952 buff/cache
KiB Swap: 2097148 total, 2097148 free, 0 used. 2545024 avail Mem
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>第一行&lt;/li>
&lt;li>程序名(top)&lt;/li>
&lt;li>21:08:58(系统时间)&lt;/li>
&lt;li>up 6:15(运行时间)&lt;/li>
&lt;li>4 users(登录用户数)&lt;/li>
&lt;li>load average(cpu 负载数,5分钟的平均负载,10分钟的平均负载,15分钟的平均负载)&lt;/li>
&lt;li>第二行&lt;/li>
&lt;li>task(总进程数)&lt;/li>
&lt;li>1 running (运行数:1)&lt;/li>
&lt;li>261 sleeping(睡眠树:1)&lt;/li>
&lt;li>stopped(停止数)&lt;/li>
&lt;li>zoimbie(僵尸数)&lt;/li>
&lt;li>第三行&lt;/li>
&lt;li>%cpu(cpu使用占比)&lt;/li>
&lt;li>us (用户)&lt;/li>
&lt;li>sy (系统)&lt;/li>
&lt;li>ni(优先级)&lt;/li>
&lt;li>id(空闲)&lt;/li>
&lt;li>wa(等待)&lt;/li>
&lt;li>hi(硬件)&lt;/li>
&lt;li>st(虚拟机)&lt;/li>
&lt;li>第四行&lt;/li>
&lt;li>kib Mem (物理内存 单位:K)&lt;/li>
&lt;li>free (空间,单位:k)&lt;/li>
&lt;li>userd(使用)&lt;/li>
&lt;li>cache(缓存硬盘内容大小)&lt;/li>
&lt;li>第五行&lt;/li>
&lt;li>交换区&lt;/li>
&lt;li>第六行&lt;/li>
&lt;li>进程ID&lt;/li>
&lt;li>用户名&lt;/li>
&lt;li>优先级(PR)&lt;/li>
&lt;li>内存(VIRT RES SHR)&lt;/li>
&lt;li>状态(S)&lt;/li>
&lt;li>cpu&lt;/li>
&lt;li>内存&lt;/li>
&lt;li>运行时间&lt;/li>
&lt;li>命令&lt;/li>
&lt;/ul>
&lt;h2 id="tree">tree&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 排除目录venv目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tree -I &lt;span style="color:#e6db74">&amp;#39;*venv*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 排除目录venv和venve2目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tree -I &lt;span style="color:#e6db74">&amp;#39;*venv|venv2*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="配置环境变量">配置环境变量&lt;/h1>
&lt;h2 id="配置java环境变量">配置Java环境变量&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>export JAVA_HOME&lt;span style="color:#f92672">=&lt;/span>/home/anthony/soft/jdk1.8.0_19
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export PATH&lt;span style="color:#f92672">=&lt;/span>$JAVA_HOME/bin:$PATH
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export CLASSPATH&lt;span style="color:#f92672">=&lt;/span>.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置maven环境变量">配置Maven环境变量&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>export M2_HOME&lt;span style="color:#f92672">=&lt;/span>/usr/local/software/apache-maven-3.6.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export PATH&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>M2_HOME&lt;span style="color:#e6db74">}&lt;/span>/bin:$PATH
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装和卸载openjdk">安装和卸载OpenJDK&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install -y openjdk-17-jdk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 卸载openJDK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get remove openjdk*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看jdk可安装的版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum -y list java*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 选择一个安装&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 要选择 要带有-devel的安装，因为这个安装的是jdk，而那个不带-devel的安装完了其实是jre&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum install -y java-1.8.0-openjdk-devel.x86_64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查找安装路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>which java
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置scala">配置Scala&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>export SCALA_HOME&lt;span style="color:#f92672">=&lt;/span>/usr/local/scala-2.13.4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export PATH&lt;span style="color:#f92672">=&lt;/span>$SCALA_HOME/bin:$PATH
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="固定ip">固定ip&lt;/h1>
&lt;p>配置完了,最好是重启下vmware和虚拟机,和禁用开启 win10上的vmare8网卡&lt;/p>
&lt;p>vmare配置
&lt;img src="https://image.runtimes.cc/202404051425040.png" alt="">&lt;/p>
&lt;p>电脑配置
&lt;img src="https://image.runtimes.cc/202404051425094.png" alt="">
虚拟机配置
&lt;img src="https://image.runtimes.cc/202404051425941.png" alt="">&lt;/p>
&lt;h2 id="centos配置">Centos配置&lt;/h2>
&lt;pre tabindex="0">&lt;code>vim /etc/sysconfig/network-scripts/ifcfg-eth0
BOOTPROTO=&amp;#34;static&amp;#34; #dhcp改为static
ONBOOT=&amp;#34;yes&amp;#34; #开机启用本配置
IPADDR=10.14.2.50 #静态IP
GATEWAY=10.14.2.11 #默认网关
NETMASK=255.255.255.0 #子网掩码
# 重启网卡,或者重启电脑
service network restart
&lt;/code>&lt;/pre>&lt;h2 id="ubuntu配置">Ubuntu配置&lt;/h2>
&lt;p>&lt;code>vim /etc/netplan&lt;/code>&lt;/p>
&lt;p>编辑完之后执行&lt;code>netplan apply&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu桌面版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">renderer&lt;/span>: &lt;span style="color:#ae81ff">NetworkManager&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ethernets&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ens33&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dhcp4&lt;/span>: &lt;span style="color:#66d9ef">no&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">optional&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">addresses&lt;/span>: [&lt;span style="color:#ae81ff">192.168.0.5&lt;/span>&lt;span style="color:#ae81ff">/24]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gateway4&lt;/span>: &lt;span style="color:#ae81ff">192.168.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">nameservers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">addresses&lt;/span>: [&lt;span style="color:#ae81ff">192.168.0.1&lt;/span>,&lt;span style="color:#ae81ff">8.8.8.8&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu服务器版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ethernets&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ens33&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dhcp4&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">optional&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">addresses&lt;/span>: [&lt;span style="color:#ae81ff">192.168.0.6&lt;/span>&lt;span style="color:#ae81ff">/24]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gateway4&lt;/span>: &lt;span style="color:#ae81ff">192.168.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">nameservers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">addresses&lt;/span>: [&lt;span style="color:#ae81ff">192.168.0.1&lt;/span>,&lt;span style="color:#ae81ff">8.8.8.8&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="关闭ipv6">关闭IPV6&lt;/h1>
&lt;p>Ubuntu关闭IPV6&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv6.conf.all.disable_ipv6&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv6.conf.default.disable_ipv6&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv6.conf.lo.disable_ipv6&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051425139.png" alt="image-20231201154102952">&lt;/p>
&lt;h1 id="防火墙">防火墙&lt;/h1>
&lt;h2 id="centos防火墙">Centos防火墙&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl start firewalld
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看状态&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl status firewalld
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 停止&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl disable firewalld
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 禁用&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl stop firewalld
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 开机启动防火墙&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl enable firewalld.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看防火墙是否开机启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl is-enabled firewalld.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 开机时禁用防火墙&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl disable firewalld.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 显示状态&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看所有打开的端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --zone&lt;span style="color:#f92672">=&lt;/span>public --list-ports
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新载入，更新防火墙规则&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看区域信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --get-active-zones
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 拒绝所有包&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --panic-on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 取消拒绝状态&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --panic-off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看是否拒绝&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --query-panic
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 开启80端口，–permanent永久生效，没有此参数重启后失效&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --zone&lt;span style="color:#f92672">=&lt;/span>public --add-port&lt;span style="color:#f92672">=&lt;/span>80/tcp --permanent
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看80端口是否开放&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --zone&lt;span style="color:#f92672">=&lt;/span>public --query-port&lt;span style="color:#f92672">=&lt;/span>80/tcp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除80端口配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>firewall-cmd --zone&lt;span style="color:#f92672">=&lt;/span>public --remove-port&lt;span style="color:#f92672">=&lt;/span>80/tcp --permanent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ubuntu防火墙">Ubuntu防火墙&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 开放端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo ufw allow &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看所有的服务端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -ap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看已经连接的服务端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如查看8888端口，则在终端中输入：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lsof -i:8888
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lsof -i:端口号查看某个端口是否被占用&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netstat -anp|grep &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="转发ip">转发IP&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 在文件中添加或修改以下行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo vim /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.ip_forward&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 激活 IP 转发功能。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 182.160.10.16 目标到目标服务器的ip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将到达端口 80 的流量转发到另一台服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo iptables -t nat -A PREROUTING -p tcp --dport &lt;span style="color:#ae81ff">80&lt;/span> -j DNAT --to-destination 182.160.10.16:80
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置 MASQUERADE 以便正确处理返回的流量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo iptables -t nat -A POSTROUTING -j MASQUERADE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 检查和保存规则&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo iptables -t nat -L -n -v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果您希望这些规则在系统重启后依然有效，您需要安装 iptables-persistent 包：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get install iptables-persistent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="用户和权限">用户和权限&lt;/h1>
&lt;h2 id="用户和用户组">用户和用户组&lt;/h2>
&lt;h3 id="普通用户和非普通用户">普通用户和非普通用户&lt;/h3>
&lt;pre tabindex="0">&lt;code>$ 是普通用户
# 不是普通用户
&lt;/code>&lt;/pre>&lt;h3 id="修改用户名">修改用户名&lt;/h3>
&lt;pre tabindex="0">&lt;code># //-l 新的登陆名称，-d 用户新的主目录， -m将家目录内容移至新位置 (仅于 -d 一起使用)
usermod -l newname -d /home/newname -m oldname
# 修改组
groupmod -n oldname newname
# 重启
reboot
&lt;/code>&lt;/pre>&lt;h3 id="用户组">用户组&lt;/h3>
&lt;pre tabindex="0">&lt;code># 新建用户组
groupadd hr
# 查看用户组
[root@192 ~]# tail -1 /etc/group
hr:x:1001:
# 修改用户组名,sudan新名字,dan就名字
groupmod -n susan dan
# 删除用户组
groupdel hr
&lt;/code>&lt;/pre>&lt;h3 id="用户">用户&lt;/h3>
&lt;pre tabindex="0">&lt;code># 添加用户:useradd hadoop,创建用户未指定任何选项,系统会创建一个同名的用户组
# 添加用户
adduser hadoop
# 删除用户,
# -r 同时也删除这个用户的主目录
userdel -r hadoop
# 修改hadoop用户密码
passwd hadoop
# 修改自己的用户名密码
passwd
# 把用户加入到用户组:
vi /etc/sudoers
# 查看用户
id user01
# 或者
whoami
# 或者
cat /etc/shadow
# 切换用户
su anthony
# 查看用户组信息
[root@192 ~]# tail -2 /etc/passwd
anthony:x:1000:1000:anthony:/home/anthony:/bin/bash
[root@192 ~]# tail /etc/group
anthony:x:1000:anthony
# 修改用户基本组
usermod username -g 组名
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://image.runtimes.cc/202404051521555.png" alt="">&lt;/p>
&lt;h3 id="修改用户基本组和附加组的demo">修改用户基本组和附加组的demo&lt;/h3>
&lt;pre tabindex="0">&lt;code># 创建hadoop用户
[root@192 ~]# useradd hadoop
# 查看hadoop用户,基本组是1002
[root@192 ~]# tail -1 /etc/passwd
hadoop:x:1001:1002::/home/hadoop:/bin/bash
# 查看hadoop基本组信息
[root@192 ~]# tail -1 /etc/group
hadoop:x:1002:
# 创建两个用户组
[root@192 ~]# groupadd hadoop_base
[root@192 ~]# groupadd hadoop_more
# 查看两个用户组
[root@192 ~]# tail -3 /etc/group
hadoop:x:1002:
hadoop_base:x:1003:
hadoop_more:x:1004:
# 修改用户基本组
[root@192 ~]# usermod hadoop -g hadoop_base
[root@192 ~]# tail -3 /etc/group
hadoop:x:1002:
hadoop_base:x:1003:
hadoop_more:x:1004:
# 用户的基本组已经变成1003
[root@192 ~]# tail -3 /etc/passwd
hadoop:x:1001:1003::/home/hadoop:/bin/bash
# 修改用户附加组
[root@192 ~]# usermod hadoop -G hadoop_more
# 用户的附加组已经变成1004
[root@192 ~]# tail -1 /etc/group
hadoop_more:x:1004:hadoop
# 最后查看
# uid 用户名
# gid 基本组id
# 组 包括基本组和附加组
[root@192 ~]# id hadoop
uid=1001(hadoop) gid=1003(hadoop_base) 组=1003(hadoop_base),1004(hadoop_more)
# 从组中删除成员
[root@192 ~]# gpasswd -d hadoop hadoop_base
正在将用户“hadoop”从“hadoop_base”组中删除
gpasswd：用户“hadoop”不是“hadoop_base”的成员
[root@192 ~]# gpasswd -d hadoop hadoop_more
正在将用户“hadoop”从“hadoop_more”组中删除
&lt;/code>&lt;/pre>&lt;h3 id="修改用户权限">修改用户权限&lt;/h3>
&lt;pre tabindex="0">&lt;code>root修改用户权限: vim /etc/sudousers
&lt;/code>&lt;/pre>&lt;h3 id="组信息文件">组信息文件&lt;/h3>
&lt;pre tabindex="0">&lt;code>[root@192 ~]# cat /etc/group
root:x:0:
bin:x:1:
daemon:x:2:
sys:x:3:
adm:x:4:
&lt;/code>&lt;/pre>&lt;p>一共有4列&lt;/p>
&lt;ol>
&lt;li>组名&lt;/li>
&lt;li>组密码&lt;/li>
&lt;li>组ID&lt;/li>
&lt;li>备用的&lt;/li>
&lt;/ol>
&lt;h3 id="用户文件信息">用户文件信息&lt;/h3>
&lt;pre tabindex="0">&lt;code>[root@192 ~]# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>用户名,登录名中不能有冒号&lt;/li>
&lt;li>口令,把真正的加密后的用户口令字存放到/etc/shadow文件中&lt;/li>
&lt;li>用户标识符,取值范围是0-65535。0是超级用户root的标识号，1-99由系统保留，作为管理账号，普通用户的标识号从100开始。在Linux系统中，这个界限是500,&lt;/li>
&lt;li>组标识符,也是基本组&lt;/li>
&lt;li>注释性描述,例如用户的真实姓名、电话、地址等，这个字段并没有什么实际的用途&lt;/li>
&lt;li>主目录&lt;/li>
&lt;li>登录shell,解释器&lt;/li>
&lt;/ol>
&lt;h2 id="权限">权限&lt;/h2>
&lt;pre tabindex="0">&lt;code>[anthony@192 ~]$ touch /tmp/demo.txt
[anthony@192 ~]$ ll /tmp/demo.txt
-rw-rw-r--. 1 anthony anthony 0 1月 11 21:57 /tmp/demo.txt
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>第一位&lt;/li>
&lt;li>代表文件,d代表文件夹&lt;/li>
&lt;li>接下来的三位(rw-),是用户权限&lt;/li>
&lt;li>接下来的三位(rw-),是组权限&lt;/li>
&lt;li>接下来的三位(r&amp;ndash;),是其他人权限&lt;/li>
&lt;li>. 不知道是啥东西&lt;/li>
&lt;li>第二位,连接&lt;/li>
&lt;li>第三位,属主&lt;/li>
&lt;li>第四位,属组&lt;/li>
&lt;li>第五位,大小&lt;/li>
&lt;li>第六位,7位,时间&lt;/li>
&lt;li>第八位,名字&lt;/li>
&lt;/ul>
&lt;h3 id="提升权限">提升权限&lt;/h3>
&lt;pre tabindex="0">&lt;code>[root@192 tmp]# touch fil1.txt
[root@192 tmp]# ll
-rw-r--r--. 1 root root 0 1月 12 21:56 fil1.txt
# 给所有人和用户都设置读写执行的权限
[root@192 tmp]# chmod a=rwx fil1.txt
[root@192 tmp]# ll
-rwxrwxrwx. 1 root root 0 1月 12 21:56 fil1.txt
# 给所有人和用户设置读写权限
[root@192 tmp]# chmod a=rx fil1.txt
[root@192 tmp]# ll
-r-xr-xr-x. 1 root root 0 1月 12 21:56 fil1.txt
# 给属主设置读权限
[root@192 tmp]# chmod u=r fil1.txt
[root@192 tmp]# ll
-r--r-xr-x. 1 root root 0 1月 12 21:56 fil1.txt
# 给组设置读写执行的权限
[root@192 tmp]# chmod g=rwx fil1.txt
[root@192 tmp]# ll
-r--rwxr-x. 1 root root 0 1月 12 21:56 fil1.txt
[root@192 tmp]#
# 给其他人 没有读写执行的权限
[root@192 tmp]# chmod o= fil1.txt
[root@192 tmp]# ll
-r--rwx---. 1 root root 0 1月 12 21:56 fil1.txt
# 给属主单独设置一个写的权限
[root@192 tmp]# chmod u+w fil1.txt
[root@192 tmp]# ll
总用量 0
-rw-rwx---. 1 root root 0 1月 12 21:56 fil1.txt
# 修改文件的属主和组权限
[root@192 tmp]# chown hadoop.hr fil1.txt
[root@192 tmp]# ll
总用量 0
-rw-rwx---. 1 hadoop hr 0 1月 12 21:56 fil1.txt
# 查看acl权限
[root@192 tmp]# getfacl acldemo.txt
# file: acldemo.txt
# owner: root
# group: root
user::rw-
group::r--
other::r--
# 当对一个文件或者文件夹需要设置3个以上的权限用户,和权限用户组,上面的那种方法就不够用了
# 需要引入 acl权限
# setfacl -m 对象:对象名:权限 文件名
# ll之后就会先是+号
setfacl -m g:hr:rw /tmp/acldemo.txt
[root@192 tmp]# ll
-rw-rw-r--+ 1 root root 0 1月 12 22:19 acldemo.txt
&lt;/code>&lt;/pre>&lt;h1 id="磁盘">磁盘&lt;/h1>
&lt;h2 id="管理磁盘的三个步骤">管理磁盘的三个步骤&lt;/h2>
&lt;p>先分区,再格式化,再挂载
&lt;img src="https://image.runtimes.cc/202404051425657.png" alt="">&lt;/p>
&lt;p>MBR一共只能有4个分区,如果要需要很多个分区
&lt;img src="https://image.runtimes.cc/202404051425931.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051521648.png" alt="">&lt;/p>
&lt;h2 id="新建主分区和逻辑分区">新建主分区和逻辑分区&lt;/h2>
&lt;pre tabindex="0">&lt;code>[root@192 ~]# lsblk
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda 8:0 0 20G 0 disk
├─sda1 8:1 0 1G 0 part /boot
└─sda2 8:2 0 19G 0 part
├─centos-root 253:0 0 17G 0 lvm /
└─centos-swap 253:1 0 2G 0 lvm [SWAP]
sdb 8:16 0 5G 0 disk
sdc 8:32 0 5G 0 disk
sdd 8:48 0 5G 0 disk
sde 8:64 0 5G 0 disk
sdf 8:80 0 5G 0 disk
sdg 8:96 0 5G 0 disk
sdh 8:112 0 5G 0 disk
sdi 8:128 0 5G 0 disk
sr0 11:0 1 4.4G 0 rom
# 启动分区工具
[root@192 ~]# fdisk /dev/sdb
欢迎使用 fdisk (util-linux 2.23.2)。
更改将停留在内存中，直到您决定将更改写入磁盘。
使用写入命令前请三思。
Device does not contain a recognized partition table
使用磁盘标识符 0xda85d71c 创建新的 DOS 磁盘标签。
命令(输入 m 获取帮助)：n
Partition type:
p primary (0 primary, 0 extended, 4 free)
e extended
Select (default p): p
分区号 (1-4，默认 1)：
起始 扇区 (2048-10485759，默认为 2048)：+2G
Last 扇区, +扇区 or +size{K,M,G} (4194304-10485759，默认为 10485759)：
将使用默认值 10485759
分区 1 已设置为 Linux 类型，大小设为 3 GiB
命令(输入 m 获取帮助)：w
The partition table has been altered!
Calling ioctl() to re-read partition table.
正在同步磁盘。
# 刷新分区
[root@192 ~]# partprobe /dev/sdb
# 查看分区结果
[root@192 ~]# fdisk -l /dev/sdb
磁盘 /dev/sdb：5368 MB, 5368709120 字节，10485760 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0xda85d71c
设备 Boot Start End Blocks Id System
/dev/sdb1 4194304 10485759 3145728 83 Linux
# 格式化(创建文件系统)
# ext4 扩展文件系统第四代,是文件系统的类型
[root@192 ~]# mkfs.ext4 /dev/sdb1
mke2fs 1.42.9 (28-Dec-2013)
文件系统标签=
OS type: Linux
块大小=4096 (log=2)
分块大小=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
196608 inodes, 786432 blocks
39321 blocks (5.00%) reserved for the super user
第一个数据块=0
Maximum filesystem blocks=805306368
24 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912
Allocating group tables: 完成
正在写入inode表: 完成
Creating journal (16384 blocks): 完成
Writing superblocks and filesystem accounting information: 完成
# 手动挂载
[root@192 ~]# mkdir /mnt/disk1
[root@192 mnt]# mount -t ext4 /dev/sdb1 /mnt/disk1/
# 查看
[root@192 mnt]# df -hT
文件系统 类型 容量 已用 可用 已用% 挂载点
devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev
tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs tmpfs 1.9G 13M 1.9G 1% /run
tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root xfs 17G 4.4G 13G 26% /
/dev/sda1 xfs 1014M 239M 776M 24% /boot
tmpfs tmpfs 378M 12K 378M 1% /run/user/42
tmpfs tmpfs 378M 0 378M 0% /run/user/0
# 刚挂载的
/dev/sdb1 ext4 2.9G 9.0M 2.8G 1% /mnt/disk1
&lt;/code>&lt;/pre>&lt;h2 id="新建swap">新建SWAP&lt;/h2>
&lt;pre tabindex="0">&lt;code>[root@localhost ~]# lsblk
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda 8:0 0 20G 0 disk
├─sda1 8:1 0 1G 0 part /boot
└─sda2 8:2 0 19G 0 part
├─centos-root 253:0 0 17G 0 lvm /
└─centos-swap 253:1 0 2G 0 lvm [SWAP]
sdb 8:16 0 5G 0 disk
└─sdb1 8:17 0 3G 0 part /mnt/disk1
sdc 8:32 0 5G 0 disk
sdd 8:48 0 5G 0 disk
sde 8:64 0 5G 0 disk
sdf 8:80 0 5G 0 disk
sdg 8:96 0 5G 0 disk
sdh 8:112 0 5G 0 disk
sdi 8:128 0 5G 0 disk
sr0 11:0 1 4.4G 0 rom /run/media/anthony/CentOS 7 x86_64
[root@localhost ~]# fdisk /dev/sdb
欢迎使用 fdisk (util-linux 2.23.2)。
更改将停留在内存中，直到您决定将更改写入磁盘。
使用写入命令前请三思。
命令(输入 m 获取帮助)：n
Partition type:
p primary (2 primary, 0 extended, 2 free)
e extended
Select (default p): p
分区号 (3,4，默认 3)：
No free sectors available
命令(输入 m 获取帮助)：q
[root@localhost ~]# fdisk /dev/sdc
欢迎使用 fdisk (util-linux 2.23.2)。
更改将停留在内存中，直到您决定将更改写入磁盘。
使用写入命令前请三思。
Device does not contain a recognized partition table
使用磁盘标识符 0x661ba46a 创建新的 DOS 磁盘标签。
命令(输入 m 获取帮助)：n
Partition type:
p primary (0 primary, 0 extended, 4 free)
e extended
Select (default p): p
分区号 (1-4，默认 1)：
起始 扇区 (2048-10485759，默认为 2048)：
将使用默认值 2048
Last 扇区, +扇区 or +size{K,M,G} (2048-10485759，默认为 10485759)：
将使用默认值 10485759
分区 1 已设置为 Linux 类型，大小设为 5 GiB
命令(输入 m 获取帮助)：p
磁盘 /dev/sdc：5368 MB, 5368709120 字节，10485760 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0x661ba46a
设备 Boot Start End Blocks Id System
/dev/sdc1 2048 10485759 5241856 83 Linux
命令(输入 m 获取帮助)：w
The partition table has been altered!
Calling ioctl() to re-read partition table.
正在同步磁盘。
[root@localhost ~]# partprobe /dev/sdc
[root@localhost ~]# fdisk -l /dev/sdb
磁盘 /dev/sdb：5368 MB, 5368709120 字节，10485760 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0xda85d71c
设备 Boot Start End Blocks Id System
/dev/sdb1 4194304 10485759 3145728 83 Linux
/dev/sdb2 2048 4194303 2096128 83 Linux
Partition table entries are not in disk order
[root@localhost ~]# mkswap /dev/sdb2
/dev/sdb2: 没有那个文件或目录
[root@localhost ~]# mkswap /dev/sdc2
/dev/sdc2: 没有那个文件或目录
[root@localhost ~]# fdisk -l /dev/sdc
磁盘 /dev/sdc：5368 MB, 5368709120 字节，10485760 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0x661ba46a
设备 Boot Start End Blocks Id System
/dev/sdc1 2048 10485759 5241856 83 Linux
[root@localhost ~]# mkswap /dev/sdc1
anaconda-ks.cfg .bashrc .dbus/ .local/ 模板/ 下载/
.bash_history .cache/ .esd_auth .tcshrc 视频/ 音乐/
.bash_logout .config/ .ICEauthority .viminfo 图片/ 桌面/
.bash_profile .cshrc initial-setup-ks.cfg 公共/ 文档/
[root@localhost ~]# mkswap /dev/sdc1
正在设置交换空间版本 1，大小 = 5241852 KiB
无标签，UUID=074198c5-dff9-4834-9fbb-06cee839372d
[root@localhost ~]# df -hT
文件系统 类型 容量 已用 可用 已用% 挂载点
devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev
tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs tmpfs 1.9G 13M 1.9G 1% /run
tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root xfs 17G 4.4G 13G 26% /
/dev/sda1 xfs 1014M 239M 776M 24% /boot
/dev/sdb1 ext4 2.9G 9.0M 2.8G 1% /mnt/disk1
tmpfs tmpfs 378M 32K 378M 1% /run/user/1000
/dev/sr0 iso9660 4.4G 4.4G 0 100% /run/media/anthony/CentOS 7 x86_64
tmpfs tmpfs 378M 0 378M 0% /run/user/0
[root@localhost ~]# lsblk
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda 8:0 0 20G 0 disk
├─sda1 8:1 0 1G 0 part /boot
└─sda2 8:2 0 19G 0 part
├─centos-root 253:0 0 17G 0 lvm /
└─centos-swap 253:1 0 2G 0 lvm [SWAP]
sdb 8:16 0 5G 0 disk
└─sdb1 8:17 0 3G 0 part /mnt/disk1
sdc 8:32 0 5G 0 disk
└─sdc1 8:33 0 5G 0 part
sdd 8:48 0 5G 0 disk
sde 8:64 0 5G 0 disk
sdf 8:80 0 5G 0 disk
sdg 8:96 0 5G 0 disk
sdh 8:112 0 5G 0 disk
sdi 8:128 0 5G 0 disk
sr0 11:0 1 4.4G 0 rom /run/media/anthony/CentOS 7 x86_64
[root@localhost ~]# free -m
total used free shared buff/cache available
Mem: 3770 919 2208 26 642 2586
Swap: 2047 0 2047
[root@localhost ~]# swapon /dev/sdc1
[root@localhost ~]# free -m
total used free shared buff/cache available
Mem: 3770 925 2201 26 642 2579
Swap: 7166 0 7166
&lt;/code>&lt;/pre>&lt;h2 id="禁用swap">禁用swap&lt;/h2>
&lt;pre tabindex="0">&lt;code>一、不重启电脑，禁用启用swap，立刻生效
# 禁用命令
sudo swapoff -a
# 启用命令
sudo swapon -a
# 查看交换分区的状态
sudo free -m
&lt;/code>&lt;/pre>&lt;h2 id="创建lvm">创建LVM&lt;/h2>
&lt;p>无限制的扩张容量&lt;/p>
&lt;pre tabindex="0">&lt;code>[root@192 ~]# lsblk
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda 8:0 0 20G 0 disk
├─sda1 8:1 0 1G 0 part /boot
└─sda2 8:2 0 19G 0 part
├─centos-root 253:0 0 17G 0 lvm /
└─centos-swap 253:1 0 2G 0 lvm [SWAP]
sdb 8:16 0 5G 0 disk
├─sdb1 8:17 0 3G 0 part
└─sdb2 8:18 0 2G 0 part
sdc 8:32 0 5G 0 disk
└─sdc1 8:33 0 5G 0 part
# 一会要操作的是这个盘
sdd 8:48 0 5G 0 disk
sde 8:64 0 5G 0 disk
# 一会要操作的是这个盘
sdf 8:80 0 5G 0 disk
sdg 8:96 0 5G 0 disk
sdh 8:112 0 5G 0 disk
sdi 8:128 0 5G 0 disk
# 物理磁盘转成物理卷
[root@192 ~]# pvcreate /dev/sdd
Physical volume &amp;#34;/dev/sdd&amp;#34; successfully created.
# 创建数据卷组
[root@192 ~]# vgcreate vg1 /dev/sdd
Volume group &amp;#34;vg1&amp;#34; successfully created
# 创建逻辑卷
# lvcreate
# -L 4g,要用磁盘的4G
# -n lv1 卷的名字,自定义
# vg1 卷组名,要把4G,加入到哪个卷组
[root@192 ~]# lvcreate -L 4G -n lv1 vg1
Logical volume &amp;#34;lv1&amp;#34; created.
# 格式化
# 这里要用/dev/卷组名/逻辑卷的名字
[root@192 ~]# mkfs.ext4 /dev/vg1/lv1
mke2fs 1.42.9 (28-Dec-2013)
文件系统标签=
OS type: Linux
块大小=4096 (log=2)
分块大小=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
262144 inodes, 1048576 blocks
52428 blocks (5.00%) reserved for the super user
第一个数据块=0
Maximum filesystem blocks=1073741824
32 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736
Allocating group tables: 完成
正在写入inode表: 完成
Creating journal (32768 blocks): 完成
Writing superblocks and filesystem accounting information: 完成
# 挂载,这里要用/dev/卷组名/逻辑卷的名字
[root@192 ~]# mkdir /mnt/lv1
[root@192 ~]# mount /dev/vg1/lv1 /mnt/lv1
[root@192 ~]# df -hT
文件系统 类型 容量 已用 可用 已用% 挂载点
devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev
tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs tmpfs 1.9G 13M 1.9G 1% /run
tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root xfs 17G 4.4G 13G 26% /
/dev/sda1 xfs 1014M 239M 776M 24% /boot
tmpfs tmpfs 378M 28K 378M 1% /run/user/1000
/dev/sr0 iso9660 4.4G 4.4G 0 100% /run/media/anthony/CentOS 7 x86_64
# 这里就有4个G的可用空间
/dev/mapper/vg1-lv1 ext4 3.9G 16M 3.6G 1% /mnt/lv1
# 把sdf物理磁盘转成物理卷
[root@192 ~]# pvcreate /dev/sdf
Physical volume &amp;#34;/dev/sdf&amp;#34; successfully created.
[root@192 ~]# vgextend vg1 /dev/sdf
Volume group &amp;#34;vg1&amp;#34; successfully extended
# 扩容lv
[root@192 ~]# lvextend -L +4G /dev/vg1/lv1
Size of logical volume vg1/lv1 changed from 4.00 GiB (1024 extents) to 8.00 GiB (2048 extents).
Logical volume vg1/lv1 successfully resized.
# 刷新
[root@192 ~]# resize2fs /dev/vg1/lv1
resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/vg1/lv1 is mounted on /mnt/lv1; on-line resizing required
old_desc_blocks = 1, new_desc_blocks = 1
The filesystem on /dev/vg1/lv1 is now 2097152 blocks long.
# 再次查看
[root@192 ~]# df -hT
文件系统 类型 容量 已用 可用 已用% 挂载点
devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev
tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs tmpfs 1.9G 13M 1.9G 1% /run
tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root xfs 17G 4.4G 13G 26% /
/dev/sda1 xfs 1014M 239M 776M 24% /boot
tmpfs tmpfs 378M 28K 378M 1% /run/user/1000
# 这里就有8个G的可用空间
/dev/mapper/vg1-lv1 ext4 7.8G 18M 7.4G 1% /mnt/lv1
[root@192 ~]# pvs
PV VG Fmt Attr PSize PFree
/dev/sda2 centos lvm2 a-- &amp;lt;19.00g 0
/dev/sdd vg1 lvm2 a-- &amp;lt;5.00g 0
/dev/sdf vg1 lvm2 a-- &amp;lt;5.00g 1.99g
[root@192 ~]# vgs
VG #PV #LV #SN Attr VSize VFree
centos 1 2 0 wz--n- &amp;lt;19.00g 0
vg1 2 1 0 wz--n- 9.99g 1.99g
&lt;/code>&lt;/pre>&lt;h1 id="yum">yum&lt;/h1>
&lt;p>yum的所有文件都在&lt;code>/etc/yum.repos.d&lt;/code>下&lt;/p>
&lt;h2 id="yum挂载光盘源">yum挂载光盘源&lt;/h2>
&lt;p>新建一个xxx.repo的文件&lt;/p>
&lt;pre tabindex="0">&lt;code>[root@192 yum.repos.d]# cat ./dvd.repo
[dvd]
name=this is descreption
baseurl=file:///mnt/cdrom
gpgcheck=0
&lt;/code>&lt;/pre>&lt;p>挂载光盘&lt;/p>
&lt;pre tabindex="0">&lt;code>[root@192 yum.repos.d]# df -hT
文件系统 类型 容量 已用 可用 已用% 挂载点
devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev
tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs tmpfs 1.9G 13M 1.9G 1% /run
tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root xfs 17G 4.4G 13G 26% /
/dev/sda1 xfs 1014M 239M 776M 24% /boot
tmpfs tmpfs 378M 32K 378M 1% /run/user/1000
/dev/mapper/vg1-lv1 ext4 7.8G 18M 7.4G 1% /mnt/lv1
/dev/sr0 iso9660 4.4G 4.4G 0 100%
# 挂载
mount /dev/sr0 /mnt/cdrom
# 查看光盘你的包
ls /mnt/cdrom/Packages/
# 安装软件
yum -y instal httpd
# 安装rpm包
rpm -ivh xxx.rpm
&lt;/code>&lt;/pre></content></item><item><title>Git</title><link>/posts/git/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>/posts/git/</guid><description>&lt;h1 id="分支管理">分支管理&lt;/h1>
&lt;h2 id="切一个新的本地分支">切一个新的本地分支&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先切换到需要复制的分支,比如想从prod分支,切一个新的分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout prod &lt;span style="color:#75715e"># 先到prod分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout -b prod-fix &lt;span style="color:#75715e"># 从prod分支拷贝一个新的分支叫prod-fix&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2>&lt;/h2>
&lt;h1 id="用命令pull-request代码">用命令pull request代码&lt;/h1>
&lt;pre tabindex="0">&lt;code># 把本地的代码切换到master
git checkout -b theme-next-master master
# https://github.com/theme-next/hexo-theme-next.git 是要合并的代码
git pull https://github.com/theme-next/hexo-theme-next.git master
&lt;/code>&lt;/pre>&lt;h1 id="git-key">Git Key&lt;/h1>
&lt;pre tabindex="0">&lt;code>cd ~/.ssh
ssh-keygen
cat ~/.ssh/id_rsa.pub
&lt;/code>&lt;/pre>&lt;h1 id="git-bash启动慢">Git Bash启动慢&lt;/h1>
&lt;pre tabindex="0">&lt;code>git config --global core.preloadindex true
git config --global core.fscache true
git config --global gc.auto 256
&lt;/code>&lt;/pre>&lt;h1 id="推送到远程">推送到远程&lt;/h1>
&lt;pre tabindex="0">&lt;code>git init
git add README.md
git commit -m &amp;#34;first commit&amp;#34;
git remote add origin git@github.com:YangAnLin/bbs.git
git push -u origin master
&lt;/code>&lt;/pre>&lt;h1 id="创建新的分支推送到远程">创建新的分支推送到远程&lt;/h1>
&lt;ol>
&lt;li>先创建本地分支&lt;code>git checkout -b &amp;lt;branch-name&amp;gt;&lt;/code>&lt;/li>
&lt;li>本地分支推送到远程服务器时，远程分支自动创建，推送本地分支到远程&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>git push --set-upstream &amp;lt;remote-name&amp;gt; &amp;lt;local-branch-name&amp;gt;:&amp;lt;remote-branch-name&amp;gt;
&amp;lt;remote-name&amp;gt;：远程git服务器名称，一般设为origin
&amp;lt;local-branch-name&amp;gt;：本地分支名称
&amp;lt;remote-branch-name&amp;gt;：远程分支名称
最后的结果是: git push --set-upstream origin prerelease:prerelease
prerelease是分支的名字
也可以这样操作:本地有个master_anthony,服务器中没有这个分支,
git push -u origin master_anthony
这个命令,就是把master_anthony分支的代码,提交到远程,还要在远程创建这个分支
&lt;/code>&lt;/pre>&lt;h1 id="删除远程仓库文件">删除远程仓库文件&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加上 -n 这个参数，执行命令时，是不会删除任何文件，而是展示此命令要删除的文件列表预览。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git rm -r -n --cached 文件/文件夹名称
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git rm -r --cached 文件/文件夹名称
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git commit -m &lt;span style="color:#e6db74">&amp;#34;提交说明&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git push
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="撤销修改">撤销修改&lt;/h1>
&lt;pre tabindex="0">&lt;code># 工作区修改过了,恢复工作区
git checkout -- file
# 已经commit了,但是还没有push
git reset --soft HEAD^
# 现在就已经把暂存区恢复到工作了
&lt;/code>&lt;/pre>&lt;h1 id="版本回退reset">版本回退reset&lt;/h1>
&lt;p>reset用于回退版本，可以遗弃不再使用的提交&lt;/p></description><content>&lt;h1 id="分支管理">分支管理&lt;/h1>
&lt;h2 id="切一个新的本地分支">切一个新的本地分支&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先切换到需要复制的分支,比如想从prod分支,切一个新的分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout prod &lt;span style="color:#75715e"># 先到prod分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout -b prod-fix &lt;span style="color:#75715e"># 从prod分支拷贝一个新的分支叫prod-fix&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2>&lt;/h2>
&lt;h1 id="用命令pull-request代码">用命令pull request代码&lt;/h1>
&lt;pre tabindex="0">&lt;code># 把本地的代码切换到master
git checkout -b theme-next-master master
# https://github.com/theme-next/hexo-theme-next.git 是要合并的代码
git pull https://github.com/theme-next/hexo-theme-next.git master
&lt;/code>&lt;/pre>&lt;h1 id="git-key">Git Key&lt;/h1>
&lt;pre tabindex="0">&lt;code>cd ~/.ssh
ssh-keygen
cat ~/.ssh/id_rsa.pub
&lt;/code>&lt;/pre>&lt;h1 id="git-bash启动慢">Git Bash启动慢&lt;/h1>
&lt;pre tabindex="0">&lt;code>git config --global core.preloadindex true
git config --global core.fscache true
git config --global gc.auto 256
&lt;/code>&lt;/pre>&lt;h1 id="推送到远程">推送到远程&lt;/h1>
&lt;pre tabindex="0">&lt;code>git init
git add README.md
git commit -m &amp;#34;first commit&amp;#34;
git remote add origin git@github.com:YangAnLin/bbs.git
git push -u origin master
&lt;/code>&lt;/pre>&lt;h1 id="创建新的分支推送到远程">创建新的分支推送到远程&lt;/h1>
&lt;ol>
&lt;li>先创建本地分支&lt;code>git checkout -b &amp;lt;branch-name&amp;gt;&lt;/code>&lt;/li>
&lt;li>本地分支推送到远程服务器时，远程分支自动创建，推送本地分支到远程&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>git push --set-upstream &amp;lt;remote-name&amp;gt; &amp;lt;local-branch-name&amp;gt;:&amp;lt;remote-branch-name&amp;gt;
&amp;lt;remote-name&amp;gt;：远程git服务器名称，一般设为origin
&amp;lt;local-branch-name&amp;gt;：本地分支名称
&amp;lt;remote-branch-name&amp;gt;：远程分支名称
最后的结果是: git push --set-upstream origin prerelease:prerelease
prerelease是分支的名字
也可以这样操作:本地有个master_anthony,服务器中没有这个分支,
git push -u origin master_anthony
这个命令,就是把master_anthony分支的代码,提交到远程,还要在远程创建这个分支
&lt;/code>&lt;/pre>&lt;h1 id="删除远程仓库文件">删除远程仓库文件&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加上 -n 这个参数，执行命令时，是不会删除任何文件，而是展示此命令要删除的文件列表预览。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git rm -r -n --cached 文件/文件夹名称
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git rm -r --cached 文件/文件夹名称
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git commit -m &lt;span style="color:#e6db74">&amp;#34;提交说明&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git push
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="撤销修改">撤销修改&lt;/h1>
&lt;pre tabindex="0">&lt;code># 工作区修改过了,恢复工作区
git checkout -- file
# 已经commit了,但是还没有push
git reset --soft HEAD^
# 现在就已经把暂存区恢复到工作了
&lt;/code>&lt;/pre>&lt;h1 id="版本回退reset">版本回退reset&lt;/h1>
&lt;p>reset用于回退版本，可以遗弃不再使用的提交&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-prolog" data-lang="prolog">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">#&lt;/span> &lt;span style="color:#e6db74">查看日志提交log&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> &lt;span style="color:#e6db74">git&lt;/span> &lt;span style="color:#e6db74">log&lt;/span> &lt;span style="color:#e6db74">--pretty&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">oneline&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">c27561bbe42dc1ae1b08442ce0d8100d4e02a689&lt;/span> (HEAD &lt;span style="color:#e6db74">-&amp;gt;&lt;/span> &lt;span style="color:#e6db74">master&lt;/span>) &lt;span style="color:#e6db74">stage&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">fd6bc87438d26b24c93441b82c8840a9ad47e32&lt;/span> &lt;span style="color:#e6db74">test_3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#e6db74">f444c9de0b3c2d1cddb8f17becca7ce774a7c7&lt;/span> &lt;span style="color:#e6db74">test_2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2502&lt;/span>&lt;span style="color:#e6db74">c400cab4d7cb48ed3e4200577f428904da9b&lt;/span> &lt;span style="color:#e6db74">test_1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">26&lt;/span>&lt;span style="color:#e6db74">d73f758411c3656b7fa243d77837943a6c782c&lt;/span> &lt;span style="color:#ae81ff">321321&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#e6db74">fa733378d5eb187d1d46bf2d2395e6c67867a8d&lt;/span> &lt;span style="color:#e6db74">测试&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">e9fa63e3bafc275e99cc88b40cc68bde6933323c&lt;/span> &lt;span style="color:#ae81ff">123&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#e6db74">d338b67e2b57dcd6887099cb3977f5d96b3cbb5&lt;/span> &lt;span style="color:#e6db74">第一次提交&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">#&lt;/span> &lt;span style="color:#e6db74">远程地址回退版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">#&lt;/span> &lt;span style="color:#e6db74">先让本地回退到指定版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">git&lt;/span> &lt;span style="color:#e6db74">reset&lt;/span> &lt;span style="color:#e6db74">--hard&lt;/span> HEAD&lt;span style="color:#e6db74">^&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">#&lt;/span>&lt;span style="color:#a6e22e">再推送到远程&lt;/span>(&lt;span style="color:#e6db74">这样也会把别人提交的给弄消息了&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">git&lt;/span> &lt;span style="color:#e6db74">push&lt;/span> &lt;span style="color:#e6db74">--force&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">#&lt;/span> &lt;span style="color:#e6db74">操作记录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> &lt;span style="color:#e6db74">git&lt;/span> &lt;span style="color:#e6db74">reflog&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">c27561b&lt;/span> (HEAD &lt;span style="color:#e6db74">-&amp;gt;&lt;/span> &lt;span style="color:#e6db74">master&lt;/span>) HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">0&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#e6db74">stage&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">fd6bc8&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">1&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> reset: &lt;span style="color:#e6db74">moving&lt;/span> &lt;span style="color:#e6db74">to&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">fd6bc8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#e6db74">f444c&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">2&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> reset: &lt;span style="color:#e6db74">moving&lt;/span> &lt;span style="color:#e6db74">to&lt;/span> HEAD&lt;span style="color:#e6db74">^&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">fd6bc8&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">3&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#e6db74">test_3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#e6db74">f444c&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">4&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#e6db74">test_2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2502&lt;/span>&lt;span style="color:#e6db74">c40&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">5&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#e6db74">test_1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">26&lt;/span>&lt;span style="color:#e6db74">d73f7&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">6&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#ae81ff">321321&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#e6db74">fa7333&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">7&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#e6db74">测试&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">e9fa63e&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">8&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> commit: &lt;span style="color:#ae81ff">123&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#e6db74">d338b6&lt;/span> HEAD&lt;span style="color:#e6db74">@&lt;/span>{&lt;span style="color:#ae81ff">9&lt;/span>}&lt;span style="color:#e6db74">:&lt;/span> &lt;span style="color:#a6e22e">commit&lt;/span> (&lt;span style="color:#e6db74">initial&lt;/span>)&lt;span style="color:#e6db74">:&lt;/span> &lt;span style="color:#e6db74">第一次提交&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="版本回退revert">版本回退revert&lt;/h1>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051416064.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">git reset &amp;lt;ID&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">git push&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>📌 操作同一个文件的时候,容易冲突&lt;/p>
&lt;h1 id="分支管理-1">分支管理&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Shell" data-lang="Shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看提交历史&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --graph --pretty&lt;span style="color:#f92672">=&lt;/span>oneline
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除本地分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git branch -d localBranchName
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除远程分支&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git push origin --delete remoteBranchName
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置全局默认的分支名字&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git config --global init.defaultBranch &amp;lt;名称&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改分支名字&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git branch -m &amp;lt;name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="tag管理">TAG管理&lt;/h1>
&lt;p>查看本地所有的tag&lt;/p>
&lt;pre tabindex="0">&lt;code>git tag
&lt;/code>&lt;/pre>&lt;p>新建tag&lt;/p>
&lt;pre tabindex="0">&lt;code># 在本地创建一个tag
git tag v2.0
# 把本地所有tag推送到远程
git push --tags
# 把指定的tag推送到远程
git push origin [tagname]
&lt;/code>&lt;/pre>&lt;h1 id="git子模块">Git子模块&lt;/h1>
&lt;h2 id="克隆项目指定分支">克隆项目指定分支&lt;/h2>
&lt;pre tabindex="0">&lt;code>git clone -b prod https://git.oschina.net/oschina/android-app.git
&lt;/code>&lt;/pre>&lt;h2 id="克隆项目">克隆项目&lt;/h2>
&lt;p>第一种方式:&lt;/p>
&lt;pre tabindex="0">&lt;code>先clone父项目
git clone sum.git
再初始化子项目
git submodule init
git submodule foreach git pull
再更新子项目
git submodule update
&lt;/code>&lt;/pre>&lt;p>第二中方法&lt;/p>
&lt;pre tabindex="0">&lt;code># 克隆完整的项目
git clone git@github.com:jjz/pod-project.git --recursive
&lt;/code>&lt;/pre>&lt;h2 id="添加项目">添加项目&lt;/h2>
&lt;pre tabindex="0">&lt;code>git submodule add module1.git
&lt;/code>&lt;/pre>&lt;h1 id="rebase">Rebase&lt;/h1>
&lt;pre tabindex="0">&lt;code># 进入编辑模式
git rebase -i N
&lt;/code>&lt;/pre>&lt;p>这些 commit 自旧到新由上而下排列&lt;/p>
&lt;p>在合并 commit 这个需求里，我们可以选择 pick(p) 最旧的 commit1，然后在后续的 commit_id 前添加 squash(s) 命令，将这些 commits 都合并到最旧的 commit1 上。&lt;/p>
&lt;p>保存 rebase 结果后，再编辑 commit 信息，使这次 rebase 失效，git 会将之前的这些 commit 都删除，并将其更改合并为一个新的 commit5&lt;/p>
&lt;p>提交的过程中,可能需要加 &lt;code>-f&lt;/code> 强制推送&lt;/p>
&lt;p>操作过程中,遇到出错,使用&lt;/p>
&lt;pre tabindex="0">&lt;code>git rebase --abort/--continue/--edit-todo
&lt;/code>&lt;/pre>&lt;h1 id="要注意的">要注意的&lt;/h1>
&lt;ul>
&lt;li>进入到子项目的目录中,默认的分支并不是master,需要手动切换到master&lt;/li>
&lt;li>删除子模块的,没有这样的功能,需要手动修改&lt;code>.gitmodules&lt;/code>文件&lt;/li>
&lt;li>添加了新的子模块之后,&lt;code>.gitmodules&lt;/code>就会被创建或者是修改,这个文件需要推送到远程仓库&lt;/li>
&lt;/ul>
&lt;h1 id="储藏">储藏&lt;/h1>
&lt;p>比如在当前分支正在开发,突然来了一个bug,但是当前写的代码又不能提交,需要先储藏起来&lt;/p>
&lt;pre tabindex="0">&lt;code> git stash
&lt;/code>&lt;/pre>&lt;p>等bug改好,再回来&lt;/p>
&lt;pre tabindex="0">&lt;code>git stash pop
&lt;/code>&lt;/pre>&lt;h1 id="升级">升级&lt;/h1>
&lt;p>window&lt;/p>
&lt;pre tabindex="0">&lt;code>git update-git-for-windows
&lt;/code>&lt;/pre>&lt;h1 id="github更新fork别人的项目">Github更新fork别人的项目&lt;/h1>
&lt;p>1.打开自己的仓库，进入code下面&lt;/p>
&lt;p>2.点击new pull request创建
&lt;img src="https://image.runtimes.cc/202404051418900.png" alt="">&lt;/p>
&lt;h1 id="终端配置github-person-token">终端配置github person token&lt;/h1>
&lt;p>应用场景 Github Personal Access Token in Jenkins&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 在命令行中的用户主目录创建如下文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vi .git-credentials
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 写入如下内容，请注意将 {username}, {password} 替换成自己的 github 用户名和 token&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://&lt;span style="color:#f92672">{&lt;/span>username&lt;span style="color:#f92672">}&lt;/span>:&lt;span style="color:#f92672">{&lt;/span>password&lt;span style="color:#f92672">}&lt;/span>@github.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 退出保存,执行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git config --global credential.helper store
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="sourcetree">SourceTree&lt;/h1>
&lt;h2 id="各种状态">各种状态&lt;/h2>
&lt;p>1.添加文件或者修改文件
uncommitted changes 这次是添加了&lt;code>f.txt&lt;/code>文件
&lt;img src="https://image.runtimes.cc/202404051418039.png" alt="未提交">&lt;/p>
&lt;p>2.add的状态
&lt;img src="https://image.runtimes.cc/202404051418540.png" alt="add">&lt;/p>
&lt;p>3.提交的状态
这里&lt;code>超前一个版本&lt;/code>,是相对远程
&lt;img src="https://image.runtimes.cc/202404051418125.png" alt="提交">&lt;/p>
&lt;p>4.推送完的状态
&lt;img src="https://image.runtimes.cc/202404051418448.png" alt="提交">&lt;/p>
&lt;h2 id="rebase分支">rebase分支&lt;/h2>
&lt;p>1.这里的分割线的这次提交是用来分区之前的测试,表示新的测试,测试rebase分支,相当于原始的样子
&lt;img src="https://image.runtimes.cc/202404051418043.png" alt="原始状态">&lt;/p>
&lt;p>2.如果现在想要开发一个新的功能
先在远程的main分支上右键,检出一个自己的分支&lt;code>dev&lt;/code>
&lt;img src="https://image.runtimes.cc/202404051419575.png" alt="">
&lt;img src="https://image.runtimes.cc/202404051518534.png" alt="">
&lt;img src="https://image.runtimes.cc/202404051419385.png" alt="">&lt;/p>
&lt;p>3.在dev分支上新建/或者编辑文件,我这里创建的一个文件,叫&lt;code>dev分支创建的文件.txt&lt;/code>,然后提交到本地,&lt;code>不要推送&lt;/code>
&lt;img src="https://image.runtimes.cc/202404051419086.png" alt="">
这里的&lt;code>超前1个版本&lt;/code>,是相对于&lt;code>origin/main&lt;/code>来说的&lt;/p>
&lt;p>4.再切换到main分支&lt;/p>
&lt;ol>
&lt;li>
&lt;p>我这里创建了一个文件,叫&lt;code>master分支创建的文件.txt&lt;/code>,提交并且推送到远程
(这个操作相当于,你在dev分支 开发自己的功能,然后有别的同事提交了新的代码提交到&lt;code>main&lt;/code>分支)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pull main分支的代码&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>5.再切换的dev分支,选中main分支,右键,选择将当前变更变基到main
&lt;img src="https://image.runtimes.cc/202404051420630.png" alt="">&lt;/p>
&lt;p>这里的:&lt;/p>
&lt;ul>
&lt;li>超前1个版本: 相当于本地的dev分支来说&lt;/li>
&lt;li>落后一个版本: 相对于远程分支来说&lt;/li>
&lt;/ul>
&lt;p>如果有冲突则合并冲突，点击左上角(中间位置)的提交，选择继续变基&lt;/p>
&lt;ul>
&lt;li>1.第三步 的操作,已经提交到本地了&lt;/li>
&lt;li>2.如果这里解决冲突,就相当于,有编辑了一次文件&lt;/li>
&lt;li>3.再把编辑的提交一次到本地&lt;/li>
&lt;/ul>
&lt;p>6.此时我们的本地更新是基于最新的 main 分支
&lt;img src="https://image.runtimes.cc/202404051420367.png" alt="">
点击推送,把dev分支,推送到远程
&lt;img src="https://image.runtimes.cc/202404051420877.png" alt="">&lt;/p>
&lt;p>7.切换到main分支,点拉取,拉取dev分支到main分支
&lt;img src="https://image.runtimes.cc/202404051420776.png" alt="">
&lt;img src="https://image.runtimes.cc/202404051420936.png" alt="">&lt;/p>
&lt;p>再推送main
&lt;img src="https://image.runtimes.cc/202404051420518.png" alt="">
&lt;img src="https://image.runtimes.cc/202404051420688.png" alt="">&lt;/p></content></item><item><title>Grafana</title><link>/posts/grafana/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>/posts/grafana/</guid><description>&lt;h1 id="监控主机">监控主机&lt;/h1>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>HostName&lt;/th>
&lt;th>IP&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>master&lt;/td>
&lt;td>10.0.0.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>node1&lt;/td>
&lt;td>10.0.0.9&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>服务&lt;/th>
&lt;th>端口&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Grafana&lt;/td>
&lt;td>3000&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Prometheus&lt;/td>
&lt;td>9090&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>node-exporter&lt;/td>
&lt;td>9100&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cadvisor&lt;/td>
&lt;td>8080&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="部署prometheusmaster机器">部署Prometheus(master机器)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name&lt;span style="color:#f92672">=&lt;/span>prometheus &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 9090:9090 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /root/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> prom/prometheus
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>编辑prometheus.yml配置文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">scrape_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;prometheus&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.6:9090&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#添加master及node节点添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;master&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.6:9100&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;node&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.9:9100&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>这里只是提前编辑好,之后如果要添加新的机器,再后面添加&lt;/p>&lt;/blockquote>
&lt;p>访问master的9090端口,&lt;code>http://10.0.0.6:9090/&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421127.png" alt="">&lt;/p>
&lt;h2 id="部署node_exportermaster和node">部署node_exporter(master和node)&lt;/h2>
&lt;p>看需求,master不部署也可以&lt;/p>
&lt;p>{% tabs docker %}&lt;/p>
&lt;!-- tab docker安装-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name node-exporter &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 9100:9100 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/proc:/host/proc:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/sys:/host/sys:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/:/rootfs:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> prom/node-exporter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;!-- tab 源码安装-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载最新的node_exporter版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 解压缩下载的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar xvfz node_exporter-1.6.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将可执行文件移动到 /usr/local/bin&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo mv node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建 node_exporter 用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>useradd -rs /bin/false node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建 systemd 服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/systemd/system/node_exporter.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Unit&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Description&lt;span style="color:#f92672">=&lt;/span>Node Exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Wants&lt;span style="color:#f92672">=&lt;/span>network-online.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>After&lt;span style="color:#f92672">=&lt;/span>network-online.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Service&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>User&lt;span style="color:#f92672">=&lt;/span>node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Group&lt;span style="color:#f92672">=&lt;/span>node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Type&lt;span style="color:#f92672">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStart&lt;span style="color:#f92672">=&lt;/span>/usr/local/bin/node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Install&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WantedBy&lt;span style="color:#f92672">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新加载 systemd 配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动 node_exporter 服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl start node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置为开机自动启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl enable node_exporter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;p>{% endtabs %}&lt;/p></description><content>&lt;h1 id="监控主机">监控主机&lt;/h1>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>HostName&lt;/th>
&lt;th>IP&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>master&lt;/td>
&lt;td>10.0.0.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>node1&lt;/td>
&lt;td>10.0.0.9&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>服务&lt;/th>
&lt;th>端口&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Grafana&lt;/td>
&lt;td>3000&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Prometheus&lt;/td>
&lt;td>9090&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>node-exporter&lt;/td>
&lt;td>9100&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cadvisor&lt;/td>
&lt;td>8080&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="部署prometheusmaster机器">部署Prometheus(master机器)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name&lt;span style="color:#f92672">=&lt;/span>prometheus &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 9090:9090 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /root/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> prom/prometheus
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>编辑prometheus.yml配置文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">scrape_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;prometheus&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.6:9090&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#添加master及node节点添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;master&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.6:9100&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;node&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.0.9:9100&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>这里只是提前编辑好,之后如果要添加新的机器,再后面添加&lt;/p>&lt;/blockquote>
&lt;p>访问master的9090端口,&lt;code>http://10.0.0.6:9090/&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421127.png" alt="">&lt;/p>
&lt;h2 id="部署node_exportermaster和node">部署node_exporter(master和node)&lt;/h2>
&lt;p>看需求,master不部署也可以&lt;/p>
&lt;p>{% tabs docker %}&lt;/p>
&lt;!-- tab docker安装-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name node-exporter &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 9100:9100 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/proc:/host/proc:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/sys:/host/sys:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">&amp;#34;/:/rootfs:ro&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> prom/node-exporter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;!-- tab 源码安装-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载最新的node_exporter版本&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 解压缩下载的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar xvfz node_exporter-1.6.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将可执行文件移动到 /usr/local/bin&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo mv node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建 node_exporter 用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>useradd -rs /bin/false node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建 systemd 服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim /etc/systemd/system/node_exporter.service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Unit&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Description&lt;span style="color:#f92672">=&lt;/span>Node Exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Wants&lt;span style="color:#f92672">=&lt;/span>network-online.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>After&lt;span style="color:#f92672">=&lt;/span>network-online.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Service&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>User&lt;span style="color:#f92672">=&lt;/span>node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Group&lt;span style="color:#f92672">=&lt;/span>node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Type&lt;span style="color:#f92672">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStart&lt;span style="color:#f92672">=&lt;/span>/usr/local/bin/node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Install&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WantedBy&lt;span style="color:#f92672">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新加载 systemd 配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动 node_exporter 服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl start node_exporter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置为开机自动启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl enable node_exporter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;p>{% endtabs %}&lt;/p>
&lt;p>验证访问&lt;code>http://&amp;lt;你的服务器IP&amp;gt;:9100/metrics&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421323.png" alt="">&lt;/p>
&lt;p>点击Mertrics,下图为node通过9100端口暴露出的监控指标&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421669.png" alt="">&lt;/p>
&lt;p>再次访问master的9090端口,就会显示上面的 &lt;code>UP&lt;/code> 状态&lt;/p>
&lt;p>再修改&lt;code>prometheus.yml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">scrape_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;node_exporter&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;&amp;lt;你的服务器IP&amp;gt;:9100&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署grafana">部署Grafana&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 新建空文件夹grafana,用来存储数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /root/grafana
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">777&lt;/span> -R /root/grafana
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 运行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 3000:3000 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name&lt;span style="color:#f92672">=&lt;/span>grafana &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -e &lt;span style="color:#e6db74">&amp;#34;GF_SECURITY_ADMIN_PASSWORD=admin&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /root/grafana:/var/lib/grafana &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> grafana/grafana
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>访问master的3000端口 默认账号密码都为admin&lt;/p>
&lt;p>创建数据源&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421951.png" alt="">&lt;/p>
&lt;p>联接&lt;code>Prometheus&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421144.png" alt="">&lt;/p>
&lt;p>点击Save &amp;amp; Test&lt;/p>
&lt;p>创建面板&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421239.png" alt="">&lt;/p>
&lt;ul>
&lt;li>点击Import&lt;/li>
&lt;li>输入模板代码9276&lt;/li>
&lt;li>点击Load&lt;/li>
&lt;li>再下拉框选中&lt;code>Prometheus&lt;/code>&lt;/li>
&lt;li>点击Import&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421239.png" alt="">&lt;/p>
&lt;p>查看,选中要查看的主机&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051421087.png" alt="">&lt;/p>
&lt;h1 id="监控节点主机的容器">监控节点主机的容器&lt;/h1>
&lt;p>&lt;code>cAdvisor&lt;/code>（Container Advisor）用于采集正在运行的容器资源使用和性能信息。&lt;/p>
&lt;p>&lt;code>cAdvisor&lt;/code>可以对节点机器上的资源及容器进行实时监控和性能数据采集，包括&lt;code>CPU使用情况内存使用情况 网络吞吐量&lt;/code>及&lt;code>文件系统使用情况&lt;/code>&lt;/p>
&lt;h2 id="部署cadvisor">部署Cadvisor&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --volume&lt;span style="color:#f92672">=&lt;/span>/:/rootfs:ro &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --volume&lt;span style="color:#f92672">=&lt;/span>/var/run:/var/run:ro &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --volume&lt;span style="color:#f92672">=&lt;/span>/sys:/sys:ro &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --volume&lt;span style="color:#f92672">=&lt;/span>/var/lib/docker/:/var/lib/docker:ro &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --volume&lt;span style="color:#f92672">=&lt;/span>/dev/disk/:/dev/disk:ro &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --publish&lt;span style="color:#f92672">=&lt;/span>8080:8080 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --detach&lt;span style="color:#f92672">=&lt;/span>true &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name&lt;span style="color:#f92672">=&lt;/span>cadvisor &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> google/cadvisor:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>访问节点IP+端口&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051422766.png" alt="">&lt;/p>
&lt;p>修改prometheus.yml,在末尾添加,修改玩之后要重启&lt;code>Prometheus&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">job_name&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;docker&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">static_configs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">targets&lt;/span>: [&lt;span style="color:#e6db74">&amp;#39;10.0.09:8080&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>访问节点IP+9090&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051422992.png" alt="">&lt;/p>
&lt;p>&lt;strong>然&lt;/strong>后在master主机登录Grafana，导入Docker监模板，id：193&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6982487112624898062">在docker中搭建micrometer + grafana + prometheus的jvm监控 - 掘金&lt;/a>&lt;/p>
&lt;h1 id="监控mysql">监控Mysql&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">docker run -d \&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --&lt;span style="color:#ae81ff">name mysql_exporter \&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --&lt;span style="color:#ae81ff">restart always \&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&lt;span style="color:#ae81ff">p 9104:9104 \&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&lt;span style="color:#ae81ff">e DATA_SOURCE_NAME=&amp;#34;root:123456@(10.0.0.8:3306)/&amp;#34; \&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">prom/mysqld-exporter&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>模板ID:&lt;strong>7362&lt;/strong>&lt;/p></content></item><item><title>Linux软件</title><link>/posts/linux%E8%BD%AF%E4%BB%B6/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>/posts/linux%E8%BD%AF%E4%BB%B6/</guid><description>&lt;h1 id="jumpsserver">JumpSserver&lt;/h1>
&lt;h2 id="设置sftp根目录">设置SFTP根目录&lt;/h2>
&lt;p>3.0版本设置文件管理&lt;/p>
&lt;p>克隆一份Linux平台&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426282.png" alt="image-20230917163307359">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426865.png" alt="image-20230917163359314">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426331.png" alt="image-20230917163415467">&lt;/p>
&lt;p>修改或者创建资产的时候,选择该克隆的平台,在资产这里不能设置SFTP路径&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426116.png" alt="image-20230917163519193">&lt;/p>
&lt;h1 id="安装vmware-tool">安装vmware tool&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>运行 ./vmware-install.pl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>一直按yes,按完一段之后就会有暂时的停顿
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>运行命令 reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="安装wget">安装Wget&lt;/h1>
&lt;p>最开始的Centos7 感觉什么都没有&lt;code>wget&lt;/code>也没有&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#远程下载的工具&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install wget
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#bash: make: command not found 是因为缺少这些工具&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install gcc automake autoconf libtool make
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install wget
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="安装lnmp环境">安装LNMP环境&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 更新源&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get update &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get dist-upgrade -y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装php-fpm和常用php扩展&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install php-fpm php-gd php-mbstring php-curl php-xml php-mcrypt php-mysql php-zip php-json php-redis php-memcached
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install mysql-server
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 建立测试站点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 1.我们在/var/www下面新建一个test目录，作为站点目录。 运行以下命令：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /var/www/test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 2.新建php入口文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;&amp;lt;?php echo 1;&amp;#39;&lt;/span> &amp;gt; /var/www/test/index.php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 3.授权给fpm用户www-data，使fpm进程可以访问站点文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown -R www-data:www-data /var/www/test &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> chmod -R &lt;span style="color:#ae81ff">755&lt;/span> /var/www/test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 4.设置nginx站点配置,在/etc/nginx/conf.d新增一个test.conf文件，并写入以下内容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 这个配置表示站点监听80端口，网站根目录为/var/www/test,入口文件为index.php,通过php-fpm进程来执行php脚本。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#ae81ff">80&lt;/span> default_server;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#f92672">[&lt;/span>::&lt;span style="color:#f92672">]&lt;/span>:80 default_server;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root /var/www/test;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.php index.html index.htm;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name _;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location / &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> try_files $uri $uri/ &lt;span style="color:#f92672">=&lt;/span>404;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location ~ &lt;span style="color:#ae81ff">\.&lt;/span>php$ &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> include snippets/fastcgi-php.conf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fastcgi_pass unix:/run/php/php7.0-fpm.sock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 5.重新加载&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -t &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nginx -s reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 6.访问试试看&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ubuntu卸载apache">Ubuntu卸载Apache&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get --purge remove apache2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get --purge remove apache2.2-common
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get autoremove
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 找到没有删除掉的配置文件，一并删除&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo find /etc -name &lt;span style="color:#e6db74">&amp;#34;*apache*&amp;#34;&lt;/span> -exec rm -rf &lt;span style="color:#f92672">{}&lt;/span> &lt;span style="color:#ae81ff">\;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo rm -rf /var/www
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重装apache2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get install apache2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo /etc/init.d/apache2 restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ubuntu安装软件指定版本号&lt;/p></description><content>&lt;h1 id="jumpsserver">JumpSserver&lt;/h1>
&lt;h2 id="设置sftp根目录">设置SFTP根目录&lt;/h2>
&lt;p>3.0版本设置文件管理&lt;/p>
&lt;p>克隆一份Linux平台&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426282.png" alt="image-20230917163307359">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426865.png" alt="image-20230917163359314">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426331.png" alt="image-20230917163415467">&lt;/p>
&lt;p>修改或者创建资产的时候,选择该克隆的平台,在资产这里不能设置SFTP路径&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426116.png" alt="image-20230917163519193">&lt;/p>
&lt;h1 id="安装vmware-tool">安装vmware tool&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>运行 ./vmware-install.pl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>一直按yes,按完一段之后就会有暂时的停顿
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>运行命令 reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="安装wget">安装Wget&lt;/h1>
&lt;p>最开始的Centos7 感觉什么都没有&lt;code>wget&lt;/code>也没有&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#远程下载的工具&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install wget
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#bash: make: command not found 是因为缺少这些工具&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install gcc automake autoconf libtool make
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> yum -y install wget
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="安装lnmp环境">安装LNMP环境&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 更新源&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get update &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get dist-upgrade -y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装php-fpm和常用php扩展&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install php-fpm php-gd php-mbstring php-curl php-xml php-mcrypt php-mysql php-zip php-json php-redis php-memcached
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install mysql-server
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 建立测试站点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 1.我们在/var/www下面新建一个test目录，作为站点目录。 运行以下命令：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /var/www/test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 2.新建php入口文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;&amp;lt;?php echo 1;&amp;#39;&lt;/span> &amp;gt; /var/www/test/index.php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 3.授权给fpm用户www-data，使fpm进程可以访问站点文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chown -R www-data:www-data /var/www/test &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> chmod -R &lt;span style="color:#ae81ff">755&lt;/span> /var/www/test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 4.设置nginx站点配置,在/etc/nginx/conf.d新增一个test.conf文件，并写入以下内容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 这个配置表示站点监听80端口，网站根目录为/var/www/test,入口文件为index.php,通过php-fpm进程来执行php脚本。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#ae81ff">80&lt;/span> default_server;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#f92672">[&lt;/span>::&lt;span style="color:#f92672">]&lt;/span>:80 default_server;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root /var/www/test;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.php index.html index.htm;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name _;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location / &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> try_files $uri $uri/ &lt;span style="color:#f92672">=&lt;/span>404;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location ~ &lt;span style="color:#ae81ff">\.&lt;/span>php$ &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> include snippets/fastcgi-php.conf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fastcgi_pass unix:/run/php/php7.0-fpm.sock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 5.重新加载&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -t &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nginx -s reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 6.访问试试看&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ubuntu卸载apache">Ubuntu卸载Apache&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get --purge remove apache2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get --purge remove apache2.2-common
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get autoremove
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 找到没有删除掉的配置文件，一并删除&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo find /etc -name &lt;span style="color:#e6db74">&amp;#34;*apache*&amp;#34;&lt;/span> -exec rm -rf &lt;span style="color:#f92672">{}&lt;/span> &lt;span style="color:#ae81ff">\;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo rm -rf /var/www
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重装apache2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo apt-get install apache2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo /etc/init.d/apache2 restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ubuntu安装软件指定版本号&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装软件的时候,机器上安装的依赖版本可能高于软件本身需要的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The following packages have unmet dependencies:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> libpcre3-dev : Depends: libpcre3 &lt;span style="color:#f92672">(=&lt;/span> 2:8.39-12build1&lt;span style="color:#f92672">)&lt;/span> but 2:8.44-1+ubuntu18.04.1+deb.sury.org+1 is to be installed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Depends: libpcrecpp0v5 &lt;span style="color:#f92672">(=&lt;/span> 2:8.39-12build1&lt;span style="color:#f92672">)&lt;/span> but 2:8.44-1+ubuntu18.04.1+deb.sury.org+1 is to be installed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install libpcrecpp0v5&lt;span style="color:#f92672">=&lt;/span>2:8.39-12build1 libpcre3&lt;span style="color:#f92672">=&lt;/span>2:8.39-12build1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="gitlab安装">Gitlab安装&lt;/h1>
&lt;p>&lt;a href="https://ken.io/note/centos7-gitlab-install-tutorial#H3-11">https://ken.io/note/centos7-gitlab-install-tutorial#H3-11&lt;/a>&lt;/p>
&lt;h1 id="zsh安装">Zsh安装&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ sudo apt-get install zsh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 验证是否安装成功&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ zsh --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将 Zsh 设为默认 Shell&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo chsh -s &lt;span style="color:#66d9ef">$(&lt;/span>which zsh&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装oh my zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://ohmyz.sh/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 注销当前用户重新登录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 若输出为 /bin/zsh 或者 /usr/bin/zsh 则表示当前默认 Shell 是 Zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ echo $SHELL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="安装confluence">安装confluence&lt;/h1>
&lt;p>&lt;a href="https://www.atlassian.com/purchase/?utm_source=pocket_mylist">atlassian的相关软件&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://3reality.tech/downloads/atlassian/?utm_source=pocket_mylist">confluence下载地址&lt;/a>&lt;/p>
&lt;p>安装:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#f92672">-&lt;/span>v \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">/&lt;/span>root&lt;span style="color:#f92672">/&lt;/span>confluence&lt;span style="color:#f92672">/&lt;/span>:&lt;span style="color:#f92672">/&lt;/span>var&lt;span style="color:#f92672">/&lt;/span>atlassian&lt;span style="color:#f92672">/&lt;/span>application&lt;span style="color:#f92672">-&lt;/span>data&lt;span style="color:#f92672">/&lt;/span>confluence&lt;span style="color:#f92672">/&lt;/span> \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">--&lt;/span>name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;confluence&amp;#34;&lt;/span> \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">-&lt;/span>d \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">-&lt;/span>p &lt;span style="color:#ae81ff">8090&lt;/span>:&lt;span style="color:#ae81ff">8090&lt;/span> \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">-&lt;/span>p &lt;span style="color:#ae81ff">8091&lt;/span>:&lt;span style="color:#ae81ff">8091&lt;/span> \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> atlassian&lt;span style="color:#f92672">/&lt;/span>confluence&lt;span style="color:#f92672">-&lt;/span>server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>破解:&lt;/p>
&lt;p>1./opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar备份
2.atlassian-extras-decoder-v2-3.4.1.jar重命名为atlassian-extras-2.4.jar并下载到本地 （和破解工具放在同一目录）
3.下载破解工具confluence_keygen.jar,在上面的超链接下载&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426404.png" alt="">&lt;/p>
&lt;p>4.将已被破解的jar包atlassian-extras-2.4.jar重名为atlassian-extras-decoder-v2-3.4.1.jar&lt;/p>
&lt;p>并放置在原路径/opt/atlassian/confluence/confluence/WEB-INF/lib&lt;/p>
&lt;p>5.下载mysql-connector-java-5.1.32-bin.jar 上传/opt/atlassian/confluence/confluence/WEB-INF/lib&lt;/p>
&lt;p>6.开始安装到需要授权码&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051426338.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051427340.png" alt="">&lt;/p>
&lt;p>相关报错:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>启动发生报错 &lt;span style="color:#e6db74">&amp;#34;Spring Application context has not been set&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm &lt;span style="color:#f92672">-&lt;/span>f &lt;span style="color:#f92672">/&lt;/span>var&lt;span style="color:#f92672">/&lt;/span>atlassian&lt;span style="color:#f92672">/&lt;/span>application&lt;span style="color:#f92672">-&lt;/span>data&lt;span style="color:#f92672">/&lt;/span>confluence&lt;span style="color:#f92672">/&lt;/span>confluence&lt;span style="color:#f92672">.&lt;/span>cfg&lt;span style="color:#f92672">.&lt;/span>xml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="nmap">Nmap&lt;/h1>
&lt;h2 id="找出活跃的主机">找出活跃的主机&lt;/h2>
&lt;pre tabindex="0">&lt;code>nmap -sP 192.168.41.136
nping --echo-client &amp;#34;public&amp;#34; echo.nmap.org
&lt;/code>&lt;/pre>&lt;h2 id="查看打开的端口">查看打开的端口&lt;/h2>
&lt;p>nmap 192.168.41.136&lt;/p>
&lt;h1 id="网络软件">网络软件&lt;/h1>
&lt;p>&lt;a href="https://one.one.one.one/purge-cache/">清理网络DNS缓存&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://dnschecker.org/ns-lookup.php?query=55lukcy.in&amp;amp;dns=cloudflare">检查nameserver有没有生效&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.whatsmydns.net/#CNAME/whatsmydns.net">DNS生效的国家&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.ip2location.com/demo/92.98.82.166">IP查询&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.amazon.com/sendtokindle">发送文件到Kindle&lt;/a>&lt;/p>
&lt;h1 id="vim">VIM&lt;/h1>
&lt;h2 id="vim的配置文件设置">vim的配置文件设置&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先复制一份vim配置模板到个人目录下&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/share/vim/vimrc ~/.vimrc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 编辑&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vi ~/.vimrc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>syntax on &lt;span style="color:#75715e"># 开启高亮&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>set nu! &lt;span style="color:#75715e"># 默认开启行号&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="行号">行号&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>set nu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="过滤注释">过滤注释&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> cat redis.conf |grep -v &lt;span style="color:#e6db74">&amp;#39;#&amp;#39;&lt;/span> |grep -v &lt;span style="color:#e6db74">&amp;#39;^$&amp;#39;&lt;/span> &amp;gt;redis-6237.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="多行注释">多行注释&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span> Ctrl+v进入v模式
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2&lt;/span> 上下方向键选中要注释的行
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span> shift+i（即大写的I）行首插入
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">4&lt;/span> 输入注释符//
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">5&lt;/span> 按esc返回
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="反注释">反注释&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span> Ctrl+v进入v模式
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2&lt;/span> 上下方向键选中要注释的行，左右键选择要删除的字符//
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span> 按d删除
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="格式化">格式化&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># gg 跳转到第一行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># shift+v 转到可视模式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># shift+g 全选&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 按下=号&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="删除开头的行">删除#开头的行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>:g/^#/d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ssh">SSH&lt;/h1>
&lt;h2 id="安装ssh">安装ssh&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 判断Ubuntu是否安装了ssh服务,检查有没有可以看到“sshd”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps -e | grep ssh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装ssh服务，输入命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get install openssh-server
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo /etc/init.d/ssh start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ssh配置文件设置">SSH配置文件设置&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 这是设置允许root登陆&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PermitRootLogin prohibit-password &lt;span style="color:#f92672">===&lt;/span>&amp;gt; PermitRootLogin yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 这是设置允许使用账号密码登录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 不能只注释,注释会不起作用,还是可以用密码登录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PasswordAuthentication no &lt;span style="color:#f92672">===&lt;/span>&amp;gt; PasswordAuthentication yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 允许用证书登录方式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PubkeyAuthentication yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重启ssh服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service ssh reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ssh连接key失效">SSH连接,key失效&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>λ ssh root@10.19.44.12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Someone could be eavesdropping on you right now &lt;span style="color:#f92672">(&lt;/span>man-in-the-middle attack&lt;span style="color:#f92672">)&lt;/span>!
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>It is also possible that a host key has just been changed.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The fingerprint &lt;span style="color:#66d9ef">for&lt;/span> the ECDSA key sent by the remote host is
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SHA256:RIqSp3Pd94k4PPQcDtKAzK0sQbf4VWffKGwy/nvO8Kw.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Please contact your system administrator.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Add correct host key in C:&lt;span style="color:#ae81ff">\\&lt;/span>Users&lt;span style="color:#ae81ff">\\&lt;/span>Owner/.ssh/known_hosts to get rid of this message.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Offending ECDSA key in C:&lt;span style="color:#ae81ff">\\&lt;/span>Users&lt;span style="color:#ae81ff">\\&lt;/span>Owner/.ssh/known_hosts:12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ECDSA host key &lt;span style="color:#66d9ef">for&lt;/span> 10.19.44.12 has changed and you have requested strict checking.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host key verification failed.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>解决方法:找到.ssh文件下的known_hosts,删除相关ip的行&lt;/p>
&lt;h2 id="生成证书">生成证书&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 客户端生成秘钥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh-keygen
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ssh目录的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># id_rsa,私钥文件。不应该分享给任何人。私钥文件通常以 PEM 格式存储。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># id_rsa.pub,公钥文件。公钥可以公开分享，用于配置在你需要访问的服务器上。服务器使用公钥来加密信息，私钥可以解密。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># known_hosts, 文件存储了你之前连接过的所有服务器的主机密钥。这些密钥用于验证服务器的身份，以防止中间人攻击。每次你连接一个新的服务器，服务器的公钥会被添加到这个文件中。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># known_hosts.old,是 `known_hosts` 文件的备份。每当 `known_hosts` 文件更新时，旧版本会被保存为 `known_hosts.old`。这可以作为一个安全机制，如果新的 `known_hosts` 文件出现问题，可以回滚到旧版本。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>➜ .ssh ll /Users/anthony/.ssh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-------@ &lt;span style="color:#ae81ff">1&lt;/span> anthony staff 1.6K &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> 21:50 id_rsa
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-r--r--@ &lt;span style="color:#ae81ff">1&lt;/span> anthony staff 425B &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> 21:50 id_rsa.pub
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-------@ &lt;span style="color:#ae81ff">1&lt;/span> anthony staff 3.0K &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> 21:24 known_hosts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-------@ &lt;span style="color:#ae81ff">1&lt;/span> anthony staff 2.3K &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> 21:23 known_hosts.old
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 把公钥拷贝到服务器,这次是要输入密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh-copy-id -i ~/.ssh/id_rsa.pub user@remote_host
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 使用证书登录服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 实验的时候有个问题,如果不指定证书登录的命令,还是会提示输入密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh -i ~/.ssh/id_rsa_server2 ubuntu@your_server_ip2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="root账号登录并且配置证书">root账号登录并且配置证书&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 已经使用别的用户(账户名是:anthony)登录了服务器之后,再执行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo passwd root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第一次输入anthony用户的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第二次输入新密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第三次再次输入新密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置文件,让root用户可以登录,看上面的配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 客户端上传rsa公钥,留意这里是root的账户的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat ~/.ssh/id_rsa.pub | ssh root@172.16.147.129 &lt;span style="color:#e6db74">&amp;#39;cat &amp;gt;&amp;gt; /root/.ssh/authorized_keys&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 然后就可以使用root账户和证书登录了&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 证书本身是不区分用户名,只认是不是一对公钥还是私钥&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="root登录之后没有高亮">root登录之后没有高亮&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cp /home/kali/.bashrc /root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source .bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="oh-my-zsh">oh-my-zsh&lt;/h2>
&lt;h3 id="安装oh-my-zsh">安装oh-my-zsh&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置文件位置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vim ~/.zshrc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置主题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># jonathan 是主题的名字&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ZSH_THEME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;jonathan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置插件,空格分开 插件的名字&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>plugins&lt;span style="color:#f92672">=(&lt;/span>git zsh-syntax-highlighting zsh-autosuggestions&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="oh-my-zsh插件">oh my zsh插件&lt;/h3>
&lt;h4 id="zsh-syntax-highlighting">zsh-syntax-highlighting&lt;/h4>
&lt;p>高亮语法，如图，输入正确语法会显示绿色，错误的会显示红色，使得我们无需运行该命令即可知道此命令语法是否正确&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git &lt;span style="color:#e6db74">${&lt;/span>ZSH_CUSTOM&lt;span style="color:#66d9ef">:-&lt;/span>~/.oh-my-zsh/custom&lt;span style="color:#e6db74">}&lt;/span>/plugins/zsh-syntax-highlighting
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>plugins=(其他的插件 zsh-syntax-highlighting)&lt;/p>
&lt;h4 id="zsh-autosuggestions">zsh-autosuggestions&lt;/h4>
&lt;p>自动补全&lt;/p>
&lt;p>只需输入部分命令即可根据之前输入过的命令提示，按右键→即可补全&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone https://github.com/zsh-users/zsh-autosuggestions &lt;span style="color:#e6db74">${&lt;/span>ZSH_CUSTOM&lt;span style="color:#66d9ef">:-&lt;/span>~/.oh-my-zsh/custom&lt;span style="color:#e6db74">}&lt;/span>/plugins/zsh-autosuggestions
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>plugins=(其他的插件 zsh-syntax-highlighting)&lt;/p>
&lt;h1 id="shell">Shell&lt;/h1>
&lt;h2 id="设置别名">设置别名&lt;/h2>
&lt;p>经常要用命令行,进入到某个目录&lt;/p>
&lt;ol>
&lt;li>编辑你的 Shell 配置文件，例如 Bash 的配置文件是 &lt;code>~/.bashrc&lt;/code> 或 &lt;code>~/.bash_profile&lt;/code>，Zsh 的配置文件是 &lt;code>~/.zshrc&lt;/code>。&lt;/li>
&lt;li>添加 &lt;code>alias work='cd /path/to/your/work/directory'&lt;/code>&lt;/li>
&lt;li>运行 &lt;code>source ~/.bashrc&lt;/code> 或 &lt;code>source ~/.zshrc&lt;/code> 来使配置生效。&lt;/li>
&lt;li>终端中输入 &lt;code>work&lt;/code> 命令，就会进入你设置的工作目录&lt;/li>
&lt;/ol>
&lt;h2 id="设置环境变量">设置环境变量&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置环境变量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export http_proxy&lt;span style="color:#f92672">=&lt;/span>http://127.0.0.1:3128
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除环境变量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unset http_proxy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="curl换行">curl换行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl http://www.baidu.com -w &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="curl请求不校验证书">curl请求不校验证书&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 报错信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># curl failed to verify the legitimacy of the server and therefore could not&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># establish a secure connection to it. To learn more about this situation and&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># how to fix it, please visit the web page mentioned above.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl -k https://random.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 或者&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl -insecure https://random.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="脚本首行">脚本首行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="脚本变量">脚本变量&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># shell脚本给变量赋值的时候 = 两边不能加空格&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>your_name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;runoob&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 使用双引号拼接&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>greeting&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;hello, &amp;#34;&lt;/span>$your_name&lt;span style="color:#e6db74">&amp;#34; !&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="判断">判断&lt;/h2>
&lt;p>&lt;a href="https://blog.csdn.net/doiido/article/details/43966819">Linux shell脚本之 if条件判断_doiido的专栏-CSDN博客&lt;/a>&lt;/p>
&lt;h2 id="判断数值">判断数值&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>命令&lt;/th>
&lt;th>解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>[ INT1 -eq INT2 ]&lt;/td>
&lt;td>INT1和INT2两数相等返回为真 ,=&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ INT1 -ne INT2 ]&lt;/td>
&lt;td>INT1和INT2两数不等返回为真 ,&amp;lt;&amp;gt;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ INT1 -gt INT2 ]&lt;/td>
&lt;td>INT1大于INT2返回为真 ,&amp;gt;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ INT1 -ge INT2 ]&lt;/td>
&lt;td>INT1大于等于INT2返回为真,&amp;gt;=&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ INT1 -lt INT2 ]&lt;/td>
&lt;td>INT1小于INT2返回为真 ,&amp;lt;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ INT1 -le INT2 ]&lt;/td>
&lt;td>INT1小于等于INT2返回为真,&amp;lt;=&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="字符串判断">字符串判断&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>命令&lt;/th>
&lt;th>解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>[ -z STRING ]&lt;/td>
&lt;td>如果STRING的长度为零则返回为真，即空是真&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ -n STRING ]&lt;/td>
&lt;td>如果STRING的长度非零则返回为真，即非空是真&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ STRING1 ]&lt;/td>
&lt;td>如果字符串不为空则返回为真,与-n类似&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ STRING1 == STRING2 ]&lt;/td>
&lt;td>如果两个字符串相同则返回为真&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ STRING1 != STRING2 ]&lt;/td>
&lt;td>如果字符串不相同则返回为真&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ STRING1 &amp;lt; STRING2 ]&lt;/td>
&lt;td>如果 “STRING1”字典排序在“STRING2”前面则返回为真。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[ STRING1 &amp;gt; STRING2 ]&lt;/td>
&lt;td>如果 “STRING1”字典排序在“STRING2”后面则返回为真。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>STRING&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -z &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$STRING&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;STRING is empty&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -n &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$STRING&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;STRING is not empty&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 结果是:STRING is empty&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>Nginx</title><link>/posts/nginx/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>/posts/nginx/</guid><description>&lt;h2 id="docker安装-nginx">Docker安装 Nginx&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 简单的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run --name nginx-test &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8080:80 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 正式的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 443:443 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 80:80 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name nginx &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/www:/usr/share/nginx/html &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/logs:/var/log/nginx &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ubuntu安装nginx">Ubuntu安装Nginx&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu安装依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev zlib1g-dev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu 如果还缺少依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install build-essential
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Centos安装依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum install -y gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入到解压的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ./nginx-1.16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --prefix&lt;span style="color:#f92672">=&lt;/span>/url/local/nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#或者&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果需要指定模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --add-module&lt;span style="color:#f92672">=&lt;/span>../nginx-rtmp-module
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#然后目录下就多了一个nginx文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ../nginx/sbin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置文件目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>程序文件在/usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>日志放在了/var/log/nginx中
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>并已经在/etc/init.d/下创建了启动脚本nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>默认的虚拟主机的目录设置在了/var/www/nginx-default &lt;span style="color:#f92672">(&lt;/span>有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx-常用命令">Nginx 常用命令&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 或者&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置后重新加载生效&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新打开日志文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s reopen
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 测试nginx配置文件是否正确&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -t -c /path/to/nginx.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 快速停止nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 完整有序的停止nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s quit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定配置文件启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -c /home/anthony/nginx.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx-配置模板">Nginx 配置模板&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#user nobody;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置 &amp;lt;= cpu核数,一般设置成cpu*核数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">worker_processes 1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">error_log logs/warn.log warn;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定pid存放路径 nginx启动后的进程ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">pid logs/nginx.pid;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 工作模式及连接数上限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#user nobody;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置 &amp;lt;= cpu核数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">worker_processes 1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># error_log logs/error.log error;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定pid存放路径 nginx启动后的进程ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># pid logs/nginx.pid;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 工作模式及连接数上限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">events {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 使用网络I/O模型，Linux系统推荐使用epoll模型，FreeBSD系统推荐使用kqueue;window下不指定&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># user epoll;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 允许的最大连接数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">worker_connections 1024;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设定http服务器，利用他的反向代理功能提供负载均衡支持&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">http {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定mime类型&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">include mime.types;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">default_type application/octet-stream;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定日志格式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">log_format main &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#ae81ff">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_header_buffer_size 1k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">large_client_header_buffers 4 4k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># access_log logs/info.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># # 设定access log&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">send_timeout 3m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sendfile on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">tcp_nopush on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">tcp_nodelay on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 这个参数表示http连接超时时间，默认是65s。要是上传文件比较大，在规定时间内没有上传完成，就会自动断开连接！所以适当调大这个时间。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">keepalive_timeout 0;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">keepalive_timeout 5000;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 开启gzip模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_min_length 1100;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_buffers 4 8k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">output_buffers 1 32k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">postpone_output 1460;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server_names_hash_bucket_size 128;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_header_timeout 3m; &lt;/span> &lt;span style="color:#75715e">#调大点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_body_timeout 3m; &lt;/span> &lt;span style="color:#75715e">#调大点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_max_body_size 200m; &lt;/span> &lt;span style="color:#75715e">#主要是这个参数，限制了上传文件大大小&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#client_body_buffer_size 1024;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_connect_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_send_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_read_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_buffer_size 64k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_buffers 4 64k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_busy_buffers_size 128k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_temp_file_write_size 128k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_http_version 1.1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_comp_level 2;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_vary on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#设定虚拟主机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">listen 80;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server_name ap.mmzcg.com;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设置url编码格式，解决参数中文乱码问题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">charset UTF-8;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定本虚拟主机的访问日志&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># access_log logs/host.access.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 对 &amp;#34;/&amp;#34; 启用负载均衡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">location / {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定代理访问地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_pass http://127.0.0.1:30000/;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置SSL证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_certificate /etc/nginx/conf.d/ssl/STAR.huihuang200.com.crt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_certificate_key /etc/nginx/conf.d/ssl/STAR.huihuang200.com.key;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_session_timeout 5m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_session_cache shared:SSL:10m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv2 SSLv3;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_prefer_server_ciphers on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_verify_client off;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 解决ajax跨域问题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;*&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Credentials&amp;#39; &amp;#39;true&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Methods&amp;#39; &amp;#39;GET, POST, OPTIONS&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Headers&amp;#39; &amp;#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 保留用户真实信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header Host $host:$server_port;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header X-Real-IP $remote_addr;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 允许客户端请求的最大单个文件字节数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_max_body_size 100m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_body_buffer_size 1280k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># nginx跟后端服务器连接超时时间，发起握手等候响应超时时间(代理连接超时)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_connect_timeout 5;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 连接成功后 等待后端服务器响应时间 其实已进入后端的排队之中等候处理&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_read_timeout 60;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 代理请求缓存区 这个缓存区间会保存用户的头信息一共Nginx进行规则处理 一般只要能保存下头信息即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_send_timeout 30;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 同上 告诉Nginx保存单个用的几个Buffer最大用多大空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_buffer_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_buffers 4 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 如果系统很忙的时候可以申请国内各大的proxy_buffers 官方推荐 *2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_busy_buffers_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># proxy 缓存临时文件的大小&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_temp_file_write_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_max_temp_file_size 128m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx日志管理">Nginx日志管理&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#access_log logs/access.log main;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># nginx的默认配置,如果在安装的nginx里没有看到这个,也没有关系
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#log_format main &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">my&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#配置日志, main 就是log_format 后面的名字
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e"># 该server的访问日志的文件是logs/access.log,使用的是main格式
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#e6db74">access_log&lt;/span> &lt;span style="color:#e6db74">logs/access.log&lt;/span> &lt;span style="color:#e6db74">main&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>推荐的配置&lt;/p></description><content>&lt;h2 id="docker安装-nginx">Docker安装 Nginx&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 简单的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run --name nginx-test &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8080:80 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 正式的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 443:443 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 80:80 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name nginx &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/www:/usr/share/nginx/html &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/nginx/logs:/var/log/nginx &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ubuntu安装nginx">Ubuntu安装Nginx&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu安装依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev zlib1g-dev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu 如果还缺少依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install build-essential
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Centos安装依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum install -y gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入到解压的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ./nginx-1.16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --prefix&lt;span style="color:#f92672">=&lt;/span>/url/local/nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#或者&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果需要指定模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --add-module&lt;span style="color:#f92672">=&lt;/span>../nginx-rtmp-module
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#然后目录下就多了一个nginx文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd ../nginx/sbin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置文件目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>程序文件在/usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>日志放在了/var/log/nginx中
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>并已经在/etc/init.d/下创建了启动脚本nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>默认的虚拟主机的目录设置在了/var/www/nginx-default &lt;span style="color:#f92672">(&lt;/span>有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx-常用命令">Nginx 常用命令&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 启动nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 或者&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 修改配置后重新加载生效&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 重新打开日志文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s reopen
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 测试nginx配置文件是否正确&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -t -c /path/to/nginx.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 快速停止nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 完整有序的停止nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s quit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定配置文件启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -c /home/anthony/nginx.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx-配置模板">Nginx 配置模板&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#user nobody;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置 &amp;lt;= cpu核数,一般设置成cpu*核数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">worker_processes 1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">error_log logs/warn.log warn;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定pid存放路径 nginx启动后的进程ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">pid logs/nginx.pid;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 工作模式及连接数上限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#user nobody;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置 &amp;lt;= cpu核数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">worker_processes 1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># error_log logs/error.log error;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定pid存放路径 nginx启动后的进程ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># pid logs/nginx.pid;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 工作模式及连接数上限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">events {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 使用网络I/O模型，Linux系统推荐使用epoll模型，FreeBSD系统推荐使用kqueue;window下不指定&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># user epoll;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 允许的最大连接数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">worker_connections 1024;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设定http服务器，利用他的反向代理功能提供负载均衡支持&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">http {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定mime类型&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">include mime.types;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">default_type application/octet-stream;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定日志格式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">log_format main &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#ae81ff">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_header_buffer_size 1k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">large_client_header_buffers 4 4k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># access_log logs/info.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># # 设定access log&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">send_timeout 3m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sendfile on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">tcp_nopush on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">tcp_nodelay on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 这个参数表示http连接超时时间，默认是65s。要是上传文件比较大，在规定时间内没有上传完成，就会自动断开连接！所以适当调大这个时间。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">keepalive_timeout 0;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">keepalive_timeout 5000;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 开启gzip模块&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_min_length 1100;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_buffers 4 8k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">output_buffers 1 32k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">postpone_output 1460;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server_names_hash_bucket_size 128;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_header_timeout 3m; &lt;/span> &lt;span style="color:#75715e">#调大点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_body_timeout 3m; &lt;/span> &lt;span style="color:#75715e">#调大点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_max_body_size 200m; &lt;/span> &lt;span style="color:#75715e">#主要是这个参数，限制了上传文件大大小&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#client_body_buffer_size 1024;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_connect_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_send_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_read_timeout 300;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_buffer_size 64k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_buffers 4 64k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_busy_buffers_size 128k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">fastcgi_temp_file_write_size 128k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_http_version 1.1;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_comp_level 2;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">gzip_vary on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#设定虚拟主机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">listen 80;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">server_name ap.mmzcg.com;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设置url编码格式，解决参数中文乱码问题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">charset UTF-8;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定本虚拟主机的访问日志&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># access_log logs/host.access.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 对 &amp;#34;/&amp;#34; 启用负载均衡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">location / {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设定代理访问地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_pass http://127.0.0.1:30000/;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置SSL证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_certificate /etc/nginx/conf.d/ssl/STAR.huihuang200.com.crt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_certificate_key /etc/nginx/conf.d/ssl/STAR.huihuang200.com.key;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_session_timeout 5m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_session_cache shared:SSL:10m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv2 SSLv3;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_prefer_server_ciphers on;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ssl_verify_client off;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 解决ajax跨域问题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;*&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Credentials&amp;#39; &amp;#39;true&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Methods&amp;#39; &amp;#39;GET, POST, OPTIONS&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">add_header &amp;#39;Access-Control-Allow-Headers&amp;#39; &amp;#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&amp;#39;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 保留用户真实信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header Host $host:$server_port;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header X-Real-IP $remote_addr;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 允许客户端请求的最大单个文件字节数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_max_body_size 100m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">client_body_buffer_size 1280k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># nginx跟后端服务器连接超时时间，发起握手等候响应超时时间(代理连接超时)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_connect_timeout 5;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 连接成功后 等待后端服务器响应时间 其实已进入后端的排队之中等候处理&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_read_timeout 60;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 代理请求缓存区 这个缓存区间会保存用户的头信息一共Nginx进行规则处理 一般只要能保存下头信息即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_send_timeout 30;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 同上 告诉Nginx保存单个用的几个Buffer最大用多大空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_buffer_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_buffers 4 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 如果系统很忙的时候可以申请国内各大的proxy_buffers 官方推荐 *2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_busy_buffers_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># proxy 缓存临时文件的大小&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_temp_file_write_size 256k;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">proxy_max_temp_file_size 128m;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx日志管理">Nginx日志管理&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#access_log logs/access.log main;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># nginx的默认配置,如果在安装的nginx里没有看到这个,也没有关系
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#log_format main &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">my&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#配置日志, main 就是log_format 后面的名字
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e"># 该server的访问日志的文件是logs/access.log,使用的是main格式
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#e6db74">access_log&lt;/span> &lt;span style="color:#e6db74">logs/access.log&lt;/span> &lt;span style="color:#e6db74">main&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>推荐的配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">log_format&lt;/span> &lt;span style="color:#e6db74">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$remote_addr &lt;span style="color:#e6db74">-&lt;/span> $remote_user &lt;span style="color:#e6db74">[&lt;/span>$time_local] &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$request&amp;#34; $http_host &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$status $request_length $body_bytes_sent &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$http_referer&amp;#34; &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;&lt;/span>$http_user_agent&amp;#34; $request_time&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>remote_addr : 客户端地址&lt;/li>
&lt;li>remote_user : 客户端用户名&lt;/li>
&lt;li>time_local : 服务器时间&lt;/li>
&lt;li>request : 请求内容，包括方法名，地址，和http协议&lt;/li>
&lt;li>http_host : 用户请求是使用的http地址&lt;/li>
&lt;li>status : 返回的http 状态码&lt;/li>
&lt;li>request_length : 请求大小&lt;/li>
&lt;li>body_bytes_sent : 返回的大小&lt;/li>
&lt;li>http_referer : 来源页&lt;/li>
&lt;li>http_user_agent : 客户端名称&lt;/li>
&lt;li>request_time : 整体请求延时&lt;/li>
&lt;/ol>
&lt;p>日志书写规则&lt;/p>
&lt;p>一行要用单引号包起来,一行一个,换行也不需要什么连接的符号&lt;/p>
&lt;h2 id="location匹配">location匹配&lt;/h2>
&lt;p>= 精准匹配
不写 一般匹配
~ 正则匹配
location proxy_pass 后面的url 加与不加/的区别&lt;/p>
&lt;h2 id="server_name匹配">server_name匹配&lt;/h2>
&lt;h3 id="通配符匹配">通配符匹配&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nix" data-lang="nix">&lt;span style="display:flex;">&lt;span>server {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name &lt;span style="color:#f92672">*.&lt;/span>example&lt;span style="color:#f92672">.&lt;/span>org;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name mail&lt;span style="color:#f92672">.*&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>通配符格式中的&lt;code>*&lt;/code>号只能在域名的开头或结尾，并且&lt;code>*&lt;/code>号两侧只能是&lt;code>.&lt;/code>这些无效:&lt;/p>
&lt;ul>
&lt;li>&lt;code>www.*.example.org&lt;/code>&lt;/li>
&lt;li>&lt;code>w*.example.org&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>*&lt;/code>号可以匹配多个域名部分，&lt;code>*.example.org&lt;/code>可以匹配到:&lt;/p>
&lt;ul>
&lt;li>&lt;code>www.example.org&lt;/code>&lt;/li>
&lt;li>&lt;code>www.sub.example.org&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>.example.org&lt;/code>是比较特殊的通配符格式, 可以同时匹配&lt;/p>
&lt;ul>
&lt;li>&lt;code>example.org&lt;/code>&lt;/li>
&lt;li>&lt;code>*.example.org&lt;/code>。&lt;/li>
&lt;/ul>
&lt;h3 id="正则匹配">正则匹配&lt;/h3>
&lt;p>⁉️ 不适用我自己&lt;/p>
&lt;h3 id="精确匹配">精确匹配&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-visual-basic" data-lang="visual-basic">server {
listen 80;
server_name example.org www.example.org;
...
}
&lt;/code>&lt;/pre>&lt;h3 id="特殊匹配格式">特殊匹配格式&lt;/h3>
&lt;ol>
&lt;li>&lt;code>server_name &amp;quot;&amp;quot;&lt;/code>; 匹配Host请求头不存在的情况。&lt;/li>
&lt;li>&lt;code>server_name &amp;quot;-&amp;quot;&lt;/code>; 无任何意义。&lt;/li>
&lt;li>&lt;code>server_name &amp;quot;*&amp;quot;;&lt;/code> 它被错误地解释为万能的名称。 它从不用作通用或通配符服务器名称。相反，它提供了server_name_in_redirect指令现在提供的功能。 &lt;code>现在不建议使用特殊名称“ *”，而应使用server_name_in_redirect指令。&lt;/code>&lt;/li>
&lt;/ol>
&lt;h4 id="匹配顺序">匹配顺序&lt;/h4>
&lt;ol>
&lt;li>精确的名字&lt;/li>
&lt;li>以*号开头的最长通配符名称，例如 *.example.org&lt;/li>
&lt;li>以&lt;em>号结尾的最长通配符名称，例如 mail.&lt;/em>&lt;/li>
&lt;li>第一个匹配的正则表达式（在配置文件中出现的顺序）&lt;/li>
&lt;/ol>
&lt;h3 id="优化">优化&lt;/h3>
&lt;ol>
&lt;li>尽量使用精确匹配;&lt;/li>
&lt;li>当定义大量server_name时或特别长的server_name时，需要在http级别调整server_names_hash_max_size和server_names_hash_bucket_size，否则nginx将无法启动。&lt;/li>
&lt;/ol>
&lt;h1 id="nginx报错">Nginx报错&lt;/h1>
&lt;h3 id="1服务器重启之后执行-nginx--t-是ok的然而在执行-nginx--s-reload-的时候报错">1.服务器重启之后，执行 nginx -t 是OK的，然而在执行 nginx -s reload 的时候报错&lt;/h3>
&lt;p>&lt;code>nginx: [error] invalid PID number &amp;quot;&amp;quot; in &amp;quot;/run/nginx.pid&amp;quot;&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code># 解决办法:
nginx -c /etc/nginx/nginx.conf
nginx.conf文件的路径可以从nginx -t的返回中找到。
nginx -s reload
&lt;/code>&lt;/pre>&lt;h3 id="2a-duplicate-default-server-for-000080">2.&lt;code>a duplicate default server for 0.0.0.0:80&lt;/code>&lt;/h3>
&lt;p>nginx: [emerg] a duplicate default server for 0.0.0.0:80 in /etc/nginx/sites-enabled/gitlab:10&lt;/p>
&lt;pre tabindex="0">&lt;code>删除/etc/nginx/sites-available/default文件，重新启动服务即可
nginx -t :检查配置文件是否出错
&lt;/code>&lt;/pre>&lt;h3 id="3403">3.403&lt;/h3>
&lt;pre tabindex="0">&lt;code>打开nginx.conf
例子：vim /etc/nginx/nginx.conf
把 user 用户名 改为 user root 或 其它有高权限的用户名称即可
&lt;/code>&lt;/pre>&lt;h1 id="nginx应用">Nginx应用&lt;/h1>
&lt;h2 id="acmesh的使用">Acme.sh的使用&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载软件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl https://get.acme.sh | sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置别名 alias:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias acme.sh&lt;span style="color:#f92672">=&lt;/span>~/.acme.sh/acme.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 切换 Let&amp;#39;s Encrypt,默认使用 ZeroSSL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --set-default-ca --server letsencrypt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 执行,会打印配置域名的TXT&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue -d baidu.me --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 配置好执行,再执行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue -d baidu.me --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please --renew
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># --nginx 就是指定域名的配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Your cert is in: /root/.acme.sh/baidu.me_ecc/baidu.me.cer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Your cert key is in: /root/.acme.sh/baidu.me_ecc/baidu.me.key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The intermediate CA cert is in: /root/.acme.sh/baidu.me_ecc/ca.cer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>And the full chain certs is there: /root/.acme.sh/baidu.me_ecc/fullchain.cer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看申请的证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@jenkins-jumpserver-nginx:~/.acme.sh# acme.sh --list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Main_Domain KeyLength SAN_Domains CA Created Renew
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>baidu &lt;span style="color:#e6db74">&amp;#34;ec-256&amp;#34;&lt;/span> no LetsEncrypt.org 2023-09-17T11:52:22Z 2023-11-15T11:52:22Z
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 续期证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 证书默认是90天，如需强制更新证书，则执行以下命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --renew -d abc.xyz --force
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># acme.sh会自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果快过期了, 需要更新, 则会自动更新证书，使用以下命令可查看定时任务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>crontab -l
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 升级 acme.sh 到最新&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --upgrade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># CF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export CF_Key&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;xxxxxxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export CF_Email&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;CF账号的邮箱&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue -d &lt;span style="color:#e6db74">&amp;#34;baidu.com&amp;#34;&lt;/span> --dns dns_cf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="建立软连接">建立软连接&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo ln -s /etc/nginx/sites-available/domain-one.com /etc/nginx/sites-enabled/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="快速部署静态应用">快速部署静态应用&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 首尾配置暂时忽略
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">8080&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">localhost&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 设置为个人项目的根目录路径
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/usr/local/var/www/my-project&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span> &lt;span style="color:#e6db74">index.htm&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># vue项目404让前端路由处理
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">try_files&lt;/span> $uri $uri/ &lt;span style="color:#e6db74">/index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 首尾配置暂时忽略
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="跨域">跨域&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 首尾配置暂时忽略
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">8080&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">localhost&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 跨域代理设置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://www.proxy.com&lt;/span>; &lt;span style="color:#75715e"># 要实现跨域的域名
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">Access-Control-Allow-Origin&lt;/span> &lt;span style="color:#e6db74">*&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">Access-Control-Allow-Methods&lt;/span> &lt;span style="color:#e6db74">&amp;#39;GET,&lt;/span> &lt;span style="color:#e6db74">POST,&lt;/span> &lt;span style="color:#e6db74">OPTIONS&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">Access-Control-Allow-Headers&lt;/span> &lt;span style="color:#e6db74">&amp;#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 首尾配置暂时忽略
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 第二种
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span> &lt;span style="color:#e6db74">www.*&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/home/ubuntu/sabong-server-front&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">try_files&lt;/span> $uri $uri/ &lt;span style="color:#e6db74">/index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/api/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">if&lt;/span> &lt;span style="color:#e6db74">(&lt;/span>$request_method = &lt;span style="color:#e6db74">&amp;#39;OPTIONS&amp;#39;)&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Origin&amp;#39;&lt;/span> &lt;span style="color:#e6db74">*&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Methods&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;GET,&lt;/span> &lt;span style="color:#e6db74">POST,&lt;/span> &lt;span style="color:#e6db74">PUT,&lt;/span> &lt;span style="color:#e6db74">DELETE,&lt;/span> &lt;span style="color:#e6db74">OPTIONS&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Headers&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,language,If-Modified-Since,Cache-Control,Content-Type&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Credentials&amp;#39;&lt;/span> &lt;span style="color:#e6db74">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Max-Age&amp;#39;&lt;/span> &lt;span style="color:#ae81ff">86400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">return&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Origin&amp;#39;&lt;/span> &lt;span style="color:#e6db74">*&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Methods&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;GET,&lt;/span> &lt;span style="color:#e6db74">POST,&lt;/span> &lt;span style="color:#e6db74">PUT,&lt;/span> &lt;span style="color:#e6db74">DELETE,&lt;/span> &lt;span style="color:#e6db74">OPTIONS&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Headers&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,language,If-Modified-Since,Cache-Control,Content-Type&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Allow-Credentials&amp;#39;&lt;/span> &lt;span style="color:#e6db74">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Access-Control-Max-Age&amp;#39;&lt;/span> &lt;span style="color:#ae81ff">86400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forward-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $http_host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Nginx-Proxy&lt;/span> &lt;span style="color:#e6db74">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.41.206:9001/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/ws&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.41.206:9006/ws&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_read_timeout&lt;/span> &lt;span style="color:#e6db74">360s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_redirect&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host:$server_port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">REMOTE-HOST&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="gzip压缩">Gzip压缩&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置gzip压缩
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">gzip&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gzip_min_length&lt;/span> &lt;span style="color:#ae81ff">1000&lt;/span>; &lt;span style="color:#75715e"># 设定压缩的临界点
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">gzip_comp_level&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; &lt;span style="color:#75715e"># 压缩级别
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">gzip_types&lt;/span> &lt;span style="color:#e6db74">text/plain&lt;/span> &lt;span style="color:#e6db74">application/xml&lt;/span>; &lt;span style="color:#75715e"># 要压缩的文件类别
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="转发vue项目">转发Vue项目&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/home/ubuntu/sabong-server-front&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># nginx 转发给前端判断是不是404
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">try_files&lt;/span> $uri $uri/ &lt;span style="color:#e6db74">/index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/api/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $http_host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Nginx-Proxy&lt;/span> &lt;span style="color:#e6db74">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.41.206:9001/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="转发websocket">转发Websocket&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/ws&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.41.206:9006/ws&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_read_timeout&lt;/span> &lt;span style="color:#e6db74">360s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_redirect&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host:$server_port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">REMOTE-HOST&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="转发redis">转发Redis&lt;/h2>
&lt;p>只知道这么配置,不知道怎么给redis配置上域名&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">user&lt;/span> &lt;span style="color:#e6db74">www-data&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">worker_processes&lt;/span> &lt;span style="color:#e6db74">auto&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pid&lt;/span> &lt;span style="color:#e6db74">/run/nginx.pid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">include&lt;/span> /etc/nginx/modules-enabled/*.conf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">events&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">worker_connections&lt;/span> &lt;span style="color:#ae81ff">768&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># multi_accept on;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 要跟http统计,旧的版本没有steram模块,需要编译的时候加
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载最新的版本肯定是有stream模块的
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#e6db74">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">redis&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># myredis.godjfp.com 要被转发的Redis地址
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e"># 6379:redis自己设置的端口是多少,就是多少
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server&lt;/span> myredis.godjfp.com:&lt;span style="color:#ae81ff">6379&lt;/span> &lt;span style="color:#e6db74">max_fails=3&lt;/span> &lt;span style="color:#e6db74">fail_timeout=30s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 公网访问的端口
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">6379&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_connect_timeout&lt;/span> &lt;span style="color:#e6db74">1s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_timeout&lt;/span> &lt;span style="color:#e6db74">3s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">redis&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://image.runtimes.cc/202404051446413.png" alt="">&lt;/p>
&lt;h2 id="图片上传">图片上传&lt;/h2>
&lt;p>post上传文件，出现413错误码 解决方案&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">允许客户端请求的最大单文件字节数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>client_max_body_size &lt;span style="color:#ae81ff">10&lt;/span>m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">缓冲区代理缓冲用户端请求的最大字节数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>client_body_buffer_size &lt;span style="color:#ae81ff">128&lt;/span>k;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="https跳转">HTTPS跳转&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">443&lt;/span> &lt;span style="color:#e6db74">ssl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置SSL证书
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">abc.xyz&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 如果是http,就跳转https,注意nginx配置文件的不同,可能会出现重定向次数过多
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">if&lt;/span> &lt;span style="color:#e6db74">(&lt;/span>$scheme = &lt;span style="color:#e6db74">http)&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">return&lt;/span> &lt;span style="color:#ae81ff">301&lt;/span> &lt;span style="color:#e6db74">https://&lt;/span>$host$request_uri;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://192.168.0.2:8084/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 比如配置强制跳转https,导致重定向次数过多
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">443&lt;/span> &lt;span style="color:#e6db74">ssl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置SSL证书
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">abc.xyz&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 如果是http,就跳转https,注意nginx配置文件的不同,可能会出现重定向次数过多
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e"># 比如这个配置 return 301 https://$server_name$request_uri;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e"># 比如这个配置 rewrite ^(.*)$ https://$host$1 permanent;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://192.168.0.2:8084/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 上面两种导致重定向的次数过多,需要修改配置文件,比如下面的配置文件就可以
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">your_domain.com&lt;/span> &lt;span style="color:#e6db74">www.your_domain.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">return&lt;/span> &lt;span style="color:#ae81ff">301&lt;/span> &lt;span style="color:#e6db74">https://&lt;/span>$host$request_uri;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">443&lt;/span> &lt;span style="color:#e6db74">ssl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">your_domain.com&lt;/span> &lt;span style="color:#e6db74">www.your_domain.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ssl_certificate&lt;/span> &lt;span style="color:#e6db74">/path/to/your/certificate.crt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ssl_certificate_key&lt;/span> &lt;span style="color:#e6db74">/path/to/your/private_key.key&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="代理jumpserver">代理JumpServer&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#e6db74">[::]:80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/var/www/html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span> &lt;span style="color:#e6db74">index.htm&lt;/span> &lt;span style="color:#e6db74">index.nginx-debian.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 比如服务器里的JumpServer的端口已经设置成了8083
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1:8083/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 按照官方的配置,需要使用WebSocket,如果不配置的话,访问JumpServer网页会提示WebSocket报错
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_buffering&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_request_buffering&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://docs.jumpserver.org/zh/v3/installation/proxy/?h=nginx#2-nginx">官方文档:使用Nginx代理JumpServer&lt;/a>&lt;/p>
&lt;h2 id="代理jenkins">代理Jenkins&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#e6db74">[::]:80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1:8083/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果使用这样的配置,会有问题,比如配置的域名是baidu.com
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 当访问baidu.com会正常访问,当登录之后,网页地址就变成http://127.0.0.1:8083/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 需要改成一下配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#e6db74">[::]:80&lt;/span> &lt;span style="color:#e6db74">default_server&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1:8080/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 下面这几个配置,访问Github会403
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">http2_push_preload&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>; &lt;span style="color:#75715e"># Enable http2 push
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-Proto&lt;/span> $scheme;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 这个配置又是正常的,要看看这个请求头是干嘛的了
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Rea&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $http_host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Nginx-Proxy&lt;/span> &lt;span style="color:#e6db74">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">_&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/api/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_max_body_size&lt;/span> &lt;span style="color:#ae81ff">100m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_buffer_size&lt;/span> &lt;span style="color:#ae81ff">50m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_redirect&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.2.105:8083/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 代理swagger稳定 openapi3的版本,springboot3的版本
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/v3/api-docs&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_max_body_size&lt;/span> &lt;span style="color:#ae81ff">100m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_buffer_size&lt;/span> &lt;span style="color:#ae81ff">50m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_redirect&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.31.2.105:8083/v3/api-docs&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">try_files&lt;/span> $uri $uri/ &lt;span style="color:#e6db74">/index.html&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/usr/share/nginx/html/manager/dist/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span> &lt;span style="color:#e6db74">index.html&lt;/span> &lt;span style="color:#e6db74">index.htm&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="srs">SRS&lt;/h1>
&lt;h2 id="docker方式运行">Docker方式运行&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-docker" data-lang="docker">&lt;span style="display:flex;">&lt;span>docker run -p 1935:1935 -p 1985:1985 -p 8080:8080 ossrs/srs:latest&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># 测试&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># 访问:[http://192.168.254.180:8080/](http://192.168.254.180:8080/)&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="srs安装参考">SRS安装参考&lt;/h2>
&lt;p>&lt;a href="https://cloud.tencent.com/developer/article/1693951">https://cloud.tencent.com/developer/article/1693951&lt;/a>&lt;/p>
&lt;h2 id="mac改成只播放系统声音">Mac改成只播放系统声音&lt;/h2>
&lt;p>&lt;a href="http://www.obsproject.com.cn/obs/78.html">Mac obs推流直播无声音解决方法_OBS教程_OBS Open Broadcaster Software&lt;/a>&lt;/p>
&lt;h2 id="obs权限监听浏览器">OBS权限监听浏览器&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051442055.png" alt="">&lt;/p></content></item><item><title>Redis</title><link>/posts/redis/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>/posts/redis/</guid><description>&lt;h1 id="安装redis">安装Redis&lt;/h1>
&lt;h2 id="安装单机redis">安装单机Redis&lt;/h2>
&lt;p>{% tabs 安装单机Redis %}&lt;/p>
&lt;!-- tab Windows安装Redis-->
&lt;p>&lt;a href="https://github.com/tporadowski/redis/releases">Releases · tporadowski/redis&lt;/a>&lt;/p>
&lt;!-- endtab -->
&lt;!-- tab Docker安装Redis -->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 6379:6379 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name myredis &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v $PWD/redis.conf:/etc/redis/redis.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v $PWD/data:/data &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d redis:3.2 redis-server /etc/redis/redis.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --appendonly yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>命令说明：&lt;/p>
&lt;ul>
&lt;li>&lt;code>-name myredis&lt;/code> : 指定容器名称，这个最好加上，不然在看docker进程的时候会很尴尬。&lt;/li>
&lt;li>&lt;code>p 6699:6379&lt;/code> ： 端口映射，默认redis启动的是6379,外部端口(6699)。&lt;/li>
&lt;li>&lt;code>v $PWD/redis.conf:/etc/redis/redis.conf&lt;/code> ： 将主机中当前目录下的redis.conf配置文件映射。&lt;/li>
&lt;li>&lt;code>v $PWD/data:/data -d redis:latest&lt;/code>： 将主机中当前目录下的data挂载到容器的/data&lt;/li>
&lt;li>&lt;code>-redis-server --appendonly yes&lt;/code> :在容器执行redis-server启动命令，并打开redis持久化配置&lt;/li>
&lt;li>&lt;code>-restart=always&lt;/code>:自动启动&lt;/li>
&lt;li>注意事项：&lt;/li>
&lt;li>如果不需要指定配置，&lt;code>v $PWD/redis.conf:/etc/redis/redis.conf&lt;/code> 可以不用&lt;/li>
&lt;li>redis-server 后面的那段 &lt;code>/etc/redis/redis.conf&lt;/code> 也可以不用。&lt;/li>
&lt;li>&lt;code>$PWD&lt;/code> 在window系统下貌似不能用,可以用相对路径&lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>客户端连接&lt;/p></description><content>&lt;h1 id="安装redis">安装Redis&lt;/h1>
&lt;h2 id="安装单机redis">安装单机Redis&lt;/h2>
&lt;p>{% tabs 安装单机Redis %}&lt;/p>
&lt;!-- tab Windows安装Redis-->
&lt;p>&lt;a href="https://github.com/tporadowski/redis/releases">Releases · tporadowski/redis&lt;/a>&lt;/p>
&lt;!-- endtab -->
&lt;!-- tab Docker安装Redis -->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 6379:6379 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name myredis &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v $PWD/redis.conf:/etc/redis/redis.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v $PWD/data:/data &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d redis:3.2 redis-server /etc/redis/redis.conf &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart&lt;span style="color:#f92672">=&lt;/span>always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --appendonly yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>命令说明：&lt;/p>
&lt;ul>
&lt;li>&lt;code>-name myredis&lt;/code> : 指定容器名称，这个最好加上，不然在看docker进程的时候会很尴尬。&lt;/li>
&lt;li>&lt;code>p 6699:6379&lt;/code> ： 端口映射，默认redis启动的是6379,外部端口(6699)。&lt;/li>
&lt;li>&lt;code>v $PWD/redis.conf:/etc/redis/redis.conf&lt;/code> ： 将主机中当前目录下的redis.conf配置文件映射。&lt;/li>
&lt;li>&lt;code>v $PWD/data:/data -d redis:latest&lt;/code>： 将主机中当前目录下的data挂载到容器的/data&lt;/li>
&lt;li>&lt;code>-redis-server --appendonly yes&lt;/code> :在容器执行redis-server启动命令，并打开redis持久化配置&lt;/li>
&lt;li>&lt;code>-restart=always&lt;/code>:自动启动&lt;/li>
&lt;li>注意事项：&lt;/li>
&lt;li>如果不需要指定配置，&lt;code>v $PWD/redis.conf:/etc/redis/redis.conf&lt;/code> 可以不用&lt;/li>
&lt;li>redis-server 后面的那段 &lt;code>/etc/redis/redis.conf&lt;/code> 也可以不用。&lt;/li>
&lt;li>&lt;code>$PWD&lt;/code> 在window系统下貌似不能用,可以用相对路径&lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>客户端连接&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先查询到myredis容器的ip地址。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker inspect myredis | grep IP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 连接到redis容器。然后就进入redis命令行了。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker run -it redis:latest redis-cli -h 192.168.42.32
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;!-- tab Linux源码安装Redis-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Cetnos安装需要的软件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum -y install gcc gcc-c++ kernel-devel make
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubunt 安装需要的软件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install gcc g++ make linux-kernel-headers kernel-package
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ubuntu 新内核版本要用到的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install gcc g++ make linux-libc-dev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 下载redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget http://download.redis.io/releases/redis-5.0.5.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -zxvf redis-5.0.5.tar.gz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd redis-5.0.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make instal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 注意make的时候可能会报错: #include &amp;lt;jemalloc/jemalloc.h&amp;gt;,使用下面的命令&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make MALLOC&lt;span style="color:#f92672">=&lt;/span>libc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改redis.cnf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置后台运行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>daemonize yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置log文件路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>logfile /var/log/redis/redis-server.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置持久化文件存放路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dir /var/lib/redis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建日志存放目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /var/log/redis/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建持久化文件存放目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /var/log/redis/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建存放配置的文件夹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir /etc/redis
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 拷贝配置文件并改名&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp redis.conf /etc/redis/6379.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 拷贝自启动脚本文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-6.0.3/utils/redis_init_script /etc/init.d/redisd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>将启动脚本复制到&lt;code>/etc/init.d&lt;/code>目录下，本例将启动脚本命名为redisd（通常都以d结尾表示是后台自启动服务）&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Centos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#设置为开机自启动服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /etc/init.d/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chkconfig redisd on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ubuntu&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#设置服务脚本有执行权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chmod +x /etc/init.d/redisd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#注册服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /etc/init.d/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo update-rc.d redisd defaults
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>此处直接配置开启自启动 &lt;code>chkconfig redisd on&lt;/code> 将报错误： &lt;code>service does not support chkconfig&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e"># chkconfig: 2345 90 10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># description: Redis is a persistent key-value database&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>通用命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#启动Redis服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service redisd start
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#关闭服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service redisd stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#重启服务：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo service redisd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;p>{% endtabs %}&lt;/p>
&lt;h2 id="安装集群redis">安装集群Redis&lt;/h2>
&lt;p>{% tabs 安装集群Redis %}&lt;/p>
&lt;!-- tab Docker安装集群-->
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>echo &lt;span style="color:#e6db74">&amp;#34;start install redis-cluster...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> ! -d /opt/docker-redis/7001/ &lt;span style="color:#f92672">]&lt;/span>;&lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mkdir -p /opt/docker-redis/700&lt;span style="color:#f92672">{&lt;/span>1,2,3,4,5,6&lt;span style="color:#f92672">}&lt;/span>/data/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /opt/docker-redis/7001/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget http://download.redis.io/redis-stable/redis.conf -O /opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#e6db74">&amp;#39;/^#/d;/^$/d&amp;#39;&lt;/span> redis7001.conf &lt;span style="color:#75715e">#取出空行和注释行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#e6db74">&amp;#39;s/bind/#bind/g;s/appendonly no/appendonly yes/g;s/protected-mode yes/protected-mode no/g&amp;#39;&lt;/span> redis7001.conf &lt;span style="color:#75715e">#开启持久化，注释监听ip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;#集群配置&amp;#39;&lt;/span> &amp;gt;&amp;gt; /opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-enabled yes&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-config-file nodes-7001.conf&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-node-timeout 15000&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-announce-ip 192.168.92.135&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-announce-port 7001&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#39;cluster-announce-bus-port 17001&amp;#39;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/7001/redis7001.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> port in &lt;span style="color:#e6db74">`&lt;/span>seq &lt;span style="color:#ae81ff">7002&lt;/span> 7006&lt;span style="color:#e6db74">`&lt;/span>;&lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cp redis7001.conf ../&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;cluster-config-file nodes-&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">.conf&amp;#34;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;cluster-announce-port &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;cluster-announce-bus-port 1&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt;/opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> port in &lt;span style="color:#e6db74">`&lt;/span>seq &lt;span style="color:#ae81ff">7001&lt;/span> 7006&lt;span style="color:#e6db74">`&lt;/span>;&lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># sed -i &amp;#34;s/logfile \&amp;#34;\&amp;#34;/logfile \&amp;#34;\/usr\/local\/docker\/redis-cluster\/log\/redis.log\&amp;#34;/g&amp;#34; redis${port}.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sed -i &lt;span style="color:#e6db74">&amp;#34;s/port 6379/port &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/g&amp;#34;&lt;/span> /opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> docker run --restart always --name redis-cluster-&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span> --net host --privileged&lt;span style="color:#f92672">=&lt;/span>true -v /opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf:/usr/local/docker/redis-cluster/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf -v &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> /opt/docker-redis/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/data/:/usr/local/docker/redis-cluster/data/ &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d redis redis-server /usr/local/docker/redis-cluster/&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>/redis&lt;span style="color:#e6db74">${&lt;/span>port&lt;span style="color:#e6db74">}&lt;/span>.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker ps
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sleep 2s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ss -tnulp|grep redis
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#创建集群&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#redis-cli --cluster create 192.168.92.135:7001 192.168.92.135:7002 192.168.92.135:7003 192.168.92.135:7004 192.168.92.135:7005 192.168.92.135:7006 --cluster-replicas 1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;!-- tab 源码安装集群-->
&lt;p>&lt;strong>下载,解压,编译安装&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>用一台虚拟机模拟6个节点，创建出3 master、3 salve 环境。&lt;/li>
&lt;li>创建文件前,先编译好Redis程序&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>创建节点&lt;/strong>
创建配置redis.conf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 端口7000 7001 7002 7003 7004 7005&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>port &lt;span style="color:#ae81ff">7000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 自己建议修改为0.0.0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bind 0.0.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># redis后台运行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>daemonize yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># pidfile文件对应7000 7001 7002 7003 7004 7005&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pidfile /var/run/redis_7000.pid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 开启集群 把注释#去掉&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-enabled yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 集群的配置,配置文件首次启动自动生成7000 7001 7002 7003 7004 7005&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-config-file nodes_7000.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 请求超时 默认15秒，可自行设置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-node-timeout &lt;span style="color:#ae81ff">15000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># AOF日志开启&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>appendonly yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建文件夹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>cd /usr/local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir redis_cluster
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd redis_cluster
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir &lt;span style="color:#ae81ff">7000&lt;/span> &lt;span style="color:#ae81ff">7001&lt;/span> &lt;span style="color:#ae81ff">7002&lt;/span> &lt;span style="color:#ae81ff">7003&lt;/span> &lt;span style="color:#ae81ff">7004&lt;/span> &lt;span style="color:#ae81ff">7005&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7000/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7001/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7002/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7003/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7004/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /usr/local/redis-5.0.5/redis.conf /usr/local/redis_cluster/7005/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>分别修改三个文件夹里的配置文件,修改如下内容&lt;/p>
&lt;p>启动节点的redis&lt;code>/usr/local/bin/redis-server&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7000/redis.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7001/redis.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7002/redis.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7003/redis.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7004/redis.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/usr/local/bin/redis-server /usr/local/redis_cluster/7005/redis.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>检查 redis 启动情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ps -ef | grep redi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61020&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7000 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61024&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7001 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61029&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7002 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61029&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7002 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61029&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7002 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root &lt;span style="color:#ae81ff">61029&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> 02:14 ? 00:00:01 redis-server 0.0.0.0:7002 &lt;span style="color:#f92672">[&lt;/span>cluster&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>启动集群&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>装的redis是5.x的版本,这里没有应用到&lt;code>redis-trib.rb&lt;/code>,所以就不需要装ruby&lt;/li>
&lt;li>这里启动的时候可能会有报错,因为默认开启了&lt;code>protected-mode&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>cd /usr/local/bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis-cli --cluster create 192.168.0.100:7003 192.168.0.100:7004 192.168.0.100:7005 192.168.0.179:7000 192.168.0.179:7001 192.168.0.179:7002 --cluster-replicas &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Can I set the above configuration? &lt;span style="color:#f92672">(&lt;/span>type &lt;span style="color:#e6db74">&amp;#39;yes&amp;#39;&lt;/span> to accept&lt;span style="color:#f92672">)&lt;/span>: yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>校验,等运行完成&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>root@worker1 src&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># redis-cli --cluster check 192.168.0.179:7000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.0.179:7000 &lt;span style="color:#f92672">(&lt;/span>27bce53b...&lt;span style="color:#f92672">)&lt;/span> -&amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> keys | &lt;span style="color:#ae81ff">5462&lt;/span> slots | &lt;span style="color:#ae81ff">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.0.100:7004 &lt;span style="color:#f92672">(&lt;/span>6b0173d9...&lt;span style="color:#f92672">)&lt;/span> -&amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> keys | &lt;span style="color:#ae81ff">5461&lt;/span> slots | &lt;span style="color:#ae81ff">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.0.100:7003 &lt;span style="color:#f92672">(&lt;/span>9f15a932...&lt;span style="color:#f92672">)&lt;/span> -&amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> keys | &lt;span style="color:#ae81ff">5461&lt;/span> slots | &lt;span style="color:#ae81ff">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>OK&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> keys in &lt;span style="color:#ae81ff">3&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0.00 keys per slot on average.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span style="color:#f92672">(&lt;/span>using node 192.168.0.179:7000&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>M: 27bce53bda92341ca4a5c82c2361ab99f24c0b27 192.168.0.179:7000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots:&lt;span style="color:#f92672">[&lt;/span>5461-10922&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">5462&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> additional replica&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>S: c7ebcd900fb7d9afb1980797acba45518cb7d877 192.168.0.100:7005
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots: &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> replicates 27bce53bda92341ca4a5c82c2361ab99f24c0b27
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>S: ed5256f8db1bf556a8dadbe8f2b07699507e17d9 192.168.0.179:7001
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots: &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> replicates 6b0173d925f70807a9081b7bc09bcd37be857342
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>S: 758609eaea88bac25b864f2badbab2171a68089b 192.168.0.179:7002
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots: &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> replicates 9f15a9329a9d0ec5c7fcb5abbba817730f0942f9
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>M: 6b0173d925f70807a9081b7bc09bcd37be857342 192.168.0.100:7004
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots:&lt;span style="color:#f92672">[&lt;/span>10923-16383&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">5461&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> additional replica&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>M: 9f15a9329a9d0ec5c7fcb5abbba817730f0942f9 192.168.0.100:7003
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slots:&lt;span style="color:#f92672">[&lt;/span>0-5460&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">5461&lt;/span> slots&lt;span style="color:#f92672">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> additional replica&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>OK&lt;span style="color:#f92672">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt;&amp;gt; Check &lt;span style="color:#66d9ef">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>OK&lt;span style="color:#f92672">]&lt;/span> All &lt;span style="color:#ae81ff">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Cluster配置&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置加入cluster，成为其中的节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-enabled yes|no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># cluster配置文件名，该文件属于自动生成，仅用于快速查找文件并查询文件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-config-file &amp;lt; filename&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 节点服务响应超时时间，用于判定该节点是否下线或切换为从节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-node-timeout &amp;lt; milliseconds&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># master连接的slave最小数量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster-migration-barrier &amp;lt; count&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Cluster节点操作命令&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 连接到集群,加一个-c就行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis-cli -c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看集群节点信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster nodes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 进入一个从节点redis，切换其主节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster replication &amp;lt;master-id&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 发现一个新节点，新增主节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster meet ip:port
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 忽略一个没有solt的节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster forget
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 手动故障转移&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster failover
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 计算键 key 应该被放置在哪个槽上&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster keyslot &amp;lt;key&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 返回槽 slot 目前包含的键值对数量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster countkeysinslot &amp;lt;slot&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 返回 count 个 slot 槽中的键&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster getkeysinslot &amp;lt;slot&amp;gt; &amp;lt;count&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;!-- endtab -->
&lt;p>{% endtabs %}&lt;/p>
&lt;h2 id="配置">配置&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># requirepass foobared 注释去掉并写入要设置的密码 , 需要重启:systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>requirepass &lt;span style="color:#ae81ff">123456&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 将 bind 设置为允许所有 IP 地址的远程访问,需要重启:systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bind 0.0.0.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="redis的数据类型">Redis的数据类型&lt;/h1>
&lt;p>redis自身是一个Map,其中所有的数据都是采用key:value的形式存储&lt;/p>
&lt;p>数据类型指的是存储的数据的类型，也就是value部分的类型，key部分永远都是字符串&lt;/p>
&lt;ul>
&lt;li>string &amp;ndash;&amp;gt; String&lt;/li>
&lt;li>hash &amp;ndash;&amp;gt; Hashmap&lt;/li>
&lt;li>list &amp;ndash;&amp;gt; LinkList&lt;/li>
&lt;li>set &amp;ndash;&amp;gt; HashSet&lt;/li>
&lt;li>sorted_set &amp;ndash;&amp;gt; TreeSet&lt;/li>
&lt;/ul>
&lt;h2 id="string">String&lt;/h2>
&lt;ul>
&lt;li>redis所有的操作都是原子性的，采用单线程处理所有业务，命令是一个一个执行的&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 格式 set &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;set k1 anthony
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;OK&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 取值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 格式 get &amp;lt;key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;get k1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除值,成功返回1,不成功返回0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;del k1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;del k1234
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 一次性存入多个值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;mset k1 v1 k2 v2 k3 v3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;OK&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 一次性取出多个值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;mget k1 k2 k3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;v1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;v2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;v3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 打印值的长度&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;set name anthony
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;OK&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;get name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;anthony&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;strlen name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;7&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 追加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 有数据就追加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;append name &lt;span style="color:#ae81ff">666&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;get name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;anthony666&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 没数据就新建&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;append othername frankie
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;7&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;get othername
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;frankie&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 递增递减,小数不行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;set num &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;OK&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;incr num
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;incr num
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;decr num
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;decr num
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 递增递减指定值,小数不行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;incrby num &lt;span style="color:#ae81ff">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;6&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;decrby num &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 小数不行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;incrby num 1.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;ERR value is not an integer or out of range&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 递增指定小数,貌似没有递减&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:1&amp;gt;incrbyfloat num 1.5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;5.5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定过期时间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># EX 用于指定 key 的过期时间。EX(秒),PX(毫秒),KEEPTTL 保持原有的过期时间不变。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># PX 毫秒-设置指定的到期时间（以毫秒为单位）。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># NX 没有key的时候才能set成功,XX key存在的时候才能set成功&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SET key value &lt;span style="color:#f92672">[&lt;/span>EX seconds|PX milliseconds|KEEPTTL&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">[&lt;/span>NX|XX&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">[&lt;/span>GET&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 指定过期时间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># time,以秒为单位。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SETEX key time value
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 功能等价NX, SET if Not eXists&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis&amp;gt; SETNX mykey &lt;span style="color:#e6db74">&amp;#34;Hello&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">(&lt;/span>integer&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis&amp;gt; SETNX mykey &lt;span style="color:#e6db74">&amp;#34;World&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">(&lt;/span>integer&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="hash">Hash&lt;/h2>
&lt;p>{% mermaid %}&lt;/p>
&lt;p>graph LR;
Key;
Key&amp;ndash;&amp;gt;Field1&amp;ndash;&amp;gt; Value1;
Key&amp;ndash;&amp;gt;Field2&amp;ndash;&amp;gt; Value2;
Key&amp;ndash;&amp;gt;Field3&amp;ndash;&amp;gt; Value3;
subgraph 相当于Value&lt;br>
Field1;
Value1;
Field2;
Value2;
Field3;
Value3;
end;&lt;/p>
&lt;p>{% endmermaid %}&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设值/修改值 hset key filed1 value&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;HSET user name zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hset user age &lt;span style="color:#ae81ff">38&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 取一个属性值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hget user age
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;38&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 取多个属性值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hmget user age name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;45&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zhangsan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 取一个key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hgetall user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zhangsan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 4&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;38&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 删除一个属性值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hdel user name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hgetall user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;38&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 查看有多少个属性&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 192.168.245.129:0&amp;gt;hlen user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取所有的属性&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hkeys user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;sex&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取所有的属性值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;hvals user
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;45&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zhangsan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 指定属性增加指定值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 192.168.245.129:0&amp;gt;hincrby user age &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;46&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="list">List&lt;/h2>
&lt;p>{% mermaid %}
flowchart LR&lt;/p>
&lt;p>subgraph 顺序表/数组
id0(头指针)
id1[华为]
id2(苹果)
id3(微软)
end&lt;/p>
&lt;p>subgraph 单向链表
direction LR
id00[头指针] &amp;ndash;&amp;gt; id4[[华为]]
id4[[华为]] &amp;ndash;&amp;gt; id5[[苹果]]
id5[[苹果]] &amp;ndash;&amp;gt; id6[[微软]]
end
subgraph 双向链表
direction LR
id000[头指针] &amp;lt;&amp;ndash;&amp;gt; id7[[华为]]
id7[[华为]] &amp;lt;&amp;ndash;&amp;gt; id8[[苹果]]
id8[[苹果]] &amp;lt;&amp;ndash;&amp;gt; id9[[微软]]
end&lt;/p>
&lt;p>{% endmermaid %}&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 先插入huawei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpush list1 huawei
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 再插入apple&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpush list1 apple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 最后插入Microsoft&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpush list1 microsoft
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 从左边取&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lrange list1 &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;microsoft&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;apple&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;huawei&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 一次性插入多条数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;rpush list2 a b c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 从左边取&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrange key start stop&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lindex key index 取指定索引的值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># llen key 取长度&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 没有rrange&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lrange list2 &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 从左边取的第二钟方法&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lrange list2 &lt;span style="color:#ae81ff">0&lt;/span> -1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lpop从左边删,rpop从右边删&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpush list3 a b c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpop list3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 阻塞取值,从运行命令开始,如果有数据,取出来,立马返回,如果没有数据,就等指定的时间20s,有就立马返回结束,如果没有,就一直等到时间结束&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;blpop list4 &lt;span style="color:#ae81ff">20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;list4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;32&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除指定数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrem key count value&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># count是删除多少个value&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lpush dianzan a b c d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lrem dianzan &lt;span style="color:#ae81ff">1&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;lrange dianzan &lt;span style="color:#ae81ff">0&lt;/span> -1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="set">Set&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051516451.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;sadd users zs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;sadd users lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;sadd users ww
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;smembers users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;lisi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ww&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 查数量&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;scard users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 判断是否有指定数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;sismember users ls
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;sismember users ww
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;smembers users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;lisi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ww&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 删除指定数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;srem users ww
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.245.129:0&amp;gt;smembers users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;lisi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#e6db74">&amp;#34;zs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 随机获取集合中指定数量的数据,获取之后,原来的队列数据不变&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> srandmember key count
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 随机获取集合中的某个数据并讲该数据移除集合&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> spop key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;gt; sadd u1 a1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sadd u1 a2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sadd u1 a3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sadd u2 a1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sadd u2 a2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 交集&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sinter u1 u2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 并集&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sunion u1 u2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 差集 (u1,u2)顺序不一样,结果不一样&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; sdiff u1 u2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>redis应用于随机推荐类信息检索，例如热点歌单推荐，热点新闻推荐，热点旅游线路，应用APP推荐，大V推荐等&lt;/p>
&lt;h2 id="sort_set">sort_set&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zadd scores &lt;span style="color:#ae81ff">100&lt;/span> zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zadd scores &lt;span style="color:#ae81ff">90&lt;/span> lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zadd scores &lt;span style="color:#ae81ff">95&lt;/span> wangwu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取全部数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrange scores &lt;span style="color:#ae81ff">0&lt;/span> -1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wangwu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取全部数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrange scores &lt;span style="color:#ae81ff">0&lt;/span> -1 withscores
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">90&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wangwu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">95&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 反向获取全部数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrevrange scores &lt;span style="color:#ae81ff">0&lt;/span> -1 withscores
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wangwu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">95&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">90&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrem scores zhangsan
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrange scores &lt;span style="color:#ae81ff">0&lt;/span> -1 withscores
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lisi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">90&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wangwu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">95&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 按条件获取数据,可以用作分页&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zrangebyscore key min max &lt;span style="color:#f92672">[&lt;/span>WITHSCORES&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">[&lt;/span>LIMIT&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zrevrangebyscore key max min &lt;span style="color:#f92672">[&lt;/span>WITHSCORES&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 条件删除&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zremrangebyrank key start stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zremrangebyscore key min max
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-----------------------------------------排名-------------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 添加模拟数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zadd movies &lt;span style="color:#ae81ff">143&lt;/span> aa &lt;span style="color:#ae81ff">97&lt;/span> bb &lt;span style="color:#ae81ff">201&lt;/span> cc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取数据对应的索引(排名)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrank movies bb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 反向获取&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; zrevrank movies bb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># score 值获取与修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zscore key member
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>zincrby key increment member
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="redis-通用命令">Redis 通用命令&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 删除&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>del key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取key是否存在&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>exists key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取key的类型&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>type key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置指定有效期,秒&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>expire key second
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置指定有效期,毫秒&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pexpire key milliseconds
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 有效期是时间戳&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>expireat key timestamp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取key的有效期&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ttl key
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pttl key 毫秒
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 集群环境下,模糊查询key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 要是查不出来数据,99999要换成一个很大的值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SCAN &lt;span style="color:#ae81ff">0&lt;/span> MATCH * count &lt;span style="color:#ae81ff">99999&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="持久化">持久化&lt;/h1>
&lt;p>很多时候我们需要持久化数据也就是将内存中的数据写入到硬盘里面，大部分原因是为了之后重用数据（比如重启机器、机器故障之后恢复数据），或者是为了防止系统故障而将数据备份到一个远程位置。&lt;/p>
&lt;p>Redis不同于Memcached的很重一点就是，Redis支持持久化，而且支持两种不同的持久化操作。&lt;/p>
&lt;p>Redis的一种持久化方式叫快照（snapshotting，RDB）&lt;/p>
&lt;p>另一种方式是只追加文件（append-only file,AOF）&lt;/p>
&lt;p>这两种方法各有千秋，下面我会详细这两种持久化方法是什么，怎么用，如何选择适合自己的持久化方法。&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051454660.png" alt="">&lt;/p>
&lt;h2 id="rdb快照">RDB(快照)&lt;/h2>
&lt;p>save 会生成rdb文件&lt;/p>
&lt;h3 id="save指令相关配置">save指令相关配置&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>配置项&lt;/th>
&lt;th>描述&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>dbfilename dump.rdb&lt;/td>
&lt;td>指定本地数据库文件名，默认值为 dump.rdb&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>dir ./&lt;/td>
&lt;td>指定本地数据库存放目录&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>注意：&lt;strong>Redis是单线程的&lt;/strong>，所有命令都会在类似队列中排好队，不建议使用save指令，因为save指令的执行会阻塞当前Redis服务器，直到当前RDB过程完成位置，有可能会造成长时间阻塞，&lt;strong>线上环境不建议使用&lt;/strong>&lt;/p>
&lt;h3 id="bgsave指令">bgsave指令&lt;/h3>
&lt;p>手动启动后台保存操作，但不是立即执行&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051453704.png" alt="">&lt;/p>
&lt;p>执行成功了不会在控制台输出,可以在日志中看到&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>58142:M &lt;span style="color:#ae81ff">07&lt;/span> Aug &lt;span style="color:#ae81ff">2020&lt;/span> 07:23:17.355 * Starting BGSAVE &lt;span style="color:#66d9ef">for&lt;/span> SYNC with target: disk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>58142:M &lt;span style="color:#ae81ff">07&lt;/span> Aug &lt;span style="color:#ae81ff">2020&lt;/span> 07:23:17.355 * Background saving started by pid &lt;span style="color:#ae81ff">58183&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>58183:C &lt;span style="color:#ae81ff">07&lt;/span> Aug &lt;span style="color:#ae81ff">2020&lt;/span> 07:23:17.357 * DB saved on disk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>58183:C &lt;span style="color:#ae81ff">07&lt;/span> Aug &lt;span style="color:#ae81ff">2020&lt;/span> 07:23:17.357 * RDB: &lt;span style="color:#ae81ff">0&lt;/span> MB of memory used by copy-on-write
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>58142:M &lt;span style="color:#ae81ff">07&lt;/span> Aug &lt;span style="color:#ae81ff">2020&lt;/span> 07:23:17.456 * Background saving terminated with success
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>bgsave命令是针对save阻塞问题做的优化。Redis内部所有涉及到RDB操作都采用bgsave的方式，save命令可以放弃使用&lt;/p>
&lt;h3 id="save配置">save配置&lt;/h3>
&lt;pre tabindex="0">&lt;code># second：监控时间范围
# changes：监控key的变化量
save second changes
save 900 1 #在900秒(15分钟)之后，如果至少有1个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
save 300 10 #在300秒(5分钟)之后，如果至少有10个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
save 60 10000 #在60秒(1分钟)之后，如果至少有10000个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
&lt;/code>&lt;/pre>&lt;h3 id="save配置原理">save配置原理&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051453062.png" alt="">&lt;/p>
&lt;p>**注意：**save配置要根据实际业务情况进行设置，频度过高或过低都会出现性能问题，结果可能是灾难性的save配置中对second与changes设置通常具有互补对应关系，尽量不要设置成包含性关系save配置启动后执行的是bgsave操作&lt;/p>
&lt;h3 id="对比">对比&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051453536.png" alt="">&lt;/p>
&lt;h3 id="rdb启动方式">RDB启动方式&lt;/h3>
&lt;ul>
&lt;li>全量复制在主从复制中会提到&lt;/li>
&lt;li>服务器运行过程中重启debug reload&lt;/li>
&lt;li>关闭服务器时指定保存数据shutdown save&lt;/li>
&lt;/ul>
&lt;h3 id="rdb-优缺点">RDB 优缺点&lt;/h3>
&lt;h3 id="rdb优点">RDB优点&lt;/h3>
&lt;ul>
&lt;li>RDB是一个紧凑压缩的二进制文件，存储效率较高&lt;/li>
&lt;li>RDB内部存储的是redis在某个时间点的数据快照，非常适合用于数据备份，全量复制等场景&lt;/li>
&lt;li>RDB恢复数据的速度要比AOF快很多&lt;/li>
&lt;li>应用：服务器中每X小时执行bgsave备份，并将RDB文件拷贝到远程己气中，用于灾难恢复&lt;/li>
&lt;/ul>
&lt;h3 id="rdb缺点">RDB缺点&lt;/h3>
&lt;ul>
&lt;li>RDB方式无论是执行指令还是利用配置，无法做到实时持久化，具体较大的可能性丢失数据&lt;/li>
&lt;li>bgsave指令每次运行要执行fork操作创建子进程，要牺牲掉一些性能&lt;/li>
&lt;li>Redis的众多版本中未进行RDB文件格式的版本统一，有可能出现个版本服务之间数据格式无法兼容现象&lt;/li>
&lt;/ul>
&lt;h3 id="rdb存储的弊端">RDB存储的弊端&lt;/h3>
&lt;ul>
&lt;li>存储数据量较大，效率较低——基于快照思想，每次读写都是全部数据，当数据量巨大时，效率非常低&lt;/li>
&lt;li>大数据量下的IO性能较低&lt;/li>
&lt;li>基于fork创建子进程，内存产生额外消耗&lt;/li>
&lt;li>宕机带来的数据丢失风险&lt;/li>
&lt;/ul>
&lt;h3 id="解决思路">解决思路&lt;/h3>
&lt;ul>
&lt;li>不写全数据，仅记录部分数据&lt;/li>
&lt;li>改记录数据未记录操作过程&lt;/li>
&lt;li>对所有操作均进行记录，排除丢失数据的风险&lt;/li>
&lt;li>这也就是AOF的引入&lt;/li>
&lt;/ul>
&lt;h2 id="aof">AOF&lt;/h2>
&lt;h3 id="aof写数据过程">AOF写数据过程&lt;/h3>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051454829.png" alt="">&lt;/p>
&lt;h3 id="aof写数据的三种策略">AOF写数据的三种策略&lt;/h3>
&lt;pre tabindex="0">&lt;code>appendfsync always #每次有数据修改发生时都会写入AOF文件,这样会严重降低Redis的速度
appendfsync everysec #每秒钟同步一次，显示地将多个写命令同步到硬盘 **(默认的)**
appendfsync no #让操作系统决定何时进行同步
&lt;/code>&lt;/pre>&lt;h3 id="aof功能开启和相关配置">AOF功能开启和相关配置&lt;/h3>
&lt;pre tabindex="0">&lt;code># 是否开启APF持久化功能，默认为不开启
appendonly yes|no
# AOF写数据策略
appendfsync always|everysec|no
# AOF持久化文件名，默认文件名为appendonly.aof,建议配置为appendonly-端口号.aof
appendfilename filename
# AOF持久化文件保存路径，与RDB持久化文件保持一致即可
dir
&lt;/code>&lt;/pre>&lt;h3 id="重写">重写&lt;/h3>
&lt;p>随着命令的不断写入AOF，文件会越来越大，为了解决这个问题，Redis引入AOF重写机制压缩文件体积，AOF文件重写是将Redis进程内的数据转换为写命令同步到新AOF文件的过程，简单说就是将同样一个数据的若干个命令执行结果转换为最终结果数据对应的指令进行记录&lt;/p>
&lt;h3 id="aof重写作用">AOF重写作用&lt;/h3>
&lt;ul>
&lt;li>降低磁盘占用量，提高磁盘利用路&lt;/li>
&lt;li>提高持久化效率，降低持久化写时间，提高IO性能&lt;/li>
&lt;li>降低数据恢复用时，提高数据恢复效率&lt;/li>
&lt;/ul>
&lt;h3 id="aof重写规则">AOF重写规则&lt;/h3>
&lt;ul>
&lt;li>进程内已超时的数据不再写入文件&lt;/li>
&lt;li>忽略无效指令，重写时使用进程内数据直接生成，这样新的AOF文件只保留最终数据的写入命令　如del key1,hdel key2,srem key3,set key 222等&lt;/li>
&lt;li>对统一数据的多条命令合并为一条命令如 lpush list1 a ,lpush list1 b,lpush list1 c可以转化为lpush list1 a b c为防止数据量过大造成客户端缓冲区溢出，对list,set,hash,set等类型，每条指令最多写入64个元素&lt;/li>
&lt;/ul>
&lt;h3 id="重写方式">重写方式&lt;/h3>
&lt;pre tabindex="0">&lt;code># 手动重写,在命令行执行,会覆盖原来的aof文件,但是文件更小
bgrewriteaof
# 自动重写
auto-aof-rewrite-min-size size
auto-aof-rewrite-percentage percentage
&lt;/code>&lt;/pre>&lt;p>手动重写流程:&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051454591.png" alt="">&lt;/p>
&lt;p>自动重写的触发条件:&lt;/p>
&lt;pre tabindex="0">&lt;code># 自动重写触发条件设置
auto-aof-rewrite-min-size
auto-aof-rewrite-percentage percent
# 自动重写触发对比参数（运行指令info Persistence获取具体信息）
aof_current_size
aof_base_size
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://image.runtimes.cc/202404051517623.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051455402.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051456010.png" alt="">&lt;/p>
&lt;h2 id="aof和rdb的区别">AOF和RDB的区别&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051456409.png" alt="">&lt;/p>
&lt;h3 id="rdb和aof的选择之感">RDB和AOF的选择之感&lt;/h3>
&lt;ul>
&lt;li>对数据非常敏感，建议使用默认的AOF持久化方案AOF持久化策略使用erverysecond，每秒钟fsync一次。该策略redis任然可以保持很好的处理性能，当出现问题时，最多丢失0-1秒中的数据。注意：由于AOF文件存储体积较大，且恢复数据较慢&lt;/li>
&lt;li>数据呈现阶段有效性，建议使用RDB持久化方案数据可以良好的做到阶段内无丢失（该阶段是开发者或运维人工手工维护的），且恢复速度较快，阶段点数据恢复通常采用RDB方案注意：利用RDB实现紧凑的数据持久化会使Redis降得很低&lt;/li>
&lt;li>综合对比&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>RDB与AOF得选择实际上是在做一种权衡，每种都有利弊&lt;/li>
&lt;li>如不能承受数分钟以内得数据丢失，对业务数据非常敏感，选用AOF&lt;/li>
&lt;li>如能承受数分钟以内数据丢失，且追求大数据集得恢复速度，选用RDB灾难恢复选用RDB&lt;/li>
&lt;li>双保险策略，同时开启RDB和AOF，重启后，Redis优先使用AOF来恢复数据，降低丢失数据的量&lt;/li>
&lt;/ol>
&lt;h2 id="redis-40-对于持久化机制的优化">&lt;strong>Redis 4.0 对于持久化机制的优化&lt;/strong>&lt;/h2>
&lt;p>Redis 4.0 开始支持 RDB 和 AOF 的混合持久化（默认关闭，可以通过配置项 &lt;code>aof-use-rdb-preamble&lt;/code> 开启）。&lt;/p>
&lt;p>如果把混合持久化打开，AOF 重写的时候就直接把 RDB 的内容写到 AOF 文件开头。这样做的好处是可以结合 RDB 和 AOF 的优点, 快速加载同时避免丢失过多的数据。当然缺点也是有的， AOF 里面的 RDB 部分是压缩格式不再是 AOF 格式，可读性较差。&lt;/p>
&lt;h1 id="事务">事务&lt;/h1>
&lt;pre tabindex="0">&lt;code># 开启事务,设定事务的开启位置，此指令执行后，后续的所有指令均加入到事务中
multi
# 执行提交事务,加入事务的命令暂时到任务队列中，并没有立即执行，只有执行exec命令才开始执行
exec
# 取消事务,终止当前事务定义，发生在multi之后，exec之前
discard
&lt;/code>&lt;/pre>&lt;h2 id="事务的工作流程">事务的工作流程&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051456083.png" alt="">&lt;/p>
&lt;h2 id="事务的注意事项">事务的注意事项&lt;/h2>
&lt;ul>
&lt;li>语法错误指命令书写格式有误&lt;/li>
&lt;li>处理结果如果定义的事务中所包含的命令存在语法错误，整体事务中所有命令均不会被执行。包括那些语法正确的命令&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>运行错误指命令格式正确，但是无法正常的执行。例如对list进行incr操作&lt;/li>
&lt;li>处理结果能够正确运行的命令会执行，运行错误的命令不会执行注意：已经执行完毕的命令对应的数据不会自动回滚，需要程序员自己在代码中实现回滚。&lt;/li>
&lt;/ul>
&lt;h3 id="手动进行事务回滚基本没法用">手动进行事务回滚(基本没法用)&lt;/h3>
&lt;ul>
&lt;li>记录操作过程中被影响的数据之前的状态单数据：string多数据：hash,list,set,zset&lt;/li>
&lt;li>设置指令恢复所有的被修改的项单数据：直接set（注意周边属性，例如时效）多数据：修改对应值或整体克隆复制&lt;/li>
&lt;/ul>
&lt;h1 id="锁">锁&lt;/h1>
&lt;pre tabindex="0">&lt;code># 对key添加监视锁，在执行exec前如果key发生了变化，终止事务执行
watch key1 [key2…]
# 取消对所有key的监视
unwatch
&lt;/code>&lt;/pre>&lt;h2 id="分布式锁">分布式锁&lt;/h2>
&lt;pre tabindex="0">&lt;code># 加锁
setnx lock-key value
# 设置超时时间
expire lock-key second
# 删除锁
dek lock-key
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>利用setnx命令的返回值特征，有值则返回设置失败，无值则返回设置成功&lt;/li>
&lt;li>对于返回设置成功的，拥有控制权，进行下一步的具体业务操作&lt;/li>
&lt;li>对于返回设置失败的，不具有控制权，排队或等待操作完毕通过&lt;strong>del&lt;/strong>操作释放锁&lt;/li>
&lt;/ul>
&lt;h1 id="删除策略">删除策略&lt;/h1>
&lt;h2 id="过期数据删除策略">过期数据删除策略&lt;/h2>
&lt;ul>
&lt;li>Redis是一种内存级数据库，所有数据均存放在内存中，内存中的数据可以通过TTL指令获取其状态&lt;/li>
&lt;li>XX : 具有时效性的数据&lt;/li>
&lt;li>1 : 永久有效的数据&lt;/li>
&lt;li>2 : 已经国企的数据 或 被删除的数据 或 未定义的数据&lt;/li>
&lt;/ul>
&lt;h2 id="时效性数据的存储结构">时效性数据的存储结构&lt;/h2>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457852.png" alt="">&lt;/p>
&lt;h3 id="定时删除">定时删除&lt;/h3>
&lt;ul>
&lt;li>创建一个定时器，当key设置过期时间，且过期时间到达时，由定时器任务立即执行对键的删除操作&lt;/li>
&lt;li>&lt;strong>优点&lt;/strong>：节约内存，到时就删除，快速释放掉不必要的内存占用&lt;/li>
&lt;li>&lt;strong>缺点&lt;/strong>：CPU压力很大，无论CPU此时负载多高，均占用CPU，会影响redis服务器响应时间和指令吞吐量&lt;/li>
&lt;li>&lt;strong>总结&lt;/strong>：用处理器性能换取存储空间&lt;/li>
&lt;/ul>
&lt;h3 id="惰性删除">惰性删除&lt;/h3>
&lt;ul>
&lt;li>数据到达过期时间，不做处理。等下次访问该数据&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>如果未过期，返回数据&lt;/li>
&lt;li>发现已经过期，删除，返回不存在&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>优点：节约CPU性能，发现必须删除的时候才删除&lt;/li>
&lt;li>缺点：内存压力很大，出现长期占用内存的数据&lt;/li>
&lt;li>总结：用存储空间换取处理器性能&lt;/li>
&lt;/ul>
&lt;h3 id="定期删除">定期删除&lt;/h3>
&lt;ul>
&lt;li>Redis启动服务器初始化时，读取配置server.hz的值，默认为10&lt;/li>
&lt;li>每秒钟执行server.hz次serverCron()&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457886.png" alt="">&lt;/p>
&lt;ul>
&lt;li>周期性轮询redis库中时效性数据，采用随机抽取的策略，利用过期数据占比的方式删除频度&lt;/li>
&lt;li>特点1：CPU性能占用设置有峰值，检测频度可自定义设置&lt;/li>
&lt;li>特点2：内存压力不是很大，长期占用内存的冷数据会被持续清理&lt;/li>
&lt;li>总结：周期性抽查存储空间&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051516388.png" alt="">&lt;/p>
&lt;h1 id="逐出算法">逐出算法&lt;/h1>
&lt;ul>
&lt;li>Redis使用内存存储数据，在执行每一个命令前，会调用freeMemorylfNeeded()检测内存是否充足。如果内存不满足新加入数据的最低存储要求，redis要临时删除一些数据为当前指令清理存储空间。清理数据的策略称为逐出算法。&lt;/li>
&lt;li>注意：逐出数据的过程不是100%能够清理出足够的可使用的内存空间，如果不成功则反复执行。当对所有数据尝试完毕后，如果不能达到内存清理的要求，将出现错误信息&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457056.png" alt="">&lt;/p>
&lt;p>相关配置&lt;/p>
&lt;pre tabindex="0">&lt;code># 最大可使用内存
maxmemory
# 每次选取代删除数据的个数
maxmemory-samples
# 删除策略
maxmemory-policy
&lt;/code>&lt;/pre>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>属性&lt;/th>
&lt;th>说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>volatile-lru&lt;/td>
&lt;td>从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>volatile-ttl&lt;/td>
&lt;td>从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>volatile-random&lt;/td>
&lt;td>从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>volatile-lfu&lt;/td>
&lt;td>从已设置过期时间的数据集(server.db[i].expires)中挑选最不经常使用的数据淘汰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>allkeys-lru&lt;/td>
&lt;td>当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key （这个是最常用的）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>allkeys-random&lt;/td>
&lt;td>从数据集（server.db[i].dict）中任意选择数据淘汰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>allkeys-lfu&lt;/td>
&lt;td>当内存不足以容纳新写入数据时，在键空间中，移除最不经常使用的key&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>no-eviction&lt;/td>
&lt;td>禁止驱逐数据，也就是说当内存不足以容纳新写入数据时，新写入操作会报错。这个应该没人使用吧！&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457458.png" alt="">&lt;/p>
&lt;p>数据逐出策略配置依据&lt;/p>
&lt;ul>
&lt;li>使用INFO命令输出监控信息，查询缓存int和miss的次数，根据业务需求调优Redis配置&lt;/li>
&lt;/ul>
&lt;h1 id="配置文件">配置文件&lt;/h1>
&lt;pre tabindex="0">&lt;code># 设置服务器以守护进程的方式运行
deamonize yes|no
# 绑定主机地址
bind 127.0.0.1
# 设置服务器端口号
port 6379
# 设置数据库数量
databases 16
----------------------------------日志配置--------------------------------------
# 设置服务器以指定日志记录级别
loglevel debug|verbose|notice|warning
# 日志记录文件名
logfile 端口号.log
# 持久化文件存放目录
dir ./
----------------------------------日志配置--------------------------------------
# 设置同一时间最大客户链接数，默认无限制。当客户端连接到达上线，Redis会关闭新的链接
maxclients 0
# 客户端限制等待最大时常，达到最大之后关闭连接。如需关闭该功能，设置为0
timeout 300
&lt;/code>&lt;/pre>&lt;h1 id="redis-cluster结构设计">Redis-Cluster结构设计&lt;/h1>
&lt;h1 id="数据存储设计">数据存储设计&lt;/h1>
&lt;p>Key -&amp;gt; CRC16(Key) 相当于HashCode值&amp;mdash;&amp;gt;%16384&lt;/p>
&lt;ul>
&lt;li>将所有的存储空间计划切割成16384份，每台主机保存一部分,每份代表的使一个存储空间，不是一个key的保存空间&lt;/li>
&lt;li>将key按照计算出的结果放到对应的存储空间&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457725.png" alt="">&lt;/p>
&lt;p>当有新的机器加入集群的时候,就会每台机器转移一些数据空间&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051457378.png" alt="">&lt;/p>
&lt;h1 id="集群内部通讯设计">集群内部通讯设计&lt;/h1>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051458468.png" alt="">&lt;/p>
&lt;h1 id="集群常用命令">集群常用命令&lt;/h1>
&lt;p>参考:&lt;a href="https://www.cnblogs.com/kevingrace/p/7910692.html">https://www.cnblogs.com/kevingrace/p/7910692.html&lt;/a>&lt;/p>
&lt;p>以下命令是Redis Cluster集群所独有的，执行下面命令需要先登录redis&lt;/p>
&lt;pre tabindex="0">&lt;code># （客户端命令：redis-cli -c -p port -h ip）
[root@manage redis]# redis-cli -c -p 6382 -h 192.168.10.12
192.168.10.12:6382&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>集群&lt;code>cluster info&lt;/code> ：打印集群的信息&lt;code>cluster nodes&lt;/code> ：列出集群当前已知的所有节点（ node），以及这些节点的相关信息。&lt;/li>
&lt;li>节点&lt;code>cluster meet &amp;lt;ip&amp;gt; &amp;lt;port&amp;gt;&lt;/code> ：将 ip 和 port 所指定的节点添加到集群当中，让它成为集群的一份子。&lt;code>cluster forget &amp;lt;node_id&amp;gt;&lt;/code>：从集群中移除 node_id 指定的节点。&lt;code>cluster replicate &amp;lt;master_node_id&amp;gt;&lt;/code> ：将当前从节点设置为 node_id 指定的master节点的slave节点。只能针对slave节点操作。&lt;code>cluster saveconfig&lt;/code> ：将节点的配置文件保存到硬盘里面。&lt;/li>
&lt;li>slot&lt;code>cluster addslots &amp;lt;slot&amp;gt; [slot ...]&lt;/code> ：将一个或多个槽（ slot）指派（ assign）给当前节点。&lt;code>cluster delslots &amp;lt;slot&amp;gt; [slot ...]&lt;/code> ：移除一个或多个槽对当前节点的指派。&lt;code>cluster flushslots&lt;/code> ：移除指派给当前节点的所有槽，让当前节点变成一个没有指派任何槽的节点。&lt;code>cluster setslot &amp;lt;slot&amp;gt; node &amp;lt;node_id&amp;gt;&lt;/code>：将槽 slot 指派给 node_id 指定的节点，如果槽已经指派给&lt;/li>
&lt;li>另一个节点，那么先让另一个节点删除该槽&amp;gt;，然后再进行指派&lt;code>cluster setslot &amp;lt;slot&amp;gt; migrating &amp;lt;node_id&amp;gt;&lt;/code>：将本节点的槽 slot 迁移到 node_id 指定的节点中。&lt;code>cluster setslot &amp;lt;slot&amp;gt; importing &amp;lt;node_id&amp;gt;&lt;/code> ：从 node_id 指定的节点中导入槽 slot 到本节点。&lt;code>cluster setslot &amp;lt;slot&amp;gt; stable&lt;/code>：取消对槽 slot 的导入（ import）或者迁移（ migrate）。&lt;/li>
&lt;li>键&lt;code>cluster keyslot &amp;lt;key&amp;gt;&lt;/code>：计算键 key 应该被放置在哪个槽上。&lt;code>cluster countkeysinslot &amp;lt;slot&amp;gt;&lt;/code>：返回槽 slot 目前包含的键值对数量。&lt;code>cluster getkeysinslot &amp;lt;slot&amp;gt; &amp;lt;count&amp;gt;&lt;/code>：返回 count 个 slot 槽中的键 。&lt;/li>
&lt;/ul>
&lt;h1 id="解决方案">解决方案&lt;/h1>
&lt;h1 id="缓存预热">缓存预热&lt;/h1>
&lt;p>在高请求之前，做好一系列措施，保证大量用户数量点击造成灾难。&lt;/p>
&lt;ol>
&lt;li>请求数量较高&lt;/li>
&lt;li>主从之间数据吞吐量较大，数据同步操作频度较高&lt;/li>
&lt;/ol>
&lt;h3 id="缓存预热解决方案">缓存预热解决方案&lt;/h3>
&lt;p>前置准备工作：&lt;/p>
&lt;ol>
&lt;li>日常例行统计数据访问记录，统计访问频度较高的热点数据&lt;/li>
&lt;li>利用LRU数据删除策略，构建数据留存队列例如：storm与kafka配合&lt;/li>
&lt;/ol>
&lt;p>准备工作：&lt;/p>
&lt;ol>
&lt;li>将统计结果中的数据分类，根据级别，redis优先加载级别较高的热点数据&lt;/li>
&lt;li>利用分布式多服务器同时进行数据读取，提速数据加载过程&lt;/li>
&lt;/ol>
&lt;p>实施：&lt;/p>
&lt;ol>
&lt;li>使用脚本程序固定出大数据预热过程&lt;/li>
&lt;li>如果条件允许，使用CDN（内容分发网络），效果会更好&lt;/li>
&lt;/ol>
&lt;p>缓存预热总结：缓存预热就是系统启动前，提前将相关的缓存数据直接加载到缓存系统。避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题！用户直接查询事先被预热的缓存数据!&lt;/p>
&lt;h1 id="缓存雪崩">缓存雪崩&lt;/h1>
&lt;ol>
&lt;li>系统平稳运行过程中，忽然数据库连接量激增&lt;/li>
&lt;li>应用服务器无法及时请求&lt;/li>
&lt;li>大量408，500错误页面出现&lt;/li>
&lt;li>客户反复刷新页面获取数据&lt;/li>
&lt;li>数据库崩溃&lt;/li>
&lt;li>应用服务器崩溃&lt;/li>
&lt;li>重启应用服务器无效&lt;/li>
&lt;li>Redis服务器崩溃&lt;/li>
&lt;li>Redis集群崩溃&lt;/li>
&lt;li>重启数据之后再次被瞬间流量放倒&lt;/li>
&lt;/ol>
&lt;h3 id="问题排查">问题排查&lt;/h3>
&lt;p>简介：缓存同一时间大面积的失效，所以，后面的请求都会落到数据库上，造成数据库短时间内承受大量请求而崩掉&lt;/p>
&lt;ol>
&lt;li>在一个较短的时间内，缓存中较多的key集中过期&lt;/li>
&lt;li>此周期内请求访问过期的数据，redis未命中，redis向数据库获取数据&lt;/li>
&lt;li>数据库同时接受到大量的请求无法即时处理&lt;/li>
&lt;li>Redis大量请求被积压，开始出现超时现象&lt;/li>
&lt;li>数据库流量激增，数据库崩溃&lt;/li>
&lt;li>重启后任然面对缓存中无数据可用&lt;/li>
&lt;li>Redis服务器资源被严重占用，Redis服务器崩溃&lt;/li>
&lt;li>Redis集群呈现崩塌，集群瓦解&lt;/li>
&lt;li>应用服务器无法即时得到数据响应请求，来自客户端的请求数量越来越多，应用服务器崩溃&lt;/li>
&lt;li>应用服务器，redis，数据库全部重启，效果不理想&lt;/li>
&lt;/ol>
&lt;h3 id="问题分析">问题分析&lt;/h3>
&lt;ul>
&lt;li>短时间范围内&lt;/li>
&lt;li>大量key集中过期&lt;/li>
&lt;/ul>
&lt;h3 id="解决方案道">解决方案（道）&lt;/h3>
&lt;ol>
&lt;li>更多的页面静态化处理&lt;/li>
&lt;li>构建多级缓存架构Nginx缓存+redis缓存+ehcache缓存&lt;/li>
&lt;li>检测Mysql严重耗时业务进行优化对数据库的瓶颈排查：例如超时查询、耗时较高事务等&lt;/li>
&lt;li>灾难预警机制监控redis服务器性能指标1、CPU占用、CPU使用率2、内存容量3、查询平均响应时间4、线程数&lt;/li>
&lt;li>限流、降级短时间范围内习生一些客户体验，限制一部分请求访问，降低应用服务器压力，待业务低速运转后再逐渐放开访问&lt;/li>
&lt;/ol>
&lt;h3 id="解决方案术">解决方案（术）&lt;/h3>
&lt;ol>
&lt;li>LRU与LFU切换&lt;/li>
&lt;li>数据有效期策略调整根据业务数据有效期进行分类错峰，A类90分钟，B类80分钟，C类70分钟过期时间使用固定形式+随机值的形式，稀释集中到期的key的数量&lt;/li>
&lt;li>超热数据使用永久key&lt;/li>
&lt;li>定期维护（自动+人工）对即将过期数据做访问量分析，确认是否演示，配合访问量统计，做热点数据的延时&lt;/li>
&lt;li>加锁 慎用！！！！！！！&lt;/li>
&lt;/ol>
&lt;p>总结缓存雪崩式瞬间过期数量太大，导致对数据库服务器造成压力。如果能有效避免过期时间集中，可以有效解决雪崩现象的出现（约40%）。配合其他策略一起使用，并监控服务器的运行数据，根据运行巨鹿做快速调整&lt;/p>
&lt;p>&lt;img src="https://image.runtimes.cc/202404051458329.png" alt="">&lt;/p>
&lt;h1 id="缓存击穿">缓存击穿&lt;/h1>
&lt;h3 id="数据库服务器崩溃2">数据库服务器崩溃（2）&lt;/h3>
&lt;ol>
&lt;li>系统平稳运行过程中&lt;/li>
&lt;li>数据库连接量瞬间激增&lt;/li>
&lt;li>Redis服务器无大量key过期&lt;/li>
&lt;li>Redis内存平稳，无波动&lt;/li>
&lt;li>Redis服务器CPU正常&lt;/li>
&lt;li>数据库崩溃&lt;/li>
&lt;/ol>
&lt;h3 id="问题排查-1">问题排查&lt;/h3>
&lt;ol>
&lt;li>Redis中某个key过期，该key访问量巨大&lt;/li>
&lt;li>多个数据请求从服务器直接压到Redis后，均为命中&lt;/li>
&lt;li>Redis在短时间内发起了大量对数据库中同一个数据的访问&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>问题分析&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>单个key高热数据&lt;/li>
&lt;li>key过期&lt;/li>
&lt;/ul>
&lt;h3 id="解决方案术-1">解决方案（术）&lt;/h3>
&lt;ol>
&lt;li>预先设定以电商为例，每个商家根据店铺等级，指定若干款主打商品，在购物节期间，加大此类信息key的过期时常注意：购物节不仅仅指当天，以及后续若干天，访问峰值呈现逐渐降低趋势&lt;/li>
&lt;li>现场调整监控访问量，对自然流量激增的数据延长过期时间或设置为永久性key&lt;/li>
&lt;li>后台刷新数据启动定时任务，高峰期来临之前，刷新数据有效期，保存不丢失&lt;/li>
&lt;li>二级缓存设置不同的失效时间，保障不会被同时淘汰就行&lt;/li>
&lt;li>加锁分布式锁，防止被击穿，但是要注意也是性能瓶颈，慎重！！！！！！！！&lt;/li>
&lt;/ol>
&lt;p>总结：缓存击穿就是单个高热数据过期的瞬间，数据访问较大，未命中redis后，发起了大量对同一数据的数据库访问，导致对数据库服务器造成压力。应对策略应该在业务数据分析与预防方面进行，配合运行监控测试与即时调整策略，毕竟单个key的过期监控难度较高，配合雪崩处理策略即可&lt;/p>
&lt;h1 id="缓存穿透">缓存穿透&lt;/h1>
&lt;h3 id="数据库服务器崩溃3">数据库服务器崩溃（3）&lt;/h3>
&lt;p>简介：一般是黑客故意去请求缓存中不存在的数据，导致所有的请求都落到数据库上，造成数据库短时间内承受大量请求而崩掉。&lt;/p>
&lt;ol>
&lt;li>系统平稳运行过程中&lt;/li>
&lt;li>应用服务器流量随时间增量较大&lt;/li>
&lt;li>Redis服务器命中率随时间逐步降低&lt;/li>
&lt;li>Redis内存平稳，内存无压力&lt;/li>
&lt;li>Redis服务器CPU占用激增&lt;/li>
&lt;li>数据库服务器压力激增&lt;/li>
&lt;li>数据库崩溃&lt;/li>
&lt;/ol>
&lt;h3 id="问题排查-2">问题排查&lt;/h3>
&lt;ol>
&lt;li>redis中大面积出现未命中&lt;/li>
&lt;li>出现非正常URL访问&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>问题分析&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>获取的数据在数据库中也不存在，数据库查询未得到对应数据&lt;/li>
&lt;li>Redis获取到null数据未进行持久化，直接返回&lt;/li>
&lt;li>下次此类数据到达重复上述过程&lt;/li>
&lt;li>出现黑客攻击服务器&lt;/li>
&lt;/ul>
&lt;h3 id="解决方法术">解决方法（术）&lt;/h3>
&lt;ol>
&lt;li>缓存null对查询结果为null的数据进行缓存（长期使用，定期清理），设定短时限，例如30-60秒，最高五分钟&lt;/li>
&lt;li>白名单策略提前预热各种分类数据id对应的bitmaps,id作为bitmaps的offset,相当于设置了数据白名单。当加载正常数据后放型，加载异常数据时直接拦截（效率偏低）使用布隆过滤器（有关布隆过滤器的命中问题对当前状态可以忽略）&lt;/li>
&lt;li>实时监控试试监控redis命中率（业务正常范围时，通常回有一个波动值）与null数据的占比非活动时间波动：通常检测3-5倍，超过5倍纳入重点排查对象活动时间波动：通常检测10-50倍，超过50倍纳入重点排查对象根据背书不同，启动不同的排查流程。然后使用黑名单进行防控（运营）&lt;/li>
&lt;li>key加密问题出现后，临时启动防灾业务key,对key进行业务层传输加密服务，设定校验程序，过来的key校验例如每天随机分配60个加密串，挑选2-3个，混淆到页面数据id中，发现访问key不满足规则，驳回数据访问&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>总结&lt;/strong>缓存穿透是访问了不存在的数据，跳过了合法数据的redis数据缓存阶段，每次访问数据库，导致对数据库服务器造成压力。通常此类数据的出现量是一个较低的值，当出现此类情况以毒攻毒，并即时报警。应对策略应该在临时预案防范方面多做文章无论是黑名单还是白名单，都是对整体系统的压力，警报解除后尽快移除&lt;/p>
&lt;h1 id="redis-java">Redis-Java&lt;/h1>
&lt;h1 id="单机jedis">单机Jedis&lt;/h1>
&lt;pre tabindex="0">&lt;code>/**
* 192.168.0.5 单机
*/
public class SingletonDemo {
private Jedis jedis;
@Before
public void before() {
//指定Redis服务Host和port
jedis = new Jedis(&amp;#34;192.168.0.5&amp;#34;, 6379);
}
@After
public void after() {
//使用完关闭连接
jedis.close();
}
/**
* 设值
*/
@Test
public void set() {
//访问Redis服务
jedis.set(&amp;#34;k1&amp;#34;, &amp;#34;v1&amp;#34;);
System.out.println(jedis.get(&amp;#34;k1&amp;#34;));
}
/**
* 设值,并且设置超时时间
*/
@Test
public void setTime() {
String key = &amp;#34;setTimeKey&amp;#34;;
jedis.setex(key, 20000, &amp;#34;setTimeValue&amp;#34;);
System.out.println(jedis.get(key));
System.out.println(jedis.ttl(key));
}
/**
* 分布式锁原理,
* key不存在的时候才插入
*/
@Test
public void setNX() {
String key = &amp;#34;setNXKey&amp;#34;;
// 1.先插入一个值
jedis.set(key, &amp;#34;setNXValue&amp;#34;);
// 2.NX是不存在时才set， XX是存在时才set， EX是秒，PX是毫秒
String set = jedis.set(key, &amp;#34;setNXValue---NX&amp;#34;, &amp;#34;NX&amp;#34;, &amp;#34;EX&amp;#34;, 20000L);
System.out.println(set);
System.out.println(jedis.get(key));
System.out.println(jedis.ttl(key));
System.out.println(&amp;#34;======================================================&amp;#34;);
// 3.设置个没有的key
String key2 = &amp;#34;setNXKey2&amp;#34;;
String set2 = jedis.set(key2, &amp;#34;setNXValue2---NX&amp;#34;, &amp;#34;NX&amp;#34;, &amp;#34;EX&amp;#34;, 20000L);
System.out.println(set2);
System.out.println(jedis.get(key2));
System.out.println(jedis.ttl(key2));
}
/**
* key存在时才插入
*/
@Test
public void setXX() {
String key = &amp;#34;setXXKey&amp;#34;;
// 1.先插入一个值
jedis.set(key, &amp;#34;setXXValue&amp;#34;);
// 2.NN
String set = jedis.set(key, &amp;#34;setXXValue---XX&amp;#34;, &amp;#34;XX&amp;#34;, &amp;#34;EX&amp;#34;, 20000L);
System.out.println(set);
System.out.println(jedis.get(key));
System.out.println(jedis.ttl(key));
System.out.println(&amp;#34;======================================================&amp;#34;);
// 3.设置个没有的key
String key2 = &amp;#34;setXXKey2&amp;#34;;
String set2 = jedis.set(key2, &amp;#34;setXXValue2---NX&amp;#34;, &amp;#34;XX&amp;#34;, &amp;#34;EX&amp;#34;, 20000L);
System.out.println(set2);
System.out.println(jedis.get(key2));
System.out.println(jedis.ttl(key2));
}
@Test
public void expire() {
}
/**
* redis监控信息
*/
@Test
public void info() {
String info = jedis.info();
Stream.of(info.split(&amp;#34;\r\n&amp;#34;)).forEach(row -&amp;gt; {
String[] split = row.split(&amp;#34;:&amp;#34;);
if (split.length == 2) {
System.out.printf(&amp;#34;key:%s ==== value:%s \r\n&amp;#34;,split[0],split[1]);
}
}
);
}
/**
* jedispool
*/
@Test
public void jedisPool() throws InterruptedException {
StopWatch watch = new StopWatch();
watch.start();
for (int i = 0; i &amp;lt; 100000; i++) {
jedis.set(i + &amp;#34;&amp;#34;, i + &amp;#34;&amp;#34;);
jedis.close();
}
watch.stop();
System.out.println(&amp;#34;5-&amp;#34;+watch.getTime());
}
@Test
public void jedisPool2() {
// 替换成你的reids地址和端口
String redisIp = &amp;#34;192.168.0.5&amp;#34;;
int reidsPort = 6379;
JedisPool jedisPool = new JedisPool(new JedisPoolConfig(), redisIp, reidsPort);
Jedis resource = jedisPool.getResource();
StopWatch watch = new StopWatch();
watch.start();
for (int i = 0; i &amp;lt; 100000; i++) {
resource.set(i + &amp;#34;&amp;#34;, i + &amp;#34;&amp;#34;);
}
watch.stop();
System.out.println(&amp;#34;5-&amp;#34;+watch.getTime());
}
}
&lt;/code>&lt;/pre>&lt;h1 id="单机jedis连接集群节点">单机Jedis连接集群节点&lt;/h1>
&lt;p>会报错&lt;/p>
&lt;pre tabindex="0">&lt;code>redis.clients.jedis.exceptions.JedisMovedDataException: MOVED 12706 192.168.0.8:6379
at redis.clients.jedis.Protocol.processError(Protocol.java:115)
at redis.clients.jedis.Protocol.process(Protocol.java:161)
at redis.clients.jedis.Protocol.read(Protocol.java:215)
at redis.clients.jedis.Connection.readProtocolWithCheckingBroken(Connection.java:340)
at redis.clients.jedis.Connection.getStatusCodeReply(Connection.java:239)
at redis.clients.jedis.Jedis.set(Jedis.java:121)
at reids.ClusterDemo.set(ClusterDemo.java:68)
&lt;/code>&lt;/pre>&lt;h1 id="集群jedis">集群Jedis&lt;/h1>
&lt;pre tabindex="0">&lt;code>/**
* anthony@base:/var/log/redis$ redis-cli --cluster check 192.168.0.6:6379
* 192.168.0.6:6379 (99af86e5...) -&amp;gt; 0 keys | 5461 slots | 1 slaves.
* 192.168.0.8:6379 (982f74c7...) -&amp;gt; 3 keys | 5461 slots | 1 slaves.
* 192.168.0.7:6379 (1069a632...) -&amp;gt; 0 keys | 5462 slots | 1 slaves.
* [OK] 3 keys in 3 masters.
* 0.00 keys per slot on average.
* &amp;gt;&amp;gt;&amp;gt; Performing Cluster Check (using node 192.168.0.6:6379)
* M: 99af86e59c7f5a4ddf212b29e9e1b12fa5e7a866 192.168.0.6:6379
* slots:[0-5460] (5461 slots) master
* 1 additional replica(s)
* S: 102517bddae6af2434519e8f348cf062b0152fa7 192.168.0.9:6379
* slots: (0 slots) slave
* replicates 982f74c79ed5c5811b7011507c56f81374c70a0b
* S: 392c5e4dcd5608c74a76902668ed58fb6ab50aaf 192.168.0.11:6379
* slots: (0 slots) slave
* replicates 1069a6320a0489f63e807c970c27f86f13f417cf
* S: 4d12dd0de1af9d90bfac7dd141c36c348071d59f 192.168.0.10:6379
* slots: (0 slots) slave
* replicates 99af86e59c7f5a4ddf212b29e9e1b12fa5e7a866
* M: 982f74c79ed5c5811b7011507c56f81374c70a0b 192.168.0.8:6379
* slots:[10923-16383] (5461 slots) master
* 1 additional replica(s)
* M: 1069a6320a0489f63e807c970c27f86f13f417cf 192.168.0.7:6379
* slots:[5461-10922] (5462 slots) master
* 1 additional replica(s)
* [OK] All nodes agree about slots configuration.
* &amp;gt;&amp;gt;&amp;gt; Check for open slots...
* &amp;gt;&amp;gt;&amp;gt; Check slots coverage...
* [OK] All 16384 slots covered.
*/
public class ClusterDemo {
private JedisCluster jedis;
@Before
public void before() {
Set&amp;lt;HostAndPort&amp;gt; nodes = new HashSet&amp;lt;&amp;gt;();
nodes.add(new HostAndPort(&amp;#34;192.168.0.6&amp;#34;, 6379));
nodes.add(new HostAndPort(&amp;#34;192.168.0.7&amp;#34;, 6379));
nodes.add(new HostAndPort(&amp;#34;192.168.0.8&amp;#34;, 6379));
nodes.add(new HostAndPort(&amp;#34;192.168.0.9&amp;#34;, 6379));
nodes.add(new HostAndPort(&amp;#34;192.168.0.10&amp;#34;, 6379));
nodes.add(new HostAndPort(&amp;#34;192.168.0.11&amp;#34;, 6379));
GenericObjectPoolConfig poolConfig = new GenericObjectPoolConfig();
jedis = new JedisCluster(nodes,poolConfig);
}
@After
public void after() throws IOException {
//使用完关闭连接
jedis.close();
}
/**
* 设值
*/
@Test
public void set() {
//访问Redis服务
jedis.set(&amp;#34;k1&amp;#34;, &amp;#34;v1&amp;#34;);
System.out.println(jedis.get(&amp;#34;k1&amp;#34;));
}
/**
* redis集群的节点信息
* map.key = IP:PORT
*/
@Test
public void info() {
Map&amp;lt;String, JedisPool&amp;gt; clusterNodes = jedis.getClusterNodes();
clusterNodes.keySet().forEach(key-&amp;gt;{
System.out.printf(&amp;#34;%s==%s\r\n&amp;#34;,key,clusterNodes.get(key).getResource().info());
});
}
}
&lt;/code>&lt;/pre>&lt;p>RedisTemplate&lt;/p>
&lt;pre tabindex="0">&lt;code># 插入
myVO.setCode(typeCode);
redisTemplate.opsForList().rightPush(key, JSONUtil.toJsonStr(myVO));
# 取出
List&amp;lt;String&amp;gt; range = redisTemplate.opsForList().range(key, 0, 100);
# 删除取出的
# trim 是保留的意思
if(range.size() &amp;gt;0){
redisTemplate.opsForList().trim(key, range.size() + 1, -1);
}
&lt;/code>&lt;/pre></content></item></channel></rss>