<!doctype html><html lang=zh><head><title>Java :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=../../tags/java/><link rel=stylesheet href=../../styles.css><link rel="shortcut icon" href=../../img/theme-colors/orange.png><link rel=apple-touch-icon href=../../img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta property="og:title" content="Java"><meta property="og:description" content><meta property="og:url" content="/tags/java/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="/img/favicon/orange.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=../../tags/java/index.xml rel=alternate type=application/rss+xml title="Hello World"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></nav></header><div class=content><h1>Posts for: #Java</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=../../posts/tron/>Tron</a></h1><div class=post-meta><time class=post-date>2023-12-20</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/java/>Java</a>&nbsp;
#<a href=../../tags/%E5%8C%BA%E5%9D%97%E9%93%BE/>区块链</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051535708.png class=post-cover alt=Tron title="Cover Image"><div class=post-content><blockquote><p><a href=https://cn.developers.tron.network/reference/quickstart>波场官方trident-java文档</a></p><p><a href=https://blog.csdn.net/u013903024/article/details/121263515>m1 mac Android protobuf 遇到的问题</a></p><p><a href=https://tronprotocol.github.io/documentation-zh/api/http/#walletcreateaccount>tron中文文档</a></p><p><a href=https://blog.csdn.net/sail331x/article/details/112972860>trc20离线签名的demo,有trxdent-java,就不需要这个了,使用http的方式可以看看</a></p><p><a href="https://blog.csdn.net/sail331x/article/details/114765892?spm=1001.2101.3001.6650.4&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-4-114765892-blog-112972860.235%5Ev39%5Epc_relevant_anti_t3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-4-114765892-blog-112972860.235%5Ev39%5Epc_relevant_anti_t3&amp;utm_relevant_index=5">trc20离线签名的demo,有trxdent-java,就不需要这个了,使用http的方式可以看看,另外一个demo</a></p><p><a href=https://liukay.com/>要继续学习tron可以看看</a></p></blockquote><p>打包依赖</p><p><a href=https://github.com/tronprotocol/trident>下载源文件trident-java</a></p><p>这里选择<code>main</code>分支</p><p><img src=https://image.runtimes.cc/202404051500865.png alt=在这里插入图片描述></p><p>进入trident-java文件夹,可以看到有build.gradle,如果是mac系统,修改一下依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>protoc <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// 原来的依赖
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        artifact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;com.google.protobuf:protoc:3.12.0&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 修改之后的依赖
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        artifact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;com.google.protobuf:protoc:3.12.0:osx-x86_64&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        grpc <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> 						<span style=color:#75715e>// 原来的依赖
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            artifact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;io.grpc:protoc-gen-grpc-java:1.31.0&#39;</span>
</span></span><span style=display:flex><span>						<span style=color:#75715e>// 修改之后的依赖
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            artifact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;io.grpc:protoc-gen-grpc-java:1.31.0:osx-x86_64&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>IDEA打包<img src=https://image.runtimes.cc/202404051500207.png alt=image-20231220205836156></p><p>打包之后,在每个子模块的<code>build/libs/xxx-jar</code></p><p><img src=https://image.runtimes.cc/202404051500763.png alt=image-20231220210042662></p><p>下面的操作就可以跟着开发文档了,创建项目</p><p>pom.xml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>org.tron.trident<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>abi<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>0.8.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;scope&gt;</span>system<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;systemPath&gt;</span>${project.basedir}/src/main/resources/jar/abi-0.8.0.jar<span style=color:#f92672>&lt;/systemPath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>org.tron.trident<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>utils<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>0.8.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;scope&gt;</span>system<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;systemPath&gt;</span>${project.basedir}/src/main/resources/jar/utils-0.8.0.jar<span style=color:#f92672>&lt;/systemPath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>org.tron.trident<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>core<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>0.8.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;scope&gt;</span>system<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;systemPath&gt;</span>${project.basedir}/src/main/resources/jar/core-0.8.0.jar<span style=color:#f92672>&lt;/systemPath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>io.grpc<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>grpc-all<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.48.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>查询余额的代码</p></div><div><a class="read-more button" href=../../posts/tron/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=../../posts/netty/>Netty</a></h1><div class=post-meta><time class=post-date>2023-12-10</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/java/>Java</a>&nbsp;
#<a href=../../tags/spring/>Spring</a>&nbsp;
#<a href=../../tags/netty/>Netty</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051531898.png class=post-cover alt=Netty title="Cover Image"><div class=post-content><p>Server</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 把 NettyServer 的创建交给 Spring 管理</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NettyServer</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Logger logger <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(getClass());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${netty.port}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer port;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> NettyServerHandlerInitializer nettyServerHandlerInitializer;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// boss 线程组，用于服务端接受客户端的连接</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> EventLoopGroup bossGroup <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NioEventLoopGroup();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// worker 线程组，用于服务端接受客户端的数据读写</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> EventLoopGroup workerGroup <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NioEventLoopGroup();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Netty Server Channel</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Channel channel;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 启动 Netty Server</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostConstruct</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>start</span>() <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 创建 ServerBootstrap 对象，用于 Netty Server 启动</span>
</span></span><span style=display:flex><span>        ServerBootstrap bootstrap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ServerBootstrap();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 ServerBootstrap 的各种属性</span>
</span></span><span style=display:flex><span>      	<span style=color:#75715e>// 设置两个 EventLoopGroup 对象</span>
</span></span><span style=display:flex><span>        bootstrap.<span style=color:#a6e22e>group</span>(bossGroup, workerGroup)
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// 指定 Channel 为服务端 NioServerSocketChannel</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>channel</span>(NioServerSocketChannel.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// 设置 Netty Server 的端口</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>localAddress</span>(<span style=color:#66d9ef>new</span> InetSocketAddress(port)) 
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// 服务端 accept 队列的大小</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>option</span>(ChannelOption.<span style=color:#a6e22e>SO_BACKLOG</span>, 1024) 
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// TCP Keepalive 机制，实现 TCP 层级的心跳保活功能</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>childOption</span>(ChannelOption.<span style=color:#a6e22e>SO_KEEPALIVE</span>, <span style=color:#66d9ef>true</span>) 
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// 允许较小的数据包的发送，降低延迟</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>childOption</span>(ChannelOption.<span style=color:#a6e22e>TCP_NODELAY</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>          			<span style=color:#75715e>// 处理器</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>childHandler</span>(nettyServerHandlerInitializer);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 绑定端口，并同步等待成功，即启动服务端</span>
</span></span><span style=display:flex><span>        ChannelFuture future <span style=color:#f92672>=</span> bootstrap.<span style=color:#a6e22e>bind</span>().<span style=color:#a6e22e>sync</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (future.<span style=color:#a6e22e>isSuccess</span>()) {
</span></span><span style=display:flex><span>            channel <span style=color:#f92672>=</span> future.<span style=color:#a6e22e>channel</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;[start][Netty Server 启动在 {} 端口]&#34;</span>, port);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 关闭 Netty Server</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PreDestroy</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shutdown</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 关闭 Netty Server</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (channel <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            channel.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// &lt;3.2&gt; 优雅关闭两个 EventLoopGroup 对象</span>
</span></span><span style=display:flex><span>        bossGroup.<span style=color:#a6e22e>shutdownGracefully</span>();
</span></span><span style=display:flex><span>        workerGroup.<span style=color:#a6e22e>shutdownGracefully</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>NettyServerHandlerInitializer</p></div><div><a class="read-more button" href=../../posts/netty/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=../../posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/>代码片段</a></h1><div class=post-meta><time class=post-date>2023-09-24</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051525920.png class=post-cover alt=代码片段 title="Cover Image"><div class=post-content><h1 id=谷歌验证码>谷歌验证码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.warrenstrange<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>googleauth<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>1.5.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> utils;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticator;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticatorKey;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.UnsupportedEncodingException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.net.URLEncoder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GoogleAuthUtil</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>generaKey</span>(){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        GoogleAuthenticatorKey key <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>createCredentials</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> key.<span style=color:#a6e22e>getKey</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成二维码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param issuer app上title名字                服务名称 如: Google Github 印象笔记
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param account app上title名字(括号里的)       用户账户 如: example@domain.com 138XXXXXXXX
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createGoogleAuthQRCodeData</span>(String key, String account,String issuer) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;otpauth://totp/%s?secret=%s&amp;issuer=%s&#34;</span>,
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> account, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(key, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        String s <span style=color:#f92672>=</span> generaKey();
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>        String googleAuthQRCodeData <span style=color:#f92672>=</span> createGoogleAuthQRCodeData(s, <span style=color:#e6db74>&#34;anthony&#34;</span>, <span style=color:#e6db74>&#34;V16&#34;</span>);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(googleAuthQRCodeData);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 检查
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param code 用户输入的面膜
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>check</span>(String key,Integer code){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 根据用户密钥和用户输入的密码，验证是否一致。</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> isCodeValid <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>authorize</span>(key, code);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> isCodeValid;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=图片验证码>图片验证码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.whvcse<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easy-captcha<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.6.2<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApiOperation</span>(<span style=color:#e6db74>&#34;获取验证码&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/getVerify&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Response<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getVerify</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    SpecCaptcha specCaptcha <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SpecCaptcha(130, 48, 6);
</span></span><span style=display:flex><span>    specCaptcha.<span style=color:#a6e22e>setFont</span>(<span style=color:#66d9ef>new</span> Font(<span style=color:#e6db74>&#34;Default&#34;</span>, Font.<span style=color:#a6e22e>PLAIN</span>, 32));
</span></span><span style=display:flex><span>    String verCode <span style=color:#f92672>=</span> specCaptcha.<span style=color:#a6e22e>text</span>().<span style=color:#a6e22e>toLowerCase</span>();
</span></span><span style=display:flex><span>    String key <span style=color:#f92672>=</span> UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> stringStringHash <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;uuid&#34;</span>, key);
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;img&#34;</span>, specCaptcha.<span style=color:#a6e22e>toBase64</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;login_code:&#34;</span> <span style=color:#f92672>+</span> key;
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>setString</span>(key, verCode);
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>expire</span>(key, 2, TimeUnit.<span style=color:#a6e22e>MINUTES</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Response.<span style=color:#a6e22e>successData</span>(stringStringHash);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;验证码生成失败&#34;</span>, e);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=华为云上传图片>华为云上传图片</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.huaweicloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>esdk-obs-java-bundle<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>3.23.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsClient;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsConfiguration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.exception.ObsException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.model.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.InputStream;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SimpleMultipartUploadSample</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通常一个链接是 https://桶的名字.obs.ap-southeast-1.myhuaweicloud.com/资源路径</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String endPoint <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://obs.ap-southeast-1.myhuaweicloud.com&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ak <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String sk <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ObsClient obsClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String bucketName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;桶的名字&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>upload</span>(String objectKey, InputStream file) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        ObsConfiguration config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsConfiguration();
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setSocketTimeout</span>(30000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setConnectionTimeout</span>(10000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setEndPoint</span>(endPoint);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            obsClient <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsClient(ak, sk, config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 1: initiate multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            InitiateMultipartUploadRequest request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> InitiateMultipartUploadRequest();
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            InitiateMultipartUploadResult result <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>initiateMultipartUpload</span>(request);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 2: upload part \n&#34;</span>);
</span></span><span style=display:flex><span>            UploadPartResult uploadPartResult <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>uploadPart</span>(bucketName, objectKey, result.<span style=color:#a6e22e>getUploadId</span>(), 1, file);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 3: complete multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            CompleteMultipartUploadRequest completeMultipartUploadRequest <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CompleteMultipartUploadRequest();
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setUploadId</span>(result.<span style=color:#a6e22e>getUploadId</span>());
</span></span><span style=display:flex><span>            PartEtag partEtag <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PartEtag();
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setPartNumber</span>(uploadPartResult.<span style=color:#a6e22e>getPartNumber</span>());
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setEtag</span>(uploadPartResult.<span style=color:#a6e22e>getEtag</span>());
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>getPartEtag</span>().<span style=color:#a6e22e>add</span>(partEtag);
</span></span><span style=display:flex><span>            obsClient.<span style=color:#a6e22e>completeMultipartUpload</span>(completeMultipartUploadRequest);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (ObsException e) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Response Code: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getResponseCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Message: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorMessage</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Code:       &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Request ID:      &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorRequestId</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Host ID:           &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorHostId</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (obsClient <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    obsClient.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div><a class="read-more button" href=../../posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=../../posts/spring/>Spring</a></h1><div class=post-meta><time class=post-date>2023-08-25</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051534866.png class=post-cover alt=Spring title="Cover Image"><div class=post-content><h1 id=springmvc>SpringMVC</h1><p><img src=https://image.runtimes.cc/202404051458028.png alt></p><p>总结：</p><ol><li>首先请求进入DispatcherServlet 由DispatcherServlet 从HandlerMappings中提取对应的Handler。</li><li>2.此时只是获取到了对应的Handle，然后得去寻找对应的适配器，即：HandlerAdapter。</li><li>拿到对应HandlerAdapter时，这时候开始调用对应的Handler处理业务逻辑了。 （这时候实际上已经执行完了我们的Controller） 执行完成之后返回一个ModeAndView</li><li>这时候交给我们的ViewResolver通过视图名称查找出对应的视图然后返回。</li><li>最后 渲染视图 返回渲染后的视图 &ndash;>响应请求。</li></ol><h2 id=初始化过程>初始化过程</h2><p>version 5.3.8</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.HttpServletBean#init</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>init</span>() <span style=color:#66d9ef>throws</span> ServletException {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 子类实现,初始化web环境</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Let subclasses do whatever initialization they like.</span>
</span></span><span style=display:flex><span>  initServletBean();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.FrameworkServlet#initServletBean</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initServletBean</span>() <span style=color:#66d9ef>throws</span> ServletException {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 初始化spring上下文</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span> <span style=color:#f92672>=</span> initWebApplicationContext();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 子类实现</span>
</span></span><span style=display:flex><span>    initFrameworkServlet();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> WebApplicationContext <span style=color:#a6e22e>initWebApplicationContext</span>() {
</span></span><span style=display:flex><span>		WebApplicationContext rootContext <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>				WebApplicationContextUtils.<span style=color:#a6e22e>getWebApplicationContext</span>(getServletContext());
</span></span><span style=display:flex><span>		WebApplicationContext wac <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// A context instance was injected at construction time -&gt; use it</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (wac <span style=color:#66d9ef>instanceof</span> ConfigurableWebApplicationContext) {
</span></span><span style=display:flex><span>				ConfigurableWebApplicationContext cwac <span style=color:#f92672>=</span> (ConfigurableWebApplicationContext) wac;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>cwac.<span style=color:#a6e22e>isActive</span>()) {
</span></span><span style=display:flex><span>					<span style=color:#75715e>// The context has not yet been refreshed -&gt; provide services such as</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>// setting the parent context, setting the application context id, etc</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (cwac.<span style=color:#a6e22e>getParent</span>() <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>						<span style=color:#75715e>// The context instance was injected without an explicit parent -&gt; set</span>
</span></span><span style=display:flex><span>						<span style=color:#75715e>// the root application context (if any; may be null) as the parent</span>
</span></span><span style=display:flex><span>						cwac.<span style=color:#a6e22e>setParent</span>(rootContext);
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#75715e>//配置和刷新spring容器（重要）</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>//这个无非就是初始化spring ioc的环境，创建bean和实例化bean等操作</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>//这个方法最终也是调用refresh()方法，已在spring源码解析中解析过了</span>
</span></span><span style=display:flex><span>					configureAndRefreshWebApplicationContext(cwac);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (wac <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// No context instance was injected at construction time -&gt; see if one</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// has been registered in the servlet context. If one exists, it is assumed</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// that the parent context (if any) has already been set and that the</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// user has performed any initialization such as setting the context id</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> findWebApplicationContext();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (wac <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// No context instance is defined for this servlet -&gt; create a local one</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> createWebApplicationContext(rootContext);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>refreshEventReceived</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Either the context is not a ConfigurableApplicationContext with refresh</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// support or the context injected at construction time had already been</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// refreshed -&gt; trigger initial onRefresh manually here.</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>synchronized</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onRefreshMonitor</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 初始化DispatcherServlet的配置initStrategies()</span>
</span></span><span style=display:flex><span>				onRefresh(wac);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>publishContext</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Publish the context as a servlet context attribute.</span>
</span></span><span style=display:flex><span>			String attrName <span style=color:#f92672>=</span> getServletContextAttributeName();
</span></span><span style=display:flex><span>			getServletContext().<span style=color:#a6e22e>setAttribute</span>(attrName, wac);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> wac;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.DispatcherServlet#onRefresh	</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onRefresh</span>(ApplicationContext context) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// //初始化springmvc的配置</span>
</span></span><span style=display:flex><span>		initStrategies(context);
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>总体流程:</p></div><div><a class="read-more button" href=../../posts/spring/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=../../posts/springboot/>SpringBoot</a></h1><div class=post-meta><time class=post-date>2023-07-15</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051534895.png class=post-cover alt=SpringBoot title="Cover Image"><div class=post-content><h1 id=定时器>定时器</h1><p>定时器的数值放到配置文件,如果使用<code>@Scheduled(fixedDelay = 类中的变量)</code>这种方式试过不行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Scheduled</span>(fixedDelayString <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${fixedDelayString}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>open</span>() {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>fixedDelayString</span><span style=color:#f92672>=</span><span style=color:#e6db74>30000</span>
</span></span></code></pre></div><h1 id=rocketmq>RocketMQ</h1><p>下载源码或者二进制包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 源码安装</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解压文件</span>
</span></span><span style=display:flex><span>unzip rocketmq-all-5.2.0-source-release.zip
</span></span><span style=display:flex><span>cd rocketmq-all-5.2.0-source-release/
</span></span><span style=display:flex><span><span style=color:#75715e># 编译</span>
</span></span><span style=display:flex><span>mvn -Prelease-all -DskipTests -Dspotbugs.skip<span style=color:#f92672>=</span>true clean install -U
</span></span><span style=display:flex><span><span style=color:#75715e># 编译后的二进制的目录,配置文件在这里</span>
</span></span><span style=display:flex><span>cd ./distribution
</span></span></code></pre></div><p>修改配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 修改配置文件</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改内存配置,虚拟机的内存太小了</span>
</span></span><span style=display:flex><span><span style=color:#75715e># vim ./bin/runserver.sh</span>
</span></span><span style=display:flex><span>JAVA_OPT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>JAVA_OPT<span style=color:#e6db74>}</span><span style=color:#e6db74> -server -Xms512m -Xmx521m -Xmn256g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># vim ./bin/runbroker.sh</span>
</span></span><span style=display:flex><span>JAVA_OPT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>JAVA_OPT<span style=color:#e6db74>}</span><span style=color:#e6db74> -server -Xms512m -Xmx512m&#34;</span>
</span></span></code></pre></div><p>启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 第一步.启动Name Server</span>
</span></span><span style=display:flex><span>sh bin/mqnamesrv
</span></span><span style=display:flex><span>The Name Server boot success...
</span></span><span style=display:flex><span><span style=color:#75715e># 第二步.启动Broker</span>
</span></span><span style=display:flex><span>sh bin/mqbroker -n localhost:9876
</span></span><span style=display:flex><span> The broker<span style=color:#f92672>[</span>%s, 172.30.30.233:10911<span style=color:#f92672>]</span> boot success...
</span></span></code></pre></div><p>测试发送消息</p></div><div><a class="read-more button" href=../../posts/springboot/>Read more →</a></div></article><div class=pagination><div class=pagination__buttons><a href=../../tags/java/page/2/ class="button next"><span class=button__text>Older posts</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=../../bundle.min.js></script></div></body></html>