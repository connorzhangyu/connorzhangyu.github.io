<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Mysql on Hello World</title><link>https://connorzhangyu.com/tags/mysql/</link><description>Recent content in Mysql on Hello World</description><generator>Hugo</generator><language>zh</language><lastBuildDate>Fri, 25 Nov 2022 18:25:00 +0000</lastBuildDate><atom:link href="https://connorzhangyu.com/tags/mysql/index.xml" rel="self" type="application/rss+xml"/><item><title>Mysql</title><link>https://connorzhangyu.com/posts/mysql/</link><pubDate>Fri, 25 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/mysql/</guid><description>&lt;h1 id="常见问题">常见问题&lt;/h1>
&lt;h2 id="字符集问题">字符集问题&lt;/h2>
&lt;p>修改mysql的数据陆慕下的my.ini的配置文件(Windows系统)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">[mysql] #大概在63行左右，在其下添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">default-character-set&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">utf8 #默认字符集&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">[mysqld] # 大概在76行左右，在其下添加&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">character-set-server&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">utf8 collation-server=utf8_general_ci&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>注意：建议修改配置文件使用notepad++等高级文本编辑器，使用记事本等软件打开修改后可能会导致文件编码修改为“含BOM头”的编码，从而服务重启失败&lt;/p>&lt;/blockquote>
&lt;p>重启服务,再查看一次编码&lt;/p>
&lt;blockquote>
&lt;p>修改编码前,已经创建的表和库,修改编码后不会自动更改,需要重新建库表或者手动修改库表的编码&lt;/p>&lt;/blockquote>
&lt;p>手动修改库表的编码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">修改数据库的字符编码为&lt;/span>utf8 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">alter&lt;/span> &lt;span style="color:#66d9ef">database&lt;/span> test charset utf8; 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">修改表字符编码为&lt;/span>UTF8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">alter&lt;/span> &lt;span style="color:#66d9ef">table&lt;/span> student charset utf8; 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">修改字段字符编码为&lt;/span>UTF8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">alter&lt;/span> &lt;span style="color:#66d9ef">table&lt;/span> student &lt;span style="color:#66d9ef">modify&lt;/span> name varchar(&lt;span style="color:#ae81ff">20&lt;/span>) charset utf8; 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="客户端连接的问题">客户端连接的问题&lt;/h2>
&lt;p>旧版本图形界面工具连接MySQL8时出现&lt;code>Authentication plugin caching_sha2_password' cannot be loaded&lt;/code>错误。&lt;/p>
&lt;p>MySQL8之前的版本中加密规则是&lt;code>mysql_native_password&lt;/code>，&lt;/p>
&lt;p>MySQL8之后的加密规则是&lt;code>caching_sha2_password&lt;/code>&lt;/p>
&lt;p>解决问题:&lt;/p>
&lt;p>修改用户名为“root@localhost”的用户密码规则为“mysql_native_password”，密码值为“123456”&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">查看所有数据库&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mysql&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">show&lt;/span> databases;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75715e">--------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">Database&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75715e">--------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">|&lt;/span> information_schema &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> mysql &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> performance_schema &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> ry&lt;span style="color:#f92672">-&lt;/span>vue &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> sys &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75715e">--------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span> &lt;span style="color:#66d9ef">rows&lt;/span> &lt;span style="color:#66d9ef">in&lt;/span> &lt;span style="color:#66d9ef">set&lt;/span> (&lt;span style="color:#ae81ff">0&lt;/span>.&lt;span style="color:#ae81ff">01&lt;/span> sec)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">使用&lt;/span>mysql数据库,&lt;span style="color:#960050;background-color:#1e0010">不需要要分号&lt;/span>,&lt;span style="color:#960050;background-color:#1e0010">其余的命令要加分号&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>use mysql;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">修改&lt;/span>&lt;span style="color:#e6db74">&amp;#39;root&amp;#39;&lt;/span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#e6db74">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">用户的密码规则和密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ALTER&lt;/span> &lt;span style="color:#66d9ef">USER&lt;/span> &lt;span style="color:#e6db74">&amp;#39;root&amp;#39;&lt;/span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#e6db74">&amp;#39;localhost&amp;#39;&lt;/span> IDENTIFIED &lt;span style="color:#66d9ef">WITH&lt;/span> mysql_native_password &lt;span style="color:#66d9ef">BY&lt;/span> &lt;span style="color:#e6db74">&amp;#39;abc123&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>FLUSH &lt;span style="color:#66d9ef">PRIVILEGES&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">#&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">开启远程访问&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">UPDATE&lt;/span> &lt;span style="color:#66d9ef">user&lt;/span> &lt;span style="color:#66d9ef">SET&lt;/span> &lt;span style="color:#66d9ef">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;%&amp;#39;&lt;/span> &lt;span style="color:#66d9ef">WHERE&lt;/span> &lt;span style="color:#66d9ef">user&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;root&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>FLUSH &lt;span style="color:#66d9ef">PRIVILEGES&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="存过报错">存过报错&lt;/h2>
&lt;p>报错信息:&lt;/p></description></item><item><title>Mycat</title><link>https://connorzhangyu.com/posts/mycat/</link><pubDate>Sat, 19 Nov 2022 18:25:00 +0000</pubDate><guid>https://connorzhangyu.com/posts/mycat/</guid><description>&lt;h1 id="主从复制">主从复制&lt;/h1>
&lt;h1 id="启动">启动&lt;/h1>
&lt;p>1 .下载jre包&lt;/p>
&lt;p>2 下载mycat包&lt;/p>
&lt;p>3 打包镜像&lt;/p>
&lt;p>Dockerfile&lt;/p>
&lt;pre tabindex="0">&lt;code>FROM centos
# 解压这个包到home下面
ADD server-jre-8u251-linux-x64.tar.gz /home/
ADD ./Mycat-server-1.6.7.4-release-20200105164103-linux.tar.gz /home
ENV WORKPATH /home/mycat/
WORKDIR $WORKPATH

ENV JAVA_HOME /home/jdk1.8.0_251
ENV CLASSPATH $JAVA_HOME/dt.jar:$JAVA_HOME/lib/tools.jar
ENV PATH $PATH:$JAVA_HOME/BIN:$CATALINA_HOME/lib:$CATALINA_HOME/bin

# 暴露8066端口
EXPOSE 8066
CMD /home/mycat/bin/mycat console
&lt;/code>&lt;/pre>&lt;p>把mycat里的conf 和 logs 从容器中拷贝出来&lt;/p>
&lt;p>再挂在两个目录,并启动&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run -it \
 --name mycat \
 -p 8066:8066 \
 -v /home/anthony/mycat/conf:/home/mycat/conf/ \
 -v /home/anthony/mycat/logs:/home/mycat/logs/ \
 java1234/mycat:1.0

Running Mycat-server...
Removed stale pid file: /home/mycat/logs/mycat.pid
wrapper | --&amp;gt; Wrapper Started as Console
wrapper | Launching a JVM...
jvm 1 | Wrapper (Version 3.2.3) http://wrapper.tanukisoftware.org
jvm 1 | Copyright 1999-2006 Tanuki Software, Inc. All Rights Reserved.
jvm 1 |
jvm 1 | MyCAT Server startup successfully. see logs in logs/mycat.log
&lt;/code>&lt;/pre>&lt;h1 id="配置">配置&lt;/h1>
&lt;ul>
&lt;li>schems.xml 定义逻辑库,表,分片节点等内容&lt;/li>
&lt;li>rule.xml 定义分片规则&lt;/li>
&lt;li>server.xml 定义用户以及系统相关变量&lt;/li>
&lt;/ul>
&lt;h1 id="安装mysql57">安装mysql5.7&lt;/h1>
&lt;pre tabindex="0">&lt;code># 从容器中拷贝这些文件
docker cp xxx:/etc/mysql/mysql.conf.d/ /home/anthony/mysql
docker cp xxx:/var/log/ /home/anthony/mysql
&lt;/code>&lt;/pre>&lt;p>启动的时候映射这些&lt;/p></description></item></channel></rss>