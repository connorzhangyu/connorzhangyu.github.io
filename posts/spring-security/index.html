<!doctype html><html lang=zh><head><title>Spring Security :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='Spring Security <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-security</artifactId> </dependency> 登录业务
@Service public class LoginService { public static Map<String, RedisUser> map = new HashMap<>(); @Resource AuthenticationManager authenticationManager; public String login(SysUser sysUser) { // AuthenticationManager 进行用户认证 UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(sysUser.getUsername(), sysUser.getPassword()); Authentication authenticate = authenticationManager.authenticate(usernamePasswordAuthenticationToken); // 如果认证不通过,给出对应的提示 if (Objects.isNull(authenticate)) { throw new RuntimeException("登录失败"); } // 如果认证通过,使用username给jwt生成一个 RedisUser principal = (RedisUser) authenticate.getPrincipal(); map.put(principal.getUsername(), principal); return createJWT("1234567", 9990000, principal.getUsername()); } public void logout() { UsernamePasswordAuthenticationToken authentication = (UsernamePasswordAuthenticationToken) SecurityContextHolder.getContext().getAuthentication(); RedisUser principal = (RedisUser) authentication.getPrincipal(); String username = principal.getUsername(); // 从redis里删除 map.remove(username); } } @RestController @RequestMapping("/") public class LoginController { @Resource LoginService loginService; @PostMapping("/user/login") public ResponseEntity<HashMap> login(@RequestParam("username") String username,@RequestParam("password") String password){ SysUser sysUser = new SysUser(); sysUser.setUsername(username); sysUser.setPassword(password); HashMap<String, Object> stringObjectHashMap = new HashMap<>(); stringObjectHashMap.put("token", loginService.login(sysUser)); return ResponseEntity.status(200).body(stringObjectHashMap); } @PostMapping("/user/logout") public ResponseEntity<String> logout(){ loginService.logout(); return ResponseEntity.ok("success"); } } 验证账户
'><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://connorzhangyu.com/posts/spring-security/><link rel=stylesheet href=https://connorzhangyu.com/styles.css><link rel="shortcut icon" href=https://connorzhangyu.com/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://connorzhangyu.com/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="Spring Security"><meta property="og:description" content='Spring Security <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-security</artifactId> </dependency> 登录业务
@Service public class LoginService { public static Map<String, RedisUser> map = new HashMap<>(); @Resource AuthenticationManager authenticationManager; public String login(SysUser sysUser) { // AuthenticationManager 进行用户认证 UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(sysUser.getUsername(), sysUser.getPassword()); Authentication authenticate = authenticationManager.authenticate(usernamePasswordAuthenticationToken); // 如果认证不通过,给出对应的提示 if (Objects.isNull(authenticate)) { throw new RuntimeException("登录失败"); } // 如果认证通过,使用username给jwt生成一个 RedisUser principal = (RedisUser) authenticate.getPrincipal(); map.put(principal.getUsername(), principal); return createJWT("1234567", 9990000, principal.getUsername()); } public void logout() { UsernamePasswordAuthenticationToken authentication = (UsernamePasswordAuthenticationToken) SecurityContextHolder.getContext().getAuthentication(); RedisUser principal = (RedisUser) authentication.getPrincipal(); String username = principal.getUsername(); // 从redis里删除 map.remove(username); } } @RestController @RequestMapping("/") public class LoginController { @Resource LoginService loginService; @PostMapping("/user/login") public ResponseEntity<HashMap> login(@RequestParam("username") String username,@RequestParam("password") String password){ SysUser sysUser = new SysUser(); sysUser.setUsername(username); sysUser.setPassword(password); HashMap<String, Object> stringObjectHashMap = new HashMap<>(); stringObjectHashMap.put("token", loginService.login(sysUser)); return ResponseEntity.status(200).body(stringObjectHashMap); } @PostMapping("/user/logout") public ResponseEntity<String> logout(){ loginService.logout(); return ResponseEntity.ok("success"); } } 验证账户
'><meta property="og:url" content="https://connorzhangyu.com/posts/spring-security/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051525605.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Java"><meta property="article:section" content="Spring"><meta property="article:section" content="Spring Security"><meta property="article:published_time" content="2022-11-19 18:25:00 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://connorzhangyu.com/posts/spring-security/>Spring Security</a></h1><div class=post-meta><time class=post-date>2022-11-19</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/spring-security/>Spring Security</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/>权限控制</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6/>安全框架</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/spring/>Spring</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051525605.jpg class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h1 id=spring-security>Spring Security<a href=#spring-security class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&lt;dependency&gt;
</span></span><span style=display:flex><span>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
</span></span><span style=display:flex><span>&lt;/dependency&gt;
</span></span></code></pre></div><p>登录业务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Map<span style=color:#f92672>&lt;</span>String, RedisUser<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    AuthenticationManager authenticationManager;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>login</span>(SysUser sysUser) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// AuthenticationManager 进行用户认证</span>
</span></span><span style=display:flex><span>        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken(sysUser.<span style=color:#a6e22e>getUsername</span>(), sysUser.<span style=color:#a6e22e>getPassword</span>());
</span></span><span style=display:flex><span>        Authentication authenticate <span style=color:#f92672>=</span> authenticationManager.<span style=color:#a6e22e>authenticate</span>(usernamePasswordAuthenticationToken);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 如果认证不通过,给出对应的提示</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (Objects.<span style=color:#a6e22e>isNull</span>(authenticate)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;登录失败&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 如果认证通过,使用username给jwt生成一个</span>
</span></span><span style=display:flex><span>        RedisUser principal <span style=color:#f92672>=</span> (RedisUser) authenticate.<span style=color:#a6e22e>getPrincipal</span>();
</span></span><span style=display:flex><span>        map.<span style=color:#a6e22e>put</span>(principal.<span style=color:#a6e22e>getUsername</span>(), principal);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> createJWT(<span style=color:#e6db74>&#34;1234567&#34;</span>, 9990000,  principal.<span style=color:#a6e22e>getUsername</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logout</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        UsernamePasswordAuthenticationToken authentication <span style=color:#f92672>=</span> (UsernamePasswordAuthenticationToken) SecurityContextHolder.<span style=color:#a6e22e>getContext</span>().<span style=color:#a6e22e>getAuthentication</span>();
</span></span><span style=display:flex><span>        RedisUser principal <span style=color:#f92672>=</span> (RedisUser) authentication.<span style=color:#a6e22e>getPrincipal</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        String username <span style=color:#f92672>=</span> principal.<span style=color:#a6e22e>getUsername</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 从redis里删除</span>
</span></span><span style=display:flex><span>        map.<span style=color:#a6e22e>remove</span>(username);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    LoginService loginService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/user/login&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>HashMap<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>login</span>(<span style=color:#a6e22e>@RequestParam</span>(<span style=color:#e6db74>&#34;username&#34;</span>) String username,<span style=color:#a6e22e>@RequestParam</span>(<span style=color:#e6db74>&#34;password&#34;</span>) String password){
</span></span><span style=display:flex><span>        SysUser sysUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SysUser();
</span></span><span style=display:flex><span>        sysUser.<span style=color:#a6e22e>setUsername</span>(username);
</span></span><span style=display:flex><span>        sysUser.<span style=color:#a6e22e>setPassword</span>(password);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        HashMap<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> stringObjectHashMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        stringObjectHashMap.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;token&#34;</span>, loginService.<span style=color:#a6e22e>login</span>(sysUser));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>status</span>(200).<span style=color:#a6e22e>body</span>(stringObjectHashMap);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/user/logout&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>logout</span>(){
</span></span><span style=display:flex><span>        loginService.<span style=color:#a6e22e>logout</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(<span style=color:#e6db74>&#34;success&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>验证账户</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.example.spirngsecutirylearn.pojo.RedisUser;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.example.spirngsecutirylearn.pojo.SysUser;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetailsService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Service;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestService</span> <span style=color:#66d9ef>implements</span> UserDetailsService {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> String user <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;anthony&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> String password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;$2a$10$yyR9WuT9JY/bpe1VPU0yguqlv0lWpgzTD9NEetf2.n8y7NXIa1rfm&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * DaoAuthenticationProvier 会调用这个方法查询用户,并且返回UserDetails对象
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param username
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws UsernameNotFoundException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span>(String username) <span style=color:#66d9ef>throws</span> UsernameNotFoundException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 从数据库查询用户信息</span>
</span></span><span style=display:flex><span>        SysUser sysUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SysUser();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (username.<span style=color:#a6e22e>equals</span>(user)) {
</span></span><span style=display:flex><span>            sysUser.<span style=color:#a6e22e>setUsername</span>(user);
</span></span><span style=display:flex><span>            sysUser.<span style=color:#a6e22e>setPassword</span>(password);
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 没有查到用户</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;没有查到用户信息&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 查询对应的权限信息</span>
</span></span><span style=display:flex><span>        ArrayList<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> strings <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>//        strings.add(&#34;test&#34;);</span>
</span></span><span style=display:flex><span>        strings.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;admin&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 返回封装的信息</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> RedisUser(sysUser,strings);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>缓存的用户对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.example.spirngsecutirylearn.pojo;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.AllArgsConstructor;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.Data;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.GrantedAuthority;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Collection;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.stream.Collectors;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedisUser</span> <span style=color:#66d9ef>implements</span> UserDetails {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    SysUser sysUser;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>RedisUser</span>(SysUser sysUser, List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sysUser</span> <span style=color:#f92672>=</span> sysUser;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>list</span> <span style=color:#f92672>=</span> list;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 权限
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> GrantedAuthority<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAuthorities</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> list.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>map</span>(SimpleGrantedAuthority::<span style=color:#66d9ef>new</span>).<span style=color:#a6e22e>collect</span>(Collectors.<span style=color:#a6e22e>toList</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getPassword</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sysUser.<span style=color:#a6e22e>getPassword</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUsername</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sysUser.<span style=color:#a6e22e>getUsername</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonExpired</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonLocked</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isCredentialsNonExpired</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isEnabled</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>认证失败的回调</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.example.spirngsecutirylearn.handler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.hutool.json.JSONUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.AuthenticationException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.AuthenticationEntryPoint;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.ServletException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthException</span> <span style=color:#66d9ef>implements</span> AuthenticationEntryPoint {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commence</span>(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) <span style=color:#66d9ef>throws</span> IOException, ServletException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> responseEntity <span style=color:#f92672>=</span> ResponseEntity.<span style=color:#a6e22e>ok</span>().<span style=color:#a6e22e>body</span>(<span style=color:#e6db74>&#34;认证失败,请重新登录&#34;</span>);
</span></span><span style=display:flex><span>        String str <span style=color:#f92672>=</span> JSONUtil.<span style=color:#a6e22e>toJsonStr</span>(responseEntity);
</span></span><span style=display:flex><span>        <span style=color:#75715e>/// 处理异常</span>
</span></span><span style=display:flex><span>        extracted(response,str);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>extracted</span>(HttpServletResponse response,String string) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setStatus</span>(200);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setContentType</span>(<span style=color:#e6db74>&#34;application/json&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setCharacterEncoding</span>(<span style=color:#e6db74>&#34;utf-8&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>getWriter</span>().<span style=color:#a6e22e>println</span>(string);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>授权失败的回调</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.example.spirngsecutirylearn.handler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.hutool.json.JSONUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.access.AccessDeniedException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.AuthenticationException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.AuthenticationEntryPoint;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.access.AccessDeniedHandler;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.ServletException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AccessException</span> <span style=color:#66d9ef>implements</span> AccessDeniedHandler {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span>(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) <span style=color:#66d9ef>throws</span> IOException, ServletException {
</span></span><span style=display:flex><span>        ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> responseEntity <span style=color:#f92672>=</span> ResponseEntity.<span style=color:#a6e22e>ok</span>().<span style=color:#a6e22e>body</span>(<span style=color:#e6db74>&#34;权限不租&#34;</span>);
</span></span><span style=display:flex><span>        String str <span style=color:#f92672>=</span> JSONUtil.<span style=color:#a6e22e>toJsonStr</span>(responseEntity);
</span></span><span style=display:flex><span>        <span style=color:#75715e>/// 处理异常</span>
</span></span><span style=display:flex><span>        extracted(response,str);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>extracted</span>(HttpServletResponse response,String string) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setStatus</span>(200);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setContentType</span>(<span style=color:#e6db74>&#34;application/json&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setCharacterEncoding</span>(<span style=color:#e6db74>&#34;utf-8&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>getWriter</span>().<span style=color:#a6e22e>println</span>(string);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>开启注解权限控制和自定义注解</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/test&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/hello&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PreAuthorize</span>(<span style=color:#e6db74>&#34;hasAnyAuthority(&#39;test&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>hello</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(<span style=color:#e6db74>&#34;hello server&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 自定义校验权限
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/hello2&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PreAuthorize</span>(<span style=color:#e6db74>&#34;@anthony.hasAnyAuthority(&#39;test&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>hello2</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(<span style=color:#e6db74>&#34;hello server2&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.example.spirngsecutirylearn.cofig;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.example.spirngsecutirylearn.filter.JwtFilter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.example.spirngsecutirylearn.handler.AccessException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.example.spirngsecutirylearn.handler.AuthException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Bean;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Configuration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.HttpMethod;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.AuthenticationManager;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.authentication.configuration.EnableGlobalAuthentication;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.http.SessionCreationPolicy;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.password.PasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.authentication.logout.LogoutFilter;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.annotation.Resource;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableGlobalMethodSecurity</span>(prePostEnabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    JwtFilter jwtFilter;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    AuthException authException;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    AccessException accessException;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> AuthenticationManager <span style=color:#a6e22e>authenticationManagerBean</span>() <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>authenticationManagerBean</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(HttpSecurity httpSecurity) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        httpSecurity
</span></span><span style=display:flex><span>                <span style=color:#75715e>// CSRF禁用，因为不使用session</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>csrf</span>().<span style=color:#a6e22e>disable</span>()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 基于token，所以不需要session</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>sessionManagement</span>().<span style=color:#a6e22e>sessionCreationPolicy</span>(SessionCreationPolicy.<span style=color:#a6e22e>STATELESS</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 过滤请求</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authorizeRequests</span>()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 对于登录login 注册register 验证码captchaImage 允许匿名访问</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/user/login&#34;</span>).<span style=color:#a6e22e>anonymous</span>()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 静态资源，permitAll 有没有登录都访问</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                .antMatchers(HttpMethod.GET, &#34;/&#34;, &#34;/*.html&#34;, &#34;/**/*.html&#34;, &#34;/**/*.css&#34;, &#34;/**/*.js&#34;, &#34;/profile/**&#34;).permitAll()</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                .antMatchers(&#34;/swagger-ui.html&#34;, &#34;/swagger-resources/**&#34;, &#34;/webjars/**&#34;, &#34;/*/api-docs&#34;, &#34;/druid/**&#34;).permitAll()</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 除上面外的所有请求全部需要鉴权认证</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>anyRequest</span>().<span style=color:#a6e22e>authenticated</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                .and()</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                .headers().frameOptions().disable();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 添加Logout filter</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        httpSecurity.logout().logoutUrl(&#34;/logout&#34;).logoutSuccessHandler(logoutSuccessHandler);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        // 添加JWT filter</span>
</span></span><span style=display:flex><span>        httpSecurity.<span style=color:#a6e22e>addFilterBefore</span>(jwtFilter, UsernamePasswordAuthenticationFilter.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//        // 添加CORS filter</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        httpSecurity.addFilterBefore(corsFilter, JwtAuthenticationTokenFilter.class);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        httpSecurity.addFilterBefore(corsFilter, LogoutFilter.class);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 添加自定义的认证和授权的自定义失败处理</span>
</span></span><span style=display:flex><span>        httpSecurity.<span style=color:#a6e22e>exceptionHandling</span>().<span style=color:#a6e22e>authenticationEntryPoint</span>(authException).<span style=color:#a6e22e>accessDeniedHandler</span>(accessException);
</span></span><span style=display:flex><span>        httpSecurity.<span style=color:#a6e22e>cors</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 密码加密的规则
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span>(){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * BCryptPasswordEncoder 的测试方法
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param args
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        BCryptPasswordEncoder bCryptPasswordEncoder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 加密</span>
</span></span><span style=display:flex><span>        String encode <span style=color:#f92672>=</span> bCryptPasswordEncoder.<span style=color:#a6e22e>encode</span>(<span style=color:#e6db74>&#34;123456&#34;</span>);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(encode);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 解密</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> matches <span style=color:#f92672>=</span> bCryptPasswordEncoder.<span style=color:#a6e22e>matches</span>(<span style=color:#e6db74>&#34;123456&#34;</span>, encode);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(matches);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>自定义注解</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>(<span style=color:#e6db74>&#34;anthony&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestExpress</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>hasAnyAuthority</span>(String authority){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Authentication authentication <span style=color:#f92672>=</span> SecurityContextHolder.<span style=color:#a6e22e>getContext</span>().<span style=color:#a6e22e>getAuthentication</span>();
</span></span><span style=display:flex><span>        RedisUser principal <span style=color:#f92672>=</span> (RedisUser) authentication.<span style=color:#a6e22e>getPrincipal</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>//        List&lt;String&gt; list = (List&lt;String&gt;)principal.getAuthorities();</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>SimpleGrantedAuthority<span style=color:#f92672>&gt;</span> authorities <span style=color:#f92672>=</span> (List<span style=color:#f92672>&lt;</span>SimpleGrantedAuthority<span style=color:#f92672>&gt;</span>) principal.<span style=color:#a6e22e>getAuthorities</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (SimpleGrantedAuthority simpleGrantedAuthority : authorities) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (simpleGrantedAuthority.<span style=color:#a6e22e>getAuthority</span>().<span style=color:#a6e22e>equals</span>(authority)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>找Java包的路径</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># mac</span>
</span></span><span style=display:flex><span>/usr/libexec/java_home -V
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://connorzhangyu.com/posts/redis/><span class=button__icon>←</span>
<span class=button__text>Redis</span>
</a></span><span class="button next"><a href=https://connorzhangyu.com/posts/%E5%89%8D%E7%AB%AF/vue/><span class=button__text>Vue</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>