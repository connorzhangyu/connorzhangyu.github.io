<!doctype html><html lang=zh><head><title>代码片段 :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='谷歌验证码 <dependency> <groupId>com.warrenstrange</groupId> <artifactId>googleauth</artifactId> <version>1.5.0</version> </dependency> package utils; import com.warrenstrange.googleauth.GoogleAuthenticator; import com.warrenstrange.googleauth.GoogleAuthenticatorKey; import java.io.UnsupportedEncodingException; import java.net.URLEncoder; public class GoogleAuthUtil { /** * 生成key */ public static String generaKey(){ GoogleAuthenticator gAuth = new GoogleAuthenticator(); GoogleAuthenticatorKey key = gAuth.createCredentials(); return key.getKey(); } /** * 生成二维码 * @param key 生成的key * @param issuer app上title名字 服务名称 如: Google Github 印象笔记 * @param account app上title名字(括号里的) 用户账户 如: example@domain.com 138XXXXXXXX */ public static String createGoogleAuthQRCodeData(String key, String account,String issuer) throws UnsupportedEncodingException { return String.format("otpauth://totp/%s?secret=%s&amp;issuer=%s", URLEncoder.encode(issuer + ":" + account, "UTF-8").replace("+", "%20"), URLEncoder.encode(key, "UTF-8").replace("+", "%20"), URLEncoder.encode(issuer, "UTF-8").replace("+", "%20")); } public static void main(String[] args) throws UnsupportedEncodingException { String s = generaKey(); System.out.println(s); String googleAuthQRCodeData = createGoogleAuthQRCodeData(s, "anthony", "V16"); System.out.println(googleAuthQRCodeData); } /** * 检查 * @param key 生成的key * @param code 用户输入的面膜 */ public static boolean check(String key,Integer code){ GoogleAuthenticator gAuth = new GoogleAuthenticator(); // 根据用户密钥和用户输入的密码，验证是否一致。 boolean isCodeValid = gAuth.authorize(key, code); return isCodeValid; } } 图片验证码 <dependency> <groupId>com.github.whvcse</groupId> <artifactId>easy-captcha</artifactId> <version>1.6.2</version> </dependency> @ApiOperation("获取验证码") @PostMapping("/getVerify") public Response<Map<String, String>> getVerify() { try { SpecCaptcha specCaptcha = new SpecCaptcha(130, 48, 6); specCaptcha.setFont(new Font("Default", Font.PLAIN, 32)); String verCode = specCaptcha.text().toLowerCase(); String key = UUID.randomUUID().toString(); Map<String, String> stringStringHash = new HashMap<>(); stringStringHash.put("uuid", key); stringStringHash.put("img", specCaptcha.toBase64()); key = "login_code:" + key; redisDao.setString(key, verCode); redisDao.expire(key, 2, TimeUnit.MINUTES); return Response.successData(stringStringHash); } catch (Exception e) { throw new RuntimeException("验证码生成失败", e); } } 华为云上传图片 <dependency> <groupId>com.huaweicloud</groupId> <artifactId>esdk-obs-java-bundle</artifactId> <version>3.23.9.1</version> </dependency> import com.obs.services.ObsClient; import com.obs.services.ObsConfiguration; import com.obs.services.exception.ObsException; import com.obs.services.model.*; import java.io.IOException; import java.io.InputStream; public class SimpleMultipartUploadSample { // 通常一个链接是 https://桶的名字.obs.ap-southeast-1.myhuaweicloud.com/资源路径 private static final String endPoint = "https://obs.ap-southeast-1.myhuaweicloud.com"; private static final String ak = "xxxx"; private static final String sk = "xxxx"; private static ObsClient obsClient; private static String bucketName = "桶的名字"; public static void upload(String objectKey, InputStream file) throws IOException { ObsConfiguration config = new ObsConfiguration(); config.setSocketTimeout(30000); config.setConnectionTimeout(10000); config.setEndPoint(endPoint); try { obsClient = new ObsClient(ak, sk, config); System.out.println("Step 1: initiate multipart upload \n"); InitiateMultipartUploadRequest request = new InitiateMultipartUploadRequest(); request.setBucketName(bucketName); request.setObjectKey(objectKey); InitiateMultipartUploadResult result = obsClient.initiateMultipartUpload(request); System.out.println("Step 2: upload part \n"); UploadPartResult uploadPartResult = obsClient.uploadPart(bucketName, objectKey, result.getUploadId(), 1, file); System.out.println("Step 3: complete multipart upload \n"); CompleteMultipartUploadRequest completeMultipartUploadRequest = new CompleteMultipartUploadRequest(); completeMultipartUploadRequest.setBucketName(bucketName); completeMultipartUploadRequest.setObjectKey(objectKey); completeMultipartUploadRequest.setUploadId(result.getUploadId()); PartEtag partEtag = new PartEtag(); partEtag.setPartNumber(uploadPartResult.getPartNumber()); partEtag.setEtag(uploadPartResult.getEtag()); completeMultipartUploadRequest.getPartEtag().add(partEtag); obsClient.completeMultipartUpload(completeMultipartUploadRequest); } catch (ObsException e) { System.out.println("Response Code: " + e.getResponseCode()); System.out.println("Error Message: " + e.getErrorMessage()); System.out.println("Error Code: " + e.getErrorCode()); System.out.println("Request ID: " + e.getErrorRequestId()); System.out.println("Host ID: " + e.getErrorHostId()); } finally { if (obsClient != null) { try { obsClient.close(); } catch (IOException e) { } } } } } '><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/><link rel=stylesheet href=https://connorzhangyu.com/styles.css><link rel="shortcut icon" href=https://connorzhangyu.com/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://connorzhangyu.com/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="代码片段"><meta property="og:description" content='谷歌验证码 <dependency> <groupId>com.warrenstrange</groupId> <artifactId>googleauth</artifactId> <version>1.5.0</version> </dependency> package utils; import com.warrenstrange.googleauth.GoogleAuthenticator; import com.warrenstrange.googleauth.GoogleAuthenticatorKey; import java.io.UnsupportedEncodingException; import java.net.URLEncoder; public class GoogleAuthUtil { /** * 生成key */ public static String generaKey(){ GoogleAuthenticator gAuth = new GoogleAuthenticator(); GoogleAuthenticatorKey key = gAuth.createCredentials(); return key.getKey(); } /** * 生成二维码 * @param key 生成的key * @param issuer app上title名字 服务名称 如: Google Github 印象笔记 * @param account app上title名字(括号里的) 用户账户 如: example@domain.com 138XXXXXXXX */ public static String createGoogleAuthQRCodeData(String key, String account,String issuer) throws UnsupportedEncodingException { return String.format("otpauth://totp/%s?secret=%s&amp;issuer=%s", URLEncoder.encode(issuer + ":" + account, "UTF-8").replace("+", "%20"), URLEncoder.encode(key, "UTF-8").replace("+", "%20"), URLEncoder.encode(issuer, "UTF-8").replace("+", "%20")); } public static void main(String[] args) throws UnsupportedEncodingException { String s = generaKey(); System.out.println(s); String googleAuthQRCodeData = createGoogleAuthQRCodeData(s, "anthony", "V16"); System.out.println(googleAuthQRCodeData); } /** * 检查 * @param key 生成的key * @param code 用户输入的面膜 */ public static boolean check(String key,Integer code){ GoogleAuthenticator gAuth = new GoogleAuthenticator(); // 根据用户密钥和用户输入的密码，验证是否一致。 boolean isCodeValid = gAuth.authorize(key, code); return isCodeValid; } } 图片验证码 <dependency> <groupId>com.github.whvcse</groupId> <artifactId>easy-captcha</artifactId> <version>1.6.2</version> </dependency> @ApiOperation("获取验证码") @PostMapping("/getVerify") public Response<Map<String, String>> getVerify() { try { SpecCaptcha specCaptcha = new SpecCaptcha(130, 48, 6); specCaptcha.setFont(new Font("Default", Font.PLAIN, 32)); String verCode = specCaptcha.text().toLowerCase(); String key = UUID.randomUUID().toString(); Map<String, String> stringStringHash = new HashMap<>(); stringStringHash.put("uuid", key); stringStringHash.put("img", specCaptcha.toBase64()); key = "login_code:" + key; redisDao.setString(key, verCode); redisDao.expire(key, 2, TimeUnit.MINUTES); return Response.successData(stringStringHash); } catch (Exception e) { throw new RuntimeException("验证码生成失败", e); } } 华为云上传图片 <dependency> <groupId>com.huaweicloud</groupId> <artifactId>esdk-obs-java-bundle</artifactId> <version>3.23.9.1</version> </dependency> import com.obs.services.ObsClient; import com.obs.services.ObsConfiguration; import com.obs.services.exception.ObsException; import com.obs.services.model.*; import java.io.IOException; import java.io.InputStream; public class SimpleMultipartUploadSample { // 通常一个链接是 https://桶的名字.obs.ap-southeast-1.myhuaweicloud.com/资源路径 private static final String endPoint = "https://obs.ap-southeast-1.myhuaweicloud.com"; private static final String ak = "xxxx"; private static final String sk = "xxxx"; private static ObsClient obsClient; private static String bucketName = "桶的名字"; public static void upload(String objectKey, InputStream file) throws IOException { ObsConfiguration config = new ObsConfiguration(); config.setSocketTimeout(30000); config.setConnectionTimeout(10000); config.setEndPoint(endPoint); try { obsClient = new ObsClient(ak, sk, config); System.out.println("Step 1: initiate multipart upload \n"); InitiateMultipartUploadRequest request = new InitiateMultipartUploadRequest(); request.setBucketName(bucketName); request.setObjectKey(objectKey); InitiateMultipartUploadResult result = obsClient.initiateMultipartUpload(request); System.out.println("Step 2: upload part \n"); UploadPartResult uploadPartResult = obsClient.uploadPart(bucketName, objectKey, result.getUploadId(), 1, file); System.out.println("Step 3: complete multipart upload \n"); CompleteMultipartUploadRequest completeMultipartUploadRequest = new CompleteMultipartUploadRequest(); completeMultipartUploadRequest.setBucketName(bucketName); completeMultipartUploadRequest.setObjectKey(objectKey); completeMultipartUploadRequest.setUploadId(result.getUploadId()); PartEtag partEtag = new PartEtag(); partEtag.setPartNumber(uploadPartResult.getPartNumber()); partEtag.setEtag(uploadPartResult.getEtag()); completeMultipartUploadRequest.getPartEtag().add(partEtag); obsClient.completeMultipartUpload(completeMultipartUploadRequest); } catch (ObsException e) { System.out.println("Response Code: " + e.getResponseCode()); System.out.println("Error Message: " + e.getErrorMessage()); System.out.println("Error Code: " + e.getErrorCode()); System.out.println("Request ID: " + e.getErrorRequestId()); System.out.println("Host ID: " + e.getErrorHostId()); } finally { if (obsClient != null) { try { obsClient.close(); } catch (IOException e) { } } } } } '><meta property="og:url" content="https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051525920.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Java"><meta property="article:section" content="Java"><meta property="article:published_time" content="2023-09-24 21:19:38 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/>代码片段</a></h1><div class=post-meta><time class=post-date>2023-09-24</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051525920.png class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h1 id=谷歌验证码>谷歌验证码<a href=#谷歌验证码 class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.warrenstrange<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>googleauth<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>1.5.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> utils;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticator;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticatorKey;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.UnsupportedEncodingException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.net.URLEncoder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GoogleAuthUtil</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>generaKey</span>(){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        GoogleAuthenticatorKey key <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>createCredentials</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> key.<span style=color:#a6e22e>getKey</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成二维码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param issuer app上title名字                服务名称 如: Google Github 印象笔记
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param account app上title名字(括号里的)       用户账户 如: example@domain.com 138XXXXXXXX
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createGoogleAuthQRCodeData</span>(String key, String account,String issuer) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;otpauth://totp/%s?secret=%s&amp;issuer=%s&#34;</span>,
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> account, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(key, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        String s <span style=color:#f92672>=</span> generaKey();
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>        String googleAuthQRCodeData <span style=color:#f92672>=</span> createGoogleAuthQRCodeData(s, <span style=color:#e6db74>&#34;anthony&#34;</span>, <span style=color:#e6db74>&#34;V16&#34;</span>);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(googleAuthQRCodeData);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 检查
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param code 用户输入的面膜
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>check</span>(String key,Integer code){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 根据用户密钥和用户输入的密码，验证是否一致。</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> isCodeValid <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>authorize</span>(key, code);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> isCodeValid;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=图片验证码>图片验证码<a href=#图片验证码 class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.whvcse<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easy-captcha<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.6.2<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApiOperation</span>(<span style=color:#e6db74>&#34;获取验证码&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/getVerify&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Response<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getVerify</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    SpecCaptcha specCaptcha <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SpecCaptcha(130, 48, 6);
</span></span><span style=display:flex><span>    specCaptcha.<span style=color:#a6e22e>setFont</span>(<span style=color:#66d9ef>new</span> Font(<span style=color:#e6db74>&#34;Default&#34;</span>, Font.<span style=color:#a6e22e>PLAIN</span>, 32));
</span></span><span style=display:flex><span>    String verCode <span style=color:#f92672>=</span> specCaptcha.<span style=color:#a6e22e>text</span>().<span style=color:#a6e22e>toLowerCase</span>();
</span></span><span style=display:flex><span>    String key <span style=color:#f92672>=</span> UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> stringStringHash <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;uuid&#34;</span>, key);
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;img&#34;</span>, specCaptcha.<span style=color:#a6e22e>toBase64</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;login_code:&#34;</span> <span style=color:#f92672>+</span> key;
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>setString</span>(key, verCode);
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>expire</span>(key, 2, TimeUnit.<span style=color:#a6e22e>MINUTES</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Response.<span style=color:#a6e22e>successData</span>(stringStringHash);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;验证码生成失败&#34;</span>, e);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=华为云上传图片>华为云上传图片<a href=#华为云上传图片 class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.huaweicloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>esdk-obs-java-bundle<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>3.23.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsClient;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsConfiguration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.exception.ObsException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.model.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.InputStream;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SimpleMultipartUploadSample</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通常一个链接是 https://桶的名字.obs.ap-southeast-1.myhuaweicloud.com/资源路径</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String endPoint <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://obs.ap-southeast-1.myhuaweicloud.com&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ak <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String sk <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ObsClient obsClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String bucketName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;桶的名字&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>upload</span>(String objectKey, InputStream file) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        ObsConfiguration config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsConfiguration();
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setSocketTimeout</span>(30000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setConnectionTimeout</span>(10000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setEndPoint</span>(endPoint);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            obsClient <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsClient(ak, sk, config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 1: initiate multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            InitiateMultipartUploadRequest request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> InitiateMultipartUploadRequest();
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            InitiateMultipartUploadResult result <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>initiateMultipartUpload</span>(request);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 2: upload part \n&#34;</span>);
</span></span><span style=display:flex><span>            UploadPartResult uploadPartResult <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>uploadPart</span>(bucketName, objectKey, result.<span style=color:#a6e22e>getUploadId</span>(), 1, file);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 3: complete multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            CompleteMultipartUploadRequest completeMultipartUploadRequest <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CompleteMultipartUploadRequest();
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setUploadId</span>(result.<span style=color:#a6e22e>getUploadId</span>());
</span></span><span style=display:flex><span>            PartEtag partEtag <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PartEtag();
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setPartNumber</span>(uploadPartResult.<span style=color:#a6e22e>getPartNumber</span>());
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setEtag</span>(uploadPartResult.<span style=color:#a6e22e>getEtag</span>());
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>getPartEtag</span>().<span style=color:#a6e22e>add</span>(partEtag);
</span></span><span style=display:flex><span>            obsClient.<span style=color:#a6e22e>completeMultipartUpload</span>(completeMultipartUploadRequest);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (ObsException e) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Response Code: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getResponseCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Message: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorMessage</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Code:       &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Request ID:      &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorRequestId</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Host ID:           &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorHostId</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (obsClient <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    obsClient.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://connorzhangyu.com/posts/jumpserver/><span class=button__icon>←</span>
<span class=button__text>JumpServer</span>
</a></span><span class="button next"><a href=https://connorzhangyu.com/posts/spring/><span class=button__text>Spring</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>