<!doctype html><html lang=zh><head><title>Posts :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://connorzhangyu.com/posts/><link rel=stylesheet href=https://connorzhangyu.com/styles.css><link rel="shortcut icon" href=https://connorzhangyu.com/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://connorzhangyu.com/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:url" content="https://connorzhangyu.com/posts/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://connorzhangyu.com/img/favicon/orange.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/posts/index.xml rel=alternate type=application/rss+xml title="Hello World"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h1 class=post-title><a href=https://connorzhangyu.com/posts/jumpserver/>JumpServer</a></h1><div class=post-meta><time class=post-date>2023-10-25</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/linux/>Linux</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/jumpserver/>JumpServer</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051529843.jpeg class=post-cover alt=JumpServer title="Cover Image"><div class=post-content><h1 id=笔记>笔记</h1><h2 id=安装jumpserver>安装JumpServer</h2><p><a href=https://community.fit2cloud.com/#/products/jumpserver/getstarted>官网一键安装</a></p><h2 id=修改配置远程访问的端口>修改配置远程访问的端口</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 进入到jp的配置文件目录</span>
</span></span><span style=display:flex><span>cd /opt/jumpserver/config
</span></span><span style=display:flex><span><span style=color:#75715e># 修改配置文件</span>
</span></span><span style=display:flex><span>vim config.txt
</span></span><span style=display:flex><span><span style=color:#75715e># 修改配置,对外提供服务端口, 如果与现有服务冲突请自行修改</span>
</span></span><span style=display:flex><span>HTTP_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8083</span>  <span style=color:#75715e># 修改这个端口</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 重新启动</span>
</span></span><span style=display:flex><span>cd /opt/jumpserver-installer-v3.6.3
</span></span><span style=display:flex><span>./jmsctl.sh restart
</span></span></code></pre></div><h2 id=修改系统管理员密码>修改系统管理员密码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 进入Docker容器</span>
</span></span><span style=display:flex><span>$ docker exec -it jms_core /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 进入根目录,如果不是Docker,进入cd /opt/jumpserver/apps</span>
</span></span><span style=display:flex><span>$ cd apps/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ python manage.py changepassword  admin
</span></span><span style=display:flex><span><span style=color:#75715e># 输入新的密码</span>
</span></span><span style=display:flex><span>$ password
</span></span></code></pre></div><h2 id=nginx反向代理>Nginx反向代理</h2><p><a href=../9355/#%E4%BB%A3%E7%90%86JumpServer>Nginx反向代理</a></p><h2 id=配置ssl>配置SSL</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 先停止服务</span>
</span></span><span style=display:flex><span>cd /opt/jumpserver-installer-v3.6.3
</span></span><span style=display:flex><span>./jmsctl.sh stop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 把证书移动到这个目录</span>
</span></span><span style=display:flex><span>/opt/jumpserver/config/nginx/cert
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改配置文件,域名和ssl证书的文职</span>
</span></span><span style=display:flex><span>/opt/jumpserver/config/config.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 启动服务</span>
</span></span><span style=display:flex><span>cd /opt/jumpserver-installer-v3.6.3
</span></span><span style=display:flex><span>./jmsctl.sh start
</span></span></code></pre></div><h2 id=配置ssh超时时间>配置SSH超时时间</h2><p>默认的时间好像半个小时不操作了,就会自动断开,改成最大值</p></div><div><a class="read-more button" href=/posts/jumpserver/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://connorzhangyu.com/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/>代码片段</a></h1><div class=post-meta><time class=post-date>2023-09-24</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051525920.png class=post-cover alt=代码片段 title="Cover Image"><div class=post-content><h1 id=谷歌验证码>谷歌验证码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.warrenstrange<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>googleauth<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>1.5.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> utils;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticator;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.warrenstrange.googleauth.GoogleAuthenticatorKey;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.UnsupportedEncodingException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.net.URLEncoder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GoogleAuthUtil</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>generaKey</span>(){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        GoogleAuthenticatorKey key <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>createCredentials</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> key.<span style=color:#a6e22e>getKey</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成二维码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param issuer app上title名字                服务名称 如: Google Github 印象笔记
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param account app上title名字(括号里的)       用户账户 如: example@domain.com 138XXXXXXXX
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createGoogleAuthQRCodeData</span>(String key, String account,String issuer) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;otpauth://totp/%s?secret=%s&amp;issuer=%s&#34;</span>,
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> account, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(key, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>),
</span></span><span style=display:flex><span>                URLEncoder.<span style=color:#a6e22e>encode</span>(issuer, <span style=color:#e6db74>&#34;UTF-8&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;+&#34;</span>, <span style=color:#e6db74>&#34;%20&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> UnsupportedEncodingException {
</span></span><span style=display:flex><span>        String s <span style=color:#f92672>=</span> generaKey();
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>        String googleAuthQRCodeData <span style=color:#f92672>=</span> createGoogleAuthQRCodeData(s, <span style=color:#e6db74>&#34;anthony&#34;</span>, <span style=color:#e6db74>&#34;V16&#34;</span>);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(googleAuthQRCodeData);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 检查
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 生成的key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param code 用户输入的面膜
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>check</span>(String key,Integer code){
</span></span><span style=display:flex><span>        GoogleAuthenticator gAuth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GoogleAuthenticator();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 根据用户密钥和用户输入的密码，验证是否一致。</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> isCodeValid <span style=color:#f92672>=</span> gAuth.<span style=color:#a6e22e>authorize</span>(key, code);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> isCodeValid;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=图片验证码>图片验证码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.whvcse<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easy-captcha<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.6.2<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApiOperation</span>(<span style=color:#e6db74>&#34;获取验证码&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/getVerify&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Response<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getVerify</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    SpecCaptcha specCaptcha <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SpecCaptcha(130, 48, 6);
</span></span><span style=display:flex><span>    specCaptcha.<span style=color:#a6e22e>setFont</span>(<span style=color:#66d9ef>new</span> Font(<span style=color:#e6db74>&#34;Default&#34;</span>, Font.<span style=color:#a6e22e>PLAIN</span>, 32));
</span></span><span style=display:flex><span>    String verCode <span style=color:#f92672>=</span> specCaptcha.<span style=color:#a6e22e>text</span>().<span style=color:#a6e22e>toLowerCase</span>();
</span></span><span style=display:flex><span>    String key <span style=color:#f92672>=</span> UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> stringStringHash <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;uuid&#34;</span>, key);
</span></span><span style=display:flex><span>    stringStringHash.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;img&#34;</span>, specCaptcha.<span style=color:#a6e22e>toBase64</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;login_code:&#34;</span> <span style=color:#f92672>+</span> key;
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>setString</span>(key, verCode);
</span></span><span style=display:flex><span>    redisDao.<span style=color:#a6e22e>expire</span>(key, 2, TimeUnit.<span style=color:#a6e22e>MINUTES</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Response.<span style=color:#a6e22e>successData</span>(stringStringHash);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;验证码生成失败&#34;</span>, e);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=华为云上传图片>华为云上传图片</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.huaweicloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>esdk-obs-java-bundle<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>3.23.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsClient;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.ObsConfiguration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.exception.ObsException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.obs.services.model.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.InputStream;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SimpleMultipartUploadSample</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通常一个链接是 https://桶的名字.obs.ap-southeast-1.myhuaweicloud.com/资源路径</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String endPoint <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://obs.ap-southeast-1.myhuaweicloud.com&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ak <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String sk <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxxx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ObsClient obsClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String bucketName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;桶的名字&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>upload</span>(String objectKey, InputStream file) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        ObsConfiguration config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsConfiguration();
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setSocketTimeout</span>(30000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setConnectionTimeout</span>(10000);
</span></span><span style=display:flex><span>        config.<span style=color:#a6e22e>setEndPoint</span>(endPoint);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            obsClient <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObsClient(ak, sk, config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 1: initiate multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            InitiateMultipartUploadRequest request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> InitiateMultipartUploadRequest();
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            InitiateMultipartUploadResult result <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>initiateMultipartUpload</span>(request);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 2: upload part \n&#34;</span>);
</span></span><span style=display:flex><span>            UploadPartResult uploadPartResult <span style=color:#f92672>=</span> obsClient.<span style=color:#a6e22e>uploadPart</span>(bucketName, objectKey, result.<span style=color:#a6e22e>getUploadId</span>(), 1, file);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Step 3: complete multipart upload \n&#34;</span>);
</span></span><span style=display:flex><span>            CompleteMultipartUploadRequest completeMultipartUploadRequest <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CompleteMultipartUploadRequest();
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setBucketName</span>(bucketName);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setObjectKey</span>(objectKey);
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>setUploadId</span>(result.<span style=color:#a6e22e>getUploadId</span>());
</span></span><span style=display:flex><span>            PartEtag partEtag <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PartEtag();
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setPartNumber</span>(uploadPartResult.<span style=color:#a6e22e>getPartNumber</span>());
</span></span><span style=display:flex><span>            partEtag.<span style=color:#a6e22e>setEtag</span>(uploadPartResult.<span style=color:#a6e22e>getEtag</span>());
</span></span><span style=display:flex><span>            completeMultipartUploadRequest.<span style=color:#a6e22e>getPartEtag</span>().<span style=color:#a6e22e>add</span>(partEtag);
</span></span><span style=display:flex><span>            obsClient.<span style=color:#a6e22e>completeMultipartUpload</span>(completeMultipartUploadRequest);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (ObsException e) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Response Code: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getResponseCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Message: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorMessage</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Error Code:       &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorCode</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Request ID:      &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorRequestId</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Host ID:           &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getErrorHostId</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (obsClient <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    obsClient.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div><a class="read-more button" href=/posts/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://connorzhangyu.com/posts/spring/>Spring</a></h1><div class=post-meta><time class=post-date>2023-08-25</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/java/>Java</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051534866.png class=post-cover alt=Spring title="Cover Image"><div class=post-content><h1 id=springmvc>SpringMVC</h1><p><img src=https://image.runtimes.cc/202404051458028.png alt></p><p>总结：</p><ol><li>首先请求进入DispatcherServlet 由DispatcherServlet 从HandlerMappings中提取对应的Handler。</li><li>2.此时只是获取到了对应的Handle，然后得去寻找对应的适配器，即：HandlerAdapter。</li><li>拿到对应HandlerAdapter时，这时候开始调用对应的Handler处理业务逻辑了。 （这时候实际上已经执行完了我们的Controller） 执行完成之后返回一个ModeAndView</li><li>这时候交给我们的ViewResolver通过视图名称查找出对应的视图然后返回。</li><li>最后 渲染视图 返回渲染后的视图 &ndash;>响应请求。</li></ol><h2 id=初始化过程>初始化过程</h2><p>version 5.3.8</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.HttpServletBean#init</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>init</span>() <span style=color:#66d9ef>throws</span> ServletException {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 子类实现,初始化web环境</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Let subclasses do whatever initialization they like.</span>
</span></span><span style=display:flex><span>  initServletBean();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.FrameworkServlet#initServletBean</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initServletBean</span>() <span style=color:#66d9ef>throws</span> ServletException {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 初始化spring上下文</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span> <span style=color:#f92672>=</span> initWebApplicationContext();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 子类实现</span>
</span></span><span style=display:flex><span>    initFrameworkServlet();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> WebApplicationContext <span style=color:#a6e22e>initWebApplicationContext</span>() {
</span></span><span style=display:flex><span>		WebApplicationContext rootContext <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>				WebApplicationContextUtils.<span style=color:#a6e22e>getWebApplicationContext</span>(getServletContext());
</span></span><span style=display:flex><span>		WebApplicationContext wac <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// A context instance was injected at construction time -&gt; use it</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationContext</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (wac <span style=color:#66d9ef>instanceof</span> ConfigurableWebApplicationContext) {
</span></span><span style=display:flex><span>				ConfigurableWebApplicationContext cwac <span style=color:#f92672>=</span> (ConfigurableWebApplicationContext) wac;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>cwac.<span style=color:#a6e22e>isActive</span>()) {
</span></span><span style=display:flex><span>					<span style=color:#75715e>// The context has not yet been refreshed -&gt; provide services such as</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>// setting the parent context, setting the application context id, etc</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (cwac.<span style=color:#a6e22e>getParent</span>() <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>						<span style=color:#75715e>// The context instance was injected without an explicit parent -&gt; set</span>
</span></span><span style=display:flex><span>						<span style=color:#75715e>// the root application context (if any; may be null) as the parent</span>
</span></span><span style=display:flex><span>						cwac.<span style=color:#a6e22e>setParent</span>(rootContext);
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#75715e>//配置和刷新spring容器（重要）</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>//这个无非就是初始化spring ioc的环境，创建bean和实例化bean等操作</span>
</span></span><span style=display:flex><span>					<span style=color:#75715e>//这个方法最终也是调用refresh()方法，已在spring源码解析中解析过了</span>
</span></span><span style=display:flex><span>					configureAndRefreshWebApplicationContext(cwac);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (wac <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// No context instance was injected at construction time -&gt; see if one</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// has been registered in the servlet context. If one exists, it is assumed</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// that the parent context (if any) has already been set and that the</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// user has performed any initialization such as setting the context id</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> findWebApplicationContext();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (wac <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// No context instance is defined for this servlet -&gt; create a local one</span>
</span></span><span style=display:flex><span>			wac <span style=color:#f92672>=</span> createWebApplicationContext(rootContext);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>refreshEventReceived</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Either the context is not a ConfigurableApplicationContext with refresh</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// support or the context injected at construction time had already been</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// refreshed -&gt; trigger initial onRefresh manually here.</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>synchronized</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onRefreshMonitor</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 初始化DispatcherServlet的配置initStrategies()</span>
</span></span><span style=display:flex><span>				onRefresh(wac);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>publishContext</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Publish the context as a servlet context attribute.</span>
</span></span><span style=display:flex><span>			String attrName <span style=color:#f92672>=</span> getServletContextAttributeName();
</span></span><span style=display:flex><span>			getServletContext().<span style=color:#a6e22e>setAttribute</span>(attrName, wac);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> wac;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// org.springframework.web.servlet.DispatcherServlet#onRefresh	</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onRefresh</span>(ApplicationContext context) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// //初始化springmvc的配置</span>
</span></span><span style=display:flex><span>		initStrategies(context);
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>总体流程:</p></div><div><a class="read-more button" href=/posts/spring/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://connorzhangyu.com/posts/%E8%AE%B0%E5%BD%95/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>面试记录</a></h1><div class=post-meta><time class=post-date>2023-08-01</time><span class=post-author>Anthony</span></div><img src=https://image.runtimes.cc/202505232149082.webp class=post-cover alt=面试记录 title="Cover Image"><div class=post-content><p>{% timeline 至今 ,color %}</p><ol><li>mysql 主从复制异常怎么办</li><li>ThreadLocal 没有答上来</li><li>强应用,弱引用</li><li>mybatis源码,myabtis怎么通过接口调用到sql的</li><li>RabbitMQ 和 RocketMQ的区别</li><li>Redis的数据结构有哪些</li><li>重构代码用了哪些设计模式</li><li>Spring Cloud的常用组件</li><li>violate关键字</li><li>实现多数据源</li><li>Spring事务传播</li></ol><p>{% endtimeline %}</p></div><div><a class="read-more button" href=/posts/%E8%AE%B0%E5%BD%95/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>Read more →</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://connorzhangyu.com/posts/waline/>Waline部署</a></h1><div class=post-meta><time class=post-date>2023-07-25</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/hexo/>Hexo</a>&nbsp;
#<a href=https://connorzhangyu.com/tags/waline/>Waline</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051525995.png class=post-cover alt=Waline部署 title="Cover Image"><div class=post-content><p>查看Waline文档,并点击<code>Deploy</code>,文档上有大概步骤,也可以参考,要使用免费的数据库,我就选择<code>MongoDB</code>,可以免费申请</p><p><a href=https://waline.js.org/guide/deploy/vercel.html>Waline-Vercel部署</a></p><p>部署Waline到Vercel
<img src=https://image.runtimes.cc/202404051403234.png alt=image-20230724225259528></p><p><img src=https://image.runtimes.cc/202404051404626.png alt=image-20230724225326229></p><p>打开Vercel分配的地址,测试评论,就会显示下图,是因为需要配置数据库
<img src=https://image.runtimes.cc/202404051404342.png alt=image-20230724225745349></p><p>申请免费的<code>MongoDB</code></p><p>访问<a href=https://www.mongodb.com/zh-cn>MongoDB官网</a>,并点击免费开始使用,跳转到注册页面,点击使用Google账号登陆,也可以自己注册,这里是为了方便使用Google登陆,登陆之后需要同意一些协议,和调查,随便填写,没有很大关系</p><p><img src=https://image.runtimes.cc/202404051404429.png alt=image-20230724225938394></p><p>选择免费的,并点击下面的Create</p><p><img src=https://image.runtimes.cc/202404051404269.png alt=image-20230724230315868></p><p><img src=https://image.runtimes.cc/202404051404594.png alt=image-20230724230343845></p><p>等待一会,会自动开始创建</p><p><img src=https://image.runtimes.cc/202404051404821.png alt=image-20230724230509021></p><p>创建成功,然后点击,Connect,设置ip,设置任何地方都可以访问</p><p>点击Choose a connection method,在弹出的窗口选择<code>Compass</code></p><p><img src=https://image.runtimes.cc/202404051404159.png alt=image-20230724231046357></p><p>获取链接地址,这里有个坑,Waine使用的包比较旧,新版本的协议是:mongod+srv,旧版本使用的mongodb,这里的选项,要使用旧版本,<code>1.11 or earlier</code></p><p>步骤1获取到的是:MONGO_HOST</p><p><img src=https://image.runtimes.cc/202404051405802.png alt=image-20230725001040403></p><p>查看Waline文档,查看MongoDB需要的环境配置</p><p><img src=https://image.runtimes.cc/202404051405587.png alt=image-20230724231654843></p><p>具体的配置如下:</p><ol><li>MONGO_HOST 就是从上面的步骤一 获取到的</li><li>默认ssl=true</li><li>MONGO_AUTHSOURCE 从上面步骤4获取到的</li><li>MONGO_USER 前面创建的用户名</li><li>MONGO_PASSWORD 前面创建的密码</li><li>MONGO_PORT 设置默认值</li><li>MONGO_REPLICASET 如果是默认值的话,就是Cluster0, 自己修改的话,就用自己的</li><li>MONGO_DB = waline, 这个值也可以随便填, 不用手动创建库,waline会自动创建</li></ol><p><img src=https://image.runtimes.cc/202404051405827.png alt=image-20230725001132730></p><p>环境变量配置好之后,重新部署下就行了</p><p><img src=https://image.runtimes.cc/202404051405198.png alt=image-20230725001724373></p><p>评论地址是:<code>vercel分配的域名</code></p><p>后台系统是:<code>vercel分配的域名/ui</code></p></div><div><a class="read-more button" href=/posts/waline/>Read more →</a></div></article><div class=pagination><div class=pagination__buttons><a href=/posts/page/10/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>Newer posts</span>
</a><a href=/posts/page/12/ class="button next"><span class=button__text>Older posts</span>
<span class=button__icon>→</span></a></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>