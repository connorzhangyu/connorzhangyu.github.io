<!doctype html><html lang=zh><head><title>Mysql :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="常见问题 字符集问题 修改mysql的数据陆慕下的my.ini的配置文件(Windows系统)
[mysql] #大概在63行左右，在其下添加 default-character-set=utf8 #默认字符集 [mysqld] # 大概在76行左右，在其下添加 character-set-server=utf8 collation-server=utf8_general_ci 注意：建议修改配置文件使用notepad++等高级文本编辑器，使用记事本等软件打开修改后可能会导致文件编码修改为“含BOM头”的编码，从而服务重启失败
重启服务,再查看一次编码
修改编码前,已经创建的表和库,修改编码后不会自动更改,需要重新建库表或者手动修改库表的编码
手动修改库表的编码
#修改数据库的字符编码为utf8 alter database test charset utf8; #修改表字符编码为UTF8 alter table student charset utf8; #修改字段字符编码为UTF8 alter table student modify name varchar(20) charset utf8; 客户端连接的问题 旧版本图形界面工具连接MySQL8时出现Authentication plugin caching_sha2_password' cannot be loaded错误。
MySQL8之前的版本中加密规则是mysql_native_password，
MySQL8之后的加密规则是caching_sha2_password
解决问题:
修改用户名为“root@localhost”的用户密码规则为“mysql_native_password”，密码值为“123456”
# 查看所有数据库 mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | ry-vue | | sys | +--------------------+ 5 rows in set (0.01 sec) # 使用mysql数据库,不需要要分号,其余的命令要加分号 use mysql; # 修改'root'@'localhost'用户的密码规则和密码 ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'abc123'; FLUSH PRIVILEGES; # 开启远程访问 UPDATE user SET host='%' WHERE user='root'; FLUSH PRIVILEGES; 存过报错 报错信息:
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=../../posts/mysql/><link rel=stylesheet href=../../styles.css><link rel="shortcut icon" href=../../img/theme-colors/orange.png><link rel=apple-touch-icon href=../../img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="Mysql"><meta property="og:description" content="常见问题 字符集问题 修改mysql的数据陆慕下的my.ini的配置文件(Windows系统)
[mysql] #大概在63行左右，在其下添加 default-character-set=utf8 #默认字符集 [mysqld] # 大概在76行左右，在其下添加 character-set-server=utf8 collation-server=utf8_general_ci 注意：建议修改配置文件使用notepad++等高级文本编辑器，使用记事本等软件打开修改后可能会导致文件编码修改为“含BOM头”的编码，从而服务重启失败
重启服务,再查看一次编码
修改编码前,已经创建的表和库,修改编码后不会自动更改,需要重新建库表或者手动修改库表的编码
手动修改库表的编码
#修改数据库的字符编码为utf8 alter database test charset utf8; #修改表字符编码为UTF8 alter table student charset utf8; #修改字段字符编码为UTF8 alter table student modify name varchar(20) charset utf8; 客户端连接的问题 旧版本图形界面工具连接MySQL8时出现Authentication plugin caching_sha2_password' cannot be loaded错误。
MySQL8之前的版本中加密规则是mysql_native_password，
MySQL8之后的加密规则是caching_sha2_password
解决问题:
修改用户名为“root@localhost”的用户密码规则为“mysql_native_password”，密码值为“123456”
# 查看所有数据库 mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | ry-vue | | sys | +--------------------+ 5 rows in set (0.01 sec) # 使用mysql数据库,不需要要分号,其余的命令要加分号 use mysql; # 修改'root'@'localhost'用户的密码规则和密码 ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'abc123'; FLUSH PRIVILEGES; # 开启远程访问 UPDATE user SET host='%' WHERE user='root'; FLUSH PRIVILEGES; 存过报错 报错信息:
"><meta property="og:url" content="/posts/mysql/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051531635.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="数据库"><meta property="article:published_time" content="2022-11-25 18:25:00 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=../../posts/mysql/>Mysql</a></h1><div class=post-meta><time class=post-date>2022-11-25</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>&nbsp;
#<a href=../../tags/mysql/>Mysql</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051531635.jpg class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h1 id=常见问题>常见问题<a href=#常见问题 class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=字符集问题>字符集问题<a href=#字符集问题 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>修改mysql的数据陆慕下的my.ini的配置文件(Windows系统)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>[mysql] #大概在63行左右，在其下添加</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default-character-set</span><span style=color:#f92672>=</span><span style=color:#e6db74>utf8 #默认字符集</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[mysqld] # 大概在76行左右，在其下添加</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>character-set-server</span><span style=color:#f92672>=</span><span style=color:#e6db74>utf8 collation-server=utf8_general_ci</span>
</span></span></code></pre></div><blockquote><p>注意：建议修改配置文件使用notepad++等高级文本编辑器，使用记事本等软件打开修改后可能会导致文件编码修改为“含BOM头”的编码，从而服务重启失败</p></blockquote><p>重启服务,再查看一次编码</p><blockquote><p>修改编码前,已经创建的表和库,修改编码后不会自动更改,需要重新建库表或者手动修改库表的编码</p></blockquote><p>手动修改库表的编码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>修改数据库的字符编码为</span>utf8 
</span></span><span style=display:flex><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>database</span> test charset utf8; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>修改表字符编码为</span>UTF8
</span></span><span style=display:flex><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> student charset utf8; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>修改字段字符编码为</span>UTF8
</span></span><span style=display:flex><span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> student <span style=color:#66d9ef>modify</span> name varchar(<span style=color:#ae81ff>20</span>) charset utf8; 
</span></span></code></pre></div><h2 id=客户端连接的问题>客户端连接的问题<a href=#客户端连接的问题 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>旧版本图形界面工具连接MySQL8时出现<code>Authentication plugin caching_sha2_password' cannot be loaded</code>错误。</p><p>MySQL8之前的版本中加密规则是<code>mysql_native_password</code>，</p><p>MySQL8之后的加密规则是<code>caching_sha2_password</code></p><p>解决问题:</p><p>修改用户名为“root@localhost”的用户密码规则为“mysql_native_password”，密码值为“123456”</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查看所有数据库</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>show</span> databases;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>Database</span>           <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> information_schema <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> mysql              <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> performance_schema <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> ry<span style=color:#f92672>-</span>vue             <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> sys                <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>5</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>使用</span>mysql数据库,<span style=color:#960050;background-color:#1e0010>不需要要分号</span>,<span style=color:#960050;background-color:#1e0010>其余的命令要加分号</span>
</span></span><span style=display:flex><span>use mysql;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>修改</span><span style=color:#e6db74>&#39;root&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span><span style=color:#960050;background-color:#1e0010>用户的密码规则和密码</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;root&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> IDENTIFIED <span style=color:#66d9ef>WITH</span> mysql_native_password <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;abc123&#39;</span>;
</span></span><span style=display:flex><span>FLUSH <span style=color:#66d9ef>PRIVILEGES</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>开启远程访问</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>host</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>;
</span></span><span style=display:flex><span>FLUSH <span style=color:#66d9ef>PRIVILEGES</span>;
</span></span></code></pre></div><h2 id=存过报错>存过报错<a href=#存过报错 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>报错信息:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>Err<span style=color:#f92672>]</span> <span style=color:#ae81ff>1418</span> - This <span style=color:#66d9ef>function</span> has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled <span style=color:#f92672>(</span>you *might* want to use the less safe log_bin_trust_function_creators variable<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>我们就必须指定我们的函数是否是:</p><ul><li>DETERMINISTIC 不确定的</li><li>NO SQL 没有SQl语句</li><li>READS SQL DATA 只是读取数据</li><li>MODIFIES SQL DATA 要修改数据</li><li>CONTAINS SQL 包含SQL语句</li></ul><p>其中在function/procedure 里面，只有 DETERMINISTIC, NO SQL 和 READS SQL DATA 被支持。</p><p>如果我们开启了 bin-log, 我们就必须为我们的function/procedure 指定一个参数。</p><p>解决方法:</p><p>{% tabs log_bin_trust_function_creators %}</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 在mysql数据库中执行以下语句 （临时生效，重启后失效）</span>
</span></span><span style=display:flex><span>set global log_bin_trust_function_creators<span style=color:#f92672>=</span>TRUE;
</span></span><span style=display:flex><span><span style=color:#75715e># 或者</span>
</span></span><span style=display:flex><span>set global log_bin_trust_function_creators<span style=color:#f92672>=</span>1;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 在配置文件/etc/my.cnf的[mysqld]或者my-default.ini文件中配置</span>
</span></span><span style=display:flex><span>log_bin_trust_function_creators<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DEFINER</span><span style=color:#f92672>=`</span>root<span style=color:#f92672>`@`</span>localhost<span style=color:#f92672>`</span> <span style=color:#66d9ef>FUNCTION</span> test(param bigint) <span style=color:#66d9ef>RETURNS</span> decimal(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>需要添加这个</span><span style=color:#66d9ef>READS</span> <span style=color:#66d9ef>SQL</span> <span style=color:#66d9ef>DATA</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>READS</span> <span style=color:#66d9ef>SQL</span> <span style=color:#66d9ef>DATA</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEGIN</span>
</span></span><span style=display:flex><span>  ....
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>RETURN</span> .....;
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>
</span></span></code></pre></div><p>{% endtabs %}</p><h1 id=常用sql例子>常用SQL例子<a href=#常用sql例子 class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- select 嵌套子查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> 
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>select</span> <span style=color:#66d9ef>count</span>(id) <span style=color:#66d9ef>from</span> user_info) <span style=color:#66d9ef>as</span> a,
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>select</span> <span style=color:#66d9ef>count</span>(id) <span style=color:#66d9ef>from</span> user_info <span style=color:#66d9ef>where</span> age <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>) <span style=color:#66d9ef>as</span> b;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 用到的函数,查询日期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> curdate();
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> date(now());
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>/* user_info已经筛选过一次, 再这之后再筛选一次 用的金额 */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>SUM</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> status <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>THEN</span> amount <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#39;冻结的用户的总金额&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>SUM</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> status <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>THEN</span> amount <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#39;活跃的用户的总金额&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> 
</span></span><span style=display:flex><span>    user_info <span style=color:#66d9ef>where</span> register <span style=color:#66d9ef>between</span> <span style=color:#e6db74>&#39;2020-02-02&#39;</span> <span style=color:#66d9ef>and</span> <span style=color:#e6db74>&#39;2023-02-02&#39;</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- insert的字段数据,需要查询出来的数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> bank_info(bank_code, bank_name)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;NEW&#39;</span>, (<span style=color:#66d9ef>select</span> user_no <span style=color:#66d9ef>from</span> user_fund_info <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>46</span>));
</span></span></code></pre></div><h1 id=优化的例子>优化的例子<a href=#优化的例子 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>优化大表的查询,查询一张流水表,要统计开始时间和时间之间的数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 业务是:一个用户,流水在这个时间段最多只有一条记录,并且查询所有用户在这个时间段一共有多少条记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 流水表目前的数据量有70w
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 这样查询,需要好几秒的时间,explain的行数是70w
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>count</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>	users <span style=color:#66d9ef>AS</span> t1
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> liushui <span style=color:#66d9ef>AS</span> t2 <span style=color:#66d9ef>ON</span> t1.id <span style=color:#f92672>=</span> t2.user_id <span style=color:#66d9ef>and</span> t2.begin_time <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span> <span style=color:#66d9ef>AND</span> t2.open_time <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span> ;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#75715e>-- 进行优化
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 增加了一个belong_date的字段,并且添加索引
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- begin_time 和 open_time 有可能之间跨天了,所以belong_date要筛选两天的
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- explain的行数只有2000多条
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>count</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>	users <span style=color:#66d9ef>AS</span> t1
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> liushui <span style=color:#66d9ef>AS</span> t2 <span style=color:#66d9ef>ON</span> t1.id <span style=color:#f92672>=</span> t2.user_id <span style=color:#66d9ef>AND</span> t2.belong_date <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;2023-09-14&#39;</span>,<span style=color:#e6db74>&#39;2023-09-13&#39;</span>) <span style=color:#66d9ef>and</span> t2.begin_time <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span> <span style=color:#66d9ef>AND</span> t2.open_time <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span> ;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#75715e>-- 再进行优化
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 上面的sql和这个sql explain 看着差不多一样,索引出来的流水表的数据量都是一样,可就是上面这条记录查询慢,下面这条记录查询快
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- explain的行数只有2000多条
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 查询查询出来的效果是,先用belong_date查一遍,再在子查询的结果集再筛选一遍
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>COUNT</span>( <span style=color:#ae81ff>1</span> ) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>	(
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>		t1.id
</span></span><span style=display:flex><span>		t2.begin_time, <span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>这两个时间字段对业务是没有用的</span>,<span style=color:#960050;background-color:#1e0010>是为了外面这个查询使用到</span>
</span></span><span style=display:flex><span>		t2.open_time 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>		lottery_open <span style=color:#66d9ef>AS</span> t1
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> lottery_period <span style=color:#66d9ef>AS</span> t2 <span style=color:#66d9ef>ON</span> t1.id <span style=color:#f92672>=</span> t2.lottery_id 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>AND</span> t2.belong_date <span style=color:#66d9ef>IN</span> ( CURDATE(), DATE_SUB( CURDATE(), INTERVAL <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>DAY</span> ) )) <span style=color:#66d9ef>AS</span> t3 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>	t3.begin_time <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span> <span style=color:#66d9ef>AND</span> t3.open_time <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2023-09-14 21:01:28&#39;</span>;
</span></span></code></pre></div><h1 id=实战>实战<a href=#实战 class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=mysql使用source导入数据>mysql使用source导入数据<a href=#mysql使用source导入数据 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>导入的数据,中文乱码,只要先执行uft-8登录之后,再导入数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 登录mysql</span>
</span></span><span style=display:flex><span>mysql -u root -p --default-character-set<span style=color:#f92672>=</span>utf8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 显示所有数据库</span>
</span></span><span style=display:flex><span>show databases;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 选择数据库</span>
</span></span><span style=display:flex><span>use <span style=color:#f92672>[</span>数据库<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 导入文件</span>
</span></span><span style=display:flex><span>mysql&gt; source d:<span style=color:#ae81ff>\m</span>ysqldb.sql
</span></span></code></pre></div><h2 id=导出>导出<a href=#导出 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># --default-character-set=utf8 编码</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -h 192.168.8.2 数据库地址</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -u root 数据库用户名</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -p</span>
</span></span><span style=display:flex><span><span style=color:#75715e># test 数据库库名</span>
</span></span><span style=display:flex><span><span style=color:#75715e># test.sql 导出sql的文件名</span>
</span></span><span style=display:flex><span>mysqldump --default-character-set<span style=color:#f92672>=</span>utf8 --single-transaction --set-gtid-purged<span style=color:#f92672>=</span>OFF -h 192.168.8.2 -u root -p test &gt; test.sql
</span></span></code></pre></div><h2 id=语法>语法<a href=#语法 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><strong>比较运算符</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>字符串存在隐式转换</span>,<span style=color:#960050;background-color:#1e0010>如果转换不成功</span>,<span style=color:#960050;background-color:#1e0010>就看做</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>两边的值一个是整数，另一个是字符串，则</span>MySQL会将字符串转化为数字进行比较<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>两边的值都是整数，则</span>MySQL会按照整数来比较两个值的大小<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>!=</span><span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>,<span style=color:#ae81ff>0</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-----+------+-------+-------+-------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>!=</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-----+------+-------+-------+-------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>   <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>   <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-----+------+-------+-------+-------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span>, <span style=color:#ae81ff>2</span> warnings (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>字符串和字符串比较</span>,<span style=color:#960050;background-color:#1e0010>就不隐式转换了</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>,<span style=color:#e6db74>&#39;ab&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ab&#39;</span>,<span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;b&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;ab&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ab&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;b&#39;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>       <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>         <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>两边的值、字符串或表达式中有一个为</span><span style=color:#66d9ef>NULL</span><span style=color:#960050;background-color:#1e0010>，则比较结果为</span><span style=color:#66d9ef>NULL</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>,<span style=color:#66d9ef>null</span><span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>=</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>   <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span>      <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)
</span></span></code></pre></div><p><strong>安全等于运算符</strong></p><p>安全等于运算符<code>&lt;=></code>与等于运算符<code>=</code>的作用是相似的,唯一的区别:<code>&lt;=></code>可 以用来对NULL进行判断。</p><p>在两个操作数均为NULL时，其返回值为1，而不为NULL;当一个操作数为NULL 时，其返回值为0，而不为NULL。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;2&#39;</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span>,<span style=color:#ae81ff>0</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-------+-------+---------+---------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-------+-------+---------+---------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-------+-------+---------+---------+---------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span>, <span style=color:#ae81ff>2</span> warnings (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span>,<span style=color:#e6db74>&#39;ab&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;ab&#39;</span>,<span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;b&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----------+-------------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;ab&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;ab&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#e6db74>&#39;b&#39;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----------+-------------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>         <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>         <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----------+-------------+-----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#66d9ef>null</span>,<span style=color:#66d9ef>null</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>----------+-------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>&lt;=&gt;</span><span style=color:#66d9ef>null</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>----------+-------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>           <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>----------+-------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>查询</span>commission_pct等于0.<span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>有数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>40</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>没有数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>有数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>有数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>&lt;=&gt;</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>40</span>; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>只会查出</span>commission_pct <span style=color:#f92672>=</span> null的
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>&lt;=&gt;</span> <span style=color:#66d9ef>null</span>; 
</span></span></code></pre></div><p><strong>非空运算符</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>查询</span>commission_pct等于NULL<span style=color:#960050;background-color:#1e0010>。比较如下的四种写法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>&lt;=&gt;</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>有点像调用函数了</span>,<span style=color:#960050;background-color:#1e0010>也是判断</span>null的
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>ISNULL</span>(commission_pct);
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>不要这样写</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> commission_pct <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>习惯用就用</span>,<span style=color:#960050;background-color:#1e0010>不习惯就换一种用法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> employee_id,commission_pct <span style=color:#66d9ef>FROM</span> employees <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>NOT</span> commission_pct <span style=color:#f92672>&lt;=&gt;</span> <span style=color:#66d9ef>NULL</span>;
</span></span></code></pre></div><p><strong>between and</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查看年纪在</span><span style=color:#ae81ff>23</span><span style=color:#960050;background-color:#1e0010>到</span><span style=color:#ae81ff>230</span><span style=color:#960050;background-color:#1e0010>之间</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>where</span> age <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>23</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>230</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查询年纪不再</span><span style=color:#ae81ff>23</span><span style=color:#960050;background-color:#1e0010>和</span><span style=color:#ae81ff>230</span><span style=color:#960050;background-color:#1e0010>之间的</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>where</span> age <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>23</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>230</span>
</span></span></code></pre></div><p><strong>In 和 not in</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name,salary,department_id <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> department_id <span style=color:#66d9ef>in</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>20</span>,<span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name,salary,department_id <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> department_id  <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>in</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>20</span>,<span style=color:#ae81ff>30</span>);
</span></span></code></pre></div><p><strong>or</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>这两个查询出来的结果是不一样的</span>,<span style=color:#960050;background-color:#1e0010>一定要仔细</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name,salary,department_id <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> department_id<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> <span style=color:#66d9ef>or</span> department_id<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span> <span style=color:#66d9ef>or</span> department_id<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name,salary,department_id <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> department_id<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> <span style=color:#66d9ef>or</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>or</span> <span style=color:#ae81ff>30</span>
</span></span></code></pre></div><p><strong>like</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#f92672>%</span><span style=color:#960050;background-color:#1e0010>代表不确定个数的字符</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%a%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#f92672>%</span><span style=color:#960050;background-color:#1e0010>代表不确定个数的字符</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;a%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>包含字符</span>a <span style=color:#960050;background-color:#1e0010>并且</span> <span style=color:#960050;background-color:#1e0010>好办字符</span>e的
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>第一种写法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%a%&#39;</span> <span style=color:#66d9ef>and</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%e%&#39;</span> ;
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>第二种写法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%a%e%&#39;</span> <span style=color:#66d9ef>or</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%e%a%&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>第三种写法</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>强制第二个符号是</span>a的,_表示一个不确定的字符
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;_a%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>转义字符</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查询第二个字符是下划线</span>,<span style=color:#960050;background-color:#1e0010>并且第三个字符串是</span>a的员工
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;_\_a%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>或者</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>告诉</span>mysql,<span style=color:#f92672>&amp;</span><span style=color:#960050;background-color:#1e0010>是我自定义的转移字符</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span>  last_name <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>where</span> last_name <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;_&amp;_a%&#39;</span> <span style=color:#66d9ef>escape</span> <span style=color:#e6db74>&#39;&amp;&#39;</span>;
</span></span></code></pre></div><p><strong>正则表达式</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;^s&#39;</span>, <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;t$&#39;</span>, <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;hk&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------------+------------------------+------------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;^s&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;t$&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;shkstart&#39;</span> REGEXP <span style=color:#e6db74>&#39;hk&#39;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------------+------------------------+------------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>                      <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>                      <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>                      <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------------+------------------------+------------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)
</span></span></code></pre></div><p><strong>NOT或者!</strong></p><ul><li><p>当给定的值为0 (False)时 NOT FALSE => 1</p></li><li><p>当给定的值为非0值时返回0;</p></li><li><p>当给定的值为NULL时，返回NULL。</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>把</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>当做</span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> NOT1  <span style=color:#f92672>==&gt;</span> <span style=color:#66d9ef>Not</span> <span style=color:#66d9ef>True</span><span style=color:#f92672>==</span> <span style=color:#66d9ef>False</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#66d9ef>not</span>(<span style=color:#ae81ff>2</span>)<span style=color:#f92672>==&gt;</span><span style=color:#ae81ff>2</span> <span style=color:#960050;background-color:#1e0010>是</span><span style=color:#66d9ef>true</span> <span style=color:#f92672>==&gt;</span><span style=color:#66d9ef>false</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#66d9ef>NOT</span> <span style=color:#f92672>!</span><span style=color:#ae81ff>1</span><span style=color:#f92672>==&gt;</span> <span style=color:#66d9ef>NOT</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>True</span> <span style=color:#f92672>==&gt;</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>False</span><span style=color:#f92672>==&gt;</span> <span style=color:#66d9ef>True</span> <span style=color:#f92672>==&gt;</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,<span style=color:#66d9ef>NOT</span> <span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>NOT</span> <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NOT</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>),<span style=color:#66d9ef>not</span>(<span style=color:#ae81ff>2</span>), <span style=color:#66d9ef>NOT</span> <span style=color:#f92672>!</span><span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-------+-------+----------+--------+--------+----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NOT</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NOT</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NOT</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>|</span> <span style=color:#66d9ef>not</span>(<span style=color:#ae81ff>2</span>) <span style=color:#f92672>|</span> <span style=color:#66d9ef>NOT</span> <span style=color:#f92672>!</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-------+-------+----------+--------+--------+----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span>   <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>     <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>      <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>      <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>     <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>-----+-------+-------+----------+--------+--------+----------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span>, <span style=color:#ae81ff>1</span> warning (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span></code></pre></div><p><strong>AND或者 &&</strong></p><p>当给定的所有值均为非0值，并且都不为NULL时，返回 1;</p><p>当给定的一个值或者多个值为0时则返回0;</p><p>否则返回NULL。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#ae81ff>1</span> <span style=color:#960050;background-color:#1e0010>理解成</span><span style=color:#66d9ef>True</span>,<span style=color:#960050;background-color:#1e0010>其它的值就不管用</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>or</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> ,<span style=color:#960050;background-color:#1e0010>有一路是通电的</span>,<span style=color:#960050;background-color:#1e0010>那就是通电的</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>---------+--------+-----------+-----------+--------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>NULL</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>---------+--------+-----------+-----------+--------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>|</span><span style=color:#66d9ef>NULL</span><span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span><span style=color:#f92672>|</span> <span style=color:#f92672>+</span><span style=color:#75715e>---------+--------+-----------+-----------+--------------+ 1 row in set, 2 warnings (0.00 sec)
</span></span></span></code></pre></div><p><strong>limit</strong></p><p>格式:<code>LIMIT [位置偏移量,] 行数</code></p><ul><li><p>第一个“位置偏移量”参数指示MySQL从哪一行开始显示，是一个可选参数，如果不指定“位置偏移 量”，将会从表中的第一条记录开始(第一条记录的位置偏移量是0，第二条记录的位置偏移量是 1，以此类推);</p></li><li><p>第二个参数“行数”指示返回的记录条数。</p></li></ul><blockquote><p>MySQL 8.0中可以使用“LIMIT 3 OFFSET 4”，意思是获取从第5条记录开始后面的3条记录，和“LIMIT 4,3;”返回的结果相同。</p></blockquote><p>分页显式公式 :(当前页数-1)*每页条数，每页条数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>LIMIT</span>(PageNo <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>PageSize,PageSize;
</span></span></code></pre></div><ul><li>注意:LIMIT 子句必须放在整个<code>SELECT</code>语句的最后!</li></ul><p><strong>order by</strong></p><p>单列排序</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>默认升序</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> salary <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> salary
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>使用列的别名</span>,<span style=color:#960050;background-color:#1e0010>进行排序</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> salary,salary<span style=color:#f92672>*</span><span style=color:#ae81ff>12</span> <span style=color:#66d9ef>as</span> year_salary <span style=color:#66d9ef>from</span> employees <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> year_salary
</span></span></code></pre></div><p>多列排序</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> employee_id, salary, department_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> employees
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> department_id <span style=color:#66d9ef>DESC</span>,salary <span style=color:#66d9ef>ASC</span>;
</span></span></code></pre></div><ul><li>可以使用不在SELECT列表中的列排序。</li><li>在对多列进行排序的时候，首先排序的第一列必须有相同的列值，才会对第二列进行排序。如果第 一列数据中所有值都是唯一的，将不再对第二列进行排序。</li></ul><h2 id=时间字段>时间字段<a href=#时间字段 class=hanchor arialabel=Anchor>&#8983;</a></h2><table><thead><tr><th></th><th>date</th><th style=text-align:left>datetime</th><th>timestamp</th></tr></thead><tbody><tr><td>插入时间(CURRENT_TIMESTAMP)</td><td>不行(now())</td><td style=text-align:left>不行(now())</td><td>可以</td></tr><tr><td>自动更新(CURRENT_TIMESTAMP)</td><td>不行</td><td style=text-align:left>可以</td><td>可以</td></tr><tr><td>时区</td><td></td><td style=text-align:left>时间字符串</td><td>保存时区</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>插入的时候</span>,<span style=color:#960050;background-color:#1e0010>自动插入时间</span> <span style=color:#960050;background-color:#1e0010>设置</span><span style=color:#66d9ef>CURRENT_TIMESTAMP</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--添加CreateTime 设置默认时间 CURRENT_TIMESTAMP 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>test_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span>  <span style=color:#f92672>`</span>my_time_date<span style=color:#f92672>`</span> datetime <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--修改CreateTime 设置默认时间 CURRENT_TIMESTAMP 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>test_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>MODIFY</span> <span style=color:#66d9ef>COLUMN</span>  <span style=color:#f92672>`</span>my_time_date<span style=color:#f92672>`</span> datetime <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>更新的时候自动更新时间</span> <span style=color:#960050;background-color:#1e0010>设置</span><span style=color:#66d9ef>CURRENT_TIMESTAMP</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--添加UpdateTime 设置 默认时间 CURRENT_TIMESTAMP   设置更新时间为 ON UPDATE CURRENT_TIMESTAMP 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>test_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span> <span style=color:#f92672>`</span>my_time_date<span style=color:#f92672>`</span> <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--修改 UpdateTime 设置 默认时间 CURRENT_TIMESTAMP   设置更新时间为 ON UPDATE CURRENT_TIMESTAMP 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>test_time<span style=color:#f92672>`</span> <span style=color:#66d9ef>MODIFY</span> <span style=color:#66d9ef>COLUMN</span> <span style=color:#f92672>`</span>my_time_date<span style=color:#f92672>`</span> <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span> ;
</span></span></code></pre></div><blockquote><p>参考:<a href=https://zhuanlan.zhihu.com/p/569416633>MySQL 的 timestamp时区问题</a></p></blockquote><h2 id=时区>时区<a href=#时区 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查询时区</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>不需要看</span>system_time_zone,<span style=color:#960050;background-color:#1e0010>只需要修改</span>time_zone
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%time_zone%&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------+--------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> Variable_name    <span style=color:#f92672>|</span> Value  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------+--------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> system_time_zone <span style=color:#f92672>|</span> UTC    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> time_zone        <span style=color:#f92672>|</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>00</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>------------------+--------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查询全局时区</span>,<span style=color:#960050;background-color:#1e0010>和会话时区</span>
</span></span><span style=display:flex><span>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span><span style=color:#66d9ef>GLOBAL</span>.time_zone,<span style=color:#f92672>@@</span><span style=color:#66d9ef>SESSION</span>.time_zone;
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#f92672>@@</span><span style=color:#66d9ef>GLOBAL</span>.time_zone <span style=color:#f92672>|</span> <span style=color:#f92672>@@</span><span style=color:#66d9ef>SESSION</span>.time_zone <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>00</span>             <span style=color:#f92672>|</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>00</span>              <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#75715e>--------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>设置会话时区</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> time_zone<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;+8:00&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>设置全局时区</span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>全局会话有效。必须重新连接才生效</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>global</span> time_zone<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;+8:00;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 修改 mysql 的配置文件永久设置时区
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[mysqld]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>default-time-zone=+08:00
</span></span></span></code></pre></div><p><strong>mysql当前在什么时区，看哪个变量</strong></p><p>看 time_zone,不看 system_time_zone。如要修改时区，直接修改 time_zone，无视 system_time_zone</p><p><strong>time_zone 的值如果是 SYSTEM 表示什么?</strong></p><p>表示跟 system_time_zone 取值一样。安装MySQL后默认就是SYSTEM</p><p><strong>system_time_zone 的值是怎么来的?</strong></p><p>它的值来自mysql服务启动时读取操作系统时区，读取后即使修改操作系统的时区，它的值也不会再改变了，除非重启mysql 服务变量重新读取</p><p><strong>system_time_zone 的值能改变吗?</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 不能通过命令改变</span>
</span></span><span style=display:flex><span>mysql&gt; set system_time_zone<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;JST&#39;</span>;
</span></span><span style=display:flex><span>ERROR <span style=color:#ae81ff>1238</span> <span style=color:#f92672>(</span>HY000<span style=color:#f92672>)</span>: Variable <span style=color:#e6db74>&#39;system_time_zone&#39;</span> is a read only variable
</span></span></code></pre></div><blockquote><p>参考:<a href=https://blog.csdn.net/w8y56f/article/details/115445442>关于mysql的时区</a></p></blockquote><h1 id=索引>索引<a href=#索引 class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=数据结构>数据结构<a href=#数据结构 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=二叉树>二叉树<a href=#二叉树 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>二叉树的缺点:顺序插入,会变成一个链表,层级比较深,检索速度慢,可以使用红黑树解决这个问题</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph TD
    subgraph Binary Tree
        10[10]
        10 --&gt; 5[5]
        10 --&gt; 15[15]
        5 --&gt; 2[2]
        5 --&gt; 7[7]
        15 --&gt; 12[12]
        15 --&gt; 20[20]
        2 --&gt; 1[1]
        2 --&gt; 3[3]
        7 --&gt; 6[6]
    end

    subgraph Slash Linked List
        direction LR
        L1[1] --&gt;|/| L2[2]
        L2[2] --&gt;|/| L3[3]
        L3[3] --&gt;|/| L4[4]
        L4[4] --&gt;|/| L5[5]
        L5[5] --&gt;|/| L6[6]
    end
</code></pre><h3 id=红黑树>红黑树<a href=#红黑树 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>红黑树是一个自平衡的二叉树,大数据情况下,层级较深,检索速度慢</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph TD
    style 10 fill:#000,stroke:#fff,stroke-width:2px,color:#fff
    style 5 fill:#f00,stroke:#000,stroke-width:2px,color:#fff
    style 15 fill:#f00,stroke:#000,stroke-width:2px,color:#fff
    style 2 fill:#000,stroke:#fff,stroke-width:2px,color:#fff
    style 7 fill:#000,stroke:#fff,stroke-width:2px,color:#fff
    style 12 fill:#000,stroke:#fff,stroke-width:2px,color:#fff
    style 20 fill:#000,stroke:#fff,stroke-width:2px,color:#fff
    style 1 fill:#f00,stroke:#000,stroke-width:2px,color:#fff
    style 3 fill:#f00,stroke:#000,stroke-width:2px,color:#fff
    style 6 fill:#f00,stroke:#000,stroke-width:2px,color:#fff

    10[10]
    10 --&gt; 5[5]
    10 --&gt; 15[15]
    5 --&gt; 2[2]
    5 --&gt; 7[7]
    15 --&gt; 12[12]
    15 --&gt; 20[20]
    2 --&gt; 1[1]
    2 --&gt; 3[3]
    7 --&gt; 6[6]
</code></pre><h3 id=b-tree和b树的区别>B-Tree和B+树的区别<a href=#b-tree和b树的区别 class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li><strong>B树</strong>：查找时可能在内部节点就能找到所需的值。</li><li><strong>B+树</strong>：查找时需要遍历到叶子节点才能找到所需的值，因为所有的值都存储在叶子节点中。</li></ul><p><strong>范围查询</strong>：</p><ul><li><strong>B树</strong>：范围查询需要在树中进行多次查找，并且由于叶子节点之间没有链接，范围查询可能效率较低。</li><li><strong>B+树</strong>：由于叶子节点形成了一个链表，范围查询可以从一个叶子节点顺序访问到下一个，效率更高。</li></ul><p><strong>插入和删除</strong>：</p><ul><li><strong>B树</strong>：插入和删除操作可能会影响到所有节点，因为值存储在所有节点中。</li><li><strong>B+树</strong>：插入和删除操作主要影响叶子节点，内部节点只需要更新键和指针。这种结构使得B+树的插入和删除操作相对简单。</li></ul><p><strong>索引覆盖/覆盖索引</strong></p><p>select 后面的字段可以从索引中获取到数据,就是<code>索引覆盖</code>,避免回标操作</p><p>比如user表,有id,name和age两个字段,id是主键索引,name是普通索引,age没有索引,select age 就是没有使用索引覆盖</p><p>如果不符合最左前缀匹配,虽然是索引覆盖,也是无法用到索引,回扫描索引树</p><p><strong>索引下推</strong></p><p>是5.6之后才有的,默认开启,可以设置<code>index_condition_pushdown=off</code>关闭掉</p><p>用类似官网的例子,user表,有id(主键),name,age三个字段,使用name,age建立一个普通索引</p><p>1,anthony,18</p><p>2,anthony,19</p><p>查询<code>select *from user where name='anthony' and age != 18</code></p><p>如果没有使用下推,存储引擎中会查询到 name=&lsquo;anthony&rsquo;的数据行,得到行主键索引,比如有两个name=&lsquo;anthony&rsquo;,比如第一行和第四行,那么主键id就是1和2,分别用1和2去聚簇索引中查找匹配的行数据,返回给mysql server层,再过滤age!= 18 ,这就会涉及到两次回表,分别是id=1和id=2</p><p>如果使用索引下推,直接在存储引擎中通过where的筛选条件,直接在存储引擎中得到行数据,再回表查询,这样就只是需要回标一次,因为只有一行数据是符合<code>name='anthony' and age != 18</code></p><p>使用了索引下推,执行explain计划的时候,extra的会显示<code>Using index condition</code></p><p><strong>回表</strong></p><p>主键索引的B+树的叶子节点存储的是整行数据,</p><p>非主键索引的B+树的叶子节点存储的是主键的值</p><p>当查询根据非聚簇索引查询的时候,会先通过非聚簇索引查询到主键的值,然后再需要通过主键的值再进行一次查询才能得到要查询的数据,这个过程就是回表</p><p><strong>主键索引为什么快</strong></p><h2 id=explain>explain<a href=#explain class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li>Possible_key 理论上用到的key<ul><li>值有可能有多个,也有可能是<code>null</code></li></ul></li><li>key 实际用到的可以<ul><li>如果值是primary 就是主键索引</li></ul></li><li>row SQL执行过程中会被扫描的行数，该数值越大，意味着需要扫描的行数，相应的耗时更长</li></ul><h1 id=事务>事务<a href=#事务 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>ACID</p><ul><li>原子性:同时成功,或者同时失败,<code>undo log</code>日志, 比如插入一条记录,undo就会保存一条delete日志</li><li>一致性:业务代码正确逻辑保证,比如try catch了异常,导致事务不能回滚</li><li>隔离性别:</li><li>持久性:一旦提交了事务,它对数据库的改变就是应该永久性的,持久性由<code>redo log</code>日志来保证</li></ul><h2 id=隔离级别>隔离级别<a href=#隔离级别 class=hanchor arialabel=Anchor>&#8983;</a></h2><table><thead><tr><th></th><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td></td><td>读未提交（Read Uncommitted）</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>mvcc</td><td>读已提交（Read Committed）</td><td>X</td><td>✅</td><td>✅</td></tr><tr><td>mvcc</td><td>可重复读（Repeatable Read）</td><td>X</td><td>X</td><td>✅</td></tr><tr><td>锁</td><td>串行化（Serializable）</td><td>X</td><td>X</td><td>X</td></tr></tbody></table><ul><li>读未提交,查询到别的事务修改但是没有提交的数据</li><li>不可重复读和幻读都是同一事务类,读取的结果不一样</li><li>区别:<ul><li>不可重复读:别的事务更新操作导致的</li><li>幻读,别的事务插入或者删除导致的</li></ul></li></ul><h3 id=数据库准备>数据库准备<a href=#数据库准备 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>SQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>mytest<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> int <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>amount<span style=color:#f92672>`</span> decimal(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>) ENGINE<span style=color:#f92672>=</span>InnoDB;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>lottery<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>mytest<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>amount<span style=color:#f92672>`</span>) <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;anthony&#39;</span>, <span style=color:#ae81ff>100</span>.<span style=color:#ae81ff>00</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>lottery<span style=color:#f92672>`</span>.<span style=color:#f92672>`</span>mytest<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>amount<span style=color:#f92672>`</span>) <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;nick&#39;</span>, <span style=color:#ae81ff>200</span>.<span style=color:#ae81ff>00</span>);
</span></span></code></pre></div><p>命令:设置会话登记</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>SESSION</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>READ</span> <span style=color:#66d9ef>UNCOMMITTED</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>SESSION</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>READ</span> <span style=color:#66d9ef>COMMITTED</span>;
</span></span></code></pre></div><blockquote><p>演示过程都是,事务A先操作,然后事务B再操作</p></blockquote><h3 id=读未提交>读未提交<a href=#读未提交 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>读未提交(read-uncommitted),演示一</p><table><thead><tr><th style=text-align:right></th><th style=text-align:center>事务A</th><th style=text-align:center>事务B</th><th></th></tr></thead><tbody><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>1</td><td style=text-align:center>BEGIN;</td><td style=text-align:center>BEGIN;</td><td></td></tr><tr><td style=text-align:right>2</td><td style=text-align:center>UPDATE mytest<br>SET amount = amount + 500<br>WHERE<br>id = 1;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right>3</td><td style=text-align:center></td><td style=text-align:center>BEGIN;<br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=600</td></tr><tr><td style=text-align:right>4</td><td style=text-align:center>commit;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center>BEGIN;<br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=600</td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td></td></tr></tbody></table><p>读未提交(read-uncommitted),演示二</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>事务A</th><th style=text-align:center>事务B</th><th></th></tr></thead><tbody><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td>anthony.amount=100</td></tr><tr><td style=text-align:center>1</td><td style=text-align:center>BEGIN;</td><td style=text-align:center>BEGIN;</td><td></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center>UPDATE mytest<br>SET amount = amount + 500<br>WHERE<br>id = 1;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=600</td></tr><tr><td style=text-align:center>4</td><td style=text-align:center>rollback;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=100</td></tr><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td></td></tr></tbody></table><h3 id=读已提交>读已提交<a href=#读已提交 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>会话2,在一个事务你,查询到两次不同的金额</p><table><thead><tr><th style=text-align:right></th><th style=text-align:center>事务A</th><th style=text-align:center>事务B</th><th></th></tr></thead><tbody><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>1</td><td style=text-align:center>BEGIN;</td><td style=text-align:center>BEGIN;</td><td></td></tr><tr><td style=text-align:right>2</td><td style=text-align:center>UPDATE mytest<br>SET amount = amount + 500<br>WHERE<br>id = 1;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right>3</td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>4</td><td style=text-align:center>commit;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=600</td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td></td></tr></tbody></table><h3 id=可重复读>可重复读<a href=#可重复读 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>会话2,在一个事务里,查到的数据是不会变的</p><table><thead><tr><th style=text-align:right></th><th style=text-align:center>事务A</th><th style=text-align:center>事务B</th><th></th></tr></thead><tbody><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>1</td><td style=text-align:center></td><td style=text-align:center>BEGIN;</td><td></td></tr><tr><td style=text-align:right>2</td><td style=text-align:center></td><td style=text-align:center>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>3</td><td style=text-align:center>BEGIN;</td><td style=text-align:center><br></td><td></td></tr><tr><td style=text-align:right>4</td><td style=text-align:center>UPDATE mytest<br>SET amount = amount + 500<br>WHERE<br>id = 1;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=100</td></tr><tr><td style=text-align:right></td><td style=text-align:center>commit;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=100</td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center>commit;</td><td></td></tr></tbody></table><h4 id=可串行化>可串行化<a href=#可串行化 class=hanchor arialabel=Anchor>&#8983;</a></h4><table><thead><tr><th style=text-align:right></th><th style=text-align:center>事务A</th><th style=text-align:center>事务B</th><th></th></tr></thead><tbody><tr><td style=text-align:right></td><td style=text-align:center>BEGIN;</td><td style=text-align:center></td><td>anthony.amount=100</td></tr><tr><td style=text-align:right>1</td><td style=text-align:center>UPDATE mytest<br>SET amount = amount + 500<br>WHERE<br>id = 1;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right>2</td><td style=text-align:center></td><td style=text-align:center>BEGIN;</td><td></td></tr><tr><td style=text-align:right>3</td><td style=text-align:center></td><td style=text-align:center>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;<br></td><td>阻塞中</td></tr><tr><td style=text-align:right>4</td><td style=text-align:center>commit;</td><td style=text-align:center></td><td></td></tr><tr><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center><br>SELECT<br>*<br>FROM<br>mytest<br>WHERE<br>id = 1;</td><td>anthony.amount=150</td></tr></tbody></table><table><thead><tr><th></th><th>事务A读操作</th><th>事务B写操作</th></tr></thead><tbody><tr><td>事务B读操作</td><td>不阻塞</td><td>阻塞</td></tr><tr><td>事务B写操作</td><td>阻塞</td><td>阻塞</td></tr></tbody></table><p>可串行化的实现原理:</p><p>在不加锁读的操作,会默认加的</p><p>读锁-共享锁-S锁:select * from mytest lock in share mode;</p><p>读锁是共享的,多个事务可以同时读取同一个资源,但不允许其他事务修改</p><table><thead><tr><th></th><th>事务A</th><th>事务B</th><th></th></tr></thead><tbody><tr><td>1</td><td>Begin;</td><td></td><td></td></tr><tr><td></td><td>select * from mytest where id =1 lock in share mode;</td><td></td><td></td></tr><tr><td></td><td></td><td>Begin;</td><td></td></tr><tr><td></td><td></td><td>Update myset set xx=xx where id =1</td><td>这里会阻塞</td></tr><tr><td></td><td>commit;</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td>然后事务B才会执行</td></tr></tbody></table><p>写-排它锁-X锁:select * from mytest for update;</p><p>写锁是拍他,会阻塞其他的写锁和读锁,update,delete,insert都会加锁</p><h2 id=参考>参考<a href=#参考 class=hanchor arialabel=Anchor>&#8983;</a></h2><blockquote><p><a href=https://learnku.com/articles/40258>https://learnku.com/articles/40258</a></p><p><a href=https://blog.51cto.com/shijianfeng/2914313>https://blog.51cto.com/shijianfeng/2914313</a></p><p><a href=https://www.zhihu.com/question/392569386>https://www.zhihu.com/question/392569386</a></p><p><a href=https://juejin.cn/post/7136112451959848991>https://juejin.cn/post/7136112451959848991</a></p></blockquote><h1 id=innodb>InnoDB<a href=#innodb class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看缓存区的大小,单位是字节(Bytes)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>GLOBAL</span> VARIABLES <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;innodb_buffer_pool_size&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 缓冲池中的总页数：
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>GLOBAL</span> STATUS <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;Innodb_buffer_pool_pages_total&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 已经缓存的页数,需要✖️每一页的大小,通常是16KB每页
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>GLOBAL</span> STATUS <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;Innodb_buffer_pool_pages_data&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 缓冲池中的脏页数：
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 脏页（即已修改但尚未写回磁盘的页）的页数。这也是一个重要的性能指标。
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- updat先修改缓存,这时候就成了脏也,然后msyql再开线程更新到磁盘
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>GLOBAL</span> STATUS <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;Innodb_buffer_pool_pages_dirty&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 清理binlog日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%log_bin%&#39;</span>;  <span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>查看</span>binlog启用状态
</span></span><span style=display:flex><span><span style=color:#66d9ef>show</span> binary logs; 	<span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>查看当前配置下已产生的</span>mysql<span style=color:#f92672>-</span>binlog日志
</span></span><span style=display:flex><span>purge master logs <span style=color:#66d9ef>before</span> <span style=color:#e6db74>&#39;2023-09-22 00:00:00&#39;</span>; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>reset</span> master;  <span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>清理过一次</span>,<span style=color:#960050;background-color:#1e0010>第二天又恢复了</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 关闭binlog
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[mysqld]
</span></span><span style=display:flex><span>skip<span style=color:#f92672>-</span>log<span style=color:#f92672>-</span>bin
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>然后重启电脑</span>
</span></span></code></pre></div><blockquote><p>参考:https://juejin.cn/post/7234924083842220092</p></blockquote></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=../../posts/%E8%AE%B0%E5%BD%95/%E5%8D%9A%E5%AE%A2%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95/><span class=button__icon>←</span>
<span class=button__text>博客修改记录</span>
</a></span><span class="button next"><a href=../../posts/linux/><span class=button__text>Linux</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=../../bundle.min.js></script></div></body></html>