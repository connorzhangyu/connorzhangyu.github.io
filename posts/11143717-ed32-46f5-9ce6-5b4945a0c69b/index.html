<!doctype html><html lang=zh><head><title>使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署 :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署 在现代微服务架构中，Nginx Proxy Manager 常被用作轻量级的反向代理管理工具，而通过 Docker 和 CI/CD 工具（如 GitHub Actions、GitLab CI/CD），可以实现自动化的部署和配置。本篇博客将带你一步步实现 Nginx Proxy Manager 与 Java 服务的自动化部署和配置。
一、背景与目标 为什么选择 Nginx Proxy Manager？
简单易用的 Web 界面。 内置 Let&rsquo;s Encrypt 自动化 SSL 配置。 支持多域名、多服务的反向代理。 我们的目标：
使用 Docker 部署 Nginx Proxy Manager 和 Java 服务。 在 CI/CD 流程中自动化反向代理配置。 支持多环境（如开发、测试、生产）的动态切换。 二、准备工作 安装 Docker 和 Docker Compose
确保服务器已安装：
Docker：安装指南 Docker Compose：安装指南 准备一个运行中的 Java 服务
假设你已有一个 Java 应用（如 Spring Boot 项目），并打包成 Docker 镜像。
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://connorzhangyu.com/posts/11143717-ed32-46f5-9ce6-5b4945a0c69b/><link rel=stylesheet href=https://connorzhangyu.com/styles.css><link rel="shortcut icon" href=https://connorzhangyu.com/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://connorzhangyu.com/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Connor"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署"><meta property="og:description" content="使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署 在现代微服务架构中，Nginx Proxy Manager 常被用作轻量级的反向代理管理工具，而通过 Docker 和 CI/CD 工具（如 GitHub Actions、GitLab CI/CD），可以实现自动化的部署和配置。本篇博客将带你一步步实现 Nginx Proxy Manager 与 Java 服务的自动化部署和配置。
一、背景与目标 为什么选择 Nginx Proxy Manager？
简单易用的 Web 界面。 内置 Let&rsquo;s Encrypt 自动化 SSL 配置。 支持多域名、多服务的反向代理。 我们的目标：
使用 Docker 部署 Nginx Proxy Manager 和 Java 服务。 在 CI/CD 流程中自动化反向代理配置。 支持多环境（如开发、测试、生产）的动态切换。 二、准备工作 安装 Docker 和 Docker Compose
确保服务器已安装：
Docker：安装指南 Docker Compose：安装指南 准备一个运行中的 Java 服务
假设你已有一个 Java 应用（如 Spring Boot 项目），并打包成 Docker 镜像。
"><meta property="og:url" content="https://connorzhangyu.com/posts/11143717-ed32-46f5-9ce6-5b4945a0c69b/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://connorzhangyu.com/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-12-06 21:06:48 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>关于</a></li><li><a href=/showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://connorzhangyu.com/posts/11143717-ed32-46f5-9ce6-5b4945a0c69b/>使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署</a></h1><div class=post-meta><time class=post-date>2024-12-06</time><span class=post-author>Connor</span></div><div class=post-content><div><h1 id=使用-docker-和-cicd-实现-java-服务与-nginx-proxy-manager-的自动化部署>使用 Docker 和 CI/CD 实现 Java 服务与 Nginx Proxy Manager 的自动化部署<a href=#使用-docker-和-cicd-实现-java-服务与-nginx-proxy-manager-的自动化部署 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>在现代微服务架构中，<strong>Nginx Proxy Manager</strong> 常被用作轻量级的反向代理管理工具，而通过 <strong>Docker</strong> 和 <strong>CI/CD 工具</strong>（如 GitHub Actions、GitLab CI/CD），可以实现自动化的部署和配置。本篇博客将带你一步步实现 Nginx Proxy Manager 与 Java 服务的自动化部署和配置。</p><hr><h2 id=一背景与目标>一、背景与目标<a href=#一背景与目标 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><strong>为什么选择 Nginx Proxy Manager？</strong></p><ul><li>简单易用的 Web 界面。</li><li>内置 Let&rsquo;s Encrypt 自动化 SSL 配置。</li><li>支持多域名、多服务的反向代理。</li></ul><p><strong>我们的目标：</strong></p><ol><li>使用 Docker 部署 Nginx Proxy Manager 和 Java 服务。</li><li>在 CI/CD 流程中自动化反向代理配置。</li><li>支持多环境（如开发、测试、生产）的动态切换。</li></ol><hr><h2 id=二准备工作>二、准备工作<a href=#二准备工作 class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li><p><strong>安装 Docker 和 Docker Compose</strong><br>确保服务器已安装：</p><ul><li>Docker：<a href=https://docs.docker.com/get-docker/>安装指南</a></li><li>Docker Compose：<a href=https://docs.docker.com/compose/install/>安装指南</a></li></ul></li><li><p><strong>准备一个运行中的 Java 服务</strong><br>假设你已有一个 Java 应用（如 Spring Boot 项目），并打包成 Docker 镜像。</p></li><li><p><strong>拥有一个域名（可选）</strong><br>如果需要通过域名访问服务，可以在 DNS 配置中指向你的服务器 IP。</p></li></ol><hr><h2 id=三docker-compose-配置>三、Docker Compose 配置<a href=#三docker-compose-配置 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>以下是一个示例的 <code>docker-compose.yml</code> 文件，用于部署 Nginx Proxy Manager 和 Java 服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx-proxy-manager</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>jc21/nginx-proxy-manager:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nginx-proxy-manager</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;81:81&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data:/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./letsencrypt:/etc/letsencrypt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>java-service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-java-app:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>java-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>SPRING_PROFILES_ACTIVE=prod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8080:8080&#34;</span>
</span></span></code></pre></div><p>启动服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p>访问 Nginx Proxy Manager 管理界面：<a href=http://%3c%E6%9C%8D%E5%8A%A1%E5%99%A8IP%3e:81>http://&lt;服务器IP>:81</a><br>默认登录账号：<strong><a href=mailto:admin@example.com>admin@example.com</a></strong>，密码：<strong>changeme</strong>。</p><hr><h2 id=四参数化配置支持多环境>四、参数化配置支持多环境<a href=#四参数化配置支持多环境 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>通过 <code>.env</code> 文件管理环境变量，以支持不同的环境（如开发、测试、生产）。以下是 <code>.env</code> 文件的示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span>SPRING_PROFILES_ACTIVE<span style=color:#f92672>=</span>prod
</span></span><span style=display:flex><span>NGINX_DOMAIN<span style=color:#f92672>=</span>myapp.example.com
</span></span><span style=display:flex><span>NGINX_FORWARD_HOST<span style=color:#f92672>=</span>java-service
</span></span><span style=display:flex><span>NGINX_FORWARD_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><p>在 <code>docker-compose.yml</code> 中动态加载环境变量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}</span>
</span></span></code></pre></div><p>运行时加载 <code>.env</code> 文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose --env-file .env up -d
</span></span></code></pre></div><hr><h2 id=五自动化反向代理配置>五、自动化反向代理配置<a href=#五自动化反向代理配置 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>为了自动化配置 Nginx Proxy Manager，可以选择以下两种方式：</p><h3 id=方式-1使用-api-配置推荐>方式 1：使用 API 配置（推荐）<a href=#方式-1使用-api-配置推荐 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li><p><strong>获取 API Token</strong><br>登录 API 获取管理员权限的 Token：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST <span style=color:#e6db74>&#34;http://&lt;NGINX_PROXY_MANAGER_IP&gt;:81/api/tokens&#34;</span>        -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span>        -d <span style=color:#e6db74>&#39;{&#34;identity&#34;: &#34;admin@example.com&#34;, &#34;secret&#34;: &#34;password&#34;}&#39;</span>
</span></span></code></pre></div></li><li><p><strong>自动创建反向代理规则</strong><br>通过 API 动态添加代理规则：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST <span style=color:#e6db74>&#34;http://&lt;NGINX_PROXY_MANAGER_IP&gt;:81/api/nginx/proxy-hosts&#34;</span>        -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;TOKEN&gt;&#34;</span>        -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span>        -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;domain_names&#34;: [&#34;${NGINX_DOMAIN}&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;forward_host&#34;: &#34;${NGINX_FORWARD_HOST}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;forward_port&#34;: ${NGINX_FORWARD_PORT},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;access_list_id&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;certificate_id&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;ssl_forced&#34;: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }&#39;</span>
</span></span></code></pre></div></li></ol><h3 id=方式-2直接操作-sqlite-数据库>方式 2：直接操作 SQLite 数据库<a href=#方式-2直接操作-sqlite-数据库 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>如果你熟悉 SQLite，可以直接修改 Nginx Proxy Manager 的 <code>data/database.sqlite</code> 文件，批量添加规则：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlite3 ./data/database.sqlite <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>INSERT INTO proxy_host (domain_names, forward_host, forward_port, ...) VALUES (...);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><hr><h2 id=六集成到-cicd-流程>六、集成到 CI/CD 流程<a href=#六集成到-cicd-流程 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>以下以 <strong>GitHub Actions</strong> 为例，展示如何在 CI/CD 流程中自动化部署和配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>CI/CD for Java Service and Nginx Proxy Manager</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set up Docker</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/setup-buildx-action@v2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy Java Service and Nginx Proxy Manager</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          docker-compose -f docker-compose.yml --env-file .env up -d</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure Nginx Proxy Manager</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          curl -X POST &#34;http://nginx-proxy-manager:81/api/nginx/proxy-hosts&#34;               -H &#34;Authorization: Bearer ${{ secrets.NPM_API_TOKEN }}&#34;               -H &#34;Content-Type: application/json&#34;               -d &#39;{&#34;domain_names&#34;: [&#34;${NGINX_DOMAIN}&#34;], &#34;forward_host&#34;: &#34;${NGINX_FORWARD_HOST}&#34;, &#34;forward_port&#34;: ${NGINX_FORWARD_PORT}}&#39;</span>
</span></span></code></pre></div><hr><h2 id=七总结>七、总结<a href=#七总结 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>通过以上方法，我们实现了：</p><ol><li><strong>Nginx Proxy Manager 与 Java 服务的 Docker 化部署</strong>。</li><li><strong>支持多环境的动态代理配置</strong>。</li><li><strong>与 CI/CD 流程无缝集成，自动化部署与测试</strong>。</li></ol><p>这不仅提高了部署效率，还保证了配置的一致性，非常适合现代化微服务架构的需求。</p><hr><p>希望这篇内容对你有所帮助！欢迎评论与分享！ 🎉</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://connorzhangyu.com/posts/%E5%A6%82%E4%BD%95%E8%A7%84%E5%88%92-aws-%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%A4%E8%AF%81%E8%B7%AF%E5%BE%84%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%9E%B6%E6%9E%84%E5%B8%88/><span class=button__icon>←</span>
<span class=button__text>如何规划 AWS 学习与认证路径：从入门到架构师</span>
</a></span><span class="button next"><a href=https://connorzhangyu.com/posts/flutter/><span class=button__text>Flutter</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>