<!doctype html><html lang=zh><head><title>ElasticSearch :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='æ‰‹åŠ¨å®‰è£…7.x æ‰‹åŠ¨å®‰è£…å•æœºElasticSearch7.x # ä¸‹è½½taråŒ…,(6.6.2) wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.2.tar.gz # è§£å‹ç¼©ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶ vi /elasticsearch-7.10.1/config/elasticsearch.yml network.host: 0.0.0.0 #è®¾ç½®æˆå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—® # è¿½åŠ å†…å®¹,ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒè¯¥å˜é‡,ä¿®æ”¹å®Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ vi /etc/sysctl.conf vm.max_map_count=262144 # åŠ è½½å‚æ•° anthony@base:/usr/local/elasticsearch-6.6.2$ sudo sysctl -p vm.max_map_count = 262144 # å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°,åŠ å…¥ vim /etc/security/limits.conf * soft nofile 65536 * hard nofile 65536 * soft nproc 4096 æˆ–è€…(65536) * hard nproc 4096 æˆ–è€…(65536) # ä¿®æ”¹JVMåˆ†é…å¤§å° è¿™ä¸¤ä¸ªå€¼è¦ä¸€è‡´ vi config/jvm.options -Xms4g -Xmx4g # å¯åŠ¨ bin/elasticsearch bin/elasticsearch -d #åå°å¯åŠ¨ å®‰è£…åˆ†è¯å™¨ä¸‹è½½è§£å‹ç¼©çš„å“¦elasticsearchçš„pluginç›®å½•ä¸‹IKåˆ†è¯å™¨https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2 POST /_analyze { "analyzer": "ik_smart", "text": " ç¨‹åºå‘˜ } æ‹¼éŸ³åˆ†è¯å™¨https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2
'><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://connorzhangyu.com/posts/elasticsearch/><link rel=stylesheet href=https://connorzhangyu.com/styles.css><link rel="shortcut icon" href=https://connorzhangyu.com/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://connorzhangyu.com/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="ElasticSearch"><meta property="og:description" content='æ‰‹åŠ¨å®‰è£…7.x æ‰‹åŠ¨å®‰è£…å•æœºElasticSearch7.x # ä¸‹è½½taråŒ…,(6.6.2) wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.2.tar.gz # è§£å‹ç¼©ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶ vi /elasticsearch-7.10.1/config/elasticsearch.yml network.host: 0.0.0.0 #è®¾ç½®æˆå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—® # è¿½åŠ å†…å®¹,ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒè¯¥å˜é‡,ä¿®æ”¹å®Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ vi /etc/sysctl.conf vm.max_map_count=262144 # åŠ è½½å‚æ•° anthony@base:/usr/local/elasticsearch-6.6.2$ sudo sysctl -p vm.max_map_count = 262144 # å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°,åŠ å…¥ vim /etc/security/limits.conf * soft nofile 65536 * hard nofile 65536 * soft nproc 4096 æˆ–è€…(65536) * hard nproc 4096 æˆ–è€…(65536) # ä¿®æ”¹JVMåˆ†é…å¤§å° è¿™ä¸¤ä¸ªå€¼è¦ä¸€è‡´ vi config/jvm.options -Xms4g -Xmx4g # å¯åŠ¨ bin/elasticsearch bin/elasticsearch -d #åå°å¯åŠ¨ å®‰è£…åˆ†è¯å™¨ä¸‹è½½è§£å‹ç¼©çš„å“¦elasticsearchçš„pluginç›®å½•ä¸‹IKåˆ†è¯å™¨https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2 POST /_analyze { "analyzer": "ik_smart", "text": " ç¨‹åºå‘˜ } æ‹¼éŸ³åˆ†è¯å™¨https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2
'><meta property="og:url" content="https://connorzhangyu.com/posts/elasticsearch/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051527399.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Java"><meta property="article:published_time" content="2022-11-19 18:25:00 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>åº·çº³çš„è®°ä»‡å°æœ¬æœ¬</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/about>å…³äº</a></li><li><a href=/showcase>ç²¾é€‰</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>å…³äº</a></li><li><a href=/showcase>ç²¾é€‰</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://connorzhangyu.com/posts/elasticsearch/>ElasticSearch</a></h1><div class=post-meta><time class=post-date>2022-11-19</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=https://connorzhangyu.com/tags/mac/>Mac</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051527399.jpg class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h1 id=æ‰‹åŠ¨å®‰è£…7x>æ‰‹åŠ¨å®‰è£…7.x<a href=#æ‰‹åŠ¨å®‰è£…7x class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=æ‰‹åŠ¨å®‰è£…å•æœºelasticsearch7x>æ‰‹åŠ¨å®‰è£…å•æœºElasticSearch7.x<a href=#æ‰‹åŠ¨å®‰è£…å•æœºelasticsearch7x class=hanchor arialabel=Anchor>&#8983;</a></h2><pre tabindex=0><code># ä¸‹è½½taråŒ…,(6.6.2)
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.2.tar.gz

# è§£å‹ç¼©ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶
vi /elasticsearch-7.10.1/config/elasticsearch.yml
network.host: 0.0.0.0 #è®¾ç½®æˆå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—®

# è¿½åŠ å†…å®¹,ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒè¯¥å˜é‡,ä¿®æ”¹å®Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ
vi /etc/sysctl.conf
vm.max_map_count=262144

# åŠ è½½å‚æ•°
anthony@base:/usr/local/elasticsearch-6.6.2$ sudo sysctl -p
vm.max_map_count = 262144

# å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°,åŠ å…¥
vim /etc/security/limits.conf
* soft nofile 65536
* hard nofile 65536
* soft nproc 4096 æˆ–è€…(65536)
* hard nproc 4096 æˆ–è€…(65536)

# ä¿®æ”¹JVMåˆ†é…å¤§å° è¿™ä¸¤ä¸ªå€¼è¦ä¸€è‡´
vi config/jvm.options
-Xms4g
-Xmx4g

# å¯åŠ¨
bin/elasticsearch
bin/elasticsearch -d  #åå°å¯åŠ¨
</code></pre><ol><li>å®‰è£…åˆ†è¯å™¨ä¸‹è½½è§£å‹ç¼©çš„å“¦elasticsearchçš„pluginç›®å½•ä¸‹IKåˆ†è¯å™¨<a href=https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2>https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.6.2</a></li></ol><pre tabindex=0><code>POST /_analyze { &#34;analyzer&#34;: &#34;ik_smart&#34;, &#34;text&#34;: &#34; ç¨‹åºå‘˜ }
</code></pre><p>æ‹¼éŸ³åˆ†è¯å™¨<a href=https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2>https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v6.6.2</a></p><pre tabindex=0><code>GET /medcl/_analyze
    {
    &#34;text&#34;: [&#34;ç¨‹åºå‘˜&#34;],
    &#34;analyzer&#34;: &#34;pinyin_analyzer&#34;
    }
</code></pre><p>æŠ¥é”™åŸå› :</p><pre tabindex=0><code># chown -R ç”¨æˆ·å:ç”¨æˆ·å  ç›®å½•å
Exception in thread &#34;main&#34; java.nio.file.AccessDeniedException: /root/home/searchengine/elasticsearch-6.2.4/config/jvm.options
	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
	at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)
	at java.nio.file.Files.newByteChannel(Files.java:361)
	at java.nio.file.Files.newByteChannel(Files.java:407)
	at java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:384)
	at java.nio.file.Files.newInputStream(Files.java:152)
	at org.elasticsearch.tools.launchers.JvmOptionsParser.main(JvmOptionsParser.java:58)
</code></pre><h2 id=æ‰‹åŠ¨å®‰è£…é›†ç¾¤elasticsearch7x>æ‰‹åŠ¨å®‰è£…é›†ç¾¤ElasticSearch7.x<a href=#æ‰‹åŠ¨å®‰è£…é›†ç¾¤elasticsearch7x class=hanchor arialabel=Anchor>&#8983;</a></h2><p>1.ä¿®æ”¹ä¸€å°elasticsearchçš„elasticsearch.yml</p><pre tabindex=0><code>cluster.name: kkb-es
node.name: node0
node.master: true
network.host: 0.0.0.0
http.port: 9200
transport.tcp.port: 9300
discovery.zen.ping.unicast.hosts: [&#34;127.0.0.1:9300&#34;,&#34;127.0.0.1:9301&#34;,&#34;127.0.0
.1:9302&#34;]
discovery.zen.minimum_master_nodes: 2
http.cors.enabled: true
http.cors.allow-origin: &#34;*&#34;
</code></pre><p>2.æ‹·è´åˆ°å…¶ä»–çš„æœåŠ¡å™¨</p><p>ä¿®æ”¹ä¸Šé¢å‘¢çš„é…ç½®æ–‡ä»¶ä¸­çš„3ä¸ªé…ç½®</p><pre tabindex=0><code>node.name: node0
http.port: 9200
transport.tcp.port: 9300
</code></pre><p>3.æ£€æŸ¥å¥åº·çŠ¶æ€</p><pre tabindex=0><code>http://localhost:9200/_cat/health?v
</code></pre><h2 id=æ‰‹åŠ¨å•æœºkibana7xå®‰è£…>æ‰‹åŠ¨å•æœºKibana7.xå®‰è£…<a href=#æ‰‹åŠ¨å•æœºkibana7xå®‰è£… class=hanchor arialabel=Anchor>&#8983;</a></h2><pre tabindex=0><code># ä¸‹è½½è§£å‹
https://artifacts.elastic.co/downloads/kibana/kibana-6.6.2-linux-x86_64.tar.gz

# ä¿®æ”¹é…ç½®æ–‡ä»¶
vi kibana-6.4.2-linux-x86_64/config/kibana.yml
server.port: 5600
server.host: &#34;0.0.0.0&#34;
elasticsearch.url: &#34;http://localhost:9200&#34;

# å¯åŠ¨,åå°å¯åŠ¨
./bin/kibana &amp;
</code></pre><h2 id=æ‰‹åŠ¨å•æœºlogstash7xå®‰è£…>æ‰‹åŠ¨å•æœºLogstash7.xå®‰è£…<a href=#æ‰‹åŠ¨å•æœºlogstash7xå®‰è£… class=hanchor arialabel=Anchor>&#8983;</a></h2><p><code>mysql-connector-java-5.1.48.jar</code>æ˜¯æ”¾åœ¨<code>logstash-6.6.2/logstash-core/lib/jars</code>,è¿™æ ·å°±ä¸éœ€è¦å†™ç›¸å¯¹è·¯å¾„äº†</p><pre tabindex=0><code>input {
    jdbc {
        jdbc_driver_library =&gt; &#34;mysql-connector-java-5.1.48.jar&#34;
        jdbc_driver_class =&gt; &#34;com.mysql.jdbc.Driver&#34;
        jdbc_connection_string =&gt; &#34;jdbc:mysql://192.168.111.128:3306/ssm&#34;
        jdbc_user =&gt; &#34;root&#34;
        jdbc_password =&gt; &#34;123456&#34;
        jdbc_paging_enabled =&gt; &#34;true&#34;
        jdbc_page_size =&gt; &#34;2&#34;
        statement =&gt; &#34;SELECT id,&#39;name&#39;,phone FROM phone where update_data &gt;= :sql_last_value&#34;
        tracking_column_type =&gt; &#34;timestamp&#34;
        tracking_column =&gt; &#34;update_date&#34;
        schedule =&gt; &#34;* * * * *&#34;
    }
}
output {
    elasticsearch {
        index =&gt; &#34;phone&#34;
        document_id=&gt; &#34;%{id}&#34;
        hosts =&gt; [&#34;http://192.168.111.128:9200&#34;]
    }
}
</code></pre><p>å¯åŠ¨å‘½ä»¤</p><pre tabindex=0><code>./logstash -f ../config/logstash-sample.conf
</code></pre><h1 id=æ‰‹åŠ¨å®‰è£…8x>æ‰‹åŠ¨å®‰è£…8.x<a href=#æ‰‹åŠ¨å®‰è£…8x class=hanchor arialabel=Anchor>&#8983;</a></h1><aside>ğŸ“Œ 8.0 å·²ç»è‡ªå¸¦äº†jdk</aside><h2 id=äºŒè¿›åˆ¶åŒ…å®‰è£…es>äºŒè¿›åˆ¶åŒ…å®‰è£…ES<a href=#äºŒè¿›åˆ¶åŒ…å®‰è£…es class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=å®‰è£…>å®‰è£…<a href=#å®‰è£… class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½åŒ…å¹¶è§£å‹</span>
</span></span><span style=display:flex><span>wget https://xxxx.tar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨./elasticsearch</span>
</span></span><span style=display:flex><span>./bin/elasticsearch
</span></span></code></pre></div><h3 id=è¿è¡Œç»“æœ>è¿è¡Œç»“æœ<a href=#è¿è¡Œç»“æœ class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>âœ… Elasticsearch security features have been automatically configured!
</span></span><span style=display:flex><span>âœ… Authentication is enabled and cluster connections are encrypted.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>â„¹ï¸  Password <span style=color:#66d9ef>for</span> the elastic user <span style=color:#f92672>(</span>reset with <span style=color:#e6db74>`</span>bin/elasticsearch-reset-password -u elastic<span style=color:#e6db74>`</span><span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  Shb2+OuCKthxFTxD-*jE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:
</span></span><span style=display:flex><span>  ceb6add33653a4c8f3493bddde839cdfcf1035a3a50cb01247962495f15ea40f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>â„¹ï¸  Configure Kibana to use this cluster:
</span></span><span style=display:flex><span>â€¢ Run Kibana and click the configuration link in the terminal when Kibana starts.
</span></span><span style=display:flex><span>â€¢ Copy the following enrollment token and paste it into Kibana in your browser <span style=color:#f92672>(</span>valid <span style=color:#66d9ef>for</span> the next <span style=color:#ae81ff>30</span> minutes<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  eyJ2ZXIiOiI4LjAuMCIsImFkciI6WyIxMC4wLjIuNDo5MjAwIl0sImZnciI6ImNlYjZhZGQzMzY1M2E0YzhmMzQ5M2JkZGRlODM5Y2RmY2YxMDM1YTNhNTBjYjAxMjQ3OTYyNDk1ZjE1ZWE0MGYiLCJrZXkiOiJXaEV4SDM4QlZXV242cU9KejgxNTprUVliUEY0dlJfaU56MnRFaDlRY0hnIn0<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>â„¹ï¸  Configure other nodes to join this cluster:
</span></span><span style=display:flex><span>â€¢ On this node:
</span></span><span style=display:flex><span>  âƒ Create an enrollment token with <span style=color:#e6db74>`</span>bin/elasticsearch-create-enrollment-token -s node<span style=color:#e6db74>`</span>.
</span></span><span style=display:flex><span>  âƒ Uncomment the transport.host setting at the end of config/elasticsearch.yml.
</span></span><span style=display:flex><span>  âƒ Restart Elasticsearch.
</span></span><span style=display:flex><span>â€¢ On other nodes:
</span></span><span style=display:flex><span>  âƒ Start Elasticsearch with <span style=color:#e6db74>`</span>bin/elasticsearch --enrollment-token &lt;token&gt;<span style=color:#e6db74>`</span>, using the enrollment token that you generated.
</span></span></code></pre></div><h3 id=åœæ­¢æœåŠ¡ä¿®æ”¹é…ç½®æ–‡ä»¶>åœæ­¢æœåŠ¡,ä¿®æ”¹é…ç½®æ–‡ä»¶<a href=#åœæ­¢æœåŠ¡ä¿®æ”¹é…ç½®æ–‡ä»¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ç„¶åè¾“å…¥ï¼šcurl 127.0.0.1:9200,è¿”å›æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>hy@localhost ~<span style=color:#f92672>]</span>$ curl 127.0.0.1:9200
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>52<span style=color:#f92672>)</span> Empty reply from server
</span></span></code></pre></div><p>è€ŒESé‚£è¾¹ä¹Ÿæœ‰å“åº”</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># çœ‹æ¥è¿™å’Œä»¥å‰çš„7.1.1ç‰ˆæœ¬ä¸ä¸€æ ·äº†</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2022-02-19T05:02:02,812<span style=color:#f92672>][</span>WARN <span style=color:#f92672>][</span>o.e.x.s.t.n.SecurityNetty4HttpServerTransport<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>localhost.localdomain<span style=color:#f92672>]</span> received plaintext http traffic on an https channel, closing connection Netty4HttpChannel<span style=color:#f92672>{</span>localAddress<span style=color:#f92672>=</span>/127.0.0.1:9200, remoteAddress<span style=color:#f92672>=</span>/127.0.0.1:38518<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2022-02-19T05:02:27,144<span style=color:#f92672>][</span>WARN <span style=color:#f92672>][</span>o.e.x.s.t.n.SecurityNetty4HttpServerTransport<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>localhost.localdomain<span style=color:#f92672>]</span> received plaintext http traffic on an https channel, closing connection Netty4HttpChannel<span style=color:#f92672>{</span>localAddress<span style=color:#f92672>=</span>/<span style=color:#f92672>[</span>0:0:0:0:0:0:0:1<span style=color:#f92672>]</span>:9200, remoteAddress<span style=color:#f92672>=</span>/<span style=color:#f92672>[</span>0:0:0:0:0:0:0:1<span style=color:#f92672>]</span>:56174<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># éœ€è¦æŠŠsecurity featureséƒ½å…³é—­ï¼Œå¦åˆ™httpä¸å¯¹å¤–æœåŠ¡äº†</span>
</span></span><span style=display:flex><span><span style=color:#75715e># trueæ”¹æˆfalse</span>
</span></span><span style=display:flex><span>xpack.security.http.ssl:
</span></span><span style=display:flex><span>  enabled: false
</span></span><span style=display:flex><span>  keystore.path: certs/http.p12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable encryption and mutual authentication between cluster nodes</span>
</span></span><span style=display:flex><span>xpack.security.transport.ssl:
</span></span><span style=display:flex><span>  enabled: false
</span></span></code></pre></div><h3 id=æµ‹è¯•è®¿é—®>æµ‹è¯•è®¿é—®<a href=#æµ‹è¯•è®¿é—® class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http://localhost:9200
</span></span><span style=display:flex><span>éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç :elastic  /  Shb2+OuCKthxFTxD-*jE
</span></span></code></pre></div><h3 id=javaè®¿é—®æµ‹è¯•>javaè®¿é—®æµ‹è¯•<a href=#javaè®¿é—®æµ‹è¯• class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.elasticsearch.client<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>elasticsearch-rest-client<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>8.0.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>@Bean(destroyMethod = &#34;close&#34;)
</span></span><span style=display:flex><span>public RestClient restClient() throws CertificateException, IOException, KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    final CredentialsProvider credentialsProvider =
</span></span><span style=display:flex><span>            new BasicCredentialsProvider();
</span></span><span style=display:flex><span>    credentialsProvider.setCredentials(AuthScope.ANY,
</span></span><span style=display:flex><span>            new UsernamePasswordCredentials(&#34;elastic&#34;, &#34;VWFjE60dbpKIjbajGJQ4&#34;));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Path caCertificatePath = Paths.get(&#34;E:\\es\\elasticsearch-8.0.0-windows-x86_64\\elasticsearch-8.0.0\\config\\certs\\http_ca.crt&#34;);
</span></span><span style=display:flex><span>    CertificateFactory factory =
</span></span><span style=display:flex><span>            CertificateFactory.getInstance(&#34;X.509&#34;);
</span></span><span style=display:flex><span>    Certificate trustedCa;
</span></span><span style=display:flex><span>    try (InputStream is = Files.newInputStream(caCertificatePath)) {
</span></span><span style=display:flex><span>        trustedCa = factory.generateCertificate(is);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    KeyStore trustStore = KeyStore.getInstance(&#34;pkcs12&#34;);
</span></span><span style=display:flex><span>    trustStore.load(null, null);
</span></span><span style=display:flex><span>    trustStore.setCertificateEntry(&#34;ca&#34;, trustedCa);
</span></span><span style=display:flex><span>    SSLContextBuilder sslContextBuilder = SSLContexts.custom()
</span></span><span style=display:flex><span>            .loadTrustMaterial(trustStore, null);
</span></span><span style=display:flex><span>    final SSLContext sslContext = sslContextBuilder.build();
</span></span><span style=display:flex><span>    RestClientBuilder builder = RestClient.builder(
</span></span><span style=display:flex><span>            new HttpHost(&#34;localhost&#34;, 9200, &#34;https&#34;))
</span></span><span style=display:flex><span>            .setHttpClientConfigCallback(httpClientBuilder -&gt; {
</span></span><span style=display:flex><span>                httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
</span></span><span style=display:flex><span>                return httpClientBuilder.setSSLContext(sslContext);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    return builder.build();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//æ³¨å…¥client</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>RestClient restClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Request request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Request(<span style=color:#e6db74>&#34;GET&#34;</span>,<span style=color:#e6db74>&#34;/ess_book/_doc/1&#34;</span>);
</span></span><span style=display:flex><span>Response response <span style=color:#f92672>=</span> restClient.<span style=color:#a6e22e>performRequest</span>(request);
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> EntityUtils.<span style=color:#a6e22e>toString</span>(response.<span style=color:#a6e22e>getEntity</span>());
</span></span></code></pre></div><h2 id=é›†ç¾¤å®‰è£…es>é›†ç¾¤å®‰è£…ES<a href=#é›†ç¾¤å®‰è£…es class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=https://juejin.cn/post/7066717637564170271>å…¨æ ˆå¼€å‘ä¹‹ElasticSearch8.0åˆ†å¸ƒå¼æœç´¢å¼•æ“é›†ç¾¤åŠå…¶é«˜å¯ç”¨æµ‹è¯• - æ˜é‡‘</a></p><h2 id=å®‰è£…kibana>å®‰è£…Kibana<a href=#å®‰è£…kibana class=hanchor arialabel=Anchor>&#8983;</a></h2><h1 id=å®‰è£…æŠ¥é”™>å®‰è£…æŠ¥é”™<a href=#å®‰è£…æŠ¥é”™ class=hanchor arialabel=Anchor>&#8983;</a></h1><p>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/sysctl.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vm.max_map_count<span style=color:#f92672>=</span>****262144
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä½¿ç”Ÿæ•ˆ</span>
</span></span><span style=display:flex><span>sysctl -p****
</span></span></code></pre></div><h1 id=å®‰è£…æ’ä»¶>å®‰è£…æ’ä»¶<a href=#å®‰è£…æ’ä»¶ class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=å®‰è£…head>å®‰è£…HEAD<a href=#å®‰è£…head class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Headæ˜¯elasticsearchçš„é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ•°æ®çš„æµè§ˆå’ŒæŸ¥è¯¢</p><p>(1)elasticsearch-headæ˜¯ä¸€æ¬¾å¼€æºè½¯ä»¶ï¼Œè¢«æ‰˜ç®¡åœ¨githubä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨å®ƒï¼Œå¿…é¡»å…ˆå®‰è£…gitï¼Œé€šè¿‡gitè·å–elasticsearch-head</p><p>(2)è¿è¡Œelasticsearch-headä¼šç”¨åˆ°gruntï¼Œè€Œgruntéœ€è¦npmåŒ…ç®¡ç†å™¨ï¼Œæ‰€ä»¥nodejsæ˜¯å¿…é¡»è¦å®‰è£…çš„</p><p>(3)elasticsearch5.0ä¹‹åï¼Œelasticsearch-headä¸åšä¸ºæ’ä»¶æ”¾åœ¨å…¶pluginsç›®å½•ä¸‹äº†ã€‚ä½¿ç”¨gitæ‹·è´elasticsearch-headåˆ°æœ¬åœ°</p><p>cd /usr/local/</p><p>git clone git://github.com/mobz/elasticsearch-head.git</p><p>(4)å®‰è£…elasticsearch-headä¾èµ–åŒ…</p><p>[root<a href=#ZgotmplZ>@localhost</a> local]# npm install -g grunt-cli</p><p>[root<a href=#ZgotmplZ>@localhost</a> _site]# cd /usr/local/elasticsearch-head/</p><p>[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# cnpm install</p><p>(5)ä¿®æ”¹Gruntfile.js</p><p>[root<a href=#ZgotmplZ>@localhost</a> _site]# cd /usr/local/elasticsearch-head/</p><p>[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# vi Gruntfile.js</p><p>åœ¨connect&ndash;>server&ndash;>optionsä¸‹é¢æ·»åŠ ï¼šhostname:â€™*â€™ï¼Œå…è®¸æ‰€æœ‰IPå¯ä»¥è®¿é—®</p><p>(6)ä¿®æ”¹elasticsearch-headé»˜è®¤è¿æ¥åœ°å€[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# cd /usr/local/elasticsearch-head/_site/</p><p>[root<a href=#ZgotmplZ>@localhost</a> _site]# vi app.js</p><p>å°†this.base_uri = this.config.base_uri || this.prefs.get(&ldquo;app-base_uri&rdquo;) || &ldquo;http://localhost:9200&rdquo;;ä¸­çš„localhostä¿®æ”¹æˆä½ esçš„æœåŠ¡å™¨åœ°å€</p><p>(7)é…ç½®elasticsearchå…è®¸è·¨åŸŸè®¿é—®</p><p>æ‰“å¼€elasticsearchçš„é…ç½®æ–‡ä»¶elasticsearch.ymlï¼Œåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä¸‹é¢ä¸¤è¡Œä»£ç å³å¯ï¼š</p><p>http.cors.enabled: true</p><p>http.cors.allow-origin: &ldquo;*&rdquo;</p><p>(8)æ‰“å¼€9100ç«¯å£</p><p>[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# firewall-cmd &ndash;zone=public &ndash;add-port=9100/tcp &ndash;permanent</p><p>é‡å¯é˜²ç«å¢™</p><p>[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# firewall-cmd &ndash;reload</p><p>(9)å¯åŠ¨elasticsearch</p><p>(10)å¯åŠ¨elasticsearch-head</p><p>[root<a href=#ZgotmplZ>@localhost</a> _site]# cd /usr/local/elasticsearch-head/</p><p>[root<a href=#ZgotmplZ>@localhost</a> elasticsearch-head]# node_modules/grunt/bin/grunt server</p><p>(11)è®¿é—®elasticsearch-head</p><p>å…³é—­é˜²ç«å¢™ï¼šsystemctl stop firewalld.service</p><p>æµè§ˆå™¨è¾“å…¥ç½‘å€ï¼š<a href=http://192.168.25.131:9100/>http://192.168.25.131:9100/</a></p><h3 id=å®‰è£…ä¸­æ–‡åˆ†è¯å™¨>å®‰è£…ä¸­æ–‡åˆ†è¯å™¨<a href=#å®‰è£…ä¸­æ–‡åˆ†è¯å™¨ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>(1)ä¸‹è½½ä¸­æ–‡åˆ†è¯å™¨<a href=https://github.com/medcl/elasticsearch-analysis-ik>https://github.com/medcl/elasticsearch-analysis-ik</a></p><pre tabindex=0><code>ä¸‹è½½elasticsearch-analysis-ik-master.zip
</code></pre><p>(2)è§£å‹elasticsearch-analysis-ik-master.zip</p><p>unzip elasticsearch-analysis-ik-master.zip</p><p>(3)è¿›å…¥elasticsearch-analysis-ik-masterï¼Œç¼–è¯‘æºç </p><p>mvn clean install -Dmaven.test.skip=true</p><p>(4)åœ¨esçš„pluginsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºç›®å½•ik</p><p>(5)å°†ç¼–è¯‘åç”Ÿæˆçš„elasticsearch-analysis-ik-ç‰ˆæœ¬.zipç§»åŠ¨åˆ°ikä¸‹ï¼Œå¹¶è§£å‹</p><p>(6)è§£å‹åçš„å†…å®¹ç§»åŠ¨åˆ°ikç›®å½•ä¸‹</p><h3 id=åˆ†è¯å™¨ä»‹ç»åŠå†…ç½®åˆ†è¯å™¨>åˆ†è¯å™¨ä»‹ç»åŠå†…ç½®åˆ†è¯å™¨<a href=#åˆ†è¯å™¨ä»‹ç»åŠå†…ç½®åˆ†è¯å™¨ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>åˆ†è¯å™¨ï¼šä»ä¸€ä¸²æ–‡æœ¬ä¸­åˆ‡åˆ†å‡ºä¸€ä¸ªä¸€ä¸ªçš„è¯æ¡ï¼Œå¹¶å¯¹æ¯ä¸ªè¯æ¡è¿›è¡Œæ ‡å‡†åŒ–</p><p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p><p>character filterï¼šåˆ†è¯ä¹‹å‰çš„é¢„å¤„ç†ï¼Œè¿‡æ»¤æ‰HTMLæ ‡ç­¾ï¼Œç‰¹æ®Šç¬¦å·è½¬æ¢ç­‰</p><p>tokenizerï¼šåˆ†è¯</p><p>token filterï¼šæ ‡å‡†åŒ–</p><p>å†…ç½®åˆ†è¯å™¨ï¼š</p><p>standard åˆ†è¯å™¨ï¼š(é»˜è®¤çš„)ä»–ä¼šå°†è¯æ±‡å•å…ƒè½¬æ¢æˆå°å†™å½¢å¼ï¼Œå¹¶å»é™¤åœç”¨è¯å’Œæ ‡ç‚¹ç¬¦å·ï¼Œæ”¯æŒä¸­æ–‡é‡‡ç”¨çš„æ–¹æ³•ä¸ºå•å­—åˆ‡åˆ†</p><p>simple åˆ†è¯å™¨ï¼šé¦–å…ˆä¼šé€šè¿‡éå­—æ¯å­—ç¬¦æ¥åˆ†å‰²æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åå°†è¯æ±‡å•å…ƒç»Ÿä¸€ä¸ºå°å†™å½¢å¼ã€‚è¯¥åˆ†æå™¨ä¼šå»æ‰æ•°å­—ç±»å‹çš„å­—ç¬¦ã€‚</p><p>Whitespace åˆ†è¯å™¨ï¼šä»…ä»…æ˜¯å»é™¤ç©ºæ ¼ï¼Œå¯¹å­—ç¬¦æ²¡æœ‰lowcaseåŒ–,ä¸æ”¯æŒä¸­æ–‡ï¼›å¹¶ä¸”ä¸å¯¹ç”Ÿæˆçš„è¯æ±‡å•å…ƒè¿›è¡Œå…¶ä»–çš„æ ‡å‡†åŒ–å¤„ç†ã€‚</p><p>language åˆ†è¯å™¨ï¼šç‰¹å®šè¯­è¨€çš„åˆ†è¯å™¨ï¼Œä¸æ”¯æŒä¸­æ–‡</p><h1 id=apiç®€å•ä½¿ç”¨>APIç®€å•ä½¿ç”¨<a href=#apiç®€å•ä½¿ç”¨ class=hanchor arialabel=Anchor>&#8983;</a></h1><h1 id=æŸ¥è¯¢ç´¢å¼•å’Œæ˜ å°„>æŸ¥è¯¢ç´¢å¼•å’Œæ˜ å°„<a href=#æŸ¥è¯¢ç´¢å¼•å’Œæ˜ å°„ class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># è¿™ä¸¤ä¸ªéƒ½æ˜¯æŸ¥çœ‹ç´¢å¼•,åªæ˜¯ç¬¬ä¸‰è¡Œæ¯”ç¬¬ä¸‰è¡Œå¤šå‡ ä¸ªå­—æ®µ
GET lib
GET /lib/_settings

# æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•
GET /_all/_settings

# æŸ¥è¯¢æ˜ å°„
GET /lib2/_mapping
</code></pre><h1 id=æ·»åŠ ç´¢å¼•>æ·»åŠ ç´¢å¼•<a href=#æ·»åŠ ç´¢å¼• class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># æ–¹å¼ä¸€,ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®
PUT /lib

# æ–¹å¼äºŒ
PUT /lib/
{
  &#34;settings&#34;: {
    &#34;index&#34;: {
      &#34;number_of_shards&#34;: 5,
      &#34;number_of_replicas&#34;: 1
    }
  }
}

# æ–¹å¼ä¸‰,æŒ‡å®šå­—æ®µç±»å‹
PUT /lib3
{
  &#34;mappings&#34;: {
    &#34;user&#34;:{
      &#34;properties&#34;:{
        &#34;name&#34;:{&#34;type&#34;:&#34;text&#34;},
        &#34;address&#34;:{&#34;type&#34;:&#34;text&#34;},
        &#34;age&#34;:{&#34;type&#34;:&#34;text&#34;},
        &#34;interests&#34;:{&#34;type&#34;:&#34;text&#34;},
        &#34;birthday&#34;:{&#34;type&#34;:&#34;text&#34;}
      }
    }
  }
}
</code></pre><h1 id=æ·»åŠ æ–‡æ¡£>æ·»åŠ æ–‡æ¡£<a href=#æ·»åŠ æ–‡æ¡£ class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># æŒ‡å®šidçš„æ—¶å€™ç”¨PUT
PUT /lib/user/1
{
    &#34;first_name&#34;:&#34;Jame&#34;,
    &#34;last_name&#34;:&#34;Smith&#34;,
    &#34;age&#34;:&#34;32&#34;,
    &#34;about&#34;:&#34;I like to collect rock albums&#34;,
    &#34;interests&#34;:[&#34;music&#34;]
}

# æ²¡æœ‰æŒ‡å®šIDç”¨POST,åˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨ç”ŸæˆID
POST /lib/user/
{
    &#34;first_name&#34;:&#34;anthony&#34;,
    &#34;last_name&#34;:&#34;Smith&#34;,
    &#34;age&#34;:&#34;32&#34;,
    &#34;about&#34;:&#34;I like to collect rock albums&#34;,
    &#34;interests&#34;:[&#34;music&#34;]
}
</code></pre><h1 id=æŸ¥è¯¢æ–‡æ¡£>æŸ¥è¯¢æ–‡æ¡£<a href=#æŸ¥è¯¢æ–‡æ¡£ class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># æŒ‡å®šID
GET /lib/user/1

# æŸ¥çœ‹æ–‡æ¡£ä¸­çš„æŒ‡å®šå­—æ®µ
GET /lib/user/1?_source=age,about

# æŸ¥è¯¢ç´¢å¼•ä¸‹çš„æ‰€æœ‰æ–‡æ¡£
GET /tt/ttt/_search
</code></pre><h1 id=æ›´æ–°æ–‡æ¡£>æ›´æ–°æ–‡æ¡£<a href=#æ›´æ–°æ–‡æ¡£ class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># ä»¥è¦†ç›–çš„æ–¹å¼,å¦‚æœæœ‰è¿™ä¸ªid,å°±è¦†ç›–æ›´æ–°,å¦‚æœæ²¡æœ‰id,å°±åˆ›å»º
PUT /lib/user/1
{
    &#34;first_name&#34;:&#34;Jame&#34;,
    &#34;last_name&#34;:&#34;Smith&#34;,
    &#34;age&#34;:&#34;36&#34;,
    &#34;about&#34;:&#34;I like to collect rock albums&#34;,
    &#34;interests&#34;:[&#34;music&#34;]
}

# åªæ˜¯æ›´æ–°æ–‡æ¡£
POST /lib/user/1/_update
{
  &#34;doc&#34;:{
     &#34;age&#34;:&#34;37&#34;
  }
}
</code></pre><h1 id=åˆ é™¤æ–‡æ¡£å’Œç´¢å¼•>åˆ é™¤æ–‡æ¡£å’Œç´¢å¼•<a href=#åˆ é™¤æ–‡æ¡£å’Œç´¢å¼• class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code># åˆ é™¤æ–‡æ¡£
DELETE /lib/user/1

# åˆ é™¤ç´¢å¼•
DELETE /lib
</code></pre><h1 id=muliget>MuliGet<a href=#muliget class=hanchor arialabel=Anchor>&#8983;</a></h1><p>MuliGet éœ€è¦ID,æ‰èƒ½å®ç°</p><pre tabindex=0><code># æ‰¹é‡æŸ¥è¯¢,è¿™æ˜¯æŸ¥å‡ºå…¨éƒ¨æ•°æ®
GET /_mget
{
  &#34;docs&#34;:[
    {
      &#34;_index&#34;:&#34;lib&#34;,
      &#34;_type&#34;:&#34;user&#34;,
      &#34;_id&#34;:1
    },
    {
      &#34;_index&#34;:&#34;lib&#34;,
      &#34;_type&#34;:&#34;user&#34;,
      &#34;_id&#34;:2
    },
    {
      &#34;_index&#34;:&#34;lib&#34;,
      &#34;_type&#34;:&#34;user&#34;,
      &#34;_id&#34;:3
    }
    ]
}

# æ‰¹é‡æŸ¥è¯¢,ç­›é€‰å­—æ®µ
GET /_mget
{
  &#34;docs&#34;:[
    {
      &#34;_index&#34;:&#34;lib&#34;,
      &#34;_type&#34;:&#34;user&#34;,
      &#34;_id&#34;:1,
      &#34;_source&#34;:&#34;interests&#34;
    },
    {
      &#34;_index&#34;:&#34;lib&#34;,
      &#34;_type&#34;:&#34;user&#34;,
      &#34;_id&#34;:2,
      &#34;_source&#34;:[&#34;interests&#34;,&#34;age&#34;]
    }]
}

# MuliGetæ‰¹é‡æŸ¥è¯¢çš„æ˜¯åŒä¸€ä¸ªæ–‡æ¡£æ—¶å€™,å¯ä»¥ç®€å†™æ–¹å¼
GET /lib/user/_mget
{
  &#34;docs&#34;: [
    {
      &#34;_id&#34;: 1
    },
    {
      &#34;_type&#34;: &#34;user&#34;,
      &#34;_id&#34;: 2
    }
  ]
}

# æ›´ç®€å•çš„æ–¹å¼
GET /lib/user/_mget
{
   &#34;ids&#34;: [&#34;1&#34;,&#34;2&#34;]
}
</code></pre><h1 id=bulkæ‰¹é‡æ’å…¥>Bulkæ‰¹é‡æ’å…¥<a href=#bulkæ‰¹é‡æ’å…¥ class=hanchor arialabel=Anchor>&#8983;</a></h1><p>bulkçš„æ ¼å¼ï¼š</p><pre tabindex=0><code>{action:{metadata}}
{requstbody}
</code></pre><ul><li>action:</li><li>createï¼šæ–‡æ¡£ä¸å­˜åœ¨æ—¶åˆ›å»º</li><li>update:æ›´æ–°æ–‡æ¡£</li><li>index:åˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£</li><li>delete:åˆ é™¤ä¸€ä¸ªæ–‡æ¡£</li><li>metadata:</li><li>index</li><li>_type</li><li>_id</li></ul><p>create å’Œindexçš„åŒºåˆ«:å¦‚æœæ•°æ®å­˜åœ¨ï¼Œä½¿ç”¨createæ“ä½œå¤±è´¥ï¼Œä¼šæç¤ºæ–‡æ¡£å·²ç»å­˜åœ¨ï¼Œä½¿ç”¨indexåˆ™å¯ä»¥æˆåŠŸæ‰§è¡Œã€‚</p><p>bulkä¸€æ¬¡æœ€å¤§å¤„ç†å¤šå°‘æ•°æ®é‡:</p><p>bulkä¼šæŠŠå°†è¦å¤„ç†çš„æ•°æ®è½½å…¥å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ•°æ®é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœ€ä½³çš„æ•°æ®é‡ä¸æ˜¯ä¸€ä¸ªç¡®å®šçš„æ•°å€¼ï¼Œå®ƒå–å†³äºä½ çš„ç¡¬ä»¶ï¼Œä½ çš„æ–‡æ¡£å¤§å°ä»¥åŠå¤æ‚æ€§ï¼Œä½ çš„ç´¢å¼•ä»¥åŠæœç´¢çš„è´Ÿè½½ã€‚ä¸€èˆ¬å»ºè®®æ˜¯1000-5000ä¸ªæ–‡æ¡£ï¼Œå¤§å°å»ºè®®æ˜¯5-15MBï¼Œé»˜è®¤ä¸èƒ½è¶…è¿‡100Mï¼Œå¯ä»¥åœ¨esçš„é…ç½®æ–‡ä»¶ï¼ˆå³$ES_HOMEä¸‹çš„configä¸‹çš„elasticsearch.ymlï¼‰ä¸­ã€‚</p><pre tabindex=0><code># æ‰¹é‡åˆ é™¤,deleteä¸éœ€è¦è¯·æ±‚ä½“
{&#34;delete&#34;:{&#34;_index&#34;:&#34;lib&#34;,&#34;_type&#34;:&#34;user&#34;,&#34;_id&#34;:&#34;1&#34;}}

# æ‰¹é‡æ·»åŠ 
POST /lib2/books/_bulk
{&#34;index&#34;:{&#34;_id&#34;:1}}
{&#34;title&#34;:&#34;java&#34;,&#34;price&#34;:55}
{&#34;index&#34;:{&#34;_id&#34;:2}}
{&#34;title&#34;:&#34;html5&#34;,&#34;price&#34;:55}
{&#34;index&#34;:{&#34;_id&#34;:3}}
{&#34;title&#34;:&#34;php&#34;,&#34;price&#34;:35}
{&#34;index&#34;:{&#34;_id&#34;:4}}
{&#34;title&#34;:&#34;python&#34;,&#34;price&#34;:50}

# æ‰¹é‡è·å–
GET /lib2/books/_mget
{
	&#34;ids&#34;: [&#34;1&#34;,&#34;2&#34;,&#34;3&#34;,&#34;4&#34;]
}

# æ‰¹é‡æ“ä½œ
POST /lib2/books/_bulk
{&#34;delete&#34;:{&#34;_index&#34;:&#34;lib2&#34;,&#34;_type&#34;:&#34;books&#34;,&#34;_id&#34;:4}}
{&#34;create&#34;:{&#34;_index&#34;:&#34;tt&#34;,&#34;_type&#34;:&#34;ttt&#34;,&#34;_id&#34;:&#34;100&#34;}}
{&#34;name&#34;:&#34;lisi&#34;}
{&#34;index&#34;:{&#34;_index&#34;:&#34;tt&#34;,&#34;_type&#34;:&#34;ttt&#34;}}
{&#34;name&#34;:&#34;zhaosi&#34;}
{&#34;update&#34;:{&#34;_index&#34;:&#34;lib2&#34;,&#34;_type&#34;:&#34;books&#34;,&#34;_id&#34;:&#34;4&#34;}}
{&#34;doc&#34;:{&#34;price&#34;:58}}
</code></pre><h1 id=åŸºæœ¬æŸ¥è¯¢queryæŸ¥è¯¢>åŸºæœ¬æŸ¥è¯¢(QueryæŸ¥è¯¢)<a href=#åŸºæœ¬æŸ¥è¯¢queryæŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=termå’ŒtermsæŸ¥è¯¢>termå’ŒtermsæŸ¥è¯¢<a href=#termå’ŒtermsæŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li>term æŸ¥è¯¢ä¼šå»å€’æ’ç´¢å¼•ä¸­å¯»æ‰¾ç¡®åˆ‡çš„tem,å®ƒå¹¶ä¸çŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨,è¿™ç§æŸ¥è¯¢ä½¿ç”¨keyword,numeric,date,åœ¨æ²¡æœ‰ä½¿ç”¨åˆ†è¯å™¨çš„æ—¶å€™ä½¿ç”¨</li><li>term æŸ¥è¯¢æŸä¸ªå­—æ®µé‡Œå«æœ‰æŸä¸ªå…³é”®è¯çš„æ–‡æ¡£</li><li>terms:æŸ¥è¯¢æŸä¸ªå­—æ®µé‡Œå«æœ‰å¤šä¸ªå…³é”®è¯çš„æ–‡æ¡£</li></ul><pre tabindex=0><code># termï¼Œnameå«æœ‰â€œzhaomingâ€
GET /lib3/user/_search/
{
  &#34;query&#34;:{
    &#34;term&#34;: {&#34;name&#34;: &#34;zhaoming&#34;}
  }
}

# termsï¼Œnameå«æœ‰â€œzhouâ€æˆ–è€…è¿˜æœ‰&#34;yang&#34;çš„æŸ¥å‡ºæ¥
GET /lib3/user/_search/
{
  &#34;query&#34;:{
    &#34;terms&#34;: {
      &#34;name&#34;: [&#34;zhou&#34;,&#34;yang&#34;]
    }
  }
}
</code></pre><h3 id=formå’Œsizeåˆ†é¡µ>formå’Œsizeåˆ†é¡µ<a href=#formå’Œsizeåˆ†é¡µ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>formæ˜¯ä»0å¼€å§‹çš„,sizeæ˜¯å–å¤šå°‘ä¸ª</p><pre tabindex=0><code>GET /lib3/user/_search/
{
  &#34;version&#34;: true,  # æŸ¥è¯¢çš„æ—¶å€™å¦‚æœéœ€è¦è¿”å›versionçš„è¯
  &#34;from&#34;: 0,
  &#34;size&#34;: 1,
  &#34;query&#34;:{
    &#34;terms&#34;: {
      &#34;name&#34;: [&#34;zhou&#34;,&#34;lisi&#34;]
    }

}
</code></pre><pre tabindex=0><code>GET article/_count
{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;title&#34;: &#34;é‡‘è&#34;
    }
  }
}
</code></pre><h3 id=matchæŸ¥è¯¢>matchæŸ¥è¯¢<a href=#matchæŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>match queryçŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨ï¼Œä¼šå¯¹filedè¿›è¡Œåˆ†è¯æ“ä½œï¼Œç„¶åå†æŸ¥è¯¢</p><ul><li>match_all:æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</li><li>match:æŸ¥è¯¢ä¸€ä¸ªå­—æ®µ</li><li>multi_match:æŸ¥è¯¢å¤šä¸ªå­—æ®µ</li><li>match_phrase:åŒ…å«å¾—å«æœ‰ä¸€æ ·çš„,è€Œä¸”é¡ºåºè¿˜ä¸€æ ·çš„,å¯ä»¥ä¸ç”¨å®Œæ•´</li><li>match_phrase_prefix: å‰ç¼€åŒ¹é…</li></ul><pre tabindex=0><code># matchæ˜¯çŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨çš„,æ‰€ä»¥ä¼šå»æŸ¥è¯¢nameæ˜¯lisiçš„,æˆ–è€…nameæ˜¯zhaomingçš„(orçš„å…³ç³»)
GET /lib3/user/_search
{
  &#34;query&#34;:{
    &#34;match&#34;: {
      &#34;name&#34;: &#34;lisi zhaoming&#34;
    }
  }
}

# å¯ä»¥æŒ‡å®šå¤šä¸ªå­—æ®µ
GET /lib3/user/_search
{
    &#34;query&#34;:{
        &#34;multi_match&#34;: {
            &#34;query&#34;: &#34;lvyou&#34;,
            &#34;fields&#34;: [&#34;interests&#34;,&#34;name&#34;]
         }
    }
}

# çŸ­è¯­åŒ¹é…(è¦å®Œå…¨åŒ¹é…),åŒ…å«çš„å…³ç³»
GET /lib3/user/_search
{
  &#34;query&#34;:{
    &#34;match_phrase&#34;: {
      &#34;interests&#34;: &#34;lvyou, duanlian &#34;
    }
  }
}

# å‰ç¼€åŒ¹é…
GET /lib3/user/_search
{
  &#34;query&#34;:{
    &#34;match_phrase_prefix&#34;: {
      &#34;name&#34;: &#34;zhao&#34;
    }
  }
}
</code></pre><h3 id=_sourceæ§åˆ¶è¿”å›å­—æ®µ>_sourceæ§åˆ¶è¿”å›å­—æ®µ<a href=#_sourceæ§åˆ¶è¿”å›å­—æ®µ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code># æŒ‡å®šè¿”å›çš„å­—æ®µ
GET /lib3/user/_search
{
    &#34;_source&#34;: [&#34;address&#34;,&#34;name&#34;],
    &#34;query&#34;: {
        &#34;match&#34;: {
            &#34;interests&#34;: &#34;changge&#34;
        }
    }
}

# åŒ…å«å’Œæ’é™¤è¿”å›å­—æ®µ
GET /lib3/user/_search
{
    &#34;query&#34;: {
        &#34;match_all&#34;: {}
    },
    &#34;_source&#34;: {
          &#34;includes&#34;: [&#34;name&#34;,&#34;address&#34;], # åŒ…å«è¿™äº›å­—æ®µ
          &#34;excludes&#34;: [&#34;age&#34;,&#34;birthday&#34;]  # æ’é™¤è¿™äº›å­—æ®µ
      }
}

# ä½¿ç”¨é€šé…ç¬¦*
GET /lib3/user/_search
{
    &#34;_source&#34;: {
          &#34;includes&#34;: &#34;addr*&#34;,
          &#34;excludes&#34;: [&#34;name&#34;,&#34;bir*&#34;]
    },
    &#34;query&#34;: {
        &#34;match_all&#34;: {}
    }
}
</code></pre><h3 id=sortæ’åº>sortæ’åº<a href=#sortæ’åº class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code># æŒ‡å®šæ’åºå­—æ®µ
GET /lib3/user/_search
{
  &#34;query&#34;:{
    &#34;match_all&#34;: {}
  },
  &#34;sort&#34;: [
    {
      &#34;age&#34;: {
        &#34;order&#34;: &#34;desc&#34;
      }
    }
  ]
}

# æ§åˆ¶èŒƒå›´
GET /lib3/user/_search
{
  &#34;query&#34;:{
    &#34;range&#34;: {
      &#34;age&#34;: {
        &#34;gte&#34;: 20,
        &#34;lte&#34;: 38,
        &#34;include_lower&#34;:true,   # trueåŒ…å«,falseä¸åŒ…å«,ä¸‹é™
        &#34;include_upper&#34;:true    # trueåŒ…å«,falseä¸åŒ…å«,ä¸Šé™
      }
    }
  },
  &#34;sort&#34;: [
    {
      &#34;age&#34;: {
        &#34;order&#34;: &#34;asc&#34;
      }
    }
  ]
}
</code></pre><h3 id=wildcardé€šé…ç¬¦æŸ¥è¯¢>wildcardé€šé…ç¬¦æŸ¥è¯¢<a href=#wildcardé€šé…ç¬¦æŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å…è®¸ä½¿ç”¨é€šé…ç¬¦* å’Œ ?æ¥è¿›è¡ŒæŸ¥è¯¢</p><ul><li>ä»£è¡¨0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</li></ul><p>ï¼Ÿä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦</p><pre tabindex=0><code>GET /lib3/user/_search
{
    &#34;query&#34;: {
        &#34;wildcard&#34;: {
             &#34;name&#34;: &#34;zhao*&#34;
        }
    }
}

GET /lib3/user/_search
{
  &#34;query&#34;: {
    &#34;wildcard&#34;: {
      &#34;name&#34;: {
        &#34;value&#34;: &#34;li?i&#34;
      }
    }
  }
}
</code></pre><h3 id=fuzzyæ¨¡ç³ŠæŸ¥è¯¢>fuzzyæ¨¡ç³ŠæŸ¥è¯¢<a href=#fuzzyæ¨¡ç³ŠæŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li>valueï¼šæŸ¥è¯¢çš„å…³é”®å­—</li><li>boostï¼šæŸ¥è¯¢çš„æƒå€¼ï¼Œé»˜è®¤å€¼æ˜¯1.0</li><li>min_similarity:è®¾ç½®åŒ¹é…çš„æœ€å°ç›¸ä¼¼åº¦ï¼Œé»˜è®¤å€¼ä¸º0.5ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼Œå–å€¼ä¸º0-1(åŒ…æ‹¬0å’Œ1);å¯¹äºæ•°å€¼ï¼Œå–å€¼å¯èƒ½å¤§äº1;å¯¹äºæ—¥æœŸå‹å–å€¼ä¸º1d,1mç­‰ï¼Œ1då°±ä»£è¡¨1å¤©</li><li>prefix_length:æŒ‡æ˜åŒºåˆ†è¯é¡¹çš„å…±åŒå‰ç¼€é•¿åº¦ï¼Œé»˜è®¤æ˜¯0</li><li>max_expansions:æŸ¥è¯¢ä¸­çš„è¯é¡¹å¯ä»¥æ‰©å±•çš„æ•°ç›®ï¼Œé»˜è®¤å¯ä»¥æ— é™å¤§</li></ul><pre tabindex=0><code>GET /lib3/user/_search
{
  &#34;query&#34;: {
    &#34;fuzzy&#34;: {
      &#34;name&#34;: {
        &#34;value&#34;: &#34;zhaoimng&#34; # zhaomingå†™åäº†,ä¹Ÿå¯ä»¥æŸ¥å‡ºæ¥
      }
    }
  }
}
</code></pre><h3 id=é«˜äº®æœç´¢>é«˜äº®æœç´¢<a href=#é«˜äº®æœç´¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>GET /lib3/user/_search
{
  &#34;query&#34;: {
    &#34;fuzzy&#34;: {
      &#34;name&#34;: {
        &#34;value&#34;: &#34;zhaoimng&#34;
      }
    }
  },
  &#34;highlight&#34;: {
    &#34;fields&#34;: {
      &#34;name&#34;:{}
    }
  }
}
</code></pre><h3 id=filteræŸ¥è¯¢>FilteræŸ¥è¯¢<a href=#filteræŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>æ˜¯ä¸è®¡ç®—ç›¸å…³æ€§çš„,åŒæ—¶å¯ä»¥ç¼“å­˜,å› æ­¤,filteré€Ÿåº¦è¦å¿«äºquery</p><pre tabindex=0><code># è¿‡æ»¤ä»·æ ¼æ˜¯40çš„
GET /lib4/items/_search
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;filter&#34;: {
        &#34;term&#34;:{&#34;price&#34;: &#34;40&#34;}
      }
    }
  }
}

# è¿‡æ»¤ä»·æ ¼æ˜¯25çš„å’Œ40çš„
GET /lib4/items/_search
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;filter&#34;: {
        &#34;terms&#34;:{&#34;price&#34;: [25,40]}
      }
    }
  }
}
</code></pre><h3 id=boolè¿‡æ»¤æŸ¥è¯¢>boolè¿‡æ»¤æŸ¥è¯¢<a href=#boolè¿‡æ»¤æŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å¯ä»¥å®ç°ç»„åˆè¿‡æ»¤æŸ¥è¯¢</p><p>æ ¼å¼ï¼š</p><pre tabindex=0><code>{
    &#34;bool&#34;: {
        &#34;must&#34;: [],
        &#34;should&#34;: [],
        &#34;must_not&#34;: []
    }
}
</code></pre><p>must:å¿…é¡»æ»¡è¶³çš„æ¡ä»¶&mdash;and</p><p>shouldï¼šå¯ä»¥æ»¡è¶³ä¹Ÿå¯ä»¥ä¸æ»¡è¶³çš„æ¡ä»¶&ndash;or</p><p>must_not:ä¸éœ€è¦æ»¡è¶³çš„æ¡ä»¶&ndash;not</p><pre tabindex=0><code># ç¿»è¯‘è¿‡æ¥:è¦æ˜¯æ˜¯ä»·æ ¼æ˜¯250,æˆ–è€…æ˜¯itemIDæ˜¯:id100123,å¹¶ä¸”priceä¸èƒ½æ˜¯30
GET /lib4/items/_search
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;should&#34;: [
        {&#34;term&#34;:{&#34;price&#34;:250}},
        {&#34;term&#34;:{&#34;itemID&#34;:&#34;id100123&#34;}}
      ],
      &#34;must_not&#34;: [
        {&#34;term&#34;:{&#34;price&#34;:30}}
      ]
    }
  }
}
</code></pre><p>è¿‡æ»¤,è¦æƒ³æ˜ç™½è·Ÿæ™®é€šæŸ¥è¯¢çš„è¿‡æ»¤æœ‰ä»€ä¹ˆä¸ä¸€æ ·</p><pre tabindex=0><code>GET /lib4/items/_search
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;filter&#34;: {
        &#34;range&#34;: {
          &#34;price&#34;: {
            &#34;gte&#34;: 40,
            &#34;lte&#34;: 250
          }
        }
      }
    }
  }
}
</code></pre><p>è·å–éç©ºçš„æ–‡æ¡£</p><pre tabindex=0><code>GET /lib4/items/_search
{
  &#34;query&#34;: {
   &#34;bool&#34;: {
     &#34;filter&#34;: {
       &#34;exists&#34;: {
         &#34;field&#34;: &#34;price&#34;
       }
     }
   }
  }
}
</code></pre><h3 id=èšåˆæŸ¥è¯¢>èšåˆæŸ¥è¯¢<a href=#èšåˆæŸ¥è¯¢ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>GET /lib4/items/_search
{
  &#34;size&#34;:0, # åªæ˜¾ç¤ºæ€»å’Œ
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{
      &#34;sum&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}

# æœ€å¤§å€¼
GET /lib4/items/_search
{
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{
      &#34;max&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}

# æœ€å°å€¼
GET /lib4/items/_search
{
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{  # price_of_sumè¿™ä¸ªåå­—éšä¾¿èµ·çš„
      &#34;min&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}

# æ±‚å¹³å‡æ•°
GET /lib4/items/_search
{
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{
      &#34;avg&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}

# ä»·æ ¼æœ‰ä¸ç›¸åŒçš„æ•°
GET /lib4/items/_search
{
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{
      &#34;cardinality&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}

# åˆ†ç»„
GET /lib4/items/_search
{
  &#34;size&#34;: 0,
  &#34;aggs&#34;:{
    &#34;price_of_sum&#34;:{
      &#34;terms&#34;:{
        &#34;field&#34;:&#34;price&#34;
      }
    }
  }
}
</code></pre><h1 id=apié«˜çº§>APIé«˜çº§<a href=#apié«˜çº§ class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=ç‰ˆæœ¬æ§åˆ¶>ç‰ˆæœ¬æ§åˆ¶<a href=#ç‰ˆæœ¬æ§åˆ¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ElasticSearché‡‡ç”¨äº†ä¹è§‚é”æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”¨æˆ·å¯¹documentè¿›è¡Œæ“ä½œæ—¶ï¼Œå¹¶ä¸éœ€è¦å¯¹è¯¥documentä½œåŠ é”å’Œè§£é”çš„æ“ä½œï¼Œåªéœ€è¦æŒ‡å®šè¦æ“ä½œçš„ç‰ˆæœ¬å³å¯ã€‚å½“ç‰ˆæœ¬å·ä¸€è‡´æ—¶ï¼ŒElasticSearchä¼šå…è®¸è¯¥æ“ä½œé¡ºåˆ©æ‰§è¡Œï¼Œè€Œå½“ç‰ˆæœ¬å·å­˜åœ¨å†²çªæ—¶ï¼ŒElasticSearchä¼šæç¤ºå†²çªå¹¶æŠ›å‡ºå¼‚å¸¸ï¼ˆVersionConflictEngineExceptionå¼‚å¸¸ï¼‰ã€‚</p><p>ElasticSearchçš„ç‰ˆæœ¬å·çš„å–å€¼èŒƒå›´ä¸º1åˆ°2^63-1ã€‚</p><p>å†…éƒ¨ç‰ˆæœ¬æ§åˆ¶ï¼šä½¿ç”¨çš„æ˜¯_version</p><p>å¤–éƒ¨ç‰ˆæœ¬æ§åˆ¶ï¼šelasticsearchåœ¨å¤„ç†å¤–éƒ¨ç‰ˆæœ¬å·æ—¶ä¼šä¸å¯¹å†…éƒ¨ç‰ˆæœ¬å·çš„å¤„ç†æœ‰äº›ä¸åŒã€‚å®ƒä¸å†æ˜¯æ£€æŸ¥<em>versionæ˜¯å¦ä¸è¯·æ±‚ä¸­æŒ‡å®šçš„æ•°å€¼</em>ç›¸åŒ*,è€Œæ˜¯æ£€æŸ¥å½“å‰çš„*versionæ˜¯å¦æ¯”æŒ‡å®šçš„æ•°å€¼å°ã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œé‚£ä¹ˆå¤–éƒ¨çš„ç‰ˆæœ¬å·å°±ä¼šè¢«å­˜å‚¨åˆ°æ–‡æ¡£ä¸­çš„_versionä¸­ã€‚</p><p>ä¸ºäº†ä¿æŒ_versionä¸å¤–éƒ¨ç‰ˆæœ¬æ§åˆ¶çš„æ•°æ®ä¸€è‡´ä½¿ç”¨version_type=external</p><h3 id=æ•°æ®ç±»å‹>æ•°æ®ç±»å‹<a href=#æ•°æ®ç±»å‹ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>æ ¸å¿ƒæ•°æ®ç±»å‹ï¼ˆCore datatypesï¼‰</p><pre tabindex=0><code>å­—ç¬¦å‹ï¼šstringï¼Œstringç±»å‹åŒ…æ‹¬
text å’Œ keyword

textç±»å‹è¢«ç”¨æ¥ç´¢å¼•é•¿æ–‡æœ¬ï¼Œåœ¨å»ºç«‹ç´¢å¼•å‰ä¼šå°†è¿™äº›æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè½¬åŒ–ä¸ºè¯çš„ç»„åˆï¼Œå»ºç«‹ç´¢å¼•ã€‚å…è®¸esæ¥æ£€ç´¢è¿™äº›è¯è¯­ã€‚textç±»å‹ä¸èƒ½ç”¨æ¥æ’åºå’Œèšåˆã€‚

Keywordç±»å‹ä¸éœ€è¦è¿›è¡Œåˆ†è¯ï¼Œå¯ä»¥è¢«ç”¨æ¥æ£€ç´¢è¿‡æ»¤ã€æ’åºå’Œèšåˆã€‚keyword ç±»å‹å­—æ®µåªèƒ½ç”¨æœ¬èº«æ¥è¿›è¡Œæ£€ç´¢

æ•°å­—å‹ï¼šlong, integer, short, byte, double, float
æ—¥æœŸå‹ï¼šdate
å¸ƒå°”å‹ï¼šboolean
äºŒè¿›åˆ¶å‹ï¼šbinary
</code></pre><p>å¤æ‚æ•°æ®ç±»å‹ï¼ˆComplex datatypesï¼‰</p><pre tabindex=0><code>æ•°ç»„ç±»å‹ï¼ˆArray datatypeï¼‰ï¼šæ•°ç»„ç±»å‹ä¸éœ€è¦ä¸“é—¨æŒ‡å®šæ•°ç»„å…ƒç´ çš„typeï¼Œä¾‹å¦‚ï¼š
    å­—ç¬¦å‹æ•°ç»„: [ &#34;one&#34;, &#34;two&#34; ]
    æ•´å‹æ•°ç»„ï¼š[ 1, 2 ]
    æ•°ç»„å‹æ•°ç»„ï¼š[ 1, [ 2, 3 ]] ç­‰ä»·äº[ 1, 2, 3 ]
    å¯¹è±¡æ•°ç»„ï¼š[ { &#34;name&#34;: &#34;Mary&#34;, &#34;age&#34;: 12 }, { &#34;name&#34;: &#34;John&#34;, &#34;age&#34;: 10 }]
å¯¹è±¡ç±»å‹ï¼ˆObject datatypeï¼‰ï¼š_ object _ ç”¨äºå•ä¸ªJSONå¯¹è±¡ï¼›
åµŒå¥—ç±»å‹ï¼ˆNested datatypeï¼‰ï¼š_ nested _ ç”¨äºJSONæ•°ç»„ï¼›
</code></pre><p>åœ°ç†ä½ç½®ç±»å‹ï¼ˆGeo datatypesï¼‰</p><pre tabindex=0><code>åœ°ç†åæ ‡ç±»å‹ï¼ˆGeo-point datatypeï¼‰ï¼š_ geo_point _ ç”¨äºç»çº¬åº¦åæ ‡ï¼›
åœ°ç†å½¢çŠ¶ç±»å‹ï¼ˆGeo-Shape datatypeï¼‰ï¼š_ geo_shape _ ç”¨äºç±»ä¼¼äºå¤šè¾¹å½¢çš„å¤æ‚å½¢çŠ¶ï¼›
</code></pre><p>ç‰¹å®šç±»å‹ï¼ˆSpecialised datatypesï¼‰</p><pre tabindex=0><code>IPv4 ç±»å‹ï¼ˆIPv4 datatypeï¼‰ï¼š_ ip _ ç”¨äºIPv4 åœ°å€ï¼›
Completion ç±»å‹ï¼ˆCompletion datatypeï¼‰ï¼š_ completion _æä¾›è‡ªåŠ¨è¡¥å…¨å»ºè®®ï¼›
Token count ç±»å‹ï¼ˆToken count datatypeï¼‰ï¼š_ token_count _ ç”¨äºç»Ÿè®¡åšäº†æ ‡è®°çš„å­—æ®µçš„indexæ•°ç›®ï¼Œè¯¥å€¼ä¼šä¸€ç›´å¢åŠ ï¼Œä¸ä¼šå› ä¸ºè¿‡æ»¤æ¡ä»¶è€Œå‡å°‘ã€‚
mapper-murmur3
ç±»å‹ï¼šé€šè¿‡æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ _ murmur3 _ æ¥è®¡ç®— index çš„ hash å€¼ï¼›
é™„åŠ ç±»å‹ï¼ˆAttachment datatypeï¼‰ï¼šé‡‡ç”¨ mapper-attachments
æ’ä»¶ï¼Œå¯æ”¯æŒ_ attachments _ ç´¢å¼•ï¼Œä¾‹å¦‚ Microsoft Office æ ¼å¼ï¼ŒOpen Document æ ¼å¼ï¼ŒePub, HTML ç­‰ã€‚
</code></pre><p>æ”¯æŒçš„å±æ€§ï¼š</p><pre tabindex=0><code>&#34;store&#34;:false//æ˜¯å¦å•ç‹¬è®¾ç½®æ­¤å­—æ®µçš„æ˜¯å¦å­˜å‚¨è€Œä»_sourceå­—æ®µä¸­åˆ†ç¦»ï¼Œé»˜è®¤æ˜¯falseï¼Œåªèƒ½æœç´¢ï¼Œä¸èƒ½è·å–å€¼

&#34;index&#34;: true//åˆ†è¯ï¼Œä¸åˆ†è¯æ˜¯ï¼šfalseï¼Œè®¾ç½®æˆfalseï¼Œå­—æ®µå°†ä¸ä¼šè¢«ç´¢å¼•

&#34;analyzer&#34;:&#34;ik&#34;//æŒ‡å®šåˆ†è¯å™¨,é»˜è®¤åˆ†è¯å™¨ä¸ºstandard analyzer

&#34;boost&#34;:1.23//å­—æ®µçº§åˆ«çš„åˆ†æ•°åŠ æƒï¼Œé»˜è®¤å€¼æ˜¯1.0

&#34;doc_values&#34;:false//å¯¹not_analyzedå­—æ®µï¼Œé»˜è®¤éƒ½æ˜¯å¼€å¯ï¼Œåˆ†è¯å­—æ®µä¸èƒ½ä½¿ç”¨ï¼Œå¯¹æ’åºå’Œèšåˆèƒ½æå‡è¾ƒå¤§æ€§èƒ½ï¼ŒèŠ‚çº¦å†…å­˜

&#34;fielddata&#34;:{&#34;format&#34;:&#34;disabled&#34;}//é’ˆå¯¹åˆ†è¯å­—æ®µï¼Œå‚ä¸æ’åºæˆ–èšåˆæ—¶èƒ½æé«˜æ€§èƒ½ï¼Œä¸åˆ†è¯å­—æ®µç»Ÿä¸€å»ºè®®ä½¿ç”¨doc_value

&#34;fields&#34;:{&#34;raw&#34;:{&#34;type&#34;:&#34;string&#34;,&#34;index&#34;:&#34;not_analyzed&#34;}} //å¯ä»¥å¯¹ä¸€ä¸ªå­—æ®µæä¾›å¤šç§ç´¢å¼•æ¨¡å¼ï¼ŒåŒä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œä¸€ä¸ªåˆ†è¯ï¼Œä¸€ä¸ªä¸åˆ†è¯

&#34;ignore_above&#34;:100 //è¶…è¿‡100ä¸ªå­—ç¬¦çš„æ–‡æœ¬ï¼Œå°†ä¼šè¢«å¿½ç•¥ï¼Œä¸è¢«ç´¢å¼•

&#34;include_in_all&#34;:ture//è®¾ç½®æ˜¯å¦æ­¤å­—æ®µåŒ…å«åœ¨_allå­—æ®µä¸­ï¼Œé»˜è®¤æ˜¯trueï¼Œé™¤éindexè®¾ç½®æˆnoé€‰é¡¹

&#34;index_options&#34;:&#34;docs&#34;//4ä¸ªå¯é€‰å‚æ•°docsï¼ˆç´¢å¼•æ–‡æ¡£å·ï¼‰ ,freqsï¼ˆæ–‡æ¡£å·+è¯é¢‘ï¼‰ï¼Œpositionsï¼ˆæ–‡æ¡£å·+è¯é¢‘+ä½ç½®ï¼Œé€šå¸¸ç”¨æ¥è·ç¦»æŸ¥è¯¢ï¼‰ï¼Œoffsetsï¼ˆæ–‡æ¡£å·+è¯é¢‘+ä½ç½®+åç§»é‡ï¼Œé€šå¸¸è¢«ä½¿ç”¨åœ¨é«˜äº®å­—æ®µï¼‰åˆ†è¯å­—æ®µé»˜è®¤æ˜¯positionï¼Œå…¶ä»–çš„é»˜è®¤æ˜¯docs

&#34;norms&#34;:{&#34;enable&#34;:true,&#34;loading&#34;:&#34;lazy&#34;}//åˆ†è¯å­—æ®µé»˜è®¤é…ç½®ï¼Œä¸åˆ†è¯å­—æ®µï¼šé»˜è®¤{&#34;enable&#34;:false}ï¼Œå­˜å‚¨é•¿åº¦å› å­å’Œç´¢å¼•æ—¶boostï¼Œå»ºè®®å¯¹éœ€è¦å‚ä¸è¯„åˆ†å­—æ®µä½¿ç”¨ ï¼Œä¼šé¢å¤–å¢åŠ å†…å­˜æ¶ˆè€—é‡

&#34;null_value&#34;:&#34;NULL&#34;//è®¾ç½®ä¸€äº›ç¼ºå¤±å­—æ®µçš„åˆå§‹åŒ–å€¼ï¼Œåªæœ‰stringå¯ä»¥ä½¿ç”¨ï¼Œåˆ†è¯å­—æ®µçš„nullå€¼ä¹Ÿä¼šè¢«åˆ†è¯

&#34;position_increament_gap&#34;:0//å½±å“è·ç¦»æŸ¥è¯¢æˆ–è¿‘ä¼¼æŸ¥è¯¢ï¼Œå¯ä»¥è®¾ç½®åœ¨å¤šå€¼å­—æ®µçš„æ•°æ®ä¸Šç«åˆ†è¯å­—æ®µä¸Šï¼ŒæŸ¥è¯¢æ—¶å¯æŒ‡å®šslopé—´éš”ï¼Œé»˜è®¤å€¼æ˜¯100

&#34;search_analyzer&#34;:&#34;ik&#34;//è®¾ç½®æœç´¢æ—¶çš„åˆ†è¯å™¨ï¼Œé»˜è®¤è·Ÿananlyzeræ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚indexæ—¶ç”¨standard+ngramï¼Œæœç´¢æ—¶ç”¨standardç”¨æ¥å®Œæˆè‡ªåŠ¨æç¤ºåŠŸèƒ½

&#34;similarity&#34;:&#34;BM25&#34;//é»˜è®¤æ˜¯TF/IDFç®—æ³•ï¼ŒæŒ‡å®šä¸€ä¸ªå­—æ®µè¯„åˆ†ç­–ç•¥ï¼Œä»…ä»…å¯¹å­—ç¬¦ä¸²å‹å’Œåˆ†è¯ç±»å‹æœ‰æ•ˆ

&#34;term_vector&#34;:&#34;no&#34;//é»˜è®¤ä¸å­˜å‚¨å‘é‡ä¿¡æ¯ï¼Œæ”¯æŒå‚æ•°yesï¼ˆtermå­˜å‚¨ï¼‰ï¼Œwith_positionsï¼ˆterm+ä½ç½®ï¼‰,with_offsetsï¼ˆterm+åç§»é‡ï¼‰ï¼Œwith_positions_offsets(term+ä½ç½®+åç§»é‡) å¯¹å¿«é€Ÿé«˜äº®fast vector highlighterèƒ½æå‡æ€§èƒ½ï¼Œä½†å¼€å¯åˆä¼šåŠ å¤§ç´¢å¼•ä½“ç§¯ï¼Œä¸é€‚åˆå¤§æ•°æ®é‡ç”¨
</code></pre><h1 id=elasticsearchåŸç†>ElasticSearchåŸç†<a href=#elasticsearchåŸç† class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=è§£æesçš„åˆ†å¸ƒå¼æ¶æ„>è§£æesçš„åˆ†å¸ƒå¼æ¶æ„<a href=#è§£æesçš„åˆ†å¸ƒå¼æ¶æ„ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>åˆ†ç‰‡çš„å‰¯æœ¬ï¼š</p><p>é›†ç¾¤å‘ç°æœºåˆ¶(cluster discovery)ï¼šæ¯”å¦‚å½“å‰æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªesè¿›ç¨‹ï¼Œå½“å¯åŠ¨äº†ç¬¬äºŒä¸ªesè¿›ç¨‹æ—¶ï¼Œè¿™ä¸ªè¿›ç¨‹ä½œä¸ºä¸€ä¸ªnodeè‡ªåŠ¨å°±å‘ç°äº†é›†ç¾¤ï¼Œå¹¶ä¸”åŠ å…¥äº†è¿›å»</p><p>shardè´Ÿè½½å‡è¡¡ï¼šæ¯”å¦‚ç°åœ¨æœ‰10shardï¼Œé›†ç¾¤ä¸­æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œesä¼šè¿›è¡Œå‡è¡¡çš„è¿›è¡Œåˆ†é…ï¼Œä»¥ä¿æŒæ¯ä¸ªèŠ‚ç‚¹å‡è¡¡çš„è´Ÿè½½è¯·æ±‚</p><p>è¯·æ±‚è·¯ç”±</p><h3 id=æ‰©å®¹æœºåˆ¶>æ‰©å®¹æœºåˆ¶<a href=#æ‰©å®¹æœºåˆ¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å‚ç›´æ‰©å®¹ï¼šè´­ç½®æ–°çš„æœºå™¨ï¼Œæ›¿æ¢å·²æœ‰çš„æœºå™¨</p><p>ä¾‹å­:ä¸€å°æœ‰6å°æœºå™¨,æ¯å°1T,ä¸€å…±6T,ç°åœ¨æ›¿æ¢æ‰å…¶ä¸­çš„ä¸¤å°,1Tå‡çº§åˆ°2T,è¿™æ ·ä¸€å…±å°±æœ‰8T</p><p>æ°´å¹³æ‰©å®¹ï¼šç›´æ¥å¢åŠ æœºå™¨</p><h3 id=rebalance>rebalance<a href=#rebalance class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ä¼šè‡ªåŠ¨å‡è¡¡</p><h3 id=masterèŠ‚ç‚¹>masterèŠ‚ç‚¹<a href=#masterèŠ‚ç‚¹ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ä¸»èŠ‚ç‚¹çš„ä¸»è¦èŒè´£æ˜¯å’Œé›†ç¾¤æ“ä½œç›¸å…³çš„å†…å®¹ï¼Œå¦‚åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œè·Ÿè¸ªå“ªäº›èŠ‚ç‚¹æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶å†³å®šå“ªäº›åˆ†ç‰‡åˆ†é…ç»™ç›¸å…³çš„èŠ‚ç‚¹ã€‚ç¨³å®šçš„ä¸»èŠ‚ç‚¹å¯¹é›†ç¾¤çš„å¥åº·æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªé›†ç¾¤,è‡³å°‘æœ‰ä¸€ä¸ªmaster.å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½è¯·æ±‚master</p><h3 id=èŠ‚ç‚¹å¯¹ç­‰>èŠ‚ç‚¹å¯¹ç­‰<a href=#èŠ‚ç‚¹å¯¹ç­‰ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½æ¥æ”¶è¯·æ±‚æ¯ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚åéƒ½èƒ½æŠŠè¯¥è¯·æ±‚è·¯ç”±åˆ°æœ‰ç›¸å…³æ•°æ®çš„å…¶å®ƒèŠ‚ç‚¹ä¸Šæ¥æ”¶åŸå§‹è¯·æ±‚çš„èŠ‚ç‚¹è´Ÿè´£é‡‡é›†æ•°æ®å¹¶è¿”å›ç»™å®¢æˆ·ç«¯</p><h3 id=åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶>åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶<a href=#åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>indexåŒ…å«å¤šä¸ªshard</li><li>æ¯ä¸ªshardéƒ½æ˜¯ä¸€ä¸ªæœ€å°å·¥ä½œå•å…ƒï¼Œæ‰¿è½½éƒ¨åˆ†æ•°æ®ï¼›æ¯ä¸ªshardéƒ½æ˜¯ä¸€ä¸ªluceneå®ä¾‹ï¼Œæœ‰å®Œæ•´çš„å»ºç«‹ç´¢å¼•å’Œå¤„ç†è¯·æ±‚çš„èƒ½åŠ›</li><li>å¢å‡èŠ‚ç‚¹æ—¶ï¼Œshardä¼šè‡ªåŠ¨åœ¨nodesä¸­è´Ÿè½½å‡è¡¡</li><li>primary shardå’Œreplica shardï¼Œæ¯ä¸ªdocumentè‚¯å®šåªå­˜åœ¨äºæŸä¸€ä¸ªprimary shardä»¥åŠå…¶å¯¹åº”çš„replica shardä¸­ï¼Œä¸å¯èƒ½å­˜åœ¨äºå¤šä¸ªprimary shard</li><li>replica shardæ˜¯primary shardçš„å‰¯æœ¬ï¼Œè´Ÿè´£å®¹é”™ï¼Œä»¥åŠæ‰¿æ‹…è¯»è¯·æ±‚è´Ÿè½½</li><li>primary shardçš„æ•°é‡åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±å›ºå®šäº†ï¼Œreplica shardçš„æ•°é‡å¯ä»¥éšæ—¶ä¿®æ”¹</li><li>primary shardçš„é»˜è®¤æ•°é‡æ˜¯5ï¼Œreplicaé»˜è®¤æ˜¯1ï¼Œé»˜è®¤æœ‰10ä¸ªshardï¼Œ5ä¸ªprimary shardï¼Œ5ä¸ªreplica shard</li><li>primary shardä¸èƒ½å’Œè‡ªå·±çš„replica shardæ”¾åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆå¦åˆ™èŠ‚ç‚¹å®•æœºï¼Œprimary shardå’Œå‰¯æœ¬éƒ½ä¸¢å¤±ï¼Œèµ·ä¸åˆ°å®¹é”™çš„ä½œç”¨ï¼‰ï¼Œä½†æ˜¯å¯ä»¥å’Œå…¶ä»–primary shardçš„replica shardæ”¾åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li></ol><h3 id=å•èŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ>å•èŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ<a href=#å•èŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>PUT /myindex
{
   &#34;settings&#34; : {
      &#34;number_of_shards&#34; : 3,  # 3ä¸ªæœ±åˆ†ç‰‡
      &#34;number_of_replicas&#34; : 1  # 1ä¸ªè´Ÿåˆ†ç‰‡
   }
}
</code></pre><p>è¿™ä¸ªæ—¶å€™ï¼Œåªä¼šå°†3ä¸ªprimary shardåˆ†é…åˆ°ä»…æœ‰çš„ä¸€ä¸ªnodeä¸Šå»ï¼Œå¦å¤–3ä¸ªreplica shardæ˜¯æ— æ³•åˆ†é…çš„ï¼ˆä¸€ä¸ªshardçš„å‰¯æœ¬replicaï¼Œä»–ä»¬ä¸¤ä¸ªæ˜¯ä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„ï¼‰ã€‚é›†ç¾¤å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°èŠ‚ç‚¹å®•æœºï¼Œæ•°æ®å…¨éƒ¨ä¸¢å¤±ï¼Œè€Œä¸”é›†ç¾¤ä¸å¯ç”¨ï¼Œæ— æ³•æ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚</p><h3 id=ä¸¤ä¸ªèŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ>ä¸¤ä¸ªèŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ<a href=#ä¸¤ä¸ªèŠ‚ç‚¹ç¯å¢ƒä¸‹åˆ›å»ºç´¢å¼•åˆ†æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å°†3ä¸ªprimary shardåˆ†é…åˆ°ä¸€ä¸ªnodeä¸Šå»ï¼Œå¦å¤–3ä¸ªreplica shardåˆ†é…åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p><p>primary shard å’Œreplica shard ä¿æŒåŒæ­¥</p><p>primary shard å’Œreplica shard éƒ½å¯ä»¥å¤„ç†å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚</p><h3 id=æ°´å¹³æ‰©å®¹çš„è¿‡ç¨‹>æ°´å¹³æ‰©å®¹çš„è¿‡ç¨‹<a href=#æ°´å¹³æ‰©å®¹çš„è¿‡ç¨‹ class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>æ‰©å®¹åprimary shardå’Œreplica shardä¼šè‡ªåŠ¨çš„è´Ÿè½½å‡è¡¡</li><li>æ‰©å®¹åæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„shardä¼šå‡å°‘ï¼Œé‚£ä¹ˆåˆ†é…ç»™æ¯ä¸ªshardçš„CPUï¼Œå†…å­˜ï¼ŒIOèµ„æºä¼šæ›´å¤šï¼Œæ€§èƒ½æé«˜</li><li>æ‰©å®¹çš„æé™ï¼Œå¦‚æœæœ‰6ä¸ªshardï¼Œæ‰©å®¹çš„æé™å°±æ˜¯6ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸€ä¸ªshardï¼Œå¦‚æœæƒ³è¶…å‡ºæ‰©å®¹çš„æé™ï¼Œæ¯”å¦‚è¯´æ‰©å®¹åˆ°9ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥å¢åŠ replica shardçš„ä¸ªæ•°</li><li>6ä¸ªshardï¼Œ3ä¸ªèŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½æ‰¿å—å‡ ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„æœåŠ¡å™¨å®•æœºï¼Ÿ(å®¹é”™æ€§)ä»»ä½•ä¸€å°æœåŠ¡å™¨å®•æœºéƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®</li></ol><p>ä¸ºäº†æé«˜å®¹é”™æ€§ï¼Œå¢åŠ shardçš„ä¸ªæ•°ï¼š9ä¸ªshardï¼Œ(3ä¸ªprimary shardï¼Œ6ä¸ªreplicashard)ï¼Œè¿™æ ·å°±èƒ½å®¹å¿æœ€å¤šä¸¤å°æœåŠ¡å™¨å®•æœºäº†</p><p>æ€»ç»“ï¼šæ‰©å®¹æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„ååé‡ï¼ŒåŒæ—¶ä¹Ÿè¦è€ƒè™‘å®¹é”™æ€§ï¼Œä¹Ÿå°±æ˜¯è®©å°½å¯èƒ½å¤šçš„æœåŠ¡å™¨å®•æœºè¿˜èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±</p><h3 id=elasticsearchçš„å®¹é”™æœºåˆ¶>ElasticSearchçš„å®¹é”™æœºåˆ¶<a href=#elasticsearchçš„å®¹é”™æœºåˆ¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ä»¥9ä¸ªshardï¼Œ3ä¸ªèŠ‚ç‚¹ä¸ºä¾‹ï¼š</p><p>1.å¦‚æœmaster node å®•æœºï¼Œæ­¤æ—¶ä¸æ˜¯æ‰€æœ‰çš„primary shardéƒ½æ˜¯Active statusï¼Œæ‰€ä»¥æ­¤æ—¶çš„é›†ç¾¤çŠ¶æ€æ˜¯redã€‚</p><p>å®¹é”™å¤„ç†çš„ç¬¬ä¸€æ­¥:æ˜¯é€‰ä¸¾ä¸€å°æœåŠ¡å™¨ä½œä¸ºmasterå®¹é”™å¤„ç†çš„ç¬¬äºŒæ­¥:æ–°é€‰ä¸¾å‡ºçš„masterä¼šæŠŠæŒ‚æ‰çš„primary shardçš„æŸä¸ªreplica shard æå‡ä¸ºprimary shard,æ­¤æ—¶é›†ç¾¤çš„çŠ¶æ€ä¸ºyellowï¼Œå› ä¸ºå°‘äº†ä¸€ä¸ªreplica shardï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„replica shardéƒ½æ˜¯active status</p><p>å®¹é”™å¤„ç†çš„ç¬¬ä¸‰æ­¥ï¼šé‡å¯æ•…éšœæœºï¼Œæ–°masterä¼šæŠŠæ‰€æœ‰çš„å‰¯æœ¬éƒ½å¤åˆ¶ä¸€ä»½åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œï¼ˆåŒæ­¥ä¸€ä¸‹å®•æœºåå‘ç”Ÿçš„ä¿®æ”¹ï¼‰ï¼Œæ­¤æ—¶é›†ç¾¤çš„çŠ¶æ€ä¸ºgreenï¼Œå› ä¸ºæ‰€æœ‰çš„primary shardå’Œreplica shardéƒ½æ˜¯Active status</p><h3 id=æ–‡æ¡£çš„æ ¸å¿ƒå…ƒæ•°æ®>æ–‡æ¡£çš„æ ¸å¿ƒå…ƒæ•°æ®<a href=#æ–‡æ¡£çš„æ ¸å¿ƒå…ƒæ•°æ® class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li><code>_index</code>:</li></ol><p>è¯´æ˜äº†ä¸€ä¸ªæ–‡æ¡£å­˜å‚¨åœ¨å“ªä¸ªç´¢å¼•ä¸­</p><p>åŒä¸€ä¸ªç´¢å¼•ä¸‹å­˜æ”¾çš„æ˜¯ç›¸ä¼¼çš„æ–‡æ¡£(æ–‡æ¡£çš„fieldå¤šæ•°æ˜¯ç›¸åŒçš„)</p><p>ç´¢å¼•åå¿…é¡»æ˜¯å°å†™çš„ï¼Œä¸èƒ½ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸èƒ½åŒ…æ‹¬é€—å·</p><ol><li><code>_type</code>:</li></ol><p>è¡¨ç¤ºæ–‡æ¡£å±äºç´¢å¼•ä¸­çš„å“ªä¸ªç±»å‹</p><p>ä¸€ä¸ªç´¢å¼•ä¸‹åªèƒ½æœ‰ä¸€ä¸ªtype</p><p>ç±»å‹åå¯ä»¥æ˜¯å¤§å†™ä¹Ÿå¯ä»¥æ˜¯å°å†™çš„ï¼Œä¸èƒ½ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸èƒ½åŒ…æ‹¬é€—å·</p><ol><li><code>_id</code>:</li></ol><p>æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ï¼Œå’Œç´¢å¼•ï¼Œç±»å‹ç»„åˆåœ¨ä¸€èµ·å”¯ä¸€æ ‡è¯†äº†ä¸€ä¸ªæ–‡æ¡£</p><p>å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå€¼ï¼Œä¹Ÿå¯ä»¥ç”±esæ¥ç”Ÿæˆè¿™ä¸ªå€¼</p><h3 id=æ–‡æ¡£idç”Ÿæˆæ–¹å¼>æ–‡æ¡£idç”Ÿæˆæ–¹å¼<a href=#æ–‡æ¡£idç”Ÿæˆæ–¹å¼ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>1.æ‰‹åŠ¨æŒ‡å®š</p><pre tabindex=0><code>put /index/type/66
</code></pre><p>é€šå¸¸æ˜¯æŠŠå…¶å®ƒç³»ç»Ÿçš„å·²æœ‰æ•°æ®å¯¼å…¥åˆ°esæ—¶</p><p>2.ç”±esç”Ÿæˆidå€¼</p><pre tabindex=0><code>post /index/type
</code></pre><p>esç”Ÿæˆçš„idé•¿åº¦ä¸º20ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨çš„æ˜¯base64ç¼–ç ï¼ŒURLå®‰å…¨ï¼Œä½¿ç”¨çš„æ˜¯GUIDç®—æ³•ï¼Œåˆ†å¸ƒå¼ä¸‹å¹¶å‘ç”Ÿæˆidå€¼æ—¶ä¸ä¼šå†²çª</p><h3 id=_sourceå…ƒæ•°æ®åˆ†æ>_sourceå…ƒæ•°æ®åˆ†æ<a href=#_sourceå…ƒæ•°æ®åˆ†æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨æ·»åŠ æ–‡æ¡£æ—¶request bodyä¸­çš„å†…å®¹</p><p>æŒ‡å®šè¿”å›çš„ç»“æœä¸­å«æœ‰å“ªäº›å­—æ®µï¼š</p><p>get /index/type/1?_source=name</p><h3 id=æ”¹å˜æ–‡æ¡£å†…å®¹åŸç†è§£æ>æ”¹å˜æ–‡æ¡£å†…å®¹åŸç†è§£æ<a href=#æ”¹å˜æ–‡æ¡£å†…å®¹åŸç†è§£æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>æ›¿æ¢æ–¹å¼(å…¨éƒ¨æ›¿æ¢)ï¼š</p><pre tabindex=0><code>PUT /lib/user/4
{
    &#34;first_name&#34; : &#34;Jane&#34;,
    &#34;last_name&#34; :   &#34;Lucy&#34;,
    &#34;age&#34; :         24,
    &#34;about&#34; :       &#34;I like to collect rock albums&#34;,
    &#34;interests&#34;:  [ &#34;music&#34; ]
}
</code></pre><p>ä¿®æ”¹æ–¹å¼(éƒ¨åˆ†ä¿®æ”¹)ï¼š</p><pre tabindex=0><code>POST /lib/user/2/_update
{
    &#34;doc&#34;:{
       &#34;age&#34;:26
     }
}
</code></pre><p>åˆ é™¤æ–‡æ¡£:</p><pre tabindex=0><code>delete /lib
</code></pre><p>ä»¥ä¸Š3ä¸ªæ“ä½œæ–‡æ¡£çš„æ–¹å¼,éƒ½æ˜¯æŠŠå·²æœ‰çš„documentæ ‡è®°ä¸ºdeletedï¼Œéšç€æ•°æ®é‡çš„å¢åŠ ï¼Œesä¼šé€‰æ‹©åˆé€‚çš„æ—¶é—´åˆ é™¤æ‰</p><h3 id=åŸºäºgroovyè„šæœ¬æ‰§è¡Œpartial-update>åŸºäºgroovyè„šæœ¬æ‰§è¡Œpartial update<a href=#åŸºäºgroovyè„šæœ¬æ‰§è¡Œpartial-update class=hanchor arialabel=Anchor>&#8983;</a></h3><p>esæœ‰å†…ç½®çš„è„šæœ¬æ”¯æŒï¼Œå¯ä»¥åŸºäºgroovyè„šæœ¬å®ç°å¤æ‚çš„æ“ä½œ</p><pre tabindex=0><code>1.ä¿®æ”¹å¹´é¾„
POST /lib/user/4/_update
{
  &#34;script&#34;: &#34;ctx._source.age+=1&#34;
}

2.ä¿®æ”¹åå­—
POST /lib/user/4/_update
{
  &#34;script&#34;: &#34;ctx._source.last_name+=&#39;hehe&#39;&#34;
}

3.æ·»åŠ çˆ±å¥½
POST /lib/user/4/_update
{
  &#34;script&#34;: {
    &#34;source&#34;: &#34;ctx._source.interests.add(params.tag)&#34;,
    &#34;params&#34;: {
      &#34;tag&#34;:&#34;picture&#34;
    }
  }
}

4.åˆ é™¤çˆ±å¥½
POST /lib/user/4/_update
{
  &#34;script&#34;: {
    &#34;source&#34;: &#34;ctx._source.interests.remove(ctx._source.interests.indexOf(params.tag))&#34;,
    &#34;params&#34;: {
      &#34;tag&#34;:&#34;picture&#34;
    }
  }
}

5.åˆ é™¤æ–‡æ¡£
POST /lib/user/4/_update
{
  &#34;script&#34;: {
    &#34;source&#34;: &#34;ctx.op=ctx._source.age==params.count?&#39;delete&#39;:&#39;none&#39;&#34;,
    &#34;params&#34;: {
        &#34;count&#34;:29
    }
  }
}

6.upsert
POST /lib/user/4/_update
{
  &#34;script&#34;: &#34;ctx._source.age += 1&#34;,

  &#34;upsert&#34;: {
     &#34;first_name&#34; : &#34;Jane&#34;,
     &#34;last_name&#34; :   &#34;Lucy&#34;,
     &#34;age&#34; :  20,
     &#34;about&#34; :       &#34;I like to collect rock albums&#34;,
     &#34;interests&#34;:  [ &#34;music&#34; ]
  }
}
</code></pre><h3 id=partial-update-å¤„ç†å¹¶å‘å†²çª>partial update å¤„ç†å¹¶å‘å†²çª<a href=#partial-update-å¤„ç†å¹¶å‘å†²çª class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ä½¿ç”¨çš„æ˜¯ä¹è§‚é”:_version</p><p>retry_on_conflict:</p><pre tabindex=0><code>POST /lib/user/4/_update?retry_on_conflict=3
</code></pre><p>é‡æ–°è·å–æ–‡æ¡£æ•°æ®å’Œç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ›´æ–°ï¼Œä¸æ–­çš„æ“ä½œï¼Œæœ€å¤šæ“ä½œçš„æ¬¡æ•°å°±æ˜¯retry_on_conflictçš„å€¼</p><h3 id=æ–‡æ¡£æ•°æ®è·¯ç”±åŸç†è§£æ>æ–‡æ¡£æ•°æ®è·¯ç”±åŸç†è§£æ<a href=#æ–‡æ¡£æ•°æ®è·¯ç”±åŸç†è§£æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>1.æ–‡æ¡£è·¯ç”±åˆ°åˆ†ç‰‡ä¸Šï¼š</p><p>ä¸€ä¸ªç´¢å¼•ç”±å¤šä¸ªåˆ†ç‰‡æ„æˆï¼Œå½“æ·»åŠ (åˆ é™¤ï¼Œä¿®æ”¹)ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œeså°±éœ€è¦å†³å®šè¿™ä¸ªæ–‡æ¡£å­˜å‚¨åœ¨å“ªä¸ªåˆ†ç‰‡ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæ•°æ®è·¯ç”±(routing)</p><p>2.è·¯ç”±ç®—æ³•ï¼š</p><pre tabindex=0><code> shard=hash(routing) % number_of_pirmary_shards
</code></pre><p>ç¤ºä¾‹ï¼šä¸€ä¸ªç´¢å¼•ï¼Œ3ä¸ªprimary shard</p><p>(1)æ¯æ¬¡å¢åˆ æ”¹æŸ¥æ—¶ï¼Œéƒ½æœ‰ä¸€ä¸ªroutingå€¼ï¼Œé»˜è®¤æ˜¯æ–‡æ¡£çš„_idçš„å€¼</p><p>(2)å¯¹è¿™ä¸ªroutingå€¼ä½¿ç”¨å“ˆå¸Œå‡½æ•°è¿›è¡Œè®¡ç®—</p><p>(3)è®¡ç®—å‡ºçš„å€¼å†å’Œä¸»åˆ†ç‰‡ä¸ªæ•°å–ä½™æ•°</p><p>ä½™æ•°è‚¯å®šåœ¨0&mdash;ï¼ˆnumber_of_pirmary_shards-1ï¼‰ä¹‹é—´ï¼Œæ–‡æ¡£å°±åœ¨å¯¹åº”çš„shardä¸Š</p><p>routingå€¼é»˜è®¤æ˜¯æ–‡æ¡£çš„_idçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªå€¼ï¼Œæ‰‹åŠ¨æŒ‡å®šå¯¹äºè´Ÿè½½å‡è¡¡ä»¥åŠæé«˜æ‰¹é‡è¯»å–çš„æ€§èƒ½éƒ½æœ‰å¸®åŠ©</p><p>3.primary shardä¸ªæ•°ä¸€æ—¦ç¡®å®šå°±ä¸èƒ½ä¿®æ”¹äº†</p><h3 id=æ–‡æ¡£å¢åˆ æ”¹å†…éƒ¨åŸç†>æ–‡æ¡£å¢åˆ æ”¹å†…éƒ¨åŸç†<a href=#æ–‡æ¡£å¢åˆ æ”¹å†…éƒ¨åŸç† class=hanchor arialabel=Anchor>&#8983;</a></h3><p>1:å‘é€å¢åˆ æ”¹è¯·æ±‚æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æˆäº†åè°ƒèŠ‚ç‚¹(coordinating node)</p><p>2.åè°ƒèŠ‚ç‚¹ä½¿ç”¨è·¯ç”±ç®—æ³•è¿›è¡Œè·¯ç”±ï¼Œç„¶åå°†è¯·æ±‚è½¬åˆ°primary shardæ‰€åœ¨èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å¤„ç†è¯·æ±‚ï¼Œå¹¶æŠŠæ•°æ®åŒæ­¥åˆ°å®ƒçš„replica shard</p><p>3.åè°ƒèŠ‚ç‚¹å¯¹å®¢æˆ·ç«¯åšå‡ºå“åº”</p><h3 id=å†™ä¸€è‡´æ€§åŸç†å’Œquorumæœºåˆ¶>å†™ä¸€è‡´æ€§åŸç†å’Œquorumæœºåˆ¶<a href=#å†™ä¸€è‡´æ€§åŸç†å’Œquorumæœºåˆ¶ class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>ä»»ä½•ä¸€ä¸ªå¢åˆ æ”¹æ“ä½œéƒ½å¯ä»¥è·Ÿä¸Šä¸€ä¸ªå‚æ•°:``consistency`</li></ol><p>å¯ä»¥ç»™è¯¥å‚æ•°æŒ‡å®šçš„å€¼ï¼š</p><pre tabindex=0><code>one: (primary shard)åªè¦æœ‰ä¸€ä¸ªprimary shardæ˜¯æ´»è·ƒçš„å°±å¯ä»¥æ‰§è¡Œ

all: (all shard)æ‰€æœ‰çš„primary shardå’Œreplica shardéƒ½æ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œ

quorum: (default) é»˜è®¤å€¼ï¼Œå¤§éƒ¨åˆ†shardæ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œ ï¼ˆä¾‹å¦‚å…±æœ‰6ä¸ªshardï¼Œè‡³å°‘æœ‰3ä¸ªshardæ˜¯æ´»è·ƒçš„æ‰èƒ½æ‰§è¡Œå†™æ“ä½œï¼‰
</code></pre><ol><li>quorumæœºåˆ¶ï¼šå¤šæ•°shardéƒ½æ˜¯å¯ç”¨çš„ï¼Œ</li></ol><p>int((primary+number_of_replica)/2)+1</p><p>ä¾‹å¦‚ï¼š3ä¸ªprimary shardï¼Œ1ä¸ªreplica</p><p>int((3+1)/2)+1=3</p><p>è‡³å°‘3ä¸ªshardæ˜¯æ´»è·ƒçš„</p><p>æ³¨æ„ï¼šå¯èƒ½å‡ºç°shardä¸èƒ½åˆ†é…é½å…¨çš„æƒ…å†µ</p><p>æ¯”å¦‚ï¼š1ä¸ªprimary shard,1ä¸ªreplicaint((1+1)/2)+1=2ä½†æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºprimary shardå’Œreplica shardä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥ä»ç„¶ä¸èƒ½æ‰§è¡Œå†™æ“ä½œ</p><p>å†ä¸¾ä¾‹ï¼š1ä¸ªprimary shard,3ä¸ªreplica,2ä¸ªèŠ‚ç‚¹</p><p>int((1+3)/2)+1=3</p><p>æœ€å:å½“æ´»è·ƒçš„shardçš„ä¸ªæ•°æ²¡æœ‰è¾¾åˆ°è¦æ±‚æ—¶ï¼Œesé»˜è®¤ä¼šç­‰å¾…ä¸€åˆ†é’Ÿï¼Œå¦‚æœåœ¨ç­‰å¾…çš„æœŸé—´æ´»è·ƒçš„shardçš„ä¸ªæ•°æ²¡æœ‰å¢åŠ ï¼Œåˆ™æ˜¾ç¤ºtimeout</p><p>put /index/type/id?timeout=60s</p><h3 id=æ–‡æ¡£æŸ¥è¯¢å†…éƒ¨åŸç†>æ–‡æ¡£æŸ¥è¯¢å†…éƒ¨åŸç†<a href=#æ–‡æ¡£æŸ¥è¯¢å†…éƒ¨åŸç† class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢è¯·æ±‚å‘ç»™ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æˆäº†coordinating nodeï¼Œè¯¥èŠ‚ç‚¹ä½¿ç”¨è·¯ç”±ç®—æ³•ç®—å‡ºæ–‡æ¡£æ‰€åœ¨çš„primary shard</p><p>ç¬¬äºŒæ­¥ï¼šåè°ƒèŠ‚ç‚¹æŠŠè¯·æ±‚è½¬å‘ç»™primary shardä¹Ÿå¯ä»¥è½¬å‘ç»™replica shard(ä½¿ç”¨è½®è¯¢è°ƒåº¦ç®—æ³•(Round-Robin Schedulingï¼ŒæŠŠè¯·æ±‚å¹³å‡åˆ†é…è‡³primary shard å’Œreplica shard)</p><p>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†è¯·æ±‚çš„èŠ‚ç‚¹æŠŠç»“æœè¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹å†è¿”å›ç»™åº”ç”¨ç¨‹åº</p><p>ç‰¹æ®Šæƒ…å†µï¼šè¯·æ±‚çš„æ–‡æ¡£è¿˜åœ¨å»ºç«‹ç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼Œprimary shardä¸Šå­˜åœ¨ï¼Œä½†replica sharä¸Šä¸å­˜åœ¨ï¼Œä½†æ˜¯è¯·æ±‚è¢«è½¬å‘åˆ°äº†replica shardä¸Šï¼Œè¿™æ—¶å°±ä¼šæç¤ºæ‰¾ä¸åˆ°æ–‡æ¡£</p><h3 id=bulkæ‰¹é‡æ“ä½œçš„jsonæ ¼å¼è§£æ>bulkæ‰¹é‡æ“ä½œçš„jsonæ ¼å¼è§£æ<a href=#bulkæ‰¹é‡æ“ä½œçš„jsonæ ¼å¼è§£æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>bulkçš„æ ¼å¼ï¼š</p><pre tabindex=0><code>{action:{metadata}}\n
{requstbody}\n
</code></pre><p>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ï¼š</p><pre tabindex=0><code>[{
    &#34;action&#34;: {
    },
    &#34;data&#34;: {
    }
}]
</code></pre><p>è¿™ç§æ–¹å¼å¯è¯»æ€§å¥½ï¼Œä½†æ˜¯å†…éƒ¨å¤„ç†å°±éº»çƒ¦äº†ï¼š</p><p>1.å°†jsonæ•°ç»„è§£æä¸ºJSONArrayå¯¹è±¡ï¼Œåœ¨å†…å­˜ä¸­å°±éœ€è¦æœ‰ä¸€ä»½jsonæ–‡æœ¬çš„æ‹·è´ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªJSONArrayå¯¹è±¡ã€‚</p><p>2.è§£æjsonæ•°ç»„é‡Œçš„æ¯ä¸ªjsonï¼Œå¯¹æ¯ä¸ªè¯·æ±‚ä¸­çš„documentè¿›è¡Œè·¯ç”±</p><p>3.ä¸ºè·¯ç”±åˆ°åŒä¸€ä¸ªshardä¸Šçš„å¤šä¸ªè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªè¯·æ±‚æ•°ç»„</p><p>4.å°†è¿™ä¸ªè¯·æ±‚æ•°ç»„åºåˆ—åŒ–</p><p>5.å°†åºåˆ—åŒ–åçš„è¯·æ±‚æ•°ç»„å‘é€åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šå»</p><p>è€—è´¹æ›´å¤šå†…å­˜ï¼Œå¢åŠ javaè™šæ‹Ÿæœºå¼€é”€</p><p>1.ä¸ç”¨å°†å…¶è½¬æ¢ä¸ºjsonå¯¹è±¡ï¼Œç›´æ¥æŒ‰ç…§æ¢è¡Œç¬¦åˆ‡å‰²jsonï¼Œå†…å­˜ä¸­ä¸éœ€è¦jsonæ–‡æœ¬çš„æ‹·è´</p><p>2.å¯¹æ¯ä¸¤ä¸ªä¸€ç»„çš„jsonï¼Œè¯»å–metaï¼Œè¿›è¡Œdocumentè·¯ç”±</p><p>3.ç›´æ¥å°†å¯¹åº”çš„jsonå‘é€åˆ°nodeä¸Šå»</p><h3 id=æŸ¥è¯¢ç»“æœåˆ†æ>æŸ¥è¯¢ç»“æœåˆ†æ<a href=#æŸ¥è¯¢ç»“æœåˆ†æ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>{
  # æŸ¥è¯¢è€—è´¹çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
  &#34;took&#34;: 419,
  # è¶…æ—¶æ—¶é—´
  &#34;timed_out&#34;: false,
  # å…±è¯·æ±‚äº†å¤šå°‘ä¸ªshard
  &#34;_shards&#34;: {
  	# æŸ¥è¯¢å‡ºçš„æ–‡æ¡£æ€»ä¸ªæ•°
    &#34;total&#34;: 3,
    &#34;successful&#34;: 3,
    &#34;skipped&#34;: 0,
    &#34;failed&#34;: 0
  },
  &#34;hits&#34;: {
    &#34;total&#34;: 3,
    # æœ¬æ¬¡æŸ¥è¯¢ä¸­ï¼Œç›¸å…³åº¦åˆ†æ•°çš„æœ€å¤§å€¼ï¼Œæ–‡æ¡£å’Œæ­¤æ¬¡æŸ¥è¯¢çš„åŒ¹é…åº¦è¶Šé«˜ï¼Œ_scoreçš„å€¼è¶Šå¤§ï¼Œæ’ä½è¶Šé å‰
    &#34;max_score&#34;: 0.6931472,
    # é»˜è®¤æŸ¥è¯¢å‰10ä¸ªæ–‡æ¡£
    &#34;hits&#34;: [
      {
        &#34;_index&#34;: &#34;lib3&#34;,
        &#34;_type&#34;: &#34;user&#34;,
        &#34;_id&#34;: &#34;3&#34;,
        &#34;_score&#34;: 0.6931472,
        &#34;_source&#34;: {
          &#34;address&#34;: &#34;bei jing hai dian qu qing he zhen&#34;,
          &#34;name&#34;: &#34;lisi&#34;
        }
      },
      {
        &#34;_index&#34;: &#34;lib3&#34;,
        &#34;_type&#34;: &#34;user&#34;,
        &#34;_id&#34;: &#34;2&#34;,
        &#34;_score&#34;: 0.47000363,
        &#34;_source&#34;: {
          &#34;address&#34;: &#34;bei jing hai dian qu qing he zhen&#34;,
          &#34;name&#34;: &#34;zhaoming&#34;
        }
      }
</code></pre><pre tabindex=0><code># è®¾ç½®è¶…æ—¶æ—¶é—´
GET /lib3/user/_search?timeout=10ms
{
    &#34;_source&#34;: [&#34;address&#34;,&#34;name&#34;],
    &#34;query&#34;: {
        &#34;match&#34;: {
            &#34;interests&#34;: &#34;changge&#34;
        }
    }
}
</code></pre><h3 id=åˆ†é¡µæŸ¥è¯¢ä¸­çš„deep-pagingé—®é¢˜>åˆ†é¡µæŸ¥è¯¢ä¸­çš„deep pagingé—®é¢˜<a href=#åˆ†é¡µæŸ¥è¯¢ä¸­çš„deep-pagingé—®é¢˜ class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>GET /lib3/user/_search
{
    &#34;from&#34;:0,
    &#34;size&#34;:2,
    &#34;query&#34;:{
        &#34;terms&#34;:{
            &#34;interests&#34;: [&#34;hejiu&#34;,&#34;changge&#34;]
        }
    }
}

GET /_search?from=0&amp;size=3
</code></pre><p>deep paging:æŸ¥è¯¢çš„å¾ˆæ·±ï¼Œæ¯”å¦‚ä¸€ä¸ªç´¢å¼•æœ‰ä¸‰ä¸ªprimary shardï¼Œåˆ†åˆ«å­˜å‚¨äº†6000æ¡æ•°æ®ï¼Œæˆ‘ä»¬è¦å¾—åˆ°ç¬¬100é¡µçš„æ•°æ®(æ¯é¡µ10æ¡)ï¼Œç±»ä¼¼è¿™ç§æƒ…å†µå°±å«deep paging</p><p>å¦‚ä½•å¾—åˆ°ç¬¬100é¡µçš„10æ¡æ•°æ®ï¼Ÿ</p><p>åœ¨æ¯ä¸ªshardä¸­æœç´¢990åˆ°999è¿™10æ¡æ•°æ®ï¼Œç„¶åç”¨è¿™30æ¡æ•°æ®æ’åºï¼Œæ’åºä¹‹åå–10æ¡æ•°æ®å°±æ˜¯è¦æœç´¢çš„æ•°æ®ï¼Œè¿™ç§åšæ³•æ˜¯é”™çš„ï¼Œå› ä¸º3ä¸ªshardä¸­çš„æ•°æ®çš„<em>scoreåˆ†æ•°ä¸ä¸€æ ·ï¼Œå¯èƒ½è¿™æŸä¸€ä¸ªshardä¸­ç¬¬ä¸€æ¡æ•°æ®çš„</em>scoreåˆ†æ•°æ¯”å¦ä¸€ä¸ªshardä¸­ç¬¬1000æ¡éƒ½è¦é«˜ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªshardä¸­æœç´¢990åˆ°999è¿™10æ¡æ•°æ®ç„¶åæ’åºçš„åšæ³•æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>æ­£ç¡®çš„åšæ³•æ˜¯æ¯ä¸ªshardæŠŠ0åˆ°999æ¡æ•°æ®å…¨éƒ¨æœç´¢å‡ºæ¥ï¼ˆæŒ‰æ’åºé¡ºåºï¼‰ï¼Œç„¶åå…¨éƒ¨è¿”å›ç»™coordinate nodeï¼Œç”±coordinate nodeæŒ‰_scoreåˆ†æ•°æ’åºåï¼Œå–å‡ºç¬¬100é¡µçš„10æ¡æ•°æ®ï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>deep pagingæ€§èƒ½é—®é¢˜</p><p>1.è€—è´¹ç½‘ç»œå¸¦å®½ï¼Œå› ä¸ºæœç´¢è¿‡æ·±çš„è¯ï¼Œå„shardè¦æŠŠæ•°æ®ä¼ é€ç»™coordinate nodeï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æœ‰å¤§é‡æ•°æ®ä¼ é€’çš„ï¼Œæ¶ˆè€—ç½‘ç»œï¼Œ</p><p>2.æ¶ˆè€—å†…å­˜ï¼Œå„shardè¦æŠŠæ•°æ®ä¼ é€ç»™coordinate nodeï¼Œè¿™ä¸ªä¼ é€’å›æ¥çš„æ•°æ®ï¼Œæ˜¯è¢«coordinate nodeä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™æ ·ä¼šå¤§é‡æ¶ˆè€—å†…å­˜ã€‚</p><p>3.æ¶ˆè€—cpu coordinate nodeè¦æŠŠä¼ å›æ¥çš„æ•°æ®è¿›è¡Œæ’åºï¼Œè¿™ä¸ªæ’åºè¿‡ç¨‹å¾ˆæ¶ˆè€—cpu.</p><p>é‰´äºdeep pagingçš„æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥åº”å°½é‡å‡å°‘ä½¿ç”¨ã€‚</p><h3 id=query-stringæŸ¥è¯¢åŠcopy_toè§£æ>query stringæŸ¥è¯¢åŠcopy_toè§£æ<a href=#query-stringæŸ¥è¯¢åŠcopy_toè§£æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>GET /lib3/user/_search?q=interests:changge</p><p>GET /lib3/user/_search?q=+interests:changge</p><p>GET /lib3/user/_search?q=-interests:changge</p><p>copy_toå­—æ®µæ˜¯æŠŠå…¶å®ƒå­—æ®µä¸­çš„å€¼ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ç»„æˆä¸€ä¸ªå¤§å­—ç¬¦ä¸²ï¼Œç„¶åè¢«åˆ†æå’Œç´¢å¼•ï¼Œä½†æ˜¯ä¸å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½è¢«æŸ¥è¯¢ï¼Œä½†ä¸èƒ½è¢«å–å›æ˜¾ç¤ºã€‚</p><p>æ³¨æ„:copy_toæŒ‡å‘çš„å­—æ®µå­—æ®µç±»å‹è¦ä¸ºï¼štext</p><p>å½“æ²¡æœ‰æŒ‡å®šfieldæ—¶ï¼Œå°±ä¼šä»copy_toå­—æ®µä¸­æŸ¥è¯¢GET /lib3/user/_search?q=changge</p><h3 id=å­—ç¬¦ä¸²æ’åºé—®é¢˜>å­—ç¬¦ä¸²æ’åºé—®é¢˜<a href=#å­—ç¬¦ä¸²æ’åºé—®é¢˜ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µè¿›è¡Œæ’åºé€šå¸¸ä¸å‡†ç¡®ï¼Œå› ä¸ºå·²ç»è¢«åˆ†è¯æˆå¤šä¸ªè¯æ¡äº†</p><p>è§£å†³æ–¹å¼ï¼šå¯¹å­—æ®µç´¢å¼•ä¸¤æ¬¡ï¼Œä¸€æ¬¡ç´¢å¼•åˆ†è¯ï¼ˆç”¨äºæœç´¢ï¼‰ï¼Œä¸€æ¬¡ç´¢å¼•ä¸åˆ†è¯(ç”¨äºæ’åº)</p><pre tabindex=0><code># è®¾ç½®mapping
PUT /lib3
{
    &#34;settings&#34;:{
        &#34;number_of_shards&#34; : 3,
        &#34;number_of_replicas&#34; : 0
      },
     &#34;mappings&#34;:{
      &#34;user&#34;:{
        &#34;properties&#34;:{
            &#34;name&#34;: {&#34;type&#34;:&#34;text&#34;},
            &#34;address&#34;: {&#34;type&#34;:&#34;text&#34;},
            &#34;age&#34;: {&#34;type&#34;:&#34;integer&#34;},
            &#34;birthday&#34;: {&#34;type&#34;:&#34;date&#34;},
            &#34;interests&#34;: {
                &#34;type&#34;:&#34;text&#34;,
                # é‡ç‚¹æ˜¯åœ¨è¿™ä¸‹é¢
                &#34;fields&#34;: {
                  &#34;raw&#34;:{
                     &#34;type&#34;: &#34;keyword&#34;
                   }
                },
                &#34;fielddata&#34;: true
             }
          }
        }
     }
}

GET /lib3/user/_search
{
  &#34;query&#34;: {
    &#34;match_all&#34;: {}
  },
  &#34;sort&#34;: [
    {
      &#34;interests&#34;: {
        &#34;order&#34;: &#34;desc&#34;
      }
    }
  ]
}

GET /lib3/user/_search
{
  &#34;query&#34;: {
    &#34;match_all&#34;: {}
  },
  &#34;sort&#34;: [
    {
      &#34;interests.raw&#34;: {
        &#34;order&#34;: &#34;asc&#34;
      }
    }
  ]
}
</code></pre><h3 id=å¦‚ä½•è®¡ç®—ç›¸å…³åº¦åˆ†æ•°>å¦‚ä½•è®¡ç®—ç›¸å…³åº¦åˆ†æ•°<a href=#å¦‚ä½•è®¡ç®—ç›¸å…³åº¦åˆ†æ•° class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ä½¿ç”¨çš„æ˜¯TF/IDFç®—æ³•(Term Frequency&amp;Inverse Document Frequency)</p><p>1.Term Frequency:æˆ‘ä»¬æŸ¥è¯¢çš„æ–‡æœ¬ä¸­çš„è¯æ¡åœ¨documentæœ¬ä¸­å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œå‡ºç°æ¬¡æ•°è¶Šå¤šï¼Œç›¸å…³åº¦è¶Šé«˜</p><p>æœç´¢å†…å®¹ï¼š hello world</p><p>Helloï¼ŒI love china.</p><p>Hello world,how are you!</p><p>2.Inverse Document Frequencyï¼šæˆ‘ä»¬æŸ¥è¯¢çš„æ–‡æœ¬ä¸­çš„è¯æ¡åœ¨ç´¢å¼•çš„æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œå‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œç›¸å…³åº¦è¶Šä½</p><p>æœç´¢å†…å®¹ï¼šhello world</p><p>helloï¼Œwhat are you doing?</p><p>I like the world.</p><p>hello åœ¨ç´¢å¼•çš„æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°äº†500æ¬¡ï¼Œworldå‡ºç°äº†100æ¬¡</p><p>3.Field-length(å­—æ®µé•¿åº¦å½’çº¦) norm:fieldè¶Šé•¿ï¼Œç›¸å…³åº¦è¶Šä½</p><p>æœç´¢å†…å®¹ï¼šhello world</p><p>{&ldquo;title&rdquo;:&ldquo;hello,what&rsquo;s your name?&rdquo;,&ldquo;content&rdquo;:{&ldquo;owieurowieuolsdjflk&rdquo;}}</p><p>{&ldquo;title&rdquo;:&ldquo;hi,good morning&rdquo;,&ldquo;content&rdquo;:{&ldquo;lkjkljkj&mldr;&mldr;.world&rdquo;}}</p><p>æŸ¥çœ‹åˆ†æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼š</p><p>GET /lib3/user/_search?explain=true{&ldquo;query&rdquo;:{&ldquo;match&rdquo;:{&ldquo;interests&rdquo;: &ldquo;duanlian,changge&rdquo;}}}</p><p>æŸ¥çœ‹ä¸€ä¸ªæ–‡æ¡£èƒ½å¦åŒ¹é…ä¸ŠæŸä¸ªæŸ¥è¯¢ï¼š</p><p>GET /lib3/user/2/_explain{&ldquo;query&rdquo;:{&ldquo;match&rdquo;:{&ldquo;interests&rdquo;: &ldquo;duanlian,changge&rdquo;}}}</p><h3 id=doc-values-è§£æ>Doc Values è§£æ<a href=#doc-values-è§£æ class=hanchor arialabel=Anchor>&#8983;</a></h3><p>DocValueså…¶å®æ˜¯Luceneåœ¨æ„å»ºå€’æ’ç´¢å¼•æ—¶ï¼Œä¼šé¢å¤–å»ºç«‹ä¸€ä¸ªæœ‰åºçš„æ­£æ’ç´¢å¼•(åŸºäºdocument => field valueçš„æ˜ å°„åˆ—è¡¨),å­—ç¬¦ä¸²ä¸ä¼šåˆ›å»ºæ­£æ’ç´¢å¼•</p><pre tabindex=0><code>{&#34;birthday&#34;:&#34;1985-11-11&#34;,age:23}

{&#34;birthday&#34;:&#34;1989-11-11&#34;,age:29}

document     age       birthday
doc1         23         1985-11-11
doc2         29         1989-11-11
</code></pre><p>å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒèŠ‚çœå†…å­˜</p><p>å¯¹æ’åºï¼Œåˆ†ç»„å’Œä¸€äº›èšåˆæ“ä½œèƒ½å¤Ÿå¤§å¤§æå‡æ€§èƒ½</p><p>æ³¨æ„ï¼šé»˜è®¤å¯¹ä¸åˆ†è¯çš„å­—æ®µæ˜¯å¼€å¯çš„ï¼Œå¯¹åˆ†è¯å­—æ®µæ— æ•ˆï¼ˆéœ€è¦æŠŠfielddataè®¾ç½®ä¸ºtrueï¼‰</p><pre tabindex=0><code>PUT /lib3
{
    &#34;settings&#34;:{
    &#34;number_of_shards&#34; : 3,
    &#34;number_of_replicas&#34; : 0
    },
     &#34;mappings&#34;:{
      &#34;user&#34;:{
        &#34;properties&#34;:{
            &#34;name&#34;: {&#34;type&#34;:&#34;text&#34;},
            &#34;address&#34;: {&#34;type&#34;:&#34;text&#34;},
            &#34;age&#34;: {
              &#34;type&#34;:&#34;integer&#34;,
              &#34;doc_values&#34;:false
            },
            &#34;interests&#34;: {&#34;type&#34;:&#34;text&#34;},
            &#34;birthday&#34;: {&#34;type&#34;:&#34;date&#34;}
        }
      }
     }
}
</code></pre><h3 id=åŸºäºscrollæŠ€æœ¯æ»šåŠ¨æœç´¢å¤§é‡æ•°æ®>åŸºäºscrollæŠ€æœ¯æ»šåŠ¨æœç´¢å¤§é‡æ•°æ®<a href=#åŸºäºscrollæŠ€æœ¯æ»šåŠ¨æœç´¢å¤§é‡æ•°æ® class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å¦‚æœä¸€æ¬¡æ€§è¦æŸ¥å‡ºæ¥æ¯”å¦‚10ä¸‡æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šå¾ˆå·®ï¼Œæ­¤æ—¶ä¸€èˆ¬ä¼šé‡‡å–ç”¨scollæ»šåŠ¨æŸ¥è¯¢ï¼Œä¸€æ‰¹ä¸€æ‰¹çš„æŸ¥ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½æŸ¥è¯¢å®Œä¸ºæ­¢ã€‚</p><p>1.scollæœç´¢ä¼šåœ¨ç¬¬ä¸€æ¬¡æœç´¢çš„æ—¶å€™ï¼Œä¿å­˜ä¸€ä¸ªå½“æ—¶çš„è§†å›¾å¿«ç…§ï¼Œä¹‹ååªä¼šåŸºäºè¯¥æ—§çš„è§†å›¾å¿«ç…§æä¾›æ•°æ®æœç´¢ï¼Œå¦‚æœè¿™ä¸ªæœŸé—´æ•°æ®å˜æ›´ï¼Œæ˜¯ä¸ä¼šè®©ç”¨æˆ·çœ‹åˆ°çš„</p><p>2.é‡‡ç”¨åŸºäº<em>doc(ä¸ä½¿ç”¨</em>score)è¿›è¡Œæ’åºçš„æ–¹å¼ï¼Œæ€§èƒ½è¾ƒé«˜</p><p>3.æ¯æ¬¡å‘é€scrollè¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªscollå‚æ•°ï¼ŒæŒ‡å®šä¸€ä¸ªæ—¶é—´çª—å£ï¼Œæ¯æ¬¡æœç´¢è¯·æ±‚åªè¦åœ¨è¿™ä¸ªæ—¶é—´çª—å£å†…èƒ½å®Œæˆå°±å¯ä»¥äº†</p><pre tabindex=0><code>GET /lib3/user/_search?scroll=1m
{
  &#34;query&#34;: {
    &#34;match_all&#34;: {}
  },
  &#34;sort&#34;:[&#34;_doc&#34;],
  # ä¸€æ‰¹æŸ¥å¤šå°‘ä¸ª
  &#34;size&#34;:3
}

GET /_search/scroll
{
   &#34;scroll&#34;: &#34;1m&#34;,
   # è¿™ä¸ªæ˜¯ä¸Šé¢é‚£ä¸ªæŸ¥è¯¢é‡Œè·å–åˆ°çš„
   &#34;scroll_id&#34;: &#34;DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAAAdFkEwRENOVTdnUUJPWVZUd1p2WE5hV2cAAAAAAAAAHhZBMERDTlU3Z1FCT1lWVHdadlhOYVdnAAAAAAAAAB8WQTBEQ05VN2dRQk9ZVlR3WnZYTmFXZw==&#34;
}
</code></pre><h3 id=dynamic-mappingç­–ç•¥>dynamic mappingç­–ç•¥<a href=#dynamic-mappingç­–ç•¥ class=hanchor arialabel=Anchor>&#8983;</a></h3><p><strong>dynamic</strong>:</p><p>1.true:é‡åˆ°é™Œç”Ÿå­—æ®µå°± dynamic mapping</p><p>2.false:é‡åˆ°é™Œç”Ÿå­—æ®µå°±å¿½ç•¥</p><p>3.strict:çº¦åˆ°é™Œç”Ÿå­—æ®µå°±æŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>PUT</span> <span style=color:#960050;background-color:#1e0010>/lib</span><span style=color:#ae81ff>8</span>{<span style=color:#f92672>&#34;settings&#34;</span>:{<span style=color:#f92672>&#34;number_of_shards&#34;</span> : <span style=color:#ae81ff>3</span>,<span style=color:#f92672>&#34;number_of_replicas&#34;</span> : <span style=color:#ae81ff>0</span>},<span style=color:#f92672>&#34;mappings&#34;</span>:{<span style=color:#f92672>&#34;user&#34;</span>:{<span style=color:#f92672>&#34;dynamic&#34;</span>:<span style=color:#960050;background-color:#1e0010>strict</span>,<span style=color:#f92672>&#34;properties&#34;</span>:{<span style=color:#f92672>&#34;name&#34;</span>: {<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;text&#34;</span>},<span style=color:#f92672>&#34;address&#34;</span>:{<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#f92672>&#34;dynamic&#34;</span>:<span style=color:#66d9ef>true</span>},}}}}
</span></span></code></pre></div><p>ä¼šæŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>PUT</span>  <span style=color:#960050;background-color:#1e0010>/lib</span><span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>/user/</span><span style=color:#ae81ff>1</span>{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;lisi&#34;</span>,<span style=color:#f92672>&#34;age&#34;</span>:<span style=color:#ae81ff>20</span>,<span style=color:#f92672>&#34;address&#34;</span>:{<span style=color:#f92672>&#34;province&#34;</span>:<span style=color:#e6db74>&#34;beijing&#34;</span>,<span style=color:#f92672>&#34;city&#34;</span>:<span style=color:#e6db74>&#34;beijing&#34;</span>}}
</span></span></code></pre></div><p><strong>date_detection</strong>:é»˜è®¤ä¼šæŒ‰ç…§ä¸€å®šæ ¼å¼è¯†åˆ«dateï¼Œæ¯”å¦‚yyyy-MM-dd</p><p>å¯ä»¥æ‰‹åŠ¨å…³é—­æŸä¸ªtypeçš„date_detection</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>PUT</span> <span style=color:#960050;background-color:#1e0010>/lib</span><span style=color:#ae81ff>8</span>{<span style=color:#f92672>&#34;settings&#34;</span>:{<span style=color:#f92672>&#34;number_of_shards&#34;</span> : <span style=color:#ae81ff>3</span>,<span style=color:#f92672>&#34;number_of_replicas&#34;</span> : <span style=color:#ae81ff>0</span>},<span style=color:#f92672>&#34;mappings&#34;</span>:{<span style=color:#f92672>&#34;user&#34;</span>:{<span style=color:#f92672>&#34;date_detection&#34;</span>: <span style=color:#66d9ef>false</span>,}}}
</span></span></code></pre></div><p><strong>å®šåˆ¶ dynamic mapping template(type)</strong></p><p>PUT /my_index{&ldquo;mappings&rdquo;: {&ldquo;my_type&rdquo;: {&ldquo;dynamic_templates&rdquo;: [{&ldquo;en&rdquo;: {&ldquo;match&rdquo;: &ldquo;*_en&rdquo;,&ldquo;match_mapping_type&rdquo;: &ldquo;string&rdquo;,&ldquo;mapping&rdquo;: {&ldquo;type&rdquo;: &ldquo;text&rdquo;,&ldquo;analyzer&rdquo;: &ldquo;english&rdquo;}}}]}}}#ä½¿ç”¨äº†æ¨¡æ¿</p><p>PUT /my_index/my_type/3{&ldquo;title_en&rdquo;: &ldquo;this is my dog&rdquo;</p><p>}#æ²¡æœ‰ä½¿ç”¨æ¨¡æ¿</p><p>PUT /my_index/my_type/5{&ldquo;title&rdquo;: &ldquo;this is my cat&rdquo;}</p><p>GET my_index/my_type/_search{&ldquo;query&rdquo;: {&ldquo;match&rdquo;: {&ldquo;title&rdquo;: &ldquo;is&rdquo;}}}</p><h3 id=é‡å»ºç´¢å¼•>é‡å»ºç´¢å¼•<a href=#é‡å»ºç´¢å¼• class=hanchor arialabel=Anchor>&#8983;</a></h3><p>ä¸€ä¸ªfieldçš„è®¾ç½®æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸€ä¸ªfieldï¼Œé‚£ä¹ˆåº”è¯¥é‡æ–°æŒ‰ç…§æ–°çš„mappingï¼Œå»ºç«‹ä¸€ä¸ªindexï¼Œç„¶åå°†æ•°æ®æ‰¹é‡æŸ¥è¯¢å‡ºæ¥ï¼Œé‡æ–°ç”¨bulk apiå†™å…¥åˆ°indexä¸­ã€‚</p><p>æ‰¹é‡æŸ¥è¯¢çš„æ—¶å€™ï¼Œå»ºè®®é‡‡ç”¨scroll apiï¼Œå¹¶ä¸”é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘çš„æ–¹å¼æ¥reindexæ•°æ®ï¼Œæ¯æ¬¡scrollå°±æŸ¥è¯¢æŒ‡å®šæ—¥æœŸçš„ä¸€æ®µæ•°æ®ï¼Œäº¤ç»™ä¸€ä¸ªçº¿ç¨‹å³å¯ã€‚</p><pre tabindex=0><code># åŸå§‹çš„æ•°æ®
PUT /index1/type1/4
{
   &#34;content&#34;:&#34;1990-12-12&#34;
}

#æŠ¥é”™
PUT /index1/type1/4
{
   &#34;content&#34;:&#34;I am very happy.&#34;
}

#ä¿®æ”¹contentçš„ç±»å‹ä¸ºstringç±»å‹,æŠ¥é”™ï¼Œä¸å…è®¸ä¿®æ”¹
PUT /index1/_mapping/type1
{
  &#34;properties&#34;: {
    &#34;content&#34;:{
      &#34;type&#34;: &#34;text&#34;
    }
  }
}
</code></pre><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠindex1ç´¢å¼•ä¸­çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥å¯¼å…¥åˆ°æ–°çš„ç´¢å¼•ä¸­,ä½†æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ˜¯ä¹‹å‰çš„ç´¢å¼•ï¼Œä¸ºäº†ä¸ç”¨é‡å¯åº”ç”¨ç¨‹åºï¼Œç»™index1è¿™ä¸ªç´¢å¼•èµ·ä¸ª</p><pre tabindex=0><code># èµ·åˆ«å
PUT /index1/_alias/index2

# åˆ›å»ºæ–°çš„ç´¢å¼•ï¼ŒæŠŠcontentçš„ç±»å‹æ”¹ä¸ºå­—ç¬¦ä¸²
PUT /newindex
{
  &#34;mappings&#34;: {
    &#34;type1&#34;:{
      &#34;properties&#34;: {
        &#34;content&#34;:{
          &#34;type&#34;: &#34;text&#34;
        }
      }
    }
  }
}

# ä½¿ç”¨scrollæ‰¹é‡æŸ¥è¯¢
GET /index1/type1/_search?scroll=1m
{
  &#34;query&#34;: {
    &#34;match_all&#34;: {}
  },
  &#34;sort&#34;: [&#34;_doc&#34;],
  &#34;size&#34;: 2
}

#ä½¿ç”¨bulkæ‰¹é‡å†™å…¥æ–°çš„ç´¢å¼•
POST /_bulk
{&#34;index&#34;:{&#34;_index&#34;:&#34;newindex&#34;,&#34;_type&#34;:&#34;type1&#34;,&#34;_id&#34;:1}}
{&#34;content&#34;:&#34;1982-12-12&#34;}

#å°†åˆ«åindex2å’Œæ–°çš„ç´¢å¼•å…³è”ï¼Œåº”ç”¨ç¨‹åºä¸ç”¨é‡å¯
POST /_aliases
{
  &#34;actions&#34;: [
        {&#34;remove&#34;: {&#34;index&#34;:&#34;index1&#34;,&#34;alias&#34;:&#34;index2&#34;}},
        {&#34;add&#34;: {&#34;index&#34;: &#34;newindex&#34;,&#34;alias&#34;: &#34;index2&#34;}}
	]
}

GET index2/type1/_search
</code></pre><h3 id=ç´¢å¼•ä¸å¯å˜çš„åŸå› >ç´¢å¼•ä¸å¯å˜çš„åŸå› <a href=#ç´¢å¼•ä¸å¯å˜çš„åŸå›  class=hanchor arialabel=Anchor>&#8983;</a></h3><p>å€’æ’ç´¢å¼•åŒ…æ‹¬ï¼š</p><p>æ–‡æ¡£çš„åˆ—è¡¨ï¼Œæ–‡æ¡£çš„æ•°é‡ï¼Œè¯æ¡åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œå‡ºç°çš„ä½ç½®ï¼Œæ¯ä¸ªæ–‡æ¡£çš„é•¿åº¦ï¼Œæ‰€æœ‰æ–‡æ¡£çš„å¹³å‡é•¿åº¦</p><p>ç´¢å¼•ä¸å˜çš„åŸå› ï¼š</p><p>ä¸éœ€è¦é”ï¼Œæå‡äº†å¹¶å‘æ€§èƒ½</p><p>å¯ä»¥ä¸€ç›´ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼ˆfilterï¼‰</p><p>èŠ‚çœcpuå’Œioå¼€é”€</p><h1 id=å…ˆè®°ç€>å…ˆè®°ç€<a href=#å…ˆè®°ç€ class=hanchor arialabel=Anchor>&#8983;</a></h1><p>ç”¨logstashå»åŒæ­¥mysqlçš„çš„å¢é‡,,éœ€è¦ä¸¤ä¸ªå­—æ®µ,ç¬¬ä¸€ä¸ªæ˜¯ id,ä¸»é”®,ç¬¬äºŒä¸ªæ˜¯update_date, ç”¨ç¬¬äºŒä¸ªå­—æ®µå»æŸ¥è¯¢,é»˜è®¤ç”¨idå»å»é‡</p><p>group by çš„æ—¶å€™æŠ¥é”™äº†</p><p>esè¿›è¡Œèšåˆæ“ä½œæ—¶æç¤ºFielddata is disabled on text fields by default</p><p><a href=https://blog.csdn.net/u011403655/article/details/71107415/>https://blog.csdn.net/u011403655/article/details/71107415/</a></p><pre tabindex=0><code># å……å€¼ç¬”æ•°
GET /shouye/rukuan/_search
{
  &#34;aggs&#34;: {
    &#34;my_cre&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;orderId&#34;
      }
    }
  }
}

GET /shouye/rukuan/_count

GET /shouye/_mapping

PUT shouye/_mapping/rukuan/
{
  &#34;properties&#34;: {
    &#34;orderId&#34;: {
      &#34;type&#34;:     &#34;text&#34;,
      &#34;fielddata&#34;: true
    }
  }
}
</code></pre><h1 id=springbootæ•´åˆelasticsearch>springbootæ•´åˆElasticsearch<a href=#springbootæ•´åˆelasticsearch class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
         xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.lzkj&lt;/groupId&gt;
        &lt;artifactId&gt;item2&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.es&lt;/groupId&gt;
    &lt;artifactId&gt;es-server&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;es-server&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre><pre tabindex=0><code>spring.elasticsearch.rest.uris=http://192.168.111.132:9200
</code></pre></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://connorzhangyu.com/posts/docker/><span class=button__icon>â†</span>
<span class=button__text>Docker</span>
</a></span><span class="button next"><a href=https://connorzhangyu.com/posts/%E5%89%8D%E7%AB%AF/element-ui/><span class=button__text>Element-UI</span>
<span class=button__icon>â†’</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>