<!doctype html><html lang=zh><head><title>Nginx :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docker安装 Nginx # 简单的 docker run --name nginx-test \ -p 8080:80 \ -d \ nginx # 正式的 docker run -d \ -p 443:443 \ -p 80:80 \ --name nginx \ -v /home/nginx/www:/usr/share/nginx/html \ -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \ -v /home/nginx/logs:/var/log/nginx \ nginx Ubuntu安装Nginx # Ubuntu安装依赖 sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev zlib1g-dev # Ubuntu 如果还缺少依赖 apt-get install build-essential # Centos安装依赖 yum install -y gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel # 进入到解压的文件 cd ./nginx-1.16 ./configure --prefix=/url/local/nginx #或者 ./configure # 如果需要指定模块 ./configure --add-module=../nginx-rtmp-module #然后目录下就多了一个nginx文件 make && make install #启动 cd ../nginx/sbin ./nginx # 配置文件目录 所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下 程序文件在/usr/sbin/nginx 日志放在了/var/log/nginx中 并已经在/etc/init.d/下创建了启动脚本nginx 默认的虚拟主机的目录设置在了/var/www/nginx-default (有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置) Nginx 常用命令 # 启动nginx start nginx # 或者 nginx # 修改配置后重新加载生效 nginx -s reload # 重新打开日志文件 nginx -s reopen # 测试nginx配置文件是否正确 nginx -t -c /path/to/nginx.conf # 快速停止nginx nginx -s stop # 完整有序的停止nginx nginx -s quit # 指定配置文件启动 nginx -c /home/anthony/nginx.conf Nginx 配置模板 #user nobody; # 设置 <= cpu核数,一般设置成cpu*核数 worker_processes 1; # 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】 error_log logs/warn.log warn; # 指定pid存放路径 nginx启动后的进程ID pid logs/nginx.pid; # 工作模式及连接数上限 #user nobody; # 设置 <= cpu核数 worker_processes 1; # 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】 # error_log logs/error.log error; # 指定pid存放路径 nginx启动后的进程ID # pid logs/nginx.pid; # 工作模式及连接数上限 events { # 使用网络I/O模型，Linux系统推荐使用epoll模型，FreeBSD系统推荐使用kqueue;window下不指定 # user epoll; # 允许的最大连接数 worker_connections 1024; } # 设定http服务器，利用他的反向代理功能提供负载均衡支持 http { # 设定mime类型 include mime.types; default_type application/octet-stream; # 设定日志格式 log_format main '$remote_addr - $remote_user [$time_local] &#34;$request&#34; ' '$status $body_bytes_sent &#34;$http_referer&#34; ' '&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;'; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # access_log logs/info.log main; # # 设定access log send_timeout 3m; sendfile on; tcp_nopush on; tcp_nodelay on; # 这个参数表示http连接超时时间，默认是65s。要是上传文件比较大，在规定时间内没有上传完成，就会自动断开连接！所以适当调大这个时间。 keepalive_timeout 0; keepalive_timeout 5000; # 开启gzip模块 gzip on; gzip_min_length 1100; gzip_buffers 4 8k; gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json; output_buffers 1 32k; postpone_output 1460; server_names_hash_bucket_size 128; client_header_timeout 3m; #调大点 client_body_timeout 3m; #调大点 client_max_body_size 200m; #主要是这个参数，限制了上传文件大大小 #client_body_buffer_size 1024; fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; gzip_http_version 1.1; gzip_comp_level 2; gzip_vary on; #设定虚拟主机 server { listen 80; server_name ap.mmzcg.com; # 设置url编码格式，解决参数中文乱码问题 charset UTF-8; # 设定本虚拟主机的访问日志 # access_log logs/host.access.log main; # 对 &#34;/&#34; 启用负载均衡 location / { # 设定代理访问地址 proxy_pass http://127.0.0.1:30000/; # 配置SSL证书 # ssl_certificate /etc/nginx/conf.d/ssl/STAR.huihuang200.com.crt; # ssl_certificate_key /etc/nginx/conf.d/ssl/STAR.huihuang200.com.key; # ssl_session_timeout 5m; # ssl_session_cache shared:SSL:10m; # ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv2 SSLv3; # ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; # ssl_prefer_server_ciphers on; # ssl_verify_client off; # 解决ajax跨域问题 add_header 'Access-Control-Allow-Origin' '*'; add_header 'Access-Control-Allow-Credentials' 'true'; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS'; add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type'; # 保留用户真实信息 proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 允许客户端请求的最大单个文件字节数 client_max_body_size 100m; # 缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户 client_body_buffer_size 1280k; # nginx跟后端服务器连接超时时间，发起握手等候响应超时时间(代理连接超时) proxy_connect_timeout 5; # 连接成功后 等待后端服务器响应时间 其实已进入后端的排队之中等候处理 proxy_read_timeout 60; # 代理请求缓存区 这个缓存区间会保存用户的头信息一共Nginx进行规则处理 一般只要能保存下头信息即可 proxy_send_timeout 30; # 同上 告诉Nginx保存单个用的几个Buffer最大用多大空间 proxy_buffer_size 256k; proxy_buffers 4 256k; # 如果系统很忙的时候可以申请国内各大的proxy_buffers 官方推荐 *2 proxy_busy_buffers_size 256k; # proxy 缓存临时文件的大小 proxy_temp_file_write_size 256k; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_max_temp_file_size 128m; } } } Nginx日志管理 #access_log logs/access.log main; # nginx的默认配置,如果在安装的nginx里没有看到这个,也没有关系 #log_format main '$remote_addr - $remote_user [$time_local] &#34;$request&#34; ' # '$status $body_bytes_sent &#34;$http_referer&#34; ' # '&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;'; server { listen 80; location / { root my; index index.html } #配置日志, main 就是log_format 后面的名字 # 该server的访问日志的文件是logs/access.log,使用的是main格式 access_log logs/access.log main; } 推荐的配置
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=../../posts/nginx/><link rel=stylesheet href=../../styles.css><link rel="shortcut icon" href=../../img/theme-colors/orange.png><link rel=apple-touch-icon href=../../img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="Nginx"><meta property="og:description" content="Docker安装 Nginx # 简单的 docker run --name nginx-test \ -p 8080:80 \ -d \ nginx # 正式的 docker run -d \ -p 443:443 \ -p 80:80 \ --name nginx \ -v /home/nginx/www:/usr/share/nginx/html \ -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \ -v /home/nginx/logs:/var/log/nginx \ nginx Ubuntu安装Nginx # Ubuntu安装依赖 sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev zlib1g-dev # Ubuntu 如果还缺少依赖 apt-get install build-essential # Centos安装依赖 yum install -y gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel # 进入到解压的文件 cd ./nginx-1.16 ./configure --prefix=/url/local/nginx #或者 ./configure # 如果需要指定模块 ./configure --add-module=../nginx-rtmp-module #然后目录下就多了一个nginx文件 make && make install #启动 cd ../nginx/sbin ./nginx # 配置文件目录 所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下 程序文件在/usr/sbin/nginx 日志放在了/var/log/nginx中 并已经在/etc/init.d/下创建了启动脚本nginx 默认的虚拟主机的目录设置在了/var/www/nginx-default (有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置) Nginx 常用命令 # 启动nginx start nginx # 或者 nginx # 修改配置后重新加载生效 nginx -s reload # 重新打开日志文件 nginx -s reopen # 测试nginx配置文件是否正确 nginx -t -c /path/to/nginx.conf # 快速停止nginx nginx -s stop # 完整有序的停止nginx nginx -s quit # 指定配置文件启动 nginx -c /home/anthony/nginx.conf Nginx 配置模板 #user nobody; # 设置 <= cpu核数,一般设置成cpu*核数 worker_processes 1; # 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】 error_log logs/warn.log warn; # 指定pid存放路径 nginx启动后的进程ID pid logs/nginx.pid; # 工作模式及连接数上限 #user nobody; # 设置 <= cpu核数 worker_processes 1; # 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】 # error_log logs/error.log error; # 指定pid存放路径 nginx启动后的进程ID # pid logs/nginx.pid; # 工作模式及连接数上限 events { # 使用网络I/O模型，Linux系统推荐使用epoll模型，FreeBSD系统推荐使用kqueue;window下不指定 # user epoll; # 允许的最大连接数 worker_connections 1024; } # 设定http服务器，利用他的反向代理功能提供负载均衡支持 http { # 设定mime类型 include mime.types; default_type application/octet-stream; # 设定日志格式 log_format main '$remote_addr - $remote_user [$time_local] &#34;$request&#34; ' '$status $body_bytes_sent &#34;$http_referer&#34; ' '&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;'; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # access_log logs/info.log main; # # 设定access log send_timeout 3m; sendfile on; tcp_nopush on; tcp_nodelay on; # 这个参数表示http连接超时时间，默认是65s。要是上传文件比较大，在规定时间内没有上传完成，就会自动断开连接！所以适当调大这个时间。 keepalive_timeout 0; keepalive_timeout 5000; # 开启gzip模块 gzip on; gzip_min_length 1100; gzip_buffers 4 8k; gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json; output_buffers 1 32k; postpone_output 1460; server_names_hash_bucket_size 128; client_header_timeout 3m; #调大点 client_body_timeout 3m; #调大点 client_max_body_size 200m; #主要是这个参数，限制了上传文件大大小 #client_body_buffer_size 1024; fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; gzip_http_version 1.1; gzip_comp_level 2; gzip_vary on; #设定虚拟主机 server { listen 80; server_name ap.mmzcg.com; # 设置url编码格式，解决参数中文乱码问题 charset UTF-8; # 设定本虚拟主机的访问日志 # access_log logs/host.access.log main; # 对 &#34;/&#34; 启用负载均衡 location / { # 设定代理访问地址 proxy_pass http://127.0.0.1:30000/; # 配置SSL证书 # ssl_certificate /etc/nginx/conf.d/ssl/STAR.huihuang200.com.crt; # ssl_certificate_key /etc/nginx/conf.d/ssl/STAR.huihuang200.com.key; # ssl_session_timeout 5m; # ssl_session_cache shared:SSL:10m; # ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv2 SSLv3; # ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; # ssl_prefer_server_ciphers on; # ssl_verify_client off; # 解决ajax跨域问题 add_header 'Access-Control-Allow-Origin' '*'; add_header 'Access-Control-Allow-Credentials' 'true'; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS'; add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type'; # 保留用户真实信息 proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 允许客户端请求的最大单个文件字节数 client_max_body_size 100m; # 缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户 client_body_buffer_size 1280k; # nginx跟后端服务器连接超时时间，发起握手等候响应超时时间(代理连接超时) proxy_connect_timeout 5; # 连接成功后 等待后端服务器响应时间 其实已进入后端的排队之中等候处理 proxy_read_timeout 60; # 代理请求缓存区 这个缓存区间会保存用户的头信息一共Nginx进行规则处理 一般只要能保存下头信息即可 proxy_send_timeout 30; # 同上 告诉Nginx保存单个用的几个Buffer最大用多大空间 proxy_buffer_size 256k; proxy_buffers 4 256k; # 如果系统很忙的时候可以申请国内各大的proxy_buffers 官方推荐 *2 proxy_busy_buffers_size 256k; # proxy 缓存临时文件的大小 proxy_temp_file_write_size 256k; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_max_temp_file_size 128m; } } } Nginx日志管理 #access_log logs/access.log main; # nginx的默认配置,如果在安装的nginx里没有看到这个,也没有关系 #log_format main '$remote_addr - $remote_user [$time_local] &#34;$request&#34; ' # '$status $body_bytes_sent &#34;$http_referer&#34; ' # '&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;'; server { listen 80; location / { root my; index index.html } #配置日志, main 就是log_format 后面的名字 # 该server的访问日志的文件是logs/access.log,使用的是main格式 access_log logs/access.log main; } 推荐的配置
"><meta property="og:url" content="/posts/nginx/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051531732.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Linux"><meta property="article:published_time" content="2022-11-19 18:25:00 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=../../posts/nginx/>Nginx</a></h1><div class=post-meta><time class=post-date>2022-11-19</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/mac/>Mac</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051531732.png class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h2 id=docker安装-nginx>Docker安装 Nginx<a href=#docker安装-nginx class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 简单的</span>
</span></span><span style=display:flex><span>docker run --name nginx-test <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     -p 8080:80 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 正式的</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -p 443:443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -p 80:80 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           --name nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -v /home/nginx/www:/usr/share/nginx/html <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -v /home/nginx/logs:/var/log/nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           nginx
</span></span></code></pre></div><h2 id=ubuntu安装nginx>Ubuntu安装Nginx<a href=#ubuntu安装nginx class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Ubuntu安装依赖</span>
</span></span><span style=display:flex><span>sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev zlib1g-dev
</span></span><span style=display:flex><span><span style=color:#75715e># Ubuntu 如果还缺少依赖</span>
</span></span><span style=display:flex><span>apt-get install build-essential
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Centos安装依赖</span>
</span></span><span style=display:flex><span>yum install -y gcc-c++ pcre pcre-devel  zlib zlib-devel  openssl openssl-devel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 进入到解压的文件</span>
</span></span><span style=display:flex><span>cd ./nginx-1.16
</span></span><span style=display:flex><span>./configure --prefix<span style=color:#f92672>=</span>/url/local/nginx
</span></span><span style=display:flex><span><span style=color:#75715e>#或者</span>
</span></span><span style=display:flex><span>./configure
</span></span><span style=display:flex><span><span style=color:#75715e># 如果需要指定模块</span>
</span></span><span style=display:flex><span>./configure --add-module<span style=color:#f92672>=</span>../nginx-rtmp-module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#然后目录下就多了一个nginx文件</span>
</span></span><span style=display:flex><span>make <span style=color:#f92672>&amp;&amp;</span> make install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#启动</span>
</span></span><span style=display:flex><span>cd ../nginx/sbin
</span></span><span style=display:flex><span>./nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置文件目录</span>
</span></span><span style=display:flex><span>所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下
</span></span><span style=display:flex><span>程序文件在/usr/sbin/nginx
</span></span><span style=display:flex><span>日志放在了/var/log/nginx中
</span></span><span style=display:flex><span>并已经在/etc/init.d/下创建了启动脚本nginx
</span></span><span style=display:flex><span>默认的虚拟主机的目录设置在了/var/www/nginx-default <span style=color:#f92672>(</span>有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=nginx-常用命令>Nginx 常用命令<a href=#nginx-常用命令 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启动nginx</span>
</span></span><span style=display:flex><span>start nginx
</span></span><span style=display:flex><span><span style=color:#75715e># 或者</span>
</span></span><span style=display:flex><span>nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改配置后重新加载生效</span>
</span></span><span style=display:flex><span>nginx -s reload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 重新打开日志文件</span>
</span></span><span style=display:flex><span>nginx -s reopen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 测试nginx配置文件是否正确</span>
</span></span><span style=display:flex><span>nginx -t -c /path/to/nginx.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 快速停止nginx</span>
</span></span><span style=display:flex><span>nginx -s stop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 完整有序的停止nginx</span>
</span></span><span style=display:flex><span>nginx -s quit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指定配置文件启动</span>
</span></span><span style=display:flex><span>nginx -c /home/anthony/nginx.conf
</span></span></code></pre></div><h2 id=nginx-配置模板>Nginx 配置模板<a href=#nginx-配置模板 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#user  nobody;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置 &lt;= cpu核数,一般设置成cpu*核数</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>worker_processes  1;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>error_log  logs/warn.log  warn;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指定pid存放路径 nginx启动后的进程ID</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>pid        logs/nginx.pid;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 工作模式及连接数上限</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#user  nobody;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置 &lt;= cpu核数</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>worker_processes  1;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指定错误日志文件存放路径，错误日志级别可选项为【debug|info|notice|warn|error|crit】</span>
</span></span><span style=display:flex><span><span style=color:#75715e># error_log  logs/error.log  error;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指定pid存放路径 nginx启动后的进程ID</span>
</span></span><span style=display:flex><span><span style=color:#75715e># pid        logs/nginx.pid;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 工作模式及连接数上限</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>events {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 使用网络I/O模型，Linux系统推荐使用epoll模型，FreeBSD系统推荐使用kqueue;window下不指定</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># user epoll;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 允许的最大连接数</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>worker_connections  1024;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设定http服务器，利用他的反向代理功能提供负载均衡支持</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>http {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 设定mime类型</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>include       mime.types;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>default_type  application/octet-stream;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 设定日志格式</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>log_format  main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span><span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>client_header_buffer_size 1k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>large_client_header_buffers 4 4k;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># access_log  logs/info.log  main;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># # 设定access log</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>send_timeout 3m;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>sendfile on;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>tcp_nopush on;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>tcp_nodelay on;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 这个参数表示http连接超时时间，默认是65s。要是上传文件比较大，在规定时间内没有上传完成，就会自动断开连接！所以适当调大这个时间。</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>keepalive_timeout  0;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>keepalive_timeout  5000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 开启gzip模块</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip  on;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_min_length 1100;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_buffers 4 8k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>output_buffers 1 32k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>postpone_output 1460;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>server_names_hash_bucket_size 128;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>client_header_timeout 3m;       </span> <span style=color:#75715e>#调大点</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>client_body_timeout 3m;         </span> <span style=color:#75715e>#调大点</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>client_max_body_size 200m;        </span> <span style=color:#75715e>#主要是这个参数，限制了上传文件大大小</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#client_body_buffer_size 1024;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_connect_timeout 300;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_send_timeout 300;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_read_timeout 300;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_buffer_size 64k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_buffers 4 64k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_busy_buffers_size 128k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>fastcgi_temp_file_write_size 128k;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_http_version 1.1;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_comp_level 2;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>gzip_vary on;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#设定虚拟主机</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>server {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>listen      80;</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>server_name  ap.mmzcg.com;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 设置url编码格式，解决参数中文乱码问题</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>charset UTF-8;</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e># 设定本虚拟主机的访问日志</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># access_log  logs/host.access.log  main;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 对 &#34;/&#34; 启用负载均衡</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>location / {</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 设定代理访问地址</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_pass http://127.0.0.1:30000/;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 配置SSL证书</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_certificate /etc/nginx/conf.d/ssl/STAR.huihuang200.com.crt;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_certificate_key  /etc/nginx/conf.d/ssl/STAR.huihuang200.com.key;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_session_timeout 5m;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_session_cache shared:SSL:10m;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv2 SSLv3;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_prefer_server_ciphers on;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># ssl_verify_client off;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 解决ajax跨域问题</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET, POST, OPTIONS&#39;;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>add_header &#39;Access-Control-Allow-Headers&#39; &#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e># 保留用户真实信息</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_set_header Host $host:$server_port;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_set_header X-Real-IP $remote_addr;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 允许客户端请求的最大单个文件字节数</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>client_max_body_size 100m;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>client_body_buffer_size 1280k;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># nginx跟后端服务器连接超时时间，发起握手等候响应超时时间(代理连接超时)</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_connect_timeout 5;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 连接成功后 等待后端服务器响应时间 其实已进入后端的排队之中等候处理</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_read_timeout 60;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 代理请求缓存区 这个缓存区间会保存用户的头信息一共Nginx进行规则处理 一般只要能保存下头信息即可</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_send_timeout 30;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 同上 告诉Nginx保存单个用的几个Buffer最大用多大空间</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_buffer_size 256k;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_buffers 4 256k;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 如果系统很忙的时候可以申请国内各大的proxy_buffers 官方推荐 *2</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_busy_buffers_size 256k;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># proxy 缓存临时文件的大小</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_temp_file_write_size 256k;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>proxy_max_temp_file_size 128m;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=nginx日志管理>Nginx日志管理<a href=#nginx日志管理 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e>#access_log  logs/access.log  main;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># nginx的默认配置,如果在安装的nginx里没有看到这个,也没有关系
</span></span></span><span style=display:flex><span><span style=color:#75715e>#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#                  &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#                  &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>  <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>my</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#配置日志, main 就是log_format 后面的名字
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  	<span style=color:#75715e># 该server的访问日志的文件是logs/access.log,使用的是main格式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>access_log</span>  <span style=color:#e6db74>logs/access.log</span>  <span style=color:#e6db74>main</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>推荐的配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>log_format</span>  <span style=color:#e6db74>main</span>  
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#39;</span>$remote_addr <span style=color:#e6db74>-</span> $remote_user <span style=color:#e6db74>[</span>$time_local] <span style=color:#e6db74>&#34;</span>$request&#34; $http_host <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#39;</span>$status $request_length $body_bytes_sent <span style=color:#e6db74>&#34;</span>$http_referer&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#39;&#34;</span>$http_user_agent&#34;  $request_time&#39;;
</span></span></code></pre></div><ol><li>remote_addr : 客户端地址</li><li>remote_user : 客户端用户名</li><li>time_local : 服务器时间</li><li>request : 请求内容，包括方法名，地址，和http协议</li><li>http_host : 用户请求是使用的http地址</li><li>status : 返回的http 状态码</li><li>request_length : 请求大小</li><li>body_bytes_sent : 返回的大小</li><li>http_referer : 来源页</li><li>http_user_agent : 客户端名称</li><li>request_time : 整体请求延时</li></ol><p>日志书写规则</p><p>一行要用单引号包起来,一行一个,换行也不需要什么连接的符号</p><h2 id=location匹配>location匹配<a href=#location匹配 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>= 精准匹配
不写 一般匹配
~ 正则匹配
location proxy_pass 后面的url 加与不加/的区别</p><h2 id=server_name匹配>server_name匹配<a href=#server_name匹配 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=通配符匹配>通配符匹配<a href=#通配符匹配 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen       <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    server_name  <span style=color:#f92672>*.</span>example<span style=color:#f92672>.</span>org;
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen       <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    server_name  mail<span style=color:#f92672>.*</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>通配符格式中的<code>*</code>号只能在域名的开头或结尾，并且<code>*</code>号两侧只能是<code>.</code>这些无效:</p><ul><li><code>www.*.example.org</code></li><li><code>w*.example.org</code></li></ul><p><code>*</code>号可以匹配多个域名部分，<code>*.example.org</code>可以匹配到:</p><ul><li><code>www.example.org</code></li><li><code>www.sub.example.org</code></li></ul><p><code>.example.org</code>是比较特殊的通配符格式, 可以同时匹配</p><ul><li><code>example.org</code></li><li><code>*.example.org</code>。</li></ul><h3 id=正则匹配>正则匹配<a href=#正则匹配 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>⁉️ 不适用我自己</p><h3 id=精确匹配>精确匹配<a href=#精确匹配 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code class=language-visual-basic data-lang=visual-basic>server {
    listen       80;
    server_name  example.org  www.example.org;
    ...
}
</code></pre><h3 id=特殊匹配格式>特殊匹配格式<a href=#特殊匹配格式 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li><code>server_name ""</code>; 匹配Host请求头不存在的情况。</li><li><code>server_name "-"</code>; 无任何意义。</li><li><code>server_name "*";</code> 它被错误地解释为万能的名称。 它从不用作通用或通配符服务器名称。相反，它提供了server_name_in_redirect指令现在提供的功能。 <code>现在不建议使用特殊名称“ *”，而应使用server_name_in_redirect指令。</code></li></ol><h4 id=匹配顺序>匹配顺序<a href=#匹配顺序 class=hanchor arialabel=Anchor>&#8983;</a></h4><ol><li>精确的名字</li><li>以*号开头的最长通配符名称，例如 *.example.org</li><li>以<em>号结尾的最长通配符名称，例如 mail.</em></li><li>第一个匹配的正则表达式（在配置文件中出现的顺序）</li></ol><h3 id=优化>优化<a href=#优化 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>尽量使用精确匹配;</li><li>当定义大量server_name时或特别长的server_name时，需要在http级别调整server_names_hash_max_size和server_names_hash_bucket_size，否则nginx将无法启动。</li></ol><h1 id=nginx报错>Nginx报错<a href=#nginx报错 class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=1服务器重启之后执行-nginx--t-是ok的然而在执行-nginx--s-reload-的时候报错>1.服务器重启之后，执行 nginx -t 是OK的，然而在执行 nginx -s reload 的时候报错<a href=#1服务器重启之后执行-nginx--t-是ok的然而在执行-nginx--s-reload-的时候报错 class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>nginx: [error] invalid PID number "" in "/run/nginx.pid"</code></p><pre tabindex=0><code># 解决办法:
nginx -c /etc/nginx/nginx.conf
nginx.conf文件的路径可以从nginx -t的返回中找到。
nginx -s reload
</code></pre><h3 id=2a-duplicate-default-server-for-000080>2.<code>a duplicate default server for 0.0.0.0:80</code><a href=#2a-duplicate-default-server-for-000080 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>nginx: [emerg] a duplicate default server for 0.0.0.0:80 in /etc/nginx/sites-enabled/gitlab:10</p><pre tabindex=0><code>删除/etc/nginx/sites-available/default文件，重新启动服务即可

nginx -t :检查配置文件是否出错
</code></pre><h3 id=3403>3.403<a href=#3403 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre tabindex=0><code>打开nginx.conf
例子：vim /etc/nginx/nginx.conf
把 user 用户名 改为 user root 或 其它有高权限的用户名称即可
</code></pre><h1 id=nginx应用>Nginx应用<a href=#nginx应用 class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=acmesh的使用>Acme.sh的使用<a href=#acmesh的使用 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 下载软件</span>
</span></span><span style=display:flex><span>curl https://get.acme.sh | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置别名 alias:</span>
</span></span><span style=display:flex><span>alias acme.sh<span style=color:#f92672>=</span>~/.acme.sh/acme.sh 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 切换 Let&#39;s Encrypt,默认使用 ZeroSSL</span>
</span></span><span style=display:flex><span>acme.sh --set-default-ca --server letsencrypt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 执行,会打印配置域名的TXT</span>
</span></span><span style=display:flex><span>acme.sh --issue -d baidu.me --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置好执行,再执行</span>
</span></span><span style=display:flex><span>acme.sh --issue -d baidu.me --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please --renew
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --nginx 就是指定域名的配置文件</span>
</span></span><span style=display:flex><span>Your cert is in: /root/.acme.sh/baidu.me_ecc/baidu.me.cer
</span></span><span style=display:flex><span>Your cert key is in: /root/.acme.sh/baidu.me_ecc/baidu.me.key
</span></span><span style=display:flex><span>The intermediate CA cert is in: /root/.acme.sh/baidu.me_ecc/ca.cer
</span></span><span style=display:flex><span>And the full chain certs is there: /root/.acme.sh/baidu.me_ecc/fullchain.cer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看申请的证书</span>
</span></span><span style=display:flex><span>root@jenkins-jumpserver-nginx:~/.acme.sh# acme.sh --list
</span></span><span style=display:flex><span>Main_Domain             KeyLength  SAN_Domains  CA               Created               Renew
</span></span><span style=display:flex><span>baidu     <span style=color:#e6db74>&#34;ec-256&#34;</span>   no           LetsEncrypt.org  2023-09-17T11:52:22Z  2023-11-15T11:52:22Z
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 续期证书</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 证书默认是90天，如需强制更新证书，则执行以下命令</span>
</span></span><span style=display:flex><span>acme.sh --renew -d abc.xyz --force
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># acme.sh会自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, </span>
</span></span><span style=display:flex><span><span style=color:#75715e># 如果快过期了, 需要更新, 则会自动更新证书，使用以下命令可查看定时任务</span>
</span></span><span style=display:flex><span>crontab -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 升级 acme.sh 到最新</span>
</span></span><span style=display:flex><span>acme.sh --upgrade
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># CF</span>
</span></span><span style=display:flex><span>export CF_Key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxxxxxx&#34;</span> 
</span></span><span style=display:flex><span>export CF_Email<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;CF账号的邮箱&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>acme.sh --issue -d <span style=color:#e6db74>&#34;baidu.com&#34;</span> --dns dns_cf
</span></span></code></pre></div><h2 id=建立软连接>建立软连接<a href=#建立软连接 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ln -s /etc/nginx/sites-available/domain-one.com /etc/nginx/sites-enabled/
</span></span></code></pre></div><h2 id=快速部署静态应用>快速部署静态应用<a href=#快速部署静态应用 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># 首尾配置暂时忽略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span>       <span style=color:#ae81ff>8080</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span>  <span style=color:#e6db74>localhost</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>         		<span style=color:#75715e># 设置为个人项目的根目录路径
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>root</span> <span style=color:#e6db74>/usr/local/var/www/my-project</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>index</span>  <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>            <span style=color:#75715e># vue项目404让前端路由处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>try_files</span> $uri $uri/ <span style=color:#e6db74>/index.html</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># 首尾配置暂时忽略
</span></span></span></code></pre></div><h2 id=跨域>跨域<a href=#跨域 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># 首尾配置暂时忽略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span>       <span style=color:#ae81ff>8080</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span>  <span style=color:#e6db74>localhost</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e># 跨域代理设置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://www.proxy.com</span>; <span style=color:#75715e># 要实现跨域的域名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Origin</span> <span style=color:#e6db74>*</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Methods</span> <span style=color:#e6db74>&#39;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>OPTIONS&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Headers</span> <span style=color:#e6db74>&#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># 首尾配置暂时忽略
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># 第二种
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span> <span style=color:#e6db74>www.*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>root</span> <span style=color:#e6db74>/home/ubuntu/sabong-server-front</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>try_files</span> $uri $uri/ <span style=color:#e6db74>/index.html</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>if</span> <span style=color:#e6db74>(</span>$request_method = <span style=color:#e6db74>&#39;OPTIONS&#39;)</span> {
</span></span><span style=display:flex><span>                        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span> <span style=color:#e6db74>*</span>;
</span></span><span style=display:flex><span>                        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Methods&#39;</span> <span style=color:#e6db74>&#39;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>PUT,</span> <span style=color:#e6db74>DELETE,</span> <span style=color:#e6db74>OPTIONS&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Headers&#39;</span> <span style=color:#e6db74>&#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,language,If-Modified-Since,Cache-Control,Content-Type&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>                        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Max-Age&#39;</span> <span style=color:#ae81ff>86400</span>;
</span></span><span style=display:flex><span>                        <span style=color:#f92672>return</span> <span style=color:#ae81ff>200</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span> <span style=color:#e6db74>*</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Methods&#39;</span> <span style=color:#e6db74>&#39;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>PUT,</span> <span style=color:#e6db74>DELETE,</span> <span style=color:#e6db74>OPTIONS&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Headers&#39;</span> <span style=color:#e6db74>&#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,language,If-Modified-Since,Cache-Control,Content-Type&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Allow-Credentials&#39;</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>add_header</span> <span style=color:#e6db74>&#39;Access-Control-Max-Age&#39;</span> <span style=color:#ae81ff>86400</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forward-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $http_host;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Nginx-Proxy</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.41.206:9001/</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/ws</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.41.206:9006/ws</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_read_timeout</span> <span style=color:#e6db74>360s</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host:$server_port;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>REMOTE-HOST</span> $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=gzip压缩>Gzip压缩<a href=#gzip压缩 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 配置gzip压缩
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>gzip</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_min_length</span> <span style=color:#ae81ff>1000</span>; <span style=color:#75715e># 设定压缩的临界点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>gzip_comp_level</span> <span style=color:#ae81ff>3</span>; <span style=color:#75715e># 压缩级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>gzip_types</span>      <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>application/xml</span>; <span style=color:#75715e># 要压缩的文件类别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h2 id=转发vue项目>转发Vue项目<a href=#转发vue项目 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>root</span> <span style=color:#e6db74>/home/ubuntu/sabong-server-front</span>;
</span></span><span style=display:flex><span>								<span style=color:#75715e># nginx 转发给前端判断是不是404
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>try_files</span> $uri $uri/ <span style=color:#e6db74>/index.html</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $http_host;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Nginx-Proxy</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.41.206:9001/</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=转发websocket>转发Websocket<a href=#转发websocket class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/ws</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.41.206:9006/ws</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_read_timeout</span> <span style=color:#e6db74>360s</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host:$server_port;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>REMOTE-HOST</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=转发redis>转发Redis<a href=#转发redis class=hanchor arialabel=Anchor>&#8983;</a></h2><p>只知道这么配置,不知道怎么给redis配置上域名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span> <span style=color:#e6db74>www-data</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span> <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pid</span> <span style=color:#e6db74>/run/nginx.pid</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> /etc/nginx/modules-enabled/*.conf;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>worker_connections</span> <span style=color:#ae81ff>768</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># multi_accept on;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 要跟http统计,旧的版本没有steram模块,需要编译的时候加
</span></span></span><span style=display:flex><span><span style=color:#75715e># 下载最新的版本肯定是有stream模块的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>stream</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>redis</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e># myredis.godjfp.com  要被转发的Redis地址
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#75715e># 6379:redis自己设置的端口是多少,就是多少
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>server</span> myredis.godjfp.com:<span style=color:#ae81ff>6379</span> <span style=color:#e6db74>max_fails=3</span> <span style=color:#e6db74>fail_timeout=30s</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e># 公网访问的端口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>6379</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_connect_timeout</span> <span style=color:#e6db74>1s</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_timeout</span> <span style=color:#e6db74>3s</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>redis</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><img src=https://image.runtimes.cc/202404051446413.png alt></p><h2 id=图片上传>图片上传<a href=#图片上传 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>post上传文件，出现413错误码 解决方案</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>允许客户端请求的最大单文件字节数</span>
</span></span><span style=display:flex><span>client_max_body_size <span style=color:#ae81ff>10</span>m; 
</span></span><span style=display:flex><span><span style=color:#f92672>#</span><span style=color:#960050;background-color:#1e0010>缓冲区代理缓冲用户端请求的最大字节数</span>
</span></span><span style=display:flex><span>client_body_buffer_size <span style=color:#ae81ff>128</span>k; 
</span></span></code></pre></div><h2 id=https跳转>HTTPS跳转<a href=#https跳转 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#75715e># 配置SSL证书
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>abc.xyz</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  			<span style=color:#75715e># 如果是http,就跳转https,注意nginx配置文件的不同,可能会出现重定向次数过多
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>if</span> <span style=color:#e6db74>(</span>$scheme = <span style=color:#e6db74>http)</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://192.168.0.2:8084/</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 比如配置强制跳转https,导致重定向次数过多
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#75715e># 配置SSL证书
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>abc.xyz</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  			<span style=color:#75715e># 如果是http,就跳转https,注意nginx配置文件的不同,可能会出现重定向次数过多
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e># 比如这个配置 return      301 https://$server_name$request_uri;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e># 比如这个配置 rewrite ^(.*)$  https://$host$1 permanent;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://192.168.0.2:8084/</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 上面两种导致重定向的次数过多,需要修改配置文件,比如下面的配置文件就可以
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span> <span style=color:#e6db74>www.your_domain.com</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span> <span style=color:#e6db74>www.your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/path/to/your/certificate.crt</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/path/to/your/private_key.key</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=代理jumpserver>代理JumpServer<a href=#代理jumpserver class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span> <span style=color:#e6db74>index.nginx-debian.html</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e># 比如服务器里的JumpServer的端口已经设置成了8083
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:8083/</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 按照官方的配置,需要使用WebSocket,如果不配置的话,访问JumpServer网页会提示WebSocket报错
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_buffering</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_request_buffering</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $remote_addr;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href="https://docs.jumpserver.org/zh/v3/installation/proxy/?h=nginx#2-nginx">官方文档:使用Nginx代理JumpServer</a></p><h2 id=代理jenkins>代理Jenkins<a href=#代理jenkins class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:8083/</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 如果使用这样的配置,会有问题,比如配置的域名是baidu.com
</span></span></span><span style=display:flex><span><span style=color:#75715e># 当访问baidu.com会正常访问,当登录之后,网页地址就变成http://127.0.0.1:8083/
</span></span></span><span style=display:flex><span><span style=color:#75715e># 需要改成一下配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:8080/</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    						<span style=color:#75715e># 下面这几个配置,访问Github会403
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>                <span style=color:#f92672>http2_push_preload</span> <span style=color:#66d9ef>on</span>; <span style=color:#75715e># Enable http2 push
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>X-Forwarded-Proto</span>  $scheme;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>X-Forwarded-For</span>    $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>X-Real-IP</span>          $remote_addr;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    						<span style=color:#75715e># 这个配置又是正常的,要看看这个请求头是干嘛的了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   						  <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Rea</span> $remote_addr;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $http_host;
</span></span><span style=display:flex><span>                <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Nginx-Proxy</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>               <span style=color:#f92672>client_max_body_size</span> <span style=color:#ae81ff>100m</span>;
</span></span><span style=display:flex><span>              <span style=color:#f92672>client_body_buffer_size</span> <span style=color:#ae81ff>50m</span>;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.2.105:8083/</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 		<span style=color:#75715e># 代理swagger稳定 openapi3的版本,springboot3的版本
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/v3/api-docs</span> {
</span></span><span style=display:flex><span>               <span style=color:#f92672>client_max_body_size</span> <span style=color:#ae81ff>100m</span>;
</span></span><span style=display:flex><span>               <span style=color:#f92672>client_body_buffer_size</span> <span style=color:#ae81ff>50m</span>;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>               <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.31.2.105:8083/v3/api-docs</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>      <span style=color:#f92672>try_files</span> $uri $uri/ <span style=color:#e6db74>/index.html</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>root</span> <span style=color:#e6db74>/usr/share/nginx/html/manager/dist/</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><h1 id=srs>SRS<a href=#srs class=hanchor arialabel=Anchor>&#8983;</a></h1><h2 id=docker方式运行>Docker方式运行<a href=#docker方式运行 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span>docker run -p 1935:1935 -p 1985:1985 -p 8080:8080 ossrs/srs:latest<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 测试</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 访问:[http://192.168.254.180:8080/](http://192.168.254.180:8080/)</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=srs安装参考>SRS安装参考<a href=#srs安装参考 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=https://cloud.tencent.com/developer/article/1693951>https://cloud.tencent.com/developer/article/1693951</a></p><h2 id=mac改成只播放系统声音>Mac改成只播放系统声音<a href=#mac改成只播放系统声音 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=http://www.obsproject.com.cn/obs/78.html>Mac obs推流直播无声音解决方法_OBS教程_OBS Open Broadcaster Software</a></p><h2 id=obs权限监听浏览器>OBS权限监听浏览器<a href=#obs权限监听浏览器 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=https://image.runtimes.cc/202404051442055.png alt></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=../../posts/mycat/><span class=button__icon>←</span>
<span class=button__text>Mycat</span>
</a></span><span class="button next"><a href=../../posts/nodejs/><span class=button__text>NodeJs</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=../../bundle.min.js></script></div></body></html>