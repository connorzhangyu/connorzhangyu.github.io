<!doctype html><html lang=zh><head><title>Harbor :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="下载离线安装包 # 解压 tzr -zxvf harbo.xxxxx.tgz # cp 下模板文件 cp ./harbor.yml.tmpl ./harbor.yml 修改配置文件 sudo vim harbor.yml # 有域名就弄域名,这里是在内网就用的ip hostname: 10.0.2.4 # http related config http: # port for http, default is 80. If https enabled, this port will redirect to https port port: 80 # 内网不需要https,https和证书就注释了 # https related config #https: # https port for harbor, default is 443 # port: 443 # The path of cert and key files for nginx # certificate: /your/certificate/path # private_key: /your/private/key/path # Uncomment external_url if you want to enable external proxy # And when it enabled the hostname will no longer used # external_url: https://reg.mydomain.com:8433 # The initial password of Harbor admin # It only works in first time to install harbor # Remember Change the admin password from UI after launching Harbor. harbor_admin_password: 123456 # Harbor DB configuration database: # The password for the root user of Harbor DB. Change this before any production use. password: root123 # The maximum number of connections in the idle connection pool. If it <=0, no idle connections are retained. max_idle_conns: 50 # The maximum number of open connections to the database. If it <= 0, then there is no limit on the number of open connections. # Note: the default number of connections is 100 for postgres. max_open_conns: 100 # The default data volume # 这里要配置好目录 data_volume: /home/yunxian/harbor/data 运行 # 每次修改完配置文件后都需要运行 ./prepare # 运行 ./install.sh 访问 访问:http://10.0.2.4/
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=../../posts/harbor/><link rel=stylesheet href=../../styles.css><link rel="shortcut icon" href=../../img/theme-colors/orange.png><link rel=apple-touch-icon href=../../img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Anthony"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="Harbor"><meta property="og:description" content="下载离线安装包 # 解压 tzr -zxvf harbo.xxxxx.tgz # cp 下模板文件 cp ./harbor.yml.tmpl ./harbor.yml 修改配置文件 sudo vim harbor.yml # 有域名就弄域名,这里是在内网就用的ip hostname: 10.0.2.4 # http related config http: # port for http, default is 80. If https enabled, this port will redirect to https port port: 80 # 内网不需要https,https和证书就注释了 # https related config #https: # https port for harbor, default is 443 # port: 443 # The path of cert and key files for nginx # certificate: /your/certificate/path # private_key: /your/private/key/path # Uncomment external_url if you want to enable external proxy # And when it enabled the hostname will no longer used # external_url: https://reg.mydomain.com:8433 # The initial password of Harbor admin # It only works in first time to install harbor # Remember Change the admin password from UI after launching Harbor. harbor_admin_password: 123456 # Harbor DB configuration database: # The password for the root user of Harbor DB. Change this before any production use. password: root123 # The maximum number of connections in the idle connection pool. If it <=0, no idle connections are retained. max_idle_conns: 50 # The maximum number of open connections to the database. If it <= 0, then there is no limit on the number of open connections. # Note: the default number of connections is 100 for postgres. max_open_conns: 100 # The default data volume # 这里要配置好目录 data_volume: /home/yunxian/harbor/data 运行 # 每次修改完配置文件后都需要运行 ./prepare # 运行 ./install.sh 访问 访问:http://10.0.2.4/
"><meta property="og:url" content="/posts/harbor/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="https://image.runtimes.cc/202404051528484.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Docker"><meta property="article:published_time" content="2022-11-19 18:25:00 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=../../posts/harbor/>Harbor</a></h1><div class=post-meta><time class=post-date>2022-11-19</time><span class=post-author>Anthony</span></div><span class=post-tags>#<a href=../../tags/docker/>Docker</a>&nbsp;
#<a href=../../tags/harbor/>Harbor</a>&nbsp;
#<a href=../../tags/%E6%9E%84%E5%BB%BA/>构建</a>&nbsp;
#<a href=../../tags/%E8%87%AA%E5%8A%A8%E5%8C%96/>自动化</a>&nbsp;
</span><img src=https://image.runtimes.cc/202404051528484.png class=post-cover alt=" " title="Cover Image"><div class=post-content><div><h2 id=下载离线安装包>下载离线安装包<a href=#下载离线安装包 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=https://image.runtimes.cc/202404051422363.png alt></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 解压</span>
</span></span><span style=display:flex><span>tzr -zxvf harbo.xxxxx.tgz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cp 下模板文件</span>
</span></span><span style=display:flex><span>cp ./harbor.yml.tmpl ./harbor.yml
</span></span></code></pre></div><h2 id=修改配置文件>修改配置文件<a href=#修改配置文件 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim harbor.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 有域名就弄域名,这里是在内网就用的ip</span>
</span></span><span style=display:flex><span><span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>10.0.2.4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># http related config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># port for http, default is 80. If https enabled, this port will redirect to https port</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 内网不需要https,https和证书就注释了</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https related config</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#https:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https port for harbor, default is 443</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># port: 443</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The path of cert and key files for nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># certificate: /your/certificate/path</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># private_key: /your/private/key/path</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Uncomment external_url if you want to enable external proxy</span>
</span></span><span style=display:flex><span><span style=color:#75715e># And when it enabled the hostname will no longer used</span>
</span></span><span style=display:flex><span><span style=color:#75715e># external_url: https://reg.mydomain.com:8433</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The initial password of Harbor admin</span>
</span></span><span style=display:flex><span><span style=color:#75715e># It only works in first time to install harbor</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remember Change the admin password from UI after launching Harbor.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>harbor_admin_password</span>: <span style=color:#ae81ff>123456</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Harbor DB configuration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>database</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># The password for the root user of Harbor DB. Change this before any production use.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>root123</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The maximum number of connections in the idle connection pool. If it &lt;=0, no idle connections are retained.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_idle_conns</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The maximum number of open connections to the database. If it &lt;= 0, then there is no limit on the number of open connections.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Note: the default number of connections is 100 for postgres.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_open_conns</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The default data volume</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 这里要配置好目录</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data_volume</span>: <span style=color:#ae81ff>/home/yunxian/harbor/data</span>
</span></span></code></pre></div><h2 id=运行>运行<a href=#运行 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 每次修改完配置文件后都需要运行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>./prepare</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 运行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>./install.sh</span>
</span></span></code></pre></div><h2 id=访问>访问<a href=#访问 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>访问:<a href=http://10.0.2.4/><code>http://10.0.2.4/</code></a></p><p>账号密码:admin / 123456</p><h1 id=解决客户端的https问题>解决客户端的https问题<a href=#解决客户端的https问题 class=hanchor arialabel=Anchor>&#8983;</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@client ~<span style=color:#f92672>]</span><span style=color:#75715e># docker login 10.19.46.15</span>
</span></span><span style=display:flex><span>Username: admin
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>Error response from daemon: Get https://10.19.46.15/v2/: dial tcp 10.19.46.15:443: connect: connection refused
</span></span></code></pre></div><p>这是因为docker1.3.2版本开始默认docker registry使用的是https，我们设置Harbor默认http方式，所以当执行用<code>docker login、pull、push</code>等命令操作非https的<code>docker regsitry</code>的时就会报错。</p><p>解决办法</p><p><code>vim docker-compose.yml</code></p><p><img src=https://image.runtimes.cc/202404051422110.png alt></p><p>编辑客户端</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/docker/daemon.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;insecure-registries&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;10.19.46.15(harbor的IP)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 重启docker</span>
</span></span><span style=display:flex><span>systemctl daemon-reload
</span></span><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></div><p>再次登录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@client ~<span style=color:#f92672>]</span><span style=color:#75715e># docker login 10.19.46.15   </span>
</span></span><span style=display:flex><span>Username: admin
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
</span></span><span style=display:flex><span>Configure a credential helper to remove this warning. See
</span></span><span style=display:flex><span>https://docs.docker.com/engine/reference/commandline/login/#credentials-store
</span></span><span style=display:flex><span>Login Succeeded
</span></span></code></pre></div><h1 id=技巧>技巧<a href=#技巧 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>pull 的命令</p><p><img src=https://image.runtimes.cc/202404051422738.png alt></p><p>推送和打tag的命令</p><p><img src=https://image.runtimes.cc/202404051423924.png alt></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=../../posts/grafana/><span class=button__icon>←</span>
<span class=button__text>Grafana</span>
</a></span><span class="button next"><a href=../../posts/%E5%89%8D%E7%AB%AF/html/><span class=button__text>HTML</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=../../bundle.min.js></script></div></body></html>