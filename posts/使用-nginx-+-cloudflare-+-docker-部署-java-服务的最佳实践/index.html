<!doctype html><html lang=zh><head><title>使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践 :: Hello World</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践 在生产环境中，Nginx、Cloudflare 和 Docker 是一个经典且高效的组合，特别适合 Java 服务的部署。本篇博客将详细介绍如何将这三者结合起来，构建高性能、高可用的服务架构。
架构概览 用户请求 → Cloudflare (CDN + DNS + HTTPS) → Nginx (反向代理 + 负载均衡) → Docker (Java 服务实例) → 数据库/缓存 架构组成 Cloudflare：提供 CDN 加速、HTTPS、DDoS 防护。 Nginx：反向代理用户请求，将流量分发到多个 Java 服务实例。 Docker：容器化运行 Java 服务，实现快速部署和弹性扩展。 一、Cloudflare 配置 1. 职责 全球 CDN 加速，减少用户请求延迟。 提供 HTTPS 加密，确保数据传输安全。 防火墙和 DDoS 防护，保护服务免受恶意攻击。 2. 配置步骤 登录 Cloudflare。 添加域名并设置 DNS 记录： A 记录指向 Nginx 服务器的公网 IP。 或 CNAME 指向已有的负载均衡器域名。 启用 SSL/TLS： 配置 &ldquo;Full&rdquo; 模式（需要 Nginx 服务器支持 HTTPS）。 设置缓存策略： 针对静态资源（如 JS、CSS、图片）启用动态缓存。 配置安全规则： 限制可疑 IP 的访问频率。 二、Nginx 配置 1. 职责 接收 Cloudflare 转发的流量，充当反向代理。 将请求分发到不同的 Java 服务实例，实现负载均衡。 提供 HTTPS 支持和 HTTP 压缩。 2. 配置示例 server { listen 80; server_name example.com; # 强制 HTTPS return 301 https://$host$request_uri; } server { listen 443 ssl; server_name example.com; ssl_certificate /etc/nginx/ssl/certificate.crt; ssl_certificate_key /etc/nginx/ssl/certificate.key; location / { proxy_pass http://java-service-cluster; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } upstream java-service-cluster { server 127.0.0.1:8081; server 127.0.0.1:8082; } 三、Docker 配置 1. 构建 Java 服务镜像 使用以下 Dockerfile 构建镜像：
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=../../posts/%E4%BD%BF%E7%94%A8-nginx-+-cloudflare-+-docker-%E9%83%A8%E7%BD%B2-java-%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/><link rel=stylesheet href=../../styles.css><link rel="shortcut icon" href=../../img/theme-colors/orange.png><link rel=apple-touch-icon href=../../img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Connor"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="og:title" content="使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践"><meta property="og:description" content="使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践 在生产环境中，Nginx、Cloudflare 和 Docker 是一个经典且高效的组合，特别适合 Java 服务的部署。本篇博客将详细介绍如何将这三者结合起来，构建高性能、高可用的服务架构。
架构概览 用户请求 → Cloudflare (CDN + DNS + HTTPS) → Nginx (反向代理 + 负载均衡) → Docker (Java 服务实例) → 数据库/缓存 架构组成 Cloudflare：提供 CDN 加速、HTTPS、DDoS 防护。 Nginx：反向代理用户请求，将流量分发到多个 Java 服务实例。 Docker：容器化运行 Java 服务，实现快速部署和弹性扩展。 一、Cloudflare 配置 1. 职责 全球 CDN 加速，减少用户请求延迟。 提供 HTTPS 加密，确保数据传输安全。 防火墙和 DDoS 防护，保护服务免受恶意攻击。 2. 配置步骤 登录 Cloudflare。 添加域名并设置 DNS 记录： A 记录指向 Nginx 服务器的公网 IP。 或 CNAME 指向已有的负载均衡器域名。 启用 SSL/TLS： 配置 &ldquo;Full&rdquo; 模式（需要 Nginx 服务器支持 HTTPS）。 设置缓存策略： 针对静态资源（如 JS、CSS、图片）启用动态缓存。 配置安全规则： 限制可疑 IP 的访问频率。 二、Nginx 配置 1. 职责 接收 Cloudflare 转发的流量，充当反向代理。 将请求分发到不同的 Java 服务实例，实现负载均衡。 提供 HTTPS 支持和 HTTP 压缩。 2. 配置示例 server { listen 80; server_name example.com; # 强制 HTTPS return 301 https://$host$request_uri; } server { listen 443 ssl; server_name example.com; ssl_certificate /etc/nginx/ssl/certificate.crt; ssl_certificate_key /etc/nginx/ssl/certificate.key; location / { proxy_pass http://java-service-cluster; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } upstream java-service-cluster { server 127.0.0.1:8081; server 127.0.0.1:8082; } 三、Docker 配置 1. 构建 Java 服务镜像 使用以下 Dockerfile 构建镜像：
"><meta property="og:url" content="/posts/%E4%BD%BF%E7%94%A8-nginx-+-cloudflare-+-docker-%E9%83%A8%E7%BD%B2-java-%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"><meta property="og:site_name" content="Hello World"><meta property="og:image" content="/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-12-08 05:07:43 +0000 UTC"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>康纳的记仇小本本</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=../../about>关于</a></li><li><a href=../../showcase>精选</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=../../posts/%E4%BD%BF%E7%94%A8-nginx-+-cloudflare-+-docker-%E9%83%A8%E7%BD%B2-java-%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/>使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践</a></h1><div class=post-meta><time class=post-date>2024-12-08</time><span class=post-author>Connor</span></div><div class=post-content><div><h1 id=使用-nginx--cloudflare--docker-部署-java-服务的最佳实践>使用 Nginx + Cloudflare + Docker 部署 Java 服务的最佳实践<a href=#使用-nginx--cloudflare--docker-部署-java-服务的最佳实践 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>在生产环境中，Nginx、Cloudflare 和 Docker 是一个经典且高效的组合，特别适合 Java 服务的部署。本篇博客将详细介绍如何将这三者结合起来，构建高性能、高可用的服务架构。</p><hr><h2 id=架构概览>架构概览<a href=#架构概览 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>用户请求 → Cloudflare (CDN + DNS + HTTPS) → Nginx (反向代理 + 负载均衡) → Docker (Java 服务实例) → 数据库/缓存
</span></span></code></pre></div><h3 id=架构组成>架构组成<a href=#架构组成 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li><strong>Cloudflare</strong>：提供 CDN 加速、HTTPS、DDoS 防护。</li><li><strong>Nginx</strong>：反向代理用户请求，将流量分发到多个 Java 服务实例。</li><li><strong>Docker</strong>：容器化运行 Java 服务，实现快速部署和弹性扩展。</li></ol><hr><h2 id=一cloudflare-配置>一、Cloudflare 配置<a href=#一cloudflare-配置 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=1-职责>1. 职责<a href=#1-职责 class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li>全球 CDN 加速，减少用户请求延迟。</li><li>提供 HTTPS 加密，确保数据传输安全。</li><li>防火墙和 DDoS 防护，保护服务免受恶意攻击。</li></ul><h3 id=2-配置步骤>2. 配置步骤<a href=#2-配置步骤 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>登录 <a href=https://www.cloudflare.com>Cloudflare</a>。</li><li>添加域名并设置 DNS 记录：<ul><li>A 记录指向 Nginx 服务器的公网 IP。</li><li>或 CNAME 指向已有的负载均衡器域名。</li></ul></li><li>启用 SSL/TLS：<ul><li>配置 &ldquo;Full&rdquo; 模式（需要 Nginx 服务器支持 HTTPS）。</li></ul></li><li>设置缓存策略：<ul><li>针对静态资源（如 JS、CSS、图片）启用动态缓存。</li></ul></li><li>配置安全规则：<ul><li>限制可疑 IP 的访问频率。</li></ul></li></ol><hr><h2 id=二nginx-配置>二、Nginx 配置<a href=#二nginx-配置 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=1-职责-1>1. 职责<a href=#1-职责-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li>接收 Cloudflare 转发的流量，充当反向代理。</li><li>将请求分发到不同的 Java 服务实例，实现负载均衡。</li><li>提供 HTTPS 支持和 HTTP 压缩。</li></ul><h3 id=2-配置示例>2. 配置示例<a href=#2-配置示例 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 强制 HTTPS
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/certificate.crt</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/certificate.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://java-service-cluster</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>upstream</span> <span style=color:#e6db74>java-service-cluster</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> 127.0.0.1:<span style=color:#ae81ff>8081</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> 127.0.0.1:<span style=color:#ae81ff>8082</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=三docker-配置>三、Docker 配置<a href=#三docker-配置 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=1-构建-java-服务镜像>1. 构建 Java 服务镜像<a href=#1-构建-java-服务镜像 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>使用以下 Dockerfile 构建镜像：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> openjdk:17-jdk</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> target/my-java-service.jar app.jar<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;java&#34;</span>, <span style=color:#e6db74>&#34;-jar&#34;</span>, <span style=color:#e6db74>&#34;/app.jar&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=2-使用-docker-compose-部署多实例>2. 使用 Docker Compose 部署多实例<a href=#2-使用-docker-compose-部署多实例 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>java-service1</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-java-service:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>java-service1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8081:8080&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>java-service2</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-java-service:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>java-service2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8082:8080&#34;</span>
</span></span></code></pre></div><p>启动服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><hr><h2 id=四监控与优化>四、监控与优化<a href=#四监控与优化 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=1-性能优化>1. 性能优化<a href=#1-性能优化 class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li><strong>Nginx</strong>：启用 gzip 压缩。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>gzip</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>application/json</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/javascript</span>;
</span></span></code></pre></div></li><li><strong>Java 服务</strong>：配置 JVM 参数优化内存使用。<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-Xms512m -Xmx1024m
</span></span></code></pre></div></li></ul><h3 id=2-监控>2. 监控<a href=#2-监控 class=hanchor arialabel=Anchor>&#8983;</a></h3><ul><li><strong>日志管理</strong>：<ul><li>使用 ELK（Elasticsearch + Logstash + Kibana）集中化日志分析。</li></ul></li><li><strong>性能监控</strong>：<ul><li>使用 Prometheus + Grafana 实时监控服务状态。</li></ul></li></ul><hr><h2 id=五总结>五、总结<a href=#五总结 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>通过 Nginx + Cloudflare + Docker 的组合，可以实现以下目标：</p><ol><li><strong>高性能</strong>：Cloudflare 提供全球 CDN 加速，Nginx 和 Docker 提供负载均衡与弹性扩展。</li><li><strong>高可用</strong>：通过多实例部署，保障服务的可用性。</li><li><strong>高安全性</strong>：Cloudflare 的防护能力结合 HTTPS，确保数据传输和服务安全。</li></ol><p>这种架构适合绝大多数生产环境的需求，特别是需要高性能和高安全性的场景。</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=../../posts/%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87-ec2-%E5%AE%9E%E4%BE%8B%E8%BF%9E%E6%8E%A5-amazon-rds-%E6%95%B0%E6%8D%AE%E5%BA%93/><span class=button__icon>←</span>
<span class=button__text>如何通过 EC2 实例连接 Amazon RDS 数据库</span>
</a></span><span class="button next"><a href=../../posts/%E4%BD%BF%E7%94%A8-cloudflare-%E5%92%8C-nginx-%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E5%AE%89%E5%85%A8%E7%AB%99%E7%82%B9/><span class=button__text>使用 Cloudflare 和 Nginx 构建高性能安全站点</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/mirus-ua/hugo-theme-re-terminal target=_blank>Theme</a> made by <a href=https://github.com/mirus-ua target=_blank>Mirus</a></span></div></div></footer><script type=text/javascript src=../../bundle.min.js></script></div></body></html>